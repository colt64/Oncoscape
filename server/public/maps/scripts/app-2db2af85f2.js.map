{"version":3,"sources":["scripts/app-2db2af85f2.js"],"names":["angular","module","tray","TrayController","$timeout","vm","this","trayClass","Math","random","toString","substring","iconClass","isLocked","toggle","elTray","element","elIcon","elContent","content","addClass","removeClass","attr","unbind","mouseOver","mouseOut","change","bind","$inject","directive","restrict","templateUrl","scope","caption","controller","controllerAs","bindToController","replace","transclude","tools","ToolsController","osApi","$state","$stateParams","isUndefined","datasource","go","name","route","img","copy","explore","tool","toolmenu","ToolMenuController","timelines","TimelinesController","osHistory","$scope","$window","$document","moment","d3","saveSelected","selectedIds","d3Bars","selectAll","map","p","__data__","id","length","addPatientSelection","optCohortMode","draw","dataProcessed","dataPatients","dataEvents","d3ScaleX","d3ScaleY","minZoom","selShow","selPatient","selEvent","selFields","optCohortModes","timescaleunit","timescales","timescale","features","feature","filters","filter","events","sorts","sort","align","zoom","brush","elChart","d3Chart","select","append","style","width","d3Axis","class","shape-rendering","stroke-width","stroke","fill","d3BarsSvg","d3BarsBackground","height","innerHeight","getPatientSelection","ids","zoomed","event","shiftKey","scale","translate","ch","rh","patients","dh","rowH","rowsVisible","rowOffset","abs","y","linear","range","domain","brushing","onBrushStart","sourceEvent","target","clear","call","onBrush","extent","lower","floor","upper","each","d","i","firstChild","classed","onBrushEnd","hRow","hChart","wChart","innerWidth","processData","bounds","nice","rows","data","exit","remove","enter","on","transform","selected","indexOf","e","cols","filteredEvents","PatientID","Name","fields","field","Fields","isArray","push","value","$apply","transition","color","endValue","startValue","x","round","daysToUnit","tlScale","svg","axis","orient","ticks","tickFormat","pow","behavior","processedData","patient","dead","hasOwnProperty","a","b","calcEvents","index","forEach","dateEvents","dateEvent","evt","timeFn","start","end","reduce","prev","current","patientMinMax","min","max","Infinity","status","rv","processEventData","Object","keys","v","__color","processFeatureData","processPatientData","key","val","m","mf","dateSingle","eventOrder","date","unix","eventID","endDates","startDates","sd","ed","concat","setBusy","setDataset","then","getTimelines","response","log","duration","asDays","payload","pts","eventTypes","Status","Dead","unshift","$watchGroup","$watch","onPatientSelectionChange","add","selection","resize","updateEventColor","item","test","TestController","message","datasets","getDataSetNames","survival","SurvivalController","getPatientHistoryTable","tbl","getCalculatedSurvivalCurves","r","login","SubnavController","toolsClick","cohortClick","toggleFilter","Pca3dController","THREE","animate","requestAnimationFrame","controls","update","geneSets","geneSet","toggleClass","rawData","mtx","rownames","setBusyMessage","getPCA","getGeneSetNames","getCalculatedPCA2","pc1","pc2","scores","scene","Scene","camera","PerspectiveCamera","position","z","renderer","WebGLRenderingContext","WebGLRenderer","antialias","CanvasRenderer","setPixelRatio","devicePixelRatio","setSize","domElement","sphereThree","numSphere","sphereGeometry","SphereGeometry","sphereMaterial","MeshBasicMaterial","idSphere","Mesh","datum","render","OrbitControls","addEventListener","PlsrController","$sce","_","addGeneSelection","node","toUpperCase","setSelected","xScale","yScale","xMax","yMax","d3Tooltip","deathMinFilter","deathMinValue","deathMaxFilter","deathMaxValue","survivalMinFilter","survivalMinValue","survivalMaxFilter","survivalMaxValue","frame","tip","getGeneSelection","getPLSR","getSummarizedPLSRPatientAttributes","AgeDx","Survival","onGeneSelectionChange","setScale","vectors","genes","bv","circles","cx","cy","html","pageX","pageY","modal","url","trustAsResourceUrl","delay","lines","x1","y1","x2","y2","text","text-anchor","factors","low","Number","high","getCalculatedPLSR","loadings","loadingNames","vectorNames","maxValue","debounce","PcaController","dataset","xAxis","yAxis","d3yAxis","d3xAxis","search","getCalculatedPCA","pathways","PathwaysController","cytoscape","skipSave","csChart","$","ele","startBatch","deselect","endBatch","getStyle","darkblue","red","purple","green","selector","text-valign","text-halign","shape","background-color","border-width","border-color","line-color","line-style","target-arrow-shape","target-arrow-color","display","overlay-opacity","overlay-color","font-size","border-style","source-arrow-shape","source-arrow-color","markersNetwork","linkTitle","links","center","term","len","nodes","unselect","substr","getPathway","fromJson","container","elements","maxZoom","layout","fit","cyTarget","source","osSound","beep","_beep","play","Audio","service","oncoscape","SockJS","$rootScope","$q","$log","$location","dataSource","callbacks","getDataSource","setDataSource","requestId","getRequestId","socket","protocol","host","port","debug","devel","onmessage","isDefined","cmd","callback","resolve","error","request","ds","deferred","defer","readyState","onopen","send","toJson","promise","factory","signals","_historyMax","_geneSelections","_geneSelection","_patientSelections","_patientSelection","_onPatientSelectionChange","Signal","_onGeneSelectionChange","getGeneSelections","desc","time","format","pop","setGeneSelection","dispatch","getGeneSelectionLast","getGeneSelectionNext","getPatientSelections","setPatientSelection","getPatientSelectionLast","getPatientSelectionNext","document","keypress","ctrlKey","keyCode","removeListeners","osSocket","$http","_dataSource","onDataSource","userApi","onLogin","onLogout","_user","password","authenticated","token","_domains","logout","user","req","method","username","res","success","getDomains","getUser","getUserApi","_userApi","show","hide","showFilter","slideToggle","hideFilter","dataPackage","getDataManifest","datasetName","durationFormat","getPatientHistoryDxAndSurvivalMinMax","getSampleDataFrame","getSampleCategorizationNames","getSampleCategorization","names","getMarkersNetwork","getDrugGeneInteractions","getCanonicalizePatientIDsInDataset","patientIds","getGeneSetGenes","getOncoprintDataSelection","matrixName","factorCount","attrs","title","sampleIDs","getCalculatedTimelines","getModuleModificationDate","getMrnaData","entities","getCnvData","getMutationData","getOncoprint","geneSetAndPatients","patientIdsAndGenes","oncoprint_utils","exports","sign","number","invert_array","arr","curr","next","cssClassToSelector","classes","split","join","mouseY","ifndef","offsetY","originalEvent","layerY","mouseX","offsetX","layerX","replacement","child_class","parent_class","prototype","create","constructor","makeIdCounter","counter","clamp","t","makeD3SVGElement","tag","createElementNS","appendD3SVGElement","elt","appendChild","cloneNode","spaceSVGElementsHorizontally","group","padding","d3SelectChildren","tagName","parseFloat","getBBox","textWidth","string","font","obj","css","float","white-space","visibility","appendTo","parent","parentNode","warn","str","context","console","stableSort","cmp","zipped","ind","stable_cmp","lin_interp","parseInt","g","R","G","B","isNaN","A","assert","bool","msg","oncoprint","OncoprintController","displayOncoprint","empty","errorMessage","JSON","parse","setState","processed_data","onc","Oncoprint","suppressRendering","when","data_gene_map","gene","track_id","data_gene","Date","now","addTrack","label","removable","setRuleSet","GENETIC_ALTERATION","useSameRuleSet","setTrackData","releaseRendering","click","toggleCellPadding","setZoom","allOncoLegendBlocks","allOncoLegendLabels","j","elControl","elInstructions","elLegend","cohortGene","getCohortGene","cohortPatient","getCohortPatient","optCohortGenes","get","optCohortGene","optCohortPatients","optCohortPatient","geneAndPatients","config","self","getTrackId","utils","id_order","inverted_id_order","visible_id_order","visible_inverted_id_order","hidden_ids","track_groups","track_group_sort_order","sort_direction","tracks","sort_config","type","cell_padding_on","true_cell_width","cell_width","zoomed_cell_width","trigger","SET_CELL_PADDING","getCellPadding","ceil","cell_padding","getZoom","updateZoomedCellWidth","updateZoom","SET_ZOOM","increaseZoom","decreaseZoom","getFullCellWidth","getZoomedCellWidth","getCellHeight","cell_height","getTrackHeight","track_height","getTrackPadding","track_padding","getFilteredIdOrder","data_filter_fn","track_ids","getTracks","getTrackDatum","getIdOrder","getInvertedIdOrder","getVisibleIdOrder","getVisibleInvertedIdOrder","updateVisibleIdOrder","SET_VISIBLE_ID_ORDER","setIdOrder","slice","SET_ID_ORDER","hideIds","clear_existing","showIds","getTopmostTrack","setTrackSortComparator","sort_cmp","getTrackSortComparator","getTrackSortDirection","setTrackSortDirection","dir","setTrackGroupSortOrder","order","getTrackGroupSortOrder","getTrackSortOrder","ret","getTrackGroups","group_id","setSortConfig","sortById","sortBy","identity","reverse","sortByTrack","track_id_list","cmp_list","lexicographically_ordered_cmp","id1","id2","cmp_result","_len","d1","d2","d1_undef","d2_undef","isFinite","extend","defaultTrackConfig","id_data_map","ADD_TRACK","removeTrack","track","track_group","getContainingTrackGroup","old_position","splice","REMOVE_TRACK","reference","flatten","find","grp","moveTrack","new_position","moved_tracks","MOVE_TRACK","getTrackLabel","getTrackTooltip","tooltip","setTrackTooltip","getTrackData","id_accessor","getTrackDatumIdAccessor","current_id_order","current_inverted_id_order","SET_TRACK_DATA","datum_id","getTrackDatumDataKey","datum_data_key","getTrackDatumIdKey","datum_id_key","setTrackDatumIdKey","isTrackRemovable","isTrackSortDirectionChangable","sort_direction_changable","clearData","oncoprint_events","RuleSet","oncoprint_RuleSet","defaultOncoprintConfig","legend","hiddenOncoprintConfig","pre_track_padding","undefined","CATEGORICAL_COLOR","GRADIENT_COLOR","BAR_CHART","container_selector_string","OncoprintSVGRenderer","label_font","onc_dev","ren_dev","params","target_track_id","source_track_id","toSVG","setLegendVisible","visible","FINISHED_RENDERING","CONTENT_AREA_MOUSEENTER","CONTENT_AREA_MOUSELEAVE","OncoprintRenderer","track_cell_selections","track_cells","active_rule_set_rules","toolbar_container","label_div","label_drag_div","label_container","cell_container","cell_container_node","cell_div","legend_table","document_fragment","percent_altered_max_width","getLabelFont","altered_data_percentage","cell_tooltip_html","content_area","LABEL_AREA_CONTAINER_CLASS","CELL_AREA_CONTAINER_CLASS","cell_column_highlight","COLUMN_HIGHLIGHT_CLASS","getCellAreaHeight","CELL_AREA_CLASS","cell_mouseover_div","calculateVisibleInterval","clipAndPositionCells","mouseMove","prev_track","prev_cell_index","prev_dom","column_highlight_timeout","highlighted_col_cells","qtip","my","at","viewport","window","CELL_QTIP_CLASS","border","fixed","hover_cell","dom","finish","unhover_cell","clear_and_unhover","clearTimeout","cell","margin","track_cell_tops","getTrackCellTops","closest_track_dist","POSITIVE_INFINITY","closest_track","top","dist","cell_unit","cell_index","cell_id","track_cell","setTimeout","cells","hover","getTrackButtonCSSClass","stop","fadeTo","fadeOut","rule_sets","removeTrackCells","removeTrackLabels","removeTrackButtons","computeTrackCellTops","renderLegend","renderTrackLabels","renderTrackButtons","resizeLabelDiv","resizeCellDiv","drawCells","computeAlteredDataPercentage","resizeCells","LABEL_DRAGGING_CLASS","rule_set","getRuleSet","alteredData","num_altered","percent_altered","getAlteredDataPercentage","cell_ctr_rect","getBoundingClientRect","visible_interval","scrollLeft","right","left","getVisibleInterval","cellRenderTarget","createDocumentFragment","ready","getRuleSetId","getLabelDiv","getLabelDragDiv","getCellAreaWidth","getLabelAreaWidth","getLabelAreaHeight","div","getTrackLabelCSSSelector","render_whole_labels","label_tops","getTrackLabelTops","label_area_width","percent_altered_left","label_top","label_text","getTrackLabelCSSClass","disp_label_text","max_label_length","span","dragLabel","button_class","new_btn","imgs","descs","current_sort_setting","new_width","getCellCSSClass","getTrackCellCSSClass","drawTrackCells","fragment","cell_class","track_cell_class","bound_svg","apply","force","display_all","interval_width","interval_number","cell_x","getCellXArray","id_key","prev_interval_number","new_x","disp","new_disp","exclude_from_legend","include_all","rendered","rule_set_id","active_rules","track_map","tr","label_header","getLegendLabel","legend_body_td","legend_div","getLegendDiv","first_track","last_track","all_track_tops","track_tops","group_track_tops","label_area_height","drag_bounds","getRenderedTrackHeight","$label_drag_div","new_pos","moveHandler","stopPropagation","preventDefault","mouse_y","sortedIndex","mouseUpHandler","off","one","full_labels","root","offset","text_elt","weight","size","pos","cell_elt","cell_rect","cell_dim","outline_styles","trim","toLowerCase","drawOncoprint","_state","SORT","SET_CELL_WIDTH","CELL_CLICK","CELL_MOUSEENTER","CELL_MOUSELEAVE","ONCOPRINT_MOUSEENTER","ONCOPRINT_MOUSELEAVE","SET_PRE_TRACK_PADDING","TRACK_INIT","UPDATE_RENDER_RULES","FINISHED_POSITIONING","SET_SORT_DIRECTION","oncoprint_defaults","makeGeneticAlterationComparator","distinguish_mutations","cna_key","cna_order","mut_type_key","mut_order","_order","mrna_key","rppa_key","regulation_order","cna_diff","mut_type_diff","mrna_diff","rppa_diff","genetic_alteration_config_base","default","z_index","altered","cna","AMPLIFIED","legend_label","GAINED","HOMODELETED","HEMIZYGOUSLYDELETED","mrna","UPREGULATED","DOWNREGULATED","rppa","genetic_alteration_config_nondistinct_mutations","mut_type","*","genetic_alteration_config","MISSENSE","INFRAME","TRUNC","FUSION","genetic_alteration_comparator","genetic_alteration_comparator_nondistinct_mutations","D3SVGCategoricalColorRuleSet","D3SVGRuleSet","d3_colors","addColorRule","category","colored_rect","condition","cat","getCategory","addStaticRule","makeNARuleParams","cat1","cat2","NEGATIVE_INFINITY","localeCompare","new_color","createElement","getRules","rule","rule_id","D3SVGGradientColorRuleSet","data_key","addGradientRule","data_range","color_range","na_color","proxy","numericalNaNSort","rule_map","D3SVGBarChartRuleSet","addBarChartRule","D3SVGGeneticAlterationRuleSet","dont_distinguish_mutation_color","defaults","distinguish_mutation_order","makeStaticShapeRule","rule_spec","styles","_key","_value","ANY","points","CELL","outline-color","outline-style","outline-width","new_rule","altered_rules","values","altered_data","getRule","filterData","uniq","D3SVGBarChartRule","D3SVGRule","inferred_data_range","log10","makeDatum","setUpHelperFunctions","scaled_data_range","height_helper","distance","y_function","height_function","inferDataRange","datumIsNaN","getEffectiveDataRange","showInLegend","display_data_range","num_digit_multiplier","legend_num_decimal_digits","mesh","D3SVGGradientRule","fill_function","rgb","D3SVGStaticRule","svg_ctr","f1","f2","f1_isNaN","f2_isNaN","children","getRuleId","addRule","removeRule","rule_ids","rules","sorted_rules","affected_groups","percentToPx","attr_val","attr_name","width_like","height_like","convertAttr","pt","split_pt","pt_x","pt_y","c","elts","makeRuleSet","clipping","upper_padding","track_group_separation","max_label_width","max_percent_altered_width","buffer_width","getTrackCellCtrCSSClass","new_rule_set","getTrackTops","tops","getCellX","track_order","MetadataController","colnames","dtTable","dataTable","paging","api","markers","MarkersController","cyChart","initializeViewModel","optCtxGeneShow","optCtxPatientShow","loadData","initializeStyles","initializeChart","initializeLayouts","initializeNodeColors","initializeEdgeColors","initializeEvents","initializeSearch","initializeZoom","initializeCommands","initializeHistory","chart","searchGene","geneSearchResult","matches","found","searchGeneResult","searchPatient","searchPatientResult","optInteractiveMode","optInteractiveModes","optCommandPatient","degmap","neighborhood","batchData","cbioDsName","n","open","optCommandGene","optCommands","zoomReset","zoomFit","showPatientsInCommon","geneNodes","geneNames","patientNodes","patientGeneNames","geneName","showGenesInCommon","patientGenes","showPatientEdges","hidePatientEdges","showGeneEdges","hideGeneEdges","selectConnectedGenes","selectConnectedPatients","selectPatients","selectGenes","deselectPatients","deselectGenes","invertPatientSelection","_private","invertGeneSelection","invertAll","deselectAll","hideAllEdges","optPatientLayouts","optPatientLayout","optNodeColors","optNodeColor","optEdgeColors","legandNodes","legandPatient","legandChromosomes","saveSelectedGenes","skipSaveGene","saveSelectedPatients","skipSavePatient","setSelectedGenes","selectedGeneIds","setSelectedPatients","selectedPatientIds","saveGenes","savePatients","el","hideEdgesOnViewport","hideLabelsOnViewport","textureOnViewport","motionBlur","selection-box-color","selection-box-border-color","selection-box-border-width","selection-box-opacity","geneOver","geneOut","geneClick","geneCtx","patientOver","patientOut","patientClick","patientCtx","removeAll","over","out","behaviors","showGeneCtxMenu","oe","elMenu","showPatientCtxMenu","showPatientInfo","nodeType","patientChromosomes","mutation","neighbourhood","cnl1","cnl2","cng1","cng2","mutations","hidePatientInfo","showDegreeOne","border-opacity","hideDegreeOne","showDegreeTwo","hideDegreeTwo","states","register","unregister","edge","ui","colors","state","colorMap","cnGain.1","cnLoss.1","cnGain.2","cnLoss.2","edges","sizeEle","updateEdge","stateName","sizeBdr","degree","sizeLbl","calculateSelections","selectedNodes","sums","cnt","gender","age","s","ii","updateNode","angle","cos","sin","cb","dataMarkers","hobo","locked","selectable","grabbable","edgeType","LoginController","domains","hasError","landing","LandingController","history","HistoryController","fnClearTable","fn","DataTable","ext","settings","diagnosis","diagnosisMin","diagnosisMax","survivalMin","survivalMax","diagnosisMinValue","diagnosisMaxValue","fnAddData","$on","applyFilter","o","init","help","HelpController","videos","footer","FooterController","header","HeaderController","showTools","showMenu","logoutClick","transitionTo","CompareController","DatasourceController","nameMap","DEMOdz","TCGAbrain","TCGAbrca","TCGAcoadread","TCGAgbm","TCGAhnsc","TCGAlgg","TCGAluad","TCGAlung","TCGAlusc","TCGApaad","TCGAprad","UWbrain","MSKbrain","runBlock","$exceptionHandler","onerror","fileName","lineNumber","columnNumber","Error","toState","authenticate","run","routerConfig","$stateProvider","$urlRouterProvider","template","otherwise","constant","in_min","in_max","out_min","out_max","$logProvider","debugEnabled","$templateCache","put"],"mappings":"CAAA,WACI,YAEAA,SACKC,OAAO,aACJ,YACA,YACA,UACA,aACA,aACA,SACA,aACA,YACA,eACA,iBACA,2BACA,cAKZ,WACI,YAOA,SAASC,KAqBL,QAASC,GAAeC,GAGpB,GAAIC,GAAKC,IACTD,GAAGE,UAAYC,KAAKC,SAASC,SAAS,IAAIC,UAAU,GACpDN,EAAGO,UAAYJ,KAAKC,SAASC,SAAS,IAAIC,UAAU,EAGpD,IAAIE,IAAW,CACfR,GAAGS,OAAS,WACR,GAAIC,GAASf,QAAQgB,QAAQ,IAAIX,EAAGE,WAChCU,EAASjB,QAAQgB,QAAQ,IAAIX,EAAGO,WAChCM,EAAYlB,QAAQgB,QAAQ,IAAIX,EAAGc,QAEvCN,IAAYA,EACZI,EACKG,SAASP,EAAW,UAAY,iBAChCQ,YAAYR,EAAW,gBAAkB,WAE9CE,EAAOO,KAAK,SAAUT,EAAW,OAAS,SAEtCA,GACAK,EACKG,YAAY,gCACjBN,EACKQ,OAAO,YAAaC,GACpBD,OAAO,WAAYE,GACnBJ,YAAY,kBACjBjB,EAAS,WACLC,EAAGqB,aAIPR,EACKE,SAAS,gCACdL,EACKK,SAAS,kBACTO,KAAK,YAAaH,GAClBG,KAAK,WAAYF,GACtBrB,EAAS,WACLC,EAAGqB,YAOf,IAAIF,GAAY,WACZxB,QAAQgB,QAAQ,IAAIX,EAAGE,WAClBc,YAAY,mBAEjBI,EAAW,WACXzB,QAAQgB,QAAQ,IAAIX,EAAGE,WAClBa,SAAS,mBAxEtBjB,EAAeyB,SAAW,WAA1B,IAAIC,IACAC,SAAU,IACVC,YAAa,gCACbC,OACIC,QAAS,IACTd,QAAS,IACTO,OAAQ,KAGZQ,WAAY/B,EACZgC,aAAc,KACdC,kBAAkB,EAClBC,SAAS,EACTC,YAAY,EAGhB,OAAOT,GAvBX7B,QACKC,OAAO,aACP4B,UAAU,SAAU3B,MAsF7B,WACI,YAOA,SAASqC,KAaL,QAASC,GAAgBC,EAAOC,EAAQC,GAEpC,GAAI3C,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAId,IAAIzC,GAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGkC,QACCQ,KAAM,qBACNC,MAAO,UACPC,IAAK,cACLC,KAAM,8DAENH,KAAM,YACNC,MAAO,YACPC,IAAK,gBACLC,KAAM,KAENH,KAAM,WACNC,MAAO,WACPC,IAAK,eACLC,KAAM,+EAENH,KAAM,OACNC,MAAO,OACPC,IAAK,WACLC,KAAM,0FAENH,KAAM,MACNC,MAAO,MACPC,IAAK,UACLC,KAAM,wDAENH,KAAM,WACNC,MAAO,WACPC,IAAK,eACLC,KAAM,yGAENH,KAAM,eACNC,MAAO,UACPC,IAAK,cACLC,KAAM,KAENH,KAAM,YACNC,MAAO,YACPC,IAAK,eACLC,KAAM,KAENH,KAAM,WACNC,MAAO,WACPC,IAAK,eACLC,KAAM,KAEV7C,EAAG8C,QAAU,SAASC,EAAMP,GACxBH,EAAOI,GAAGM,GACNP,WAAYA,KAnExBL,EAAgBZ,SAAW,QAAS,SAAU,eAD9C,IAAIC,IACAC,SAAU,IACVC,YAAa,kCACbG,WAAYM,EACZL,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,UAAWU,MAiF9B,WACI,YAOA,SAASc,KAiBL,QAASC,GAAmBb,EAAOC,GAG/B,GAAIlB,GAAY,WACZxB,QAAQgB,QAAQ,cACXK,YAAY,wBAGjBI,EAAW,WACXzB,QAAQgB,QAAQ,cACXI,SAAS,wBAGdL,EAASf,QAAQgB,QAAQ,aACzBD,GACKY,KAAK,YAAaH,GAClBG,KAAK,WAAYF,EAE1B,IAAIpB,GAAKC,IACTD,GAAGkC,QACCQ,KAAM,qBACNC,MAAO,UACPC,IAAK,cACLC,KAAM,8DAENH,KAAM,YACNC,MAAO,YACPC,IAAK,gBACLC,KAAM,KAENH,KAAM,WACNC,MAAO,WACPC,IAAK,eACLC,KAAM,+EAENH,KAAM,OACNC,MAAO,OACPC,IAAK,WACLC,KAAM,0FAENH,KAAM,MACNC,MAAO,MACPC,IAAK,UACLC,KAAM,wDAENH,KAAM,WACNC,MAAO,WACPC,IAAK,eACLC,KAAM,yGAENH,KAAM,eACNC,MAAO,UACPC,IAAK,cACLC,KAAM,KAENH,KAAM,YACNC,MAAO,YACPC,IAAK,cACLC,KAAM,KAENH,KAAM,WACNC,MAAO,WACPC,IAAK,eACLC,KAAM,KAEV7C,EAAG8C,QAAU,SAASC,GAClB/C,EAAGqB,SACHgB,EAAOI,GAAGM,GACNP,WAAYxC,EAAGwC,cAjF3BS,EAAmB1B,SAAW,QAAS,SAFvC,IAAIC,IACAC,SAAU,IACVC,YAAa,wCACbG,WAAYoB,EACZnB,aAAc,KACdH,OACIa,WAAY,IACZnB,OAAQ,KAEZU,kBAAkB,EAGtB,OAAOP,GAnBX7B,QACKC,OAAO,aACP4B,UAAU,aAAcwB,MAgGjC,WACI,YAOA,SAASE,KAaL,QAASC,GAAoBf,EAAOgB,EAAWf,EAAQgB,EAAQf,EAAcgB,EAASC,EAAWC,EAAQC,GAyDrG,QAASC,KACLC,EAAcC,EAAOC,UAAU,sBAAsB,GAAGC,IAAK,SAAUC,GAAK,MAAOA,GAAEC,SAASC,KACtE,GAApBN,EAAYO,SAAWP,EAAcC,EAAOC,YAAY,GAAGC,IAAK,SAAUC,GAAK,MAAOA,GAAEC,SAASC,MACrGb,EAAUe,oBAAoB,kBAAmB,mBAC7CR,GAEuB,UAAvB3D,EAAGoE,cAAc1B,MAAgB2B,IA7DzC,GAAI1E,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAKd,IAAI6B,GACAC,EACAC,EACAC,EACAC,EACAC,EAAU,EAIV3E,EAAKC,IACLD,GAAG4E,SAAU,EACb5E,EAAG6E,WACH7E,EAAG8E,SACH9E,EAAG+E,aACH/E,EAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGgF,eACHhF,EAAGoE,cACHpE,EAAGiF,cACHjF,EAAGkF,WACHlF,EAAGmF,UACHnF,EAAGoF,SACHpF,EAAGqF,QACHrF,EAAGsF,QACHtF,EAAGuF,OACHvF,EAAGwF,OACHxF,EAAGyF,MACHzF,EAAG0F,KACH1F,EAAG2F,MACH3F,EAAGgF,iBAAmBtC,KAAK,cAAcA,KAAK,WAC9C1C,EAAGoE,cAAgBpE,EAAGgF,eAAe,EAGzC,IA0BIY,GAyBAC,EAnDAC,EAAUnG,QAAQgB,QAAQ,oBAC1BoF,EAAUtC,EAAGuC,OAAO,oBAAoBC,OAAO,OAC9ChF,KAAK,KAAM,SACXiF,OAAOC,MAAM,SACdC,EAASL,EAAQE,OAAO,KACvBhF,MAAMoF,QAAQ,SACdH,OAAOI,kBAAmB,aAAaC,eAAgB,MAAOC,OAAU,OAAOC,KAAQ,SACxFC,EAAYX,EAAQE,OAAO,OAC1BhF,MAAMoF,QAAQ,aACfM,EAAmBD,EAAUT,OAAO,QACnChF,MAAMkF,MAASL,EAAQK,QAASS,OAAUtD,EAAQuD,YAAc,GAAK,GAAK,IAAI,KAC9EX,OAAOO,KAAK,YACb7C,EAAS8C,EAAUT,OAAO,KACzBhF,MAAMoF,QAAQ,SAGf1C,EAAkD,MAAnCP,EAAU0D,sBAAiC,KAAO1D,EAAU0D,sBAAsBC,IAWjGC,EAAS,WACT,IAAIvD,EAAGwD,MAAMC,SAAb,CAEA,GAAIC,GAAQxC,EAAUlB,EAAGwD,MAAME,KACrBxC,GAANwC,IAAeA,EAAQxC,EAC3B,IAAIyC,GAAW3D,EAAGwD,MAAMG,UAAU,GAE9BC,EAAK/D,EAAQuD,YAAc,GAAK,GAAK,IAAK,GAC1CS,EAAoC,GAA9BhD,EAAciD,SAASrD,OAAaiD,EAC1CK,EAAKH,EAAKC,CAEVF,GAAU,IAAGA,EAAU,GACbI,EAAVJ,IAAcA,EAAUI,GAE5B5B,EAAKwB,WAAW3D,EAAGwD,MAAMG,UAAU,GAAGA,GACtC,IAAIK,GAAQ,GAAKN,EACbO,EAAeL,EAAKI,EACpBE,EAAYxH,KAAKyH,IAAIR,EAAYK,EACnC5B,GAAMgC,EAAEpE,EAAG0D,MAAMW,SAASC,OAAO,EAAEV,IAAKW,QAAQL,EAAWA,EAAUD,KAGvE9D,EAAO3C,KAAK,YAAY,eAAemG,EAAU,YAAcD,EAAQ,OAIvEc,GAAW,EACXC,EAAe,WACVzE,EAAGwD,MAAMkB,YAAYjB,SAItBe,GAAW,GAHXxE,EAAGwD,MAAMmB,OAAOC,QAChB5E,EAAGuC,OAAO/F,MAAMqI,KAAK7E,EAAGwD,MAAMmB,UAKlCG,EAAU,WACV,GAAKN,EAAL,CACA,GAAIO,GAAS3C,EAAM2C,SACfC,EAAQtI,KAAKuI,MAAMF,EAAO,GAAG,IAC7BG,EAAQxI,KAAKuI,MAAMF,EAAO,GAAG,GACjC5E,GAAOC,UAAU,cACZ+E,KAAM,SAASC,EAAGC,GACfrF,EAAGuC,OAAO/F,KAAK8I,YAAYC,QAAQ,oBAAsBF,GAAGL,GAAYE,GAAHG,OAG7EG,EAAa,WACRhB,IACLA,GAAW,EACXxE,EAAGwD,MAAMmB,OAAOC,QAChB5E,EAAGuC,OAAO/F,MAAMqI,KAAK7E,EAAGwD,MAAMmB,QAC9B1E,MAIAW,EAAO,WAGP,GAAI6E,GAAO,GACPC,EAAS7F,EAAQuD,YAAc,GAAK,GAAK,IACzCuC,EAAS9F,EAAQ+F,WAAa,GAC9BD,GAAS,MAAMA,GAAU,KACsB,SAA/CzJ,QAAQgB,QAAQ,eAAeM,KAAK,YACpCmI,GAAU,KAGd9E,EAAgBgF,EAAY/E,EAAcvE,EAAG2F,MAAO3F,EAAG0F,MACvDjB,EAAWhB,EAAG0D,MAAMW,SAASE,OAAQ1D,EAAciF,QAASxB,OAAO,GAAIqB,EAAO,KAAKI,OACnF9E,EAAWjB,EAAG0D,MAAMW,SAASE,QAAQ,EAAG1D,EAAciD,SAASrD,SAAS6D,MAAM,EAAEoB,EAAO,IAAIK,OAC3F7E,GAAWwE,EAAO,KAAuC,GAAhC7E,EAAciD,SAASrD,QAGhD6B,EAAQ9E,MAAO2F,OAAUuC,EAAO,OAChCzC,EAAUzF,MAAO2F,OAAYuC,EAAO,GAAI,KAAMhD,MAAQiD,EAAO,OAC7DzC,EAAiB1F,MAAO2F,OAAYuC,EAAO,GAAI,KAAMhD,MAAQiD,EAAO,OACpExF,EAAO3C,KAAK,YAAY,WAAa0D,EAAU,IAG/C,IAAI8E,GAAO7F,EAAOC,UAAU,cAAc6F,KAAMpF,EAAciD,SAC1DkC,GAAKE,OAAOC,SACZH,EAAKI,QAAQ5D,OAAO,KAAKhF,MAAOoF,QAAU,aACrCyD,GAAG,YAAa,WACRrG,EAAGwD,MAAMC,UAAUtD,EAAOC,UAAU,sBAAsBmF,QAAQ,qBAAqB,KAI/F/H,MACGkF,MAASiD,EACTxC,OAAUsC,EACVa,UAAa,SAASlB,EAAGC,GAAK,MAAO,eAAmBA,EAAII,EAAO,OAEtEjD,OAAO,QACPhF,MACGoF,QAAS,eACTF,MAAS,EACTS,OAAUsC,IAIS,aAAvBlJ,EAAGoE,cAAc1B,MAAqBiB,EACtC8F,EACKb,KAAM,SAASC,GACZ,GAAImB,GAAYrG,EAAYsG,QAAQpB,EAAE5E,KAAK,EACvCiG,EAAIzG,EAAGuC,OAAO/F,KAAK8I,WACvBmB,GAAElB,QAAQ,oBAAqBgB,KAGvCP,EACKb,KAAM,WACH,GAAIsB,GAAIzG,EAAGuC,OAAO/F,KAAK8I,WACvBmB,GAAElB,QAAQ,qBAAqB,IAK/C,IAAImB,GAAOV,EAAK5F,UAAU,cAAc6F,KAAM,SAASb,GAAK,MAAOA,GAAEuB,gBACjED,GAAKR,OAAOC,SACZO,EAAKN,QAAQ5D,OAAO,QAAQhF,MAAMoF,QAAQ,UACrCyD,GAAG,YAAa,WACT,GAAI7C,GAAQzC,EAAWvE,KAAK+D,SAASC,GACrCjE,GAAG6E,WAAaoC,EAAMoD,UACtBrK,EAAG8E,SAAWmC,EAAMqD,IACpB,IAAIC,KACJ,KAAI,GAAIC,KAASvD,GAAMwD,OACM,MAArBxD,EAAMwD,OAAOD,KACD,QAAPA,GAAiB7K,QAAQ+K,QAAQzD,EAAMwD,OAAOD,KAC/CD,EAAOI,MAAOjI,KAAK,aAAckI,MAAM3D,EAAMwD,OAAOD,GAAO,KAC3DD,EAAOI,MAAOjI,KAAK,YAAakI,MAAM3D,EAAMwD,OAAOD,GAAO,MAE1DD,EAAOI,MACFjI,KAAK8H,EAAOI,MAAM3D,EAAMwD,OAAOD,KAKhDxK,GAAG4E,SAAU,EACb5E,EAAG+E,UAAYwF,EACflH,EAAOwH,WAEVf,GAAG,WAAY,WACZ9J,EAAG4E,SAAU,EACbvB,EAAOwH,WAEnBV,EAAKW,aACA5E,OAAOO,KAAO,SAASoC,GAAI,MAAOA,GAAEkC,SACpC9J,MACG2F,OAAS,SAASiC,GAAI,MAAkB,aAAVA,EAAEnG,MAA+B,QAARmG,EAAEnG,KAAgBwG,EAAK,EAAIA,GAClF/C,MAAQ,SAAS0C,GAAI,MAAoB,OAAZA,EAAEmC,SAAkB,EAAKvG,EAASoE,EAAEmC,UAAYvG,EAASoE,EAAEoC,aACxFC,EAAK,SAASrC,GAAK,MAAO1I,MAAKgL,MAAM1G,EAASoE,EAAEoC,cAChDpD,EAAK,SAASgB,GAAK,MAAmB,aAAVA,EAAEnG,KAAuBwG,EAAK,EAAI,IAGtE,IAAIkC,GAAa,SAASvC,GACtB,MAAiB,IAAb1I,KAAKyH,IAAIiB,GAAcA,EACvB1I,KAAKyH,IAAIiB,GAAG,GAAWA,EAAE,QACzB1I,KAAKyH,IAAIiB,GAAG,IAAY1I,KAAKgL,MAAQtC,EAAE,KAAQ,IAAO,GAAK,UACxD1I,KAAKgL,MAAQtC,EAAE,IAAO,IAAO,GAAK,UAEzCwC,EAAU5H,EAAG6H,IAAIC,OAChBpE,MAAM1C,GACN+G,OAAO,UACPC,MAAM,EAGPJ,GADmB,OAAnBrL,EAAGmF,UAAUzC,KACH2I,EAAQK,WAAW,SAAU7C,GACnC,MAAOuC,GAAWjL,KAAKgL,OAAS,EAAFtC,EAAM,GAAK,IAAM1I,KAAKwL,IAAI,EAAIxL,KAAKyH,IAAIiB,IAAK,GAAI,KAAK,OAG7EwC,EAAQK,WAAW,SAAU7C,GACnC,MAAOuC,GAAWvC,KAK9BhD,EAAQpC,EAAG6H,IAAIzF,QACVqF,EAAEzG,GACFoD,EAAEpE,EAAG0D,MAAMW,SAASC,OAAO,EAAEoB,IAASnB,QAAQ,EAAG1D,EAAciD,SAASrD,UACxE4F,GAAG,QAASvB,GACZuB,GAAG,aAAc5B,GACjB4B,GAAG,WAAYb,GACpBtC,EAAiB2B,KAAKzC,GAGtBc,EAAiBmD,GAAG,YAAa,WACxBrG,EAAGwD,MAAMC,UAAUtD,EAAOC,UAAU,sBAAsBmF,QAAQ,qBAAqB,KAIhGpD,EAAOnC,EAAGmI,SAAShG,OACdsF,EAAGzG,GACHoD,EAAGnD,GACH0C,WAAW,EAAE,IACbD,MAAM,EAAGxC,GACTmF,GAAG,OAAQ9C,GAChBL,EAAiB2B,KAAK1C,GAItBQ,EAAOnF,MACHoF,QAAS,gBACTF,MAAS,IACT4D,UAAW,WAAa,MAAO,gBAAmBZ,EAAO,IAAM,OAEnE/C,EAAOkC,KAAM+C,IAOb/B,EAAc,SAAUI,EAAM/D,EAAOD,GAEjC,GAAImG,KAoEJ,OAjEAA,GAAcrG,OAASxF,EAAGwF,OAAOD,OAAQ,SAASC,GAAU,MAAOA,GAAOwE,WAG1E6B,EAActE,SAAWmC,EAAKnE,OAAO,SAASuG,GAC1C,MAAoB,cAAhB9L,EAAGuF,OAAO7C,MAAsBoJ,EAAQC,MAAa,GACrC,aAAhB/L,EAAGuF,OAAO7C,MAAsBoJ,EAAQC,OACvCD,EAAQE,eAAe,KAAK/L,KAAK0F,OAClC1F,KAAKsF,QAAUtF,KAAK8G,KACc,IAA9B9G,KAAK8G,IAAIkD,QAAQ6B,EAAQ7H,KAAgB,GAE1C,GALkD,IAOzD0B,MAAQA,EAAMjD,KAAM6C,OAAiC,UAAvBvF,EAAGoE,cAAc1B,KAAiBqE,IAAMpD,IAG3D,YAAX+B,EAAKhD,KACLmJ,EAActE,SAAWsE,EAActE,SAAS7B,KAAK,SAASuG,EAAEC,GAC5D,MAAID,GAAEF,MAAMG,EAAEH,KACFE,EAAEE,WAAWzG,EAAK0G,OAAOxB,MAAMsB,EAAEC,WAAWzG,EAAK0G,OAAOxB,MAAS,EAAI,GAErEqB,EAAE,KAAQ,EAAI,IAG3BvG,GAEHmG,EAActE,SAAWsE,EAActE,SAAS7B,KAAK,SAASuG,EAAEC,GAC5D,MAAQD,GAAEE,WAAWzG,EAAK0G,OAAOxB,MAAMsB,EAAEC,WAAWzG,EAAK0G,OAAOxB,MAAS,EAAI,IAC9ElF,GAKPmG,EAActE,SAAS8E,QAAQ,SAASP,GAEpCA,EAAQ1B,eAAiB0B,EAAQQ,WAAW/G,OAAO,SAASgH,GACxD,IAAK,GAAIzD,GAAE,EAAGA,EAAE7I,KAAKiE,OAAQ4E,IACzB,GAAI7I,KAAK6I,GAAGpG,MAAM6J,EAAU7J,KAAM,OAAO,CAE7C,QAAO,GACRmJ,EAAcrG,QAEjBsG,EAAQ1B,eAAeiC,QAAQ,SAASG,GACpCA,EAAIvB,WAAajL,EAAGmF,UAAUsH,OAAOD,EAAIE,MAAQzM,MACjDuM,EAAIxB,SAAqB,MAATwB,EAAIG,IAAa3M,EAAGmF,UAAUsH,OAAOD,EAAIG,IAAM1M,MAAQ,OACvE6L,EAAQ,KAAK7L,KAAK,MAASyC,MAAMgK,SAErC/G,MAAQA,EAAOH,OAASqG,EAAcrG,SAG1CqG,EAActC,OAASsC,EAActE,SAASqF,OAAQ,SAAUC,EAAMC,GAElE,GAAIC,GAAgBD,EAAQ1C,eAAewC,OAAO,SAAUC,EAAMC,GAE9D,OACI3M,KAAK6M,IAAIF,EAAQ7B,WAAY4B,EAAK,IAClC1M,KAAK8M,IAAuB,MAAlBH,EAAQ9B,SAAkB8B,EAAQ7B,WAAa6B,EAAQ9B,SAAU6B,EAAK,OAGpFK,EAAAA,IAAWA,EAAAA,IAEf,QACI/M,KAAK6M,IAAID,EAAc,GAAIF,EAAK,IAChC1M,KAAK8M,IAAIF,EAAc,GAAIF,EAAK,OAEpCK,EAAAA,IAAWA,EAAAA,KACRrB,IAMf,WAEI,GAAId,GAAQ,SAASlC,GACjB,GAAIsE,GAAStE,EAAEnG,KACX0K,EACU,UAATD,EAAqB,UACZ,cAATA,EAAwB,UACf,cAATA,EAAwB,UACf,gBAATA,EAA0B,UACjB,WAATA,EAAqB,UACZ,WAATA,EAAqB,UACZ,cAATA,EAAwB,UACf,cAATA,EAAwB,UACf,cAATA,EAAwB,UACf,SAATA,EAAmB,UACpB,OACA,OAAOC,IAIXC,EAAmB,SAAS7H,GAC5B,MAAO8H,QAAOC,KAAK/H,GAAQ1B,IAAI,SAAS0J,GAChC,GAAIJ,IAAQ1K,KAAQ8K,EAAGxD,UAAY,EAEnC,OADAoD,GAAGrC,MAAQqC,EAAGK,QAAU1C,EAAMqC,GACvBA,KAIfM,EAAqB,SAASnG,GAC9B,MAAOA,GAAS,GAAG4E,WAAWrI,IAAI,SAAS+E,EAAGC,GAC1C,OAASpG,KAAQmG,EAAEnG,KAAM0J,MAAStD,MAItC6E,EAAqB,SAASpG,EAAUwE,GAExCxE,EAAW+F,OAAOC,KAAKhG,GAAUzD,IAAI,SAAS8J,GAC1C,GAAIC,GAAMtG,EAASqG,EAEnB,OADAC,GAAI5J,GAAK2J,EACFC,GAEX,KAAK,GAAI/E,GAAI,EAAGA,EAAIvB,EAASrD,OAAQ4E,IAAK,CAGtC,GAAI/E,GAAIwD,EAASuB,GACbgF,EAAItK,EACJuK,EAAK,aAILC,EACAjK,EAAEuI,WACD/G,OAAO,SAASsD,GACb,MAAwB,WAAjBA,EAAEoF,aAEZnK,IAAI,SAAS+E,GACV,OACI6D,MAASoB,EAAEjF,EAAEqF,KAAMH,GAAII,OACvBxB,IAAO,KACPjK,KAAQmG,EAAEnG,KACVuB,GAAK4E,EAAEuF,WAKfC,EAAWtK,EAAEuI,WACZ/G,OAAO,SAASsD,GAAK,MAAsB,QAAfA,EAAEoF,aAC9BnK,IAAI,SAAS+E,GAAI,OAAQ8D,IAAMmB,EAAEjF,EAAEqF,KAAMH,GAAII,OAAQlK,GAAK4E,EAAEuF,WAC7DE,EAAavK,EAAEuI,WACd/G,OAAO,SAASsD,GAAK,MAAsB,UAAfA,EAAEoF,aAC9BnK,IAAI,SAAS+E,GAAI,OAAQ6D,MAAQoB,EAAEjF,EAAEqF,KAAMH,GAAII,OAAOzL,KAAOmG,EAAEnG,KAAMuB,GAAK4E,EAAEuF,UACjFE,GACKjC,QAAQ,SAASkC,GAAKA,EAAG5B,IAAM0B,EAC3B9I,OAAO,SAASiJ,GAAM,MAAOA,GAAGvK,IAAIsK,EAAGtK,KAAM,GAAG0I,MAGzD5I,EAAEuI,WAAcgC,EAAWpK,OAAO,EAAKoK,EAAWG,OAAOT,GAAcA,EACvEjK,EAAEuI,WAAWD,QAAQ,SAASxD,GAC1BA,EAAEkC,MAAQA,EAAMlC,GAChB9E,EAAE,KAAK8E,EAAEnG,MAAQmG,EACL,UAARA,EAAEnG,OACFqB,EAAEgI,KAA4B,IAApBA,EAAK9B,QAAQpB,EAAE5E,OAKrC,MAAOsD,GAGXnF,GAAMsM,SAAQ,GAAM,mBACpBtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,WACjCxM,EAAMyM,eAAeD,KAAK,SAASE,GAG/B9O,EAAGkF,aACExC,KAAK,MACF+J,OAAQ,SAASoB,GACb,OAAY,EAAJA,EAAQ,GAAK,GAAK1N,KAAK4O,IAAI5O,KAAKyH,IAAS,IAAJiG,EAAU,OAAU,GAAG1N,KAAK4O,IAAI,MAEpFrM,KAAK,SACF+J,OAAQ,SAASoB,GACb,MAAOrK,GAAOwL,SAAa,IAAJnB,GAAUoB,YAG7CjP,EAAGmF,UAAYnF,EAAGkF,WAAW,GAG7BX,EAAeoJ,EAAmBmB,EAASI,QAAQC,IAAKL,EAASI,QAAQE,WAAWC,OAAOlC,OAAOmC,MAClG9K,EAAasK,EAASI,QAAQ1J,OAC9BxF,EAAGyF,MAAQiI,EAAmBnJ,GAE9BvE,EAAGsF,UACE5C,KAAK,iBACLA,KAAK,eACLA,KAAK,cAEV1C,EAAGuF,OAASvF,EAAGsF,QAAQ,EAGvB,IAAIF,GAAWsI,EAAmBnJ,EAClCa,GAASmK,SAASnD,MAAM,GAAI1J,KAAK,SACjC1C,EAAGoF,SAAYA,EACfpF,EAAGqF,QAAUrF,EAAGoF,SAAS,GACzBpF,EAAGwF,OAAS6H,EAAiByB,EAASI,QAAQE,YAG9CpP,EAAG0F,KAAO1F,EAAGyF,MAAM,GACnBzF,EAAGwF,OAAO6G,QAAQ,SAASnC,GACX,SAARA,EAAExH,OAAiBwH,EAAEF,UAAW,EAAOE,EAAEa,MAAQ,WACzC,aAARb,EAAExH,OAAmBzC,KAAK0F,MAAQuE,IACvClK,GAGHqD,EAAOmM,aAAa,aAAc,UAAW,WAAY,eAAgB,aAAcnL,GACvF1E,QAAQgB,QAAQ2C,GAAShC,KAAK,SAAU+C,GAExChB,EAAOoM,OAAO,mBAAoBpL,GAGlCjB,EAAUsM,yBAAyBC,IAAI,SAASC,GAC5CjM,EAAciM,EAAU7I,IACxB1C,MAEJjC,EAAMsM,SAAQ,UAO1B1O,EAAG6P,OAAS,WACRxL,KAEJrE,EAAG8P,iBAAmB,SAASC,GAC3BA,EAAK/F,UAAY+F,EAAK/F,SACtB+F,EAAKhF,MAASgF,EAAK,SAAYA,EAAKtC,QAAU,UAC9CpJ,KAngBRlB,EAAoB5B,SAAW,QAAS,YAAa,SAAU,SAAU,eAAgB,UAAW,YAAa,SAAU,KAH3H,IAAIC,IACAC,SAAU,IACVC,YAAa,0CACbG,WAAYsB,EACZrB,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,cAAe0B,MAkhBlC,WACI,YAOA,SAAS8M,KAaL,QAASC,GAAe7N,GAGpB,GAAIpC,GAAKC,IACTD,GAAGkQ,QAAU,SACblQ,EAAGmQ,YAEH/N,EAAMsM,SAAQ,GACdtM,EAAMgO,kBAAkBxB,KAAK,SAASE,GAElC9O,EAAGmQ,SAAWrB,EAASI,QAAQiB,SAE/B/N,EAAMsM,SAAQ,KAnBtBuB,EAAe1O,SAAW,QAJ1B,IAAIC,IACAC,SAAU,IACVC,YAAa,gCACbG,WAAYoO,EACZnO,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,SAAUwO,MAiC7B,WACI,YAOA,SAASK,KAaL,QAASC,GAAmBlO,EAAOgB,EAAWf,EAAQtC,EAAUsD,EAAQf,GAEpE,GAAI3C,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAMd,IAAIzC,GAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAG7BJ,EAAMsM,SAAQ,GACdtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,WAEI,MAAjCxL,EAAU0D,sBACV1E,EAAMmO,uBAAuBvQ,EAAGwC,YAAYoM,KAAK,SAASE,GACtDzK,EAAKyK,EAASI,QAAQsB,IAAI1M,IAAK,SAAU+E,GAAK,MAAOA,GAAE,QAG3DxE,EAAKjB,EAAU0D,sBAAsBC,OAK7C3D,EAAUsM,yBAAyBC,IAAI,SAASC,GAC5CvL,EAAKuL,EAAU7I,MAInB,IAAI1C,GAAO,SAAS0C,GAChB3E,EAAMsM,SAAQ,GACdtM,EAAMqO,4BAA4B1J,EAAK,IAAI6H,KAAK,SAAS8B,GACrD/Q,QAAQgB,QAAQ,iBAAiBM,KAAK,MAAMyP,EAAExB,SAC9C9M,EAAMsM,SAAQ,MAzC1B4B,EAAmB/O,SAAW,QAAS,YAAa,SAAU,WAAY,SAAU,eALpF,IAAIC,IACAC,SAAU,IACVC,YAAa,wCACbG,WAAYyO,EACZxO,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,aAAc6O,MA0DjC,WACI,YAQA,SAASM,KAcL,QAASC,GAAiBxO,EAAOC,GAE7B,GAAIrC,GAAKC,IACTD,GAAG+C,KAAO,WACV/C,EAAGuF,OAAS,SAEZvF,EAAG6Q,WAAa,WACZxO,EAAOI,GAAG,SACND,WAAYxC,EAAGwC,cAIvBxC,EAAG8Q,YAAc,WACb1O,EAAM2O,gBAnBdH,EAAiBrP,SAAW,QAAS,SANrC,IAAIC,IACAC,SAAU,IACVC,YAAa,oCACbM,SAAS,EACTH,WAAY+O,EACZ9O,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAjBX7B,QACKC,OAAO,aACP4B,UAAU,WAAYmP,MAsC/B,WACI,YAOA,SAAS7N,KAaL,QAASkO,GAAgB5O,EAAOC,EAAQC,EAAcvC,EAAUsD,EAAQI,EAAIwN,EAAO3N,GA0G/E,QAAS4N,KAEnBC,sBAAuBD,GACvBE,EAASC,SA3GC,GAAI1R,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAKd,IAAIzC,GAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGsR,YACHtR,EAAGuR,QAAU,KACbvR,EAAG+Q,aAAe,WACdpR,QAAQgB,QAAQ,sBAAsB6Q,YAAY,+BAClD7R,QAAQgB,QAAQ,4BAA4B6Q,YAAY,qCAE5D,IAAIC,GAGA3L,EAAUnG,QAAQgB,QAAQ,aAI9ByB,GAAMsM,SAAQ,GAAM,mBACpBtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,SAASE,GAC1C,GAAI4C,GAAM5C,EAASI,QAAQyC,SAASpM,OAAO,SAASiI,GAChD,MAAOA,GAAEvD,QAAQ,aAAe,GAGpCyH,GAAMA,EAAIA,EAAIxN,OAAS,GAAGlC,QAAQ,SAAU,IAC5CI,EAAMwP,eAAe,uBACrBxP,EAAMyP,OAAO7R,EAAGwC,WAAYkP,GAAK9C,KAAK,WAClCxM,EAAMwP,eAAe,qBACrBxP,EAAM0P,kBAAkBlD,KAAK,SAASE,GAGlC9O,EAAGsR,SAAWxC,EAASI,QACvBlP,EAAGuR,QAAUvR,EAAGsR,SAAS,GACzBjO,EAAOoM,OAAO,aAAc,WACxB4B,WAOhB,IAAIA,GAAS,WACTjP,EAAMwP,eAAe,mBACrBxP,EAAM2P,kBAAkB/R,EAAGuR,SAAS3C,KAAK,SAASE,GAC9C1M,EAAMwP,eAAe,gBACrB,IAAI1C,GAAUJ,EAASI,OACvBlP,GAAGgS,IAAMlD,EAASI,QAAQ,kBAC1BlP,EAAGiS,IAAMnD,EAASI,QAAQ,iBAC1B,IAAIgD,GAAShD,EAAQgD,OACjBnL,EAAMmI,EAAQnI,GAClB0K,GAAUS,EAAOpO,IAAI,SAAS+E,EAAGC,GAE7B,MADAD,GAAE5E,GAAK8C,EAAI+B,GACJD,GACRqG,EAAQnI,KACX1C,IACAjC,EAAMsM,SAAQ,MAIlByD,EAAQ,GAAIlB,GAAMmB,MAClBC,EAAS,GAAIpB,GAAMqB,kBAAmB,GAAIhP,EAAQ+F,WAAa/F,EAAQuD,YAAa,GAAK,IAC7FwL,GAAOE,SAASC,EAAI,EAEpB,IAAIC,GAAWnP,EAAQoP,sBAAwB,GAAIzB,GAAM0B,eAAgBC,WAAW,IAAU,GAAI3B,GAAM4B,cACxGJ,GAASK,cAAexP,EAAQyP,kBAChCN,EAASO,QAAS1P,EAAQ+F,WAAY/F,EAAQuD,aAC9Cf,EAAQG,OAAQwM,EAASQ,WAIzB,IAAI5O,GAAO,WAKP,IAAI,GAJA6O,MACAC,EAAY1B,EAAQvN,OACpBkP,EAAiB,GAAInC,GAAMoC,eAAe,GAAI,EAAG,GACjDC,EAAiB,GAAIrC,GAAMsC,mBAAmBxI,MAAO,YACjDyI,EAAW,EAAcL,EAAXK,EAAsBA,IAAW,CACnDN,EAAYM,GAAY,GAAIvC,GAAMwC,KAAKL,EAAgBE,EACvD,IAAII,GAAQjC,EAAQ+B,EACpBN,GAAYM,GAAUjB,SAASrH,EAAIwI,EAAM,GACzCR,EAAYM,GAAUjB,SAAS1K,EAAI6L,EAAM,GACzCR,EAAYM,GAAUjB,SAASC,EAAIkB,EAAM,GACzCvB,EAAMxC,IAAIuD,EAAYM,IAE1BG,KAIAA,EAAS,WAUTlB,EAASkB,OAAQxB,EAAOE,IAalCjB,EAAW,GAAIH,GAAM2C,cAAevB,EACxCjB,GAASyC,iBAAkB,SAAUF,GAGvCzC,IA3HQF,EAAgBzP,SAAW,QAAS,SAAU,eAAgB,WAAY,SAAU,KAAM,QAAS,UAPnG,IAAIC,IACAC,SAAU,IACVC,YAAa,kCACbG,WAAYmP,EACZlP,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,UAAWsB,MAiJ9B,WACI,YAOA,SAASA,KAaL,QAASgR,GAAe1R,EAAOgB,EAAWf,EAAQC,EAAcvC,EAAUsD,EAAQI,EAAID,EAAQuQ,EAAMzQ,EAAS0Q,GA6BzG,QAAStQ,KACLN,EAAU6Q,iBAAiB,OAAQ,mBAC/BlO,EAAQlC,UAAU,uBAAuB,GAAGC,IAAI,SAASoQ,GACrD,MAAOA,GAAKlQ,SAAStB,KAAKyR,iBAItC,QAASC,KACc,MAAfzQ,EACAoC,EAAQlC,UAAU,uBAAuBmF,QAAQ,sBAAsB,GAEvEjD,EAAQlC,UAAU,UAAUmF,QAAQ,qBAAsB,WACtD,MAAQrF,GAAYsG,QAAQhK,KAAK+D,SAAStB,OAAS,IAvC/D,GAAI/C,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAKd,IAII0D,GAAOS,EAAQyN,EAAQC,EAAQC,EAAMC,EAAM3O,EAJ3CE,EAAUtC,EAAGuC,OAAO,eAAeC,OAAO,OAAOhF,KAAK,KAAM,SAC5DwT,EAAYhR,EAAGuC,OAAO,QAAQC,OAAO,OAAOhF,KAAK,QAAS,wBAM1DjB,EAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAG0U,eAAiB1U,EAAG2U,cAAgB,GACvC3U,EAAG4U,eAAiB5U,EAAG6U,cAAgB,GACvC7U,EAAG8U,kBAAoB9U,EAAG+U,iBAAmB,EAC7C/U,EAAGgV,kBAAoBhV,EAAGiV,iBAAmB,EAC7CjV,EAAGsR,YACHtR,EAAGuR,QAAU,KACbvR,EAAGkV,MACHlV,EAAGmV,IAAM,IAIT,IAAIxR,GAA+C,MAAhCP,EAAUgS,mBAA8B,KAAOhS,EAAUgS,mBAAmBrO,GAuB/F3E,GAAMsM,SAAQ,GAAM,mBACpBtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,SAASE,GAC1C,GAAI4C,GAAM5C,EAASI,QAAQyC,SAASpM,OAAO,SAASiI,GAChD,MAAOA,GAAEvD,QAAQ,aAAe,GAEpCyH,GAAMA,EAAIA,EAAIxN,OAAS,GAAGlC,QAAQ,SAAU,IAC5CI,EAAMwP,eAAe,wBACrBxP,EAAMiT,QAAQrV,EAAGwC,WAAYkP,GAAK9C,KAAK,WACnCxM,EAAMwP,eAAe,qBACrBxP,EAAM0P,kBAAkBlD,KAAK,SAASE,GAGlC9O,EAAGsR,SAAWxC,EAASI,QACvBlP,EAAGuR,QAAUvR,EAAGsR,SAAS,GACzBlP,EAAMwP,eAAe,oBACrBxP,EAAMkT,qCAAqC1G,KAAK,SAASE,GAGrD,GAAII,GAAUJ,EAASI,OACvBlP,GAAG2U,cAAgBxU,KAAKuI,MAAMwG,EAAQqG,MAAM,GAAK,QACjDvV,EAAG6U,cAAgB1U,KAAKuI,MAAMwG,EAAQqG,MAAM,GAAK,QACjDvV,EAAG+U,iBAAmB5U,KAAKuI,MAAMwG,EAAQsG,SAAS,GAAK,QACvDxV,EAAGiV,iBAAmB9U,KAAKuI,MAAMwG,EAAQsG,SAAS,GAAK,QACvDnS,EAAOoM,OAAO,aAAc,WACxBzP,EAAGqR,WAIPjO,EAAUqS,sBAAsB9F,IAAI,SAASC,GACzCjM,EAAciM,EAAU7I,IACxB1D,EAAOwH,SACPuJ,cASpBpU,EAAGqR,OAAS,WAiCR,QAASqE,KACLvP,EAAQ7C,EAAQ+F,WAAa,IAC7BzC,EAAStD,EAAQuD,YAAc,IACc,QAAzClH,QAAQgB,QAAQ,SAASM,KAAK,YAAmBkF,GAAS,KAE9DJ,EACK9E,KAAK,QAAS,QACdA,KAAK,SAAU2F,GACpByN,EAAS5Q,EAAG0D,MAAMW,SACbE,SAASuM,EAAMA,IACfxM,OAAO,EAAG5B,IAAQqD,OAEvB8K,EAAS7Q,EAAG0D,MAAMW,SACbE,SAASwM,EAAMA,IACfzM,OAAOnB,EAAQ,IAAI4C,OAI5B,QAASnF,GAAKuD,EAAK+N,EAASC,GAExBrB,EAAa,GAAN3M,EACP4M,EAAa,GAAN5M,EACP8N,IAGA7P,EAAQpC,EAAG6H,IAAIzF,QACVqF,EAAEmJ,GACFxM,EAAEyM,GACFxK,GAAG,WAAY,WACZ,GAAI+L,GAAKhQ,EAAM2C,QACfzC,GAAQlC,UAAU,UACbmF,QAAQ,qBAAsB,SAASH,GACpC,MAAQA,GAAE,GAAKgN,EAAG,GAAG,IAAMhN,EAAE,GAAKgN,EAAG,GAAG,IAAMhN,EAAE,GAAKgN,EAAG,GAAG,IAAMhN,EAAE,GAAKgN,EAAG,GAAG,KAEtFpS,EAAGuC,OAAO/F,MAAM6K,aAAakE,SAAS,KACjC1G,KAAKzC,EAAM2C,SACP,EAAG,IACH,EAAG,MAEZ9E,MAGRqC,EAAQuC,KAAKzC,EAGb,IAAIiQ,GAAU/P,EAAQlC,UAAU,UAAU6F,KAAKkM,EAAO,SAAS/M,GAAK,MAAOA,IAC3EiN,GAAQjM,QACH5D,OAAO,UACPhF,MACGoF,QAAS,YACT0P,GAAe,GAAR5P,EACP6P,GAAe,GAATpP,EACN8J,EAAK,IAERxK,MAAM,eAAgB,KACtB4D,GAAG,YAAa,SAASjB,GACtB4L,EAAU3J,aACLkE,SAAS,KACT9I,MAAM,UAAW,GACtBuO,EAAUwB,KAAKpN,EAAEnG,MACZwD,MAAM,OAASzC,EAAGwD,MAAMiP,MAAM,GAAM,MACpChQ,MAAM,MAAQzC,EAAGwD,MAAMkP,MAAM,GAAM,QAE3CrM,GAAG,WAAY,WACZ2K,EAAU3J,aACLkE,SAAS,KACT9I,MAAM,UAAW,KAEzB4D,GAAG,QAAS,SAASjB,GAClBlJ,QAAQgB,QAAQ,iBAAiByV,OACjC,IAAIC,GAAM,sDAAwDxN,EAAEnG,IACpEW,GAAOwH,OAAO,WACV7K,EAAGkV,MAAQnB,EAAKuC,mBAAmBD,OAG/CP,EAAQhL,aACHkE,SAAS,KACTuH,MAAM,SAAS1N,EAAGC,GACf,MAAOA,GAAI,IAAM,MAEpB7H,KAAK,KAAM,SAAS4H,GACjB,MAAOwL,GAAOxL,EAAE,MAEnB5H,KAAK,KAAM,SAAS4H,GACjB,MAAOyL,GAAOzL,EAAE,MAEnB3C,MAAM,eAAgB,GAE1B4P,EAAQnM,OACJmB,aACAkE,SAAS,KACTuH,MAAM,SAAS1N,EAAGC,GACf,MAAOA,GAAI,IAAM,MAEpB7H,KAAK,KAAc,GAARkF,GACXlF,KAAK,KAAe,GAAT2F,GACXV,MAAM,eAAgB,KACtB0D,QAGL,IAAI4M,GAAQzQ,EAAQlC,UAAU,QAAQ6F,KAAKiM,EAC3Ca,GAAM3M,QACD5D,OAAO,QACPhF,MACGoF,QAAS,OACTE,eAAgB,EAChBkQ,GAAMpC,EAAO,GACbqC,GAAMpC,EAAO,GACbqC,GAAMtC,EAAO,GACbuC,GAAMtC,EAAO,KAEhBpO,MAAM,SAAU,SAAS2C,GACtB,MAAQA,GAAEnG,KAAKuH,QAAQ,OAAU,UAAY,YAErDuM,EAAM1L,aACDkE,SAAS,KACT/N,MACGwV,GAAMpC,EAAO,GACbqC,GAAMpC,EAAO,GACbqC,GAAM,SAASnJ,GAAK,MAAO6G,GAAO7G,EAAE,KACpCoJ,GAAM,SAASpJ,GAAK,MAAO8G,GAAO9G,EAAE,OAE5CgJ,EAAM7M,OAAOC,QAGb,IAAIiN,GAAO9Q,EAAQlC,UAAU,QAAQ6F,KAAKiM,EAC1CkB,GAAKhN,QACA5D,OAAO,QACPhF,MACGoF,QAAS,OACT6E,EAAa,GAAR/E,EACL0B,EAAc,GAATjB,EACLkQ,cAAe,SAAStJ,GAAK,MAAQA,GAAE,GAAK,EAAK,QAAU,SAE9DqJ,KAAK,SAASrJ,GAAK,MAAOA,GAAE9K,OAC5BwD,OACGO,KAAQ,QACRqQ,cAAe,WAGvBD,EAAK/L,aACAkE,SAAS,KACT/N,MACGiK,EAAK,SAASsC,GAAK,MAAO6G,GAAO7G,EAAE,KACnC3F,EAAK,SAAS2F,GAAK,MAAO8G,GAAO9G,EAAE,OAG3CqJ,EAAKlN,OAAOC,SACZwK,IApLJhS,EAAMwP,eAAe,mBAIrB,IAAImF,KACArU,KAAM,WACNsU,IAAoC,OAA/BC,OAAOjX,EAAG8U,mBACfoC,KAAqC,OAA/BD,OAAOjX,EAAGgV,qBAEhBtS,KAAM,QACNsU,IAAiC,OAA5BC,OAAOjX,EAAG0U,gBACfwC,KAAkC,OAA5BD,OAAOjX,EAAG4U,iBAGpBxS,GAAM+U,kBAAkBnX,EAAGuR,QAASwF,GAASnI,KAAK,SAASE,GACvD1M,EAAMwP,eAAe,iBAGrB,IAAI1C,GAAUJ,EAASI,QACnB0G,EAAQ1G,EAAQkI,SAAStT,IAAI,SAASiM,EAAM3D,GAE5C,MADA2D,GAAKrN,KAAOzC,KAAKmM,GACV2D,GACRb,EAAQmI,cACP1B,EAAUzG,EAAQyG,QAAQ7R,IAAI,SAASiM,EAAM3D,GAE7C,MADA2D,GAAKrN,KAAOzC,KAAKmM,GACV2D,GACRb,EAAQoI,aACP1P,EAAyB,IAAnBsH,EAAQqI,QAClBlT,GAAKuD,EAAK+N,EAASC,GACnBxT,EAAMsM,SAAQ,KA0JlB1O,EAAG6P,OAAS,WACR6F,IAEA3P,EAAQlC,UAAU,UACb5C,MACG8U,GAAM,SAASlN,GAAK,MAAOwL,GAAOxL,EAAE,KACpCmN,GAAM,SAASnN,GAAK,MAAOyL,GAAOzL,EAAE,OAG5C9C,EAAQlC,UAAU,QACd5C,MACIiK,EAAK,SAASsC,GAAK,MAAO6G,GAAO7G,EAAE,KACnC3F,EAAK,SAAS2F,GAAK,MAAO8G,GAAO9G,EAAE,OAG3CzH,EAAQlC,UAAU,QACb5C,MACGwV,GAAMpC,EAAO,GACbqC,GAAMpC,EAAO,GACbqC,GAAM,SAASnJ,GAAK,MAAO6G,GAAO7G,EAAE,KACpCoJ,GAAM,SAASpJ,GAAK,MAAO8G,GAAO9G,EAAE,QAKhD7N,QAAQgB,QAAQ2C,GAAShC,KAAK,SAC1B0S,EAAEwD,SAASxX,EAAG6P,OAAQ,OAhTlCiE,EAAevS,SAAW,QAAS,YAAa,SAAU,eAAgB,WAAY,SAAU,KAAM,SAAU,OAAQ,UAAW,IARnI,IAAIC,IACAC,SAAU,IACVC,YAAa,gCACbG,WAAYiS,EACZhS,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,SAAUsB,MAqU7B,WACI,YAOA,SAASA,KAaL,QAAS2U,GAAcrV,EAAOgB,EAAWf,EAAQC,EAAcvC,EAAUsD,EAAQI,EAAID,EAAQF,EAAS0Q,GA0BlG,QAAStQ,KACLN,EAAUe,oBAAoB,MAAO,mBACjC4B,EAAQlC,UAAU,sBAAsB,GAAGC,IAAI,SAASoQ,GACpD,MAAOA,GAAKlQ,SAASC,GAAGkQ,iBAIpC,QAASC,KACc,MAAfzQ,EACAoC,EAAQlC,UAAU,sBAAsBmF,QAAQ,qBAAqB,GAErEjD,EAAQlC,UAAU,UAAUmF,QAAQ,oBAAqB,WACrD,MAAQrF,GAAYsG,QAAQhK,KAAK+D,SAASC,KAAO,IA2D7D,QAASyR,KACLvP,EAAQ7C,EAAQ+F,WAAa,IAC7BzC,EAAStD,EAAQuD,YAAc,IACgB,QAA3ClH,QAAQgB,QAAQ,SAASM,KAAK,YAAqBkF,GAAS,KAEhEJ,EACK9E,KAAK,QAAS,QACdA,KAAK,SAAU2F,GACpByN,EAAS5Q,EAAG0D,MAAMW,SACbE,SAASuM,EAAMA,IACfxM,OAAO,EAAG5B,IAAQqD,OAEvB8K,EAAS7Q,EAAG0D,MAAMW,SACbE,SAASwM,EAAMA,IACfzM,OAAOnB,EAAQ,IAAI4C,OAI5B,QAASnF,KAEL,GAEI4I,GAAKD,EAFL0K,EAAUjG,CAGdxE,GAAM9M,KAAKyH,IAAInE,EAAGwJ,IAAIyK,EAAS,SAAS7O,GACpC,OAAQA,EAAE,MAEdmE,EAAM7M,KAAKyH,IAAInE,EAAGuJ,IAAI0K,EAAS,SAAS7O,GACpC,OAAQA,EAAE,MAEd0L,EAAmC,KAA1BtH,EAAMD,EAAOC,EAAMD,GAC5BC,EAAM9M,KAAKyH,IAAInE,EAAGwJ,IAAIyK,EAAS,SAAS7O,GACpC,OAAQA,EAAE,MAEdmE,EAAM7M,KAAKyH,IAAInE,EAAGuJ,IAAI0K,EAAS,SAAS7O,GACpC,OAAQA,EAAE,MAEd2L,EAAmC,KAA1BvH,EAAMD,EAAOC,EAAMD,GAE5B0I,IAEAiC,EAAQlU,EAAG6H,IAAIC,OACVpE,MAAMkN,GACN7I,OAAO,OACPC,MAAM,GAEXmM,EAAQnU,EAAG6H,IAAIC,OACVpE,MAAMmN,GACN9I,OAAO,QACPC,MAAM,EAGX,IAAI5F,GAAQpC,EAAG6H,IAAIzF,QACdqF,EAAEmJ,GACFxM,EAAEyM,GACFxK,GAAG,WAAY,WACZ,GAAI+L,GAAKhQ,EAAM2C,QACfzC,GAAQlC,UAAU,UACbmF,QAAQ,oBAAqB,SAASH,GACnC,MAAQA,GAAE,GAAKgN,EAAG,GAAG,IAAMhN,EAAE,GAAKgN,EAAG,GAAG,IAAMhN,EAAE,GAAKgN,EAAG,GAAG,IAAMhN,EAAE,GAAKgN,EAAG,GAAG,KAEtFpS,EAAGuC,OAAO/F,MAAM6K,aAAakE,SAAS,KACjC1G,KAAKzC,EAAM2C,SACP,EAAG,IACH,EAAG,MAEZ9E,KAGRqC,GAAQuC,KAAKzC,EAEb,IAAIiQ,GAAU/P,EAAQlC,UAAU,UAAU6F,KAAK+H,EAAS,SAAS5I,GAC7D,MAAOA,IAGXiN,GAAQjM,QACH5D,OAAO,UACPhF,MACGoF,QAAS,WACT0P,GAAc,GAAR5P,EACN6P,GAAe,GAATpP,EACN8J,EAAK,IAERxK,MAAM,eAAgB,KACtB4D,GAAG,YAAa,SAASjB,GACtB4L,EAAU3J,aACLkE,SAAS,KACT9I,MAAM,UAAW,GACtBuO,EAAUwB,KAAKpN,EAAE5E,IACZiC,MAAM,OAASzC,EAAGwD,MAAMiP,MAAQ,GAAM,MACtChQ,MAAM,MAAQzC,EAAGwD,MAAMkP,MAAQ,EAAK,QAE5CrM,GAAG,WAAY,WACZ2K,EAAU3J,aACLkE,SAAS,KACT9I,MAAM,UAAW,KAEzB4E,aACAkE,SAAS,KACTuH,MAAM,SAAS1N,EAAGC,GACf,MAAOA,GAAI,IAAM,MAEpB7H,KAAK,KAAM,SAAS4H,GACjB,MAAOwL,GAAOxL,EAAE,MAEnB5H,KAAK,KAAM,SAAS4H,GACjB,MAAOyL,GAAOzL,EAAE,MAEnB3C,MAAM,eAAgB,GAE3B4P,EAAQnM,OACHmB,aACAkE,SAAS,KACTuH,MAAM,SAAS1N,EAAGC,GACf,MAAOA,GAAI,IAAM,MAEpB7H,KAAK,KAAc,GAARkF,GACXlF,KAAK,KAAe,GAAT2F,GACXV,MAAM,eAAgB,KACtB0D,SAGLiO,EACK5W,KAAK,QAAS,QACdA,KAAK,YAAa,gBAAkBqT,EAAO,GAAK,KAChDhM,KAAKqP,GACL1R,OAAO,QACP4Q,KAAK,OAEViB,EACK7W,KAAK,QAAS,QACdA,KAAK,YAAa,aAAeoT,EAAO,GAAK,QAC7C/L,KAAKsP,GACL3R,OAAO,QACPhF,KAAK,IAAK,IACVA,KAAK,KAAM,SACX4V,KAAK,OAEVzC,IAxOJ,GAAIzU,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAKd,IAMI0D,GAAOS,EAAQyN,EAAQC,EAAQC,EAAMC,EAAMmD,EAAOC,EAClDnG,EAPA1L,EAAUtC,EAAGuC,OAAO,cAAcC,OAAO,OAAOhF,KAAK,KAAM,SAC3D6W,EAAU/R,EAAQE,OAAO,KACzB4R,EAAU9R,EAAQE,OAAO,KACzBwO,EAAYhR,EAAGuC,OAAO,QAAQC,OAAO,OAAOhF,KAAK,QAAS,uBAO1DjB,EAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGsR,YACHtR,EAAGuR,QAAU,KACbvR,EAAG+X,OAAS,EAGZ,IAAIpU,GAAkD,MAAnCP,EAAU0D,sBAAiC,KAAO1D,EAAU0D,sBAAsBC,GAmBrG3E,GAAMsM,SAAQ,GAAM,mBACpBtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,SAASE,GAC1C,GAAI4C,GAAM5C,EAASI,QAAQyC,SAASpM,OAAO,SAASiI,GAChD,MAAOA,GAAEvD,QAAQ,aAAe,GAGpCyH,GAAMA,EAAIA,EAAIxN,OAAS,GAAGlC,QAAQ,SAAU,IAC5CI,EAAMwP,eAAe,uBACrBxP,EAAMyP,OAAO7R,EAAGwC,WAAYkP,GAAK9C,KAAK,WAElCxM,EAAMwP,eAAe,qBACrBxP,EAAM0P,kBAAkBlD,KAAK,SAASE,GAGlC9O,EAAGsR,SAAWxC,EAASI,QACvBlP,EAAGsR,SAAS/B,QAAQ,OACpBvP,EAAGuR,QAAUvR,EAAGsR,SAAS,GAEzBjO,EAAOoM,OAAO,aAAc,WACxB4B,MAIJjO,EAAUsM,yBAAyBC,IAAI,SAASC,GAC5CjM,EAAciM,EAAU7I,IACxB/G,EAAG+X,OAAS,GACZ1U,EAAOwH,SACPuJ,WAOhB,IAAI/C,GAAS,WACTjP,EAAMwP,eAAe,mBACrBxP,EAAM4V,iBAA8B,OAAZhY,EAAGuR,QAAkB,KAAOvR,EAAGuR,SAAS3C,KAAK,SAASE,GAC1E1M,EAAMwP,eAAe,gBACrB,IAAI1C,GAAUJ,EAASI,OACvBlP,GAAGgS,IAAM7R,KAAKgL,MAA2C,IAArC2D,EAASI,QAAQ,mBACrClP,EAAGiS,IAAM9R,KAAKgL,MAA2C,IAArC2D,EAASI,QAAQ,kBAErC,IAAIgD,GAAShD,EAAQgD,OACjBnL,EAAMmI,EAAQnI,GAClB0K,GAAUS,EAAOpO,IAAI,SAAS+E,EAAGC,GAE7B,MADAD,GAAE5E,GAAK8C,EAAI+B,GACJD,GACRqG,EAAQnI,KACX1C,IACAjC,EAAMsM,SAAQ,KAgJtB1O,GAAG6P,OAAS,WACR6F,IACAiC,EAAMxQ,MAAMkN,GACZuD,EAAMzQ,MAAMmN,GACZuD,EAAQ5W,KAAK,YAAa,gBAAkBqT,EAAO,GAAK,KAAKhM,KAAKqP,GAClEG,EAAQ7W,KAAK,YAAa,aAAeoT,EAAO,GAAK,QAAQ/L,KAAKsP,GAClE7R,EAAQlC,UAAU,UACb5C,KAAK,KAAM,SAAS4H,GACjB,MAAOwL,GAAOxL,EAAE,MAEnB5H,KAAK,KAAM,SAAS4H,GACjB,MAAOyL,GAAOzL,EAAE,OAK5BlJ,QAAQgB,QAAQ2C,GAAShC,KAAK,SAC1B0S,EAAEwD,SAASxX,EAAG6P,OAAQ,MAhQ9B4H,EAAclW,SAAW,QAAS,YAAa,SAAU,eAAgB,WAAY,SAAU,KAAM,SAAU,UAAW,IAT1H,IAAIC,IACAC,SAAU,IACVC,YAAa,8BACbG,WAAY4V,EACZ3V,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,QAASsB,MAqR5B,WACI,YAOA,SAASmV,KAaL,QAASC,GAAmB9V,EAAOgB,EAAWf,EAAQC,EAAce,EAAQ0Q,EAAMzQ,EAASE,EAAQ2U,EAAWnE,GAgB1G,QAAStQ,KAEL,GAAI0U,EAA8B,YAAlBA,GAAW,EAC3B,IAAIrR,GAAMsR,EAAQC,EAAE,kCAAkCxU,IAAI,SAASyU,GAAM,MAAOA,GAAI7O,OAAOzF,GAAGkQ,eAC9F/Q,GAAU6Q,iBAAiB,WAAY,mBAAoBlN,GAE/D,QAASqN,KAELgE,GAAW,EACXC,EAAQG,aACW,MAAf7U,EACA0U,EAAQC,EAAE,kCACLjM,QAAS,SAASkM,GACfA,EAAIE,aAGZJ,EAAQC,EAAE,yBACLjM,QAAS,SAASkM,GACfA,EAA8B,IAAxBtY,KAAKgK,QAAQsO,EAAItU,MAAa,WAAa,aAClDN,GAEX0U,EAAQK,WA0HZ,QAASC,KACL,GAAIC,GAAW,mBACXC,EAAM,MACNC,EAAS,kBACTC,EAAQ,OACZ,SACQC,SAAY,OACZ9S,OACIpF,QAAW,cACXmY,cAAe,SACfC,cAAe,SACfC,MAAS,UACThT,MAAS,OACTS,OAAU,OACVmE,MAAS6N,EACTQ,mBAAoB,qBACpBC,eAAgB,MAChBC,eAAgBV,KAIpBI,SAAY,OACZ9S,OACIC,MAAS,MACToT,aAAcX,EACdY,aAAc,WAKlBR,SAAY,4EACZ9S,OACIpF,QAAW,GACXsY,mBAAoB,QACpBD,MAAS,oBAMbH,SAAY,oEACZ9S,OACIqT,aAAcR,EACdU,qBAAsB,WACtBC,qBAAsBX,KAK1BC,SAAY,8DACZ9S,OACIqT,aAAcV,EACdY,qBAAsB,MACtBC,qBAAsBb,KAK1BG,SAAY,0BACZ9S,OACIqT,aAAcR,KAKlBC,SAAY,4BACZ9S,OACIyT,QAAW,UAGfX,SAAY,2BACZ9S,WAEA8S,SAAY,iCACZ9S,OACI0T,kBAAmB,MACnBC,gBAAiB,SAMrBb,SAAY,uBACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,qBACpBE,eAAgB,QAChBD,eAAgB,MAChBS,YAAa,OACbX,MAAS,iBACThT,MAAS,OACTS,OAAU,WAGdoS,SAAY,0BACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,qBACpBD,MAAS,UACThT,MAAS,QACTS,OAAU,QACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,yBACZ9S,OACIpF,QAAW,GACXsY,mBAAoB,qBACpBD,MAAS,UACThT,MAAS,QACTS,OAAU,QACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,wBACZ9S,OACIpF,QAAW,GACXsY,mBAAoB,qBACpBD,MAAS,UACThT,MAAS,QACTS,OAAU,QACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,MAChBU,eAAgB,YAGpBf,SAAY,0BACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,qBACpBD,MAAS,UACThT,MAAS,QACTS,OAAU,QACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,2BACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,oBACpBD,MAAS,UACThT,MAAS,OACTS,OAAU,QACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,uBACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,oBACpBD,MAAS,UACThT,MAAS,OACTS,OAAU,OACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,2BACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,qBACpBD,MAAS,iBACThT,MAAS,QACTS,OAAU,OACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,sBACZ9S,OACIpF,QAAW,cACXsY,mBAAoB,oBACpBD,MAAS,UACThT,MAAS,QACTS,OAAU,OACVkT,YAAa,OACbR,eAAgB,QAChBD,eAAgB,SAGpBL,SAAY,+BACZ9S,OACIpF,QAAW,cACXqY,MAAS,iBACTW,YAAa,OACbR,eAAgB,MAChBD,eAAgB,SAGpBL,SAAY,gBACZ9S,OACI2T,gBAAiB,OACjBD,kBAAmB,SAGvBZ,SAAY,4BACZ9S,OACIC,MAAS,SAGb6S,SAAY,0BACZ9S,OACIqT,aAAcT,KAGlBE,SAAY,4BACZ9S,OACIqT,aAAc,MACdpT,MAAS,MACTqT,aAAc,SACdC,qBAAsB,WACtBC,qBAAsB,WAG1BV,SAAY,0BACZ9S,OACIqT,aAAc,QACdpT,MAAS,MACTqT,aAAc,SACdC,qBAAsB,WACtBO,qBAAsB,WACtBN,qBAAsB,QACtBO,qBAAsB,SAG1BjB,SAAY,8BACZ9S,OACIqT,aAAc,QACdpT,MAAS,MACTqT,aAAc,WAGlBR,SAAY,8BACZ9S,OACIqT,aAAc,QACdpT,MAAS,SAGb6S,SAAY,8BACZ9S,OACIqT,aAAc,MACdpT,MAAS,SAzZzB,GAAIxG,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAGd,IAAIyX,GAKA7B,EAJArY,EAAKC,KAGL6F,EAAUnG,QAAQgB,QAAQ,cAI1ByX,GAAW,EACXzU,EAA+C,MAAhCP,EAAUgS,mBAA8B,KAAOhS,EAAUgS,mBAAmBrO,GAyB/F/G,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAG+X,OAAS,GACZ/X,EAAGkV,MACHlV,EAAGmV,IAAM,KACTnV,EAAGma,UAAY,GACfna,EAAGoa,SAEHpa,EAAG6P,OAAS,WACR,GAAI1J,GAAQ7C,EAAQ+F,UAChBlD,GAAQ,MAAMA,GAAS,KACkB,QAAzCxG,QAAQgB,QAAQ,SAASM,KAAK,YAAmBkF,GAAS,KAC9DL,EAAQK,MAAOA,GACfL,EAAQc,OAAOtD,EAAQuD,YAAc,IACjCwR,IACAA,EAAQxI,SACRwI,EAAQgC,WAKhB1a,QAAQgB,QAAQ2C,GAAShC,KAAK,SAC1B0S,EAAEwD,SAASxX,EAAG6P,OAAQ,MAG1BxM,EAAOoM,OAAO,YAAa,WACvB,IAAI9P,QAAQ4C,YAAY8V,GAAxB,CACA,GAAIiC,GAAOta,EAAG+X,OAAO5D,cACjBoG,EAAMD,EAAKpW,MACfmU,GAAQG,aACRH,EAAQmC,QAAQ1W,IAAI,SAASyU,GACd,GAAPgC,EACAhC,EAAIkC,WACGlC,EAAItX,KAAK,QAAQyZ,OAAO,EAAGH,KAASD,EAC3C/B,EAAIvS,SAEJuS,EAAIkC,aAGZpC,EAAQK,cAIZtW,EAAMsM,SAAQ,GACdtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,WAEjCxM,EAAMuY,aAAa/L,KAAK,SAASE,GAE7BoL,EAAiBva,QAAQib,SAAS9L,EAASI,SAC3CmJ,EAAUF,GACF0C,UAAW/U,EACXgV,SAAUZ,EAAeY,SACzB5U,MAAOyS,IACPhU,QAAS,GACToW,QAAS,EACTC,QACItY,KAAM,SACNuY,KAAK,KAGZnR,GAAG,SAAU,OAAQkK,EAAEwD,SAAS9T,EAAc,MAC9CoG,GAAG,QAAS,OAAQ,cAQpBA,GAAG,QAAS,OAAQ,cAelBA,GAAG,YAAa,OAAQ,SAASI,GAChC7G,EAAOwH,OAAO,WACV7K,EAAGmV,IAAMjL,EAAEgR,SAASxR,OAAOyR,OAAS,aAGxCjR,EAAEgR,SAAShV,OACPC,MAAS,UAEd2D,GAAG,WAAY,OAAQ,SAASI,GAC/B7G,EAAOwH,OAAO,WACV7K,EAAGmV,IAAM,OAEbjL,EAAEgR,SAAShV,OACPC,MAAS,UAEd2D,GAAG,YAAa,OAAQ,SAASI,GAChC7G,EAAOwH,OAAO,WACV7K,EAAGmV,IAAMjL,EAAEgR,SAASxR,OAAOhH,KAAO,iBAEvCoH,GAAG,WAAY,OAAQ,WACtBzG,EAAOwH,OAAO,WACV7K,EAAGmV,IAAM,SAKrB/R,EAAUqS,sBAAsB9F,IAAI,SAASC,GACzCjM,EAAciM,EAAU7I;AACxBqN,MAEJA,IACAhS,EAAMsM,SAAQ,OA3J1BwJ,EAAmB3W,SAAW,QAAS,YAAa,SAAU,eAAgB,SAAU,OAAQ,UAAW,SAAU,YAAa,IAVlI,IAAIC,IACAC,SAAU,IACVC,YAAa,wCACbG,WAAYqW,EACZpW,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,aAAcyW,MAqbjC,WACI,YAOA,SAASmD,KAGL,QAASC,KAASC,EAAMC,OADxB,GAAID,GAAQ,GAAIE,OAAM,y/HAGtB,QACIH,KAAMA,GAXd1b,QACKC,OAAO,aACP6b,QAAQ,UAAWL,MAc3B,WACG,YAOA,SAASM,GAAUC,EAAQC,EAAYC,EAAIC,EAAMC,GAG7C,GACIC,GADAC,KAEAC,EAAgB,WAChB,MAAOF,IAEPG,EAAgB,SAASvR,GACzBoR,EAAapR,GAIbwR,EAAY,EACZC,EAAe,WAEf,MADe,OAAXD,IAAiBA,EAAY,GAC1BA,KAIPE,EAAS,GAAIX,GACbI,EAAUQ,WAAW,MAAMR,EAAUS,OAAO,KAAyB,QAAlBT,EAAUU,OAAkB,GAAKV,EAAUU,QAAS,aAAa,IAEhHC,OAAS,EACTC,OAAS,GAKjBL,GAAOM,UAAY,SAAS3V,GACxB,GAAIyC,GAAO/J,QAAQib,SAAS3T,EAAMyC,KAClC,IAAI/J,QAAQkd,UAAUZ,EAAUvS,EAAKoT,MAAO,CACxC,GAAIC,GAAWd,EAAUvS,EAAKoT,WACvBb,GAAUvS,EAAKoT,KACtBC,EAASC,QAAQtT,OAGjBoS,GAAKmB,MAAM,wBAAyBvT,GAK5C,IAAIwT,GAAU,SAASA,GAGnBA,EAAQH,SAAWV,IACnBa,EAAQ/P,OAAS,UACjB+P,EAAQhO,QAAUgO,EAAQhO,SAAW,GACrCgO,EAAQC,GAAKjB,GAGb,IAAIkB,GAAWvB,EAAGwB,OAalB,OAZApB,GAAUiB,EAAQH,UAAYK,EAGN,IAApBd,EAAOgB,WACPhB,EAAOiB,OAAS,WACZjB,EAAOkB,KAAK7d,QAAQ8d,OAAOP,KAG/BZ,EAAOkB,KAAK7d,QAAQ8d,OAAOP,IAIxBE,EAASM,QAAQ9O,KAAK,SAASE,GAElC,MADAoO,GAAQpO,SAAWA,EACZA,IAKf,QACIoO,QAASA,EACTf,cAAeA,GAnEvBT,EAAUna,SAAW,SAAU,aAAc,KAAM,OAAQ,aAX3D5B,QACKC,OAAO,aACP+d,QAAQ,WAAYjC,MAiF7B,WACI,YAOA,SAAStY,GAAUI,EAAQoa,EAASxC,GAEhC,GAAIyC,GAAc,GACdC,KACAC,EAAiB,KACjBC,KACAC,EAAoB,KACpBC,EAA4B,GAAIN,GAAQO,OACxCC,EAAyB,GAAIR,GAAQO,OAErC9V,EAAQ,WACRyV,KACAC,EAAiB,KACjBC,KACAC,EAAoB,MAIpBI,EAAoB,WACpB,MAAOP,IAEP7J,EAAmB,SAASlR,EAAMub,EAAMvX,GACxC,GAAI+G,GAAItK,IACJoM,GAAa7M,KAAKA,EAAMub,KAAKA,EAAMvX,IAAIA,EAAKmH,KAAKJ,EAAEK,OAAQoQ,KAAKzQ,EAAE0Q,OAAO,QAC7ET,GAAiBnO,EACjBkO,EAAgBvO,QAAQK,GACpBkO,EAAgB5Z,OAAO2Z,GAAaC,EAAgBW,OAExDC,EAAmB,SAAS9O,GAC5BmO,EAAiBnO,EACjBwO,EAAuBO,SAAS/O,IAEhCwF,EAAmB,WACnB,MAAO2I,IAEPa,EAAuB,WACvB,GAAI9V,GAAIgV,EAAgB7T,QAAQ8T,GAAkB,CAClD,OAAM,GAAFjV,GACAsS,EAAQC,OACD,MAEX0C,EAAiBD,EAAgBhV,IAGjC+V,EAAuB,WACvB,GAAI/V,GAAIgV,EAAgB7T,QAAQ8T,GAAkB,CAClD,OAAIjV,IAAGgV,EAAgB5Z,QACnBkX,EAAQC,OACD,MAEX0C,EAAiBD,EAAgBhV,IAMjCgW,EAAuB,WACvB,MAAOd,IAEP7Z,EAAsB,SAASpB,EAAMub,EAAMvX,GAC3C,GAAI+G,GAAItK,IACJoM,GAAa7M,KAAKA,EAAMub,KAAKA,EAAMvX,IAAIA,EAAKmH,KAAKJ,EAAEK,OAAQoQ,KAAKzQ,EAAE0Q,OAAO,QAC7EP,GAAoBrO,EACpBoO,EAAmBzO,QAAQK,GACvBoO,EAAmB9Z,OAAO2Z,GAAaG,EAAmBS,OAE9DM,EAAsB,SAASnP,GAC/BqO,EAAoBrO,EACpBsO,EAA0BS,SAAS/O,IAEnC9I,EAAsB,WACtB,MAAOmX,IAEPe,EAA0B,WAC1B,GAAIlW,GAAIkV,EAAmB/T,QAAQgU,GAAqB,CACxD,OAAM,GAAFnV,GACAsS,EAAQC,OACD,MAEX4C,EAAoBD,EAAmBlV,IAGvCmW,EAA0B,WAC1B,GAAInW,GAAIkV,EAAmB/T,QAAQgU,GAAqB,CACxD,OAAInV,IAAGkV,EAAmB9Z,QACtBkX,EAAQC,OACD,MAEX4C,EAAoBD,EAAmBlV,GAI3CnJ,SAAQgB,QAAQue,UAAUC,SAAS,SAASjV,GACxC,GAAI0F,EACJ,IAAK1F,EAAEkV,QACP,OAAQlV,EAAEmV,SAEN,IAAK,IACDzP,EAAYgP,IACG,MAAXhP,GAAiBwO,EAAuBO,SAAS/O,EACrD,MACJ,KAAK,IACDA,EAAYiP,IACG,MAAXjP,GAAiBwO,EAAuBO,SAAS/O,EACrD,MACJ,KAAK,IACDA,EAAYoP,IACG,MAAXpP,GAAiBsO,EAA0BS,SAAS/O,EACxD,MACJ,KAAK,IACDA,EAAYqP,IACG,MAAXrP,GAAiBsO,EAA0BS,SAAS/O,KAIpE,IAAI0P,GAAkB,YAItB,QAEI5P,yBAA0BwO,EAC1BzI,sBAAuB2I,EAEvBnK,iBAAkBA,EAClByK,iBAAkBA,EAClBtJ,iBAAkBA,EAClBiJ,kBAAmBA,EACnBO,qBAAsBA,EACtBC,qBAAsBA,EAEtB1a,oBAAqBA,EACrB4a,oBAAqBA,EACrBjY,oBAAqBA,EACrBgY,qBAAsBA,EACtBE,wBAAyBA,EACzBC,wBAAyBA,EAEzBK,gBAAiBA,EACjBjX,MAAOA,GApIfjF,EAAU7B,SAAW,SAAU,UAAW,WAZ1C5B,QACKC,OAAO,aACP6b,QAAQ,YAAarY,MAkJ9B,WACE,gBAuBF,WACI,YAOA,SAASsY,GAAU6D,EAAUC,EAAO5B,EAAS7B,GAIzC,QAASG,KAAiB,MAAOuD,GACjC,QAAStD,GAAcvR,GACnB2U,EAASpD,cAAcvR,GACvB6U,EAAc7U,EACd8U,EAAaf,SAASc,GAI1B,QAASE,KAGL,GAAIC,GAAU,GAAIhC,GAAQO,OACtB0B,EAAW,GAAIjC,GAAQO,OACvB2B,GACApd,KAAO,GACPqd,SAAW,GACX/X,QAAUtF,KAAO,SACjBsd,eAAgB,EAChBC,MAAS,KACT9P,aAEA+P,IACExd,KAAQ,UACRA,KAAQ,UACRA,KAAQ,OAEVyd,EAAS,WACTL,EAAMpd,KAAO,GACbod,EAAMC,SAAW,GACjBD,EAAM9X,QAAUtF,KAAO,SACvBod,EAAME,eAAgB,EACtBF,EAAMG,MAAQ,KACdH,EAAM3P,YAEN0P,EAASlB,YAEThO,EAAQ,SAASyP,GACjBN,EAAQM,CAER,IAAIC,IACAC,OAAQ,OACRjK,IAAK0F,EAAUQ,WAAW,MAAMR,EAAUS,OAAO,KAAyB,QAAlBT,EAAUU,OAAkB,GAAKV,EAAUU,QAAS,SAC5G/S,MACI6W,SAAUT,EAAMpd,KAChBqd,SAAUD,EAAMC,SAChB/X,OAAQ8X,EAAM9X,OAAOtF,MAG7B,OAAO8c,GAAMa,GAAKzR,KAAK,SAAS4R,GACxBA,EAAI9W,KAAK+W,SACTX,EAAME,eAAgB,EACtBF,EAAMG,MAAQO,EAAI9W,KAAKuW,MACvBH,EAAM3P,SAAWqQ,EAAI9W,KAAKyG,SAC1ByP,EAAQjB,SAASmB,KAEjBA,EAAME,eAAgB,EACtBF,EAAMG,MAAO,QAIzB,QACIS,WAAY,WAAY,MAAOR,IAC/BS,QAAS,WAAa,MAAOb,IAC7BnP,MAAOA,EACPwP,OAAQA,EACRP,QAASA,EACTC,SAAUA,GAIlB,QAASe,KAAe,MAAOC,GAG/B,QAASnS,GAAQ9D,GAMb,MALIA,GACAjL,QAAQgB,QAAQ,iBAAiBmgB,OAEjCnhB,QAAQgB,QAAQ,iBAAiBogB,OAE9BnP,EAEX,QAASA,MAGT,QAASoP,KACLrhB,QAAQgB,QAAQ,oBAAoBsgB,cAExC,QAASC,KACLvhB,QAAQgB,QAAQ,oBAAoBsgB,cAExC,QAASlQ,KACLpR,QAAQgB,QAAQ,oBAAoBsgB,cAKxC,QAAStS,GAAWwS,GAEhB,MADA5B,GAASpD,cAAcgF,GAChB5B,EAASrC,SACZJ,IAAK,wBACL5N,QAASiS,IAIjB,QAASC,GAAgBD,GACrB,MAAO5B,GAASrC,SACZJ,IAAK,kBACL5N,QAASiS,IAGjB,QAAS5Q,GAAuB4Q,GAC5B,MAAO5B,GAASrC,SACZJ,IAAK,yBACL5N,SACImS,YAAaF,EACbG,eAAgB,YAI5B,QAASC,MACT,QAASC,MACT,QAAS1P,KACL,MAAOyN,GAASrC,SACZJ,IAAK,oBAGb,QAAS2E,KACL,MAAOlC,GAASrC,SACZJ,IAAK,iCAGb,QAAS4E,GAAwBC,GAC7B,MAAOpC,GAASrC,SACZJ,IAAK,0BACL5N,QAASyS,IAGjB,QAASC,GAAkB1S,GAEvB,MAAOqQ,GAASrC,SACZJ,IAAK,oBACL5N,QAASA,IAGjB,QAAS2S,MACT,QAASC,GAAmCC,GACxC,MAAOxC,GAASrC,SACZJ,IAAK,qCACL5N,QAAS6S,IAGjB,QAASC,MACT,QAASC,MACT,QAASpQ,GAAOsP,EAAae,GACzB,GAAIhT,IACAiS,YAAaA,EACbe,WAAYA,EAEhB,OAAO3C,GAASrC,SACZJ,IAAK,YACL5N,QAASA,IAGjB,QAAS8I,GAAiBzG,GACtB,GAAIrC,IACA0G,MAAOrE,EAGX,OAAOgO,GAASrC,SACZJ,IAAK,eAEL5N,QAASA,IAGjB,QAAS6C,GAAkBR,GACvB,GAAIrC,IACA0G,MAAOrE,EAEX,OAAOgO,GAASrC,SACZJ,IAAK,gBACL5N,QAASA,IAGjB,QAASmG,GAAQ8L,EAAae,GAC1B,GAAIhT,IACAiS,YAAaA,EACbe,WAAYA,EAEhB,OAAO3C,GAASrC,SACZJ,IAAK,aACL5N,QAASA,IAGjB,QAASiI,GAAkB5F,EAASwF,GAChC,GAAI7H,IACA0G,MAAOrE,EACP4Q,YAAapL,EAAQ7S,OACrB6S,QAASA,EAEb,OAAOwI,GAASrC,SACZJ,IAAK,gBACL5N,QAASA,IAGjB,QAASoG,GAAmC8M,GAExC,MADAA,GAAQA,IAAU,QAAS,YACpB7C,EAASrC,SACZJ,IAAK,iCACL5N,QAASkT,IAGjB,QAAS3R,GAA4BsR,EAAYM,GAC7C,MAAO9C,GAASrC,SACZJ,IAAK,0BACL5N,SACIoT,UAAWP,EACXM,MAAOA,KAInB,QAASxT,KACL,MAAO0Q,GAASrC,SACZJ,IAAK,oBAGb,QAASyF,MACT,QAASC,KACL,MAAOjD,GAASrC,SACZJ,IAAK,4BACL5N,QAAS,gBAGjB,QAASyL,KACL,MAAO4E,GAASrC,SACZJ,IAAK,aACL5N,QAAS,uBAGjB,QAASuT,GAAYC,EAAUtd,GAC3B,MAAOma,GAASrC,SACZJ,IAAK,gBACL5N,SACIwT,SAAUA,EACVtd,SAAUA,KAItB,QAASud,GAAWD,EAAUtd,GAC1B,MAAOma,GAASrC,SACZJ,IAAK,eACL5N,SACIwT,SAAUA,EACVtd,SAAUA,KAItB,QAASwd,GAAgBF,EAAUtd,GAC/B,MAAOma,GAASrC,SACZJ,IAAK,oBACL5N,SACIwT,SAAUA,EACVtd,SAAUA,KAItB,QAASyd,GAAaC,GAClB,MAAOvD,GAASrC,SACZJ,IAAK,2BACL5N,SACI6T,mBAAoBD,KA/QhC,GAAIrD,GACAC,EAAe,GAAI9B,GAAQO,OAsE3B0C,EAAWlB,GA6Mf,QACIxD,cAAeA,EACfD,cAAeA,EACfwD,aAAcA,EACdkB,WAAYA,EACZI,WAAYA,EACZE,WAAYA,EACZnQ,aAAcA,EACdrC,QAASA,EACTkD,eAAgBA,EAChBjD,WAAYA,EACZyS,gBAAiBA,EACjB7Q,uBAAwBA,EACxBgR,qCAAsCA,EACtCC,mBAAoBA,EACpB1P,gBAAiBA,EACjB2P,6BAA8BA,EAC9BC,wBAAyBA,EACzBE,kBAAmBA,EACnBjH,WAAYA,EACZkH,wBAAyBA,EACzBC,mCAAoCA,EACpCE,gBAAiBA,EACjBC,0BAA2BA,EAC3BpQ,OAAQA,EACRmG,iBAAkBA,EAClBjG,kBAAmBA,EACnBsD,QAASA,EACT8B,kBAAmBA,EACnB7B,mCAAoCA,EACpC7E,4BAA6BA,EAC7B5B,aAAcA,EACd0T,uBAAwBA,EACxBE,YAAaA,EACbE,WAAYA,EACZC,gBAAiBA,EACjBJ,0BAA2BA,EAC3BK,aAAcA,GAnTtBnH,EAAUna,SAAW,WAAY,QAAS,UAAW,aAbrD5B,QACKC,OAAO,aACP6b,QAAQ,QAASC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+V1BsH,gBAAkB,WACjB,GAAIC,KAgJJ,OA9IAA,GAAQC,KAAO,SAASC,GACvB,MAAOA,GAAgB,EAAPA,EAAU,GAAG,EAAG,GAGjCF,EAAQG,aAAe,SAAsBC,GAC5C,MAAOA,GAAIzW,OAAO,SAAS0W,EAAMC,EAAMnX,GAEtC,MADAkX,GAAKC,GAAQnX,EACNkX,QAITL,EAAQO,mBAAqB,SAASC,GACrC,MAAO,IAAIA,EAAQC,MAAM,KAAKC,KAAK,MAEpCV,EAAQW,OAAS,SAASpX,GACzB,MAAOyW,GAAQY,OAAOrX,EAAIsX,QAAStX,EAAIuX,eAAiBvX,EAAIuX,cAAcC,SAE3Ef,EAAQgB,OAAS,SAASzX,GACzB,MAAOyW,GAAQY,OAAOrX,EAAI0X,QAAS1X,EAAIuX,eAAiBvX,EAAIuX,cAAcI,SAE3ElB,EAAQY,OAAS,SAAShW,EAAKuW,GAC9B,MAAuB,mBAARvW,GAAuBuW,EAAcvW,GAErDoV,EAAAA,WAAkB,SAASoB,EAAaC,GACvCD,EAAYE,UAAYjX,OAAOkX,OAAOF,EAAaC,WACnDF,EAAYE,UAAUE,YAAcJ,GAGrCpB,EAAQyB,cAAgB,WACvB,GAAIC,GAAU,CACd,OAAO,YAEN,MADAA,IAAW,IAKb1B,EAAQ2B,MAAQ,SAASC,EAAG5Y,EAAGC,GAC9B,MAAO/L,MAAK8M,IAAI9M,KAAK6M,IAAId,EAAE2Y,GAAI5Y,IAGhCgX,EAAQ6B,iBAAmB,SAASC,GACnC,MAAOthB,IAAGuC,OAAOkZ,SAAS8F,gBAAgB,6BAA8BD,KAGzE9B,EAAQgC,mBAAqB,SAASC,EAAK9c,EAAQkD,GAClD,MAAOlD,GAAOpC,OAAO,WACpB,MAAO/F,MAAKklB,YAAYD,EAAIhR,OAAOkR,WAAU,OAI/CnC,EAAQoC,6BAA+B,SAASC,EAAOC,GACtD,GAAIra,GAAI,CACG+X,GAAQuC,iBAAiBF,EAAO,KAAK1c,KAAK,WACpD,GAAqB,SAAjB3I,KAAKwlB,QAAT,CAIA,GAAI1b,GAAYtG,GAAGuC,OAAO/F,MAAMgB,KAAK,aACjC4G,EAAIkC,GAAaA,EAAUE,QAAQ,aAAe,IAAMyb,WAAW3b,EAAU2Z,MAAM,KAAK,GAAI,GAChG7b,GAAIA,GAAK,EACTpE,GAAGuC,OAAO/F,MAAMgB,KAAK,YAAagiB,EAAQ7b,UAAU8D,EAAGrD,IACvDqD,GAAKjL,KAAK0lB,UAAUxf,MACpB+E,GAAKqa,IAEN,OAAOD,IAGRrC,EAAQ2C,UAAY,SAASC,EAAQC,GACpC,GAAIC,GAAMzN,EAAE,QAAQuN,EAAO,UACxBG,KAAKzT,SAAU,WAAY0T,QAAO,OAClCC,cAAc,SAAUC,WAAY,SACpCL,KAAMA,IACNM,SAAS9N,EAAE,SACVnS,EAAQ4f,EAAI5f,OAEhB,OADA4f,GAAInc,SACGzD,GAGR8c,EAAQuC,iBAAmB,SAASa,EAAQrN,GAC3C,MAAOqN,GAAOxiB,UAAUmV,GAAUzT,OAAO,WACxC,MAAOtF,MAAKqmB,aAAeD,EAAOnS,UAIpC+O,EAAQsD,KAAO,SAASC,EAAKC,GAC5BC,QAAQ3X,IAAI,sBAAsB0X,EAAQ,KAAKD,IAGhDvD,EAAQ0D,WAAa,SAAStD,EAAKuD,GAGlC,GAAIC,KACJ7S,GAAEpL,KAAKya,EAAK,SAASxV,EAAKiZ,GACzBD,EAAOlc,MAAMkD,EAAKiZ,KAEnB,IAAIC,GAAa,SAAS9a,EAAEC,GAC3B,GAAIsU,GAAMoG,EAAI3a,EAAE,GAAIC,EAAE,GAQtB,OAPY,KAARsU,IACCvU,EAAE,GAAKC,EAAE,GACZsU,EAAM,GACIvU,EAAE,GAAKC,EAAE,KACnBsU,EAAM,IAGDA,EAGR,OADAqG,GAAOnhB,KAAKqhB,GACL/S,EAAElQ,IAAI+iB,EAAQ,SAAS3b,GAAK,MAAOA,GAAE,MAG7C+X,EAAQ+D,WAAa,SAASnC,EAAG5Y,EAAGC,GACnC,GAAa,MAATD,EAAE,GAAY,CACjB,GAAIyE,IAAKuW,SAAShb,EAAE3L,UAAU,EAAE,GAAI,IAAK2mB,SAAS/a,EAAE5L,UAAU,EAAE,GAAI,KAChE4mB,GAAKD,SAAShb,EAAE3L,UAAU,EAAE,GAAI,IAAK2mB,SAAS/a,EAAE5L,UAAU,EAAE,GAAI,KAChE4L,GAAK+a,SAAShb,EAAE3L,UAAU,EAAE,GAAI,IAAK2mB,SAAS/a,EAAE5L,UAAU,EAAE,GAAI,KAChE6mB,EAAIhnB,KAAKgL,MAAMuF,EAAE,IAAI,EAAEmU,GAAKnU,EAAE,GAAGmU,GAAGxkB,SAAS,IAC7C+mB,EAAIjnB,KAAKgL,MAAM+b,EAAE,IAAI,EAAErC,GAAKqC,EAAE,GAAGrC,GAAGxkB,SAAS,IAC7CgnB,EAAIlnB,KAAKgL,MAAMe,EAAE,IAAI,EAAE2Y,GAAK3Y,EAAE,GAAG2Y,GAAGxkB,SAAS,GAMjD,OAJA8mB,GAAIA,EAAEjjB,OAAS,EAAI,IAAIijB,EAAIA,EAC3BC,EAAIA,EAAEljB,OAAS,EAAI,IAAIkjB,EAAIA,EAC3BC,EAAIA,EAAEnjB,OAAS,EAAI,IAAImjB,EAAIA,EAEpB,IAAMF,EAAIC,EAAIC,EACf,GAAIC,MAAMrb,IAAMA,EAAEhC,QAAQ,KAAO,GAAI,CAC3C,GAAIsd,GAAI7B,WAAWzZ,EAAG,IAClBob,EAAI3B,WAAWxZ,EAAG,GACtB,OAAQqb,IAAG,EAAE1C,GAAKwC,EAAExC,EAAG,IAEvB,MAAO5Y,IAAG,EAAE4Y,GAAK3Y,EAAE2Y,GAIrB5B,EAAQ7b,UAAY,SAAS8D,EAAErD,GAC9B,MAAO,aAAeqD,EAAI,IAAMrD,EAAI,KAGrCob,EAAQuE,OAAS,SAASC,EAAMC,GAC/B,IAAKD,EACJ,KAAMC,IAGDzE,KAER,WACI,YAOA,SAAS0E,KAaL,QAASC,GAAoBxlB,EAAOC,EAAQC,EAAcvC,EAAUsD,EAAQI,EAAIH,EAAS0Q,GAoyCrF,QAAS6T,GAAiBH,GAMvB,GAJApP,EAAE,QAAQwP,QACVxP,EAAE,0BAA0BwP,QAC5BxP,EAAE,yBAAyBwP,QAEV,SAAdJ,EAAIva,OACJnN,EAAG+nB,aAAeC,KAAKC,MAAMP,EAAIxY,SACjCwX,QAAQ3X,IAAI,mCAAoC/O,EAAG+nB,cACnDG,EAAS,cACN,CACA,GAAItS,GAAQ8R,EAAIxY,QAAQ,GACpBiZ,EAAiBT,EAAIxY,QAAQ,GAC7BkZ,EAAMC,EAAU7D,OAAO,OAC3B4D,GAAIE,oBACJhQ,EAAEiQ,KAAKJ,GAAgBvZ,KAAK,WASrB,QAAS4Z,GAAczC,GACnB,MAAOA,GAAI0C,OAASA,EATL,gBAAlB,KACD7S,GAASA,GAKX,KAAI,GADA8S,IAFiB9S,EAAM1R,WAGnB4E,EAAI,EAAGA,EAAI8M,EAAM1R,OAAQ4E,IAAI,CACnC,GAAI2f,GAAO7S,EAAM9M,GAIb6f,EAAYR,EAAe5iB,OAAOijB,EAElBI,MAAKC,KACzBH,GAAS5f,GAAKsf,EAAIU,UAAUC,MAAON,EAAMO,WAAU,GAAO,GACjD,IAANlgB,EACDsf,EAAIa,WAAWP,EAAS5f,GAAIuf,EAAUa,oBAEtCd,EAAIe,eAAeT,EAAS5f,GAAI4f,EAAS,IAE3CN,EAAIgB,aAAaV,EAAS5f,GAAI6f,GAAW,GAE7CP,EAAIiB,mBACJjB,EAAI1iB,OACJ4S,EAAE,sBAAsBgR,MAAM,WAC3BlB,EAAImB,qBAEP,IAAI/W,GAAI,CACR8F,GAAE,sBAAsBgR,MAAM,WAC1B9W,GAAK,GACL4V,EAAIoB,QAAQhX,IAKpB,KAAI,GAFAiX,GAAsBnR,EAAE,2BACxBoR,EAAsBpR,EAAE,2BACpBqR,EAAI,EAAGA,EAAIF,EAAoBvlB,OAAQylB,IAC7CF,EAAoBE,GAAGxE,YAAYuE,EAAoBC,GAEzDrR,GAAE,yBAAyBrS,OAAOwjB,GAClCnR,EAAE,0BAA0ByI,UAz1CpC,GAAIphB,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAKd,IAAImnB,GAAYjqB,QAAQgB,QAAQ,yBAC5BkpB,EAAiBlqB,QAAQgB,QAAQ,0BAEjCmpB,GADWnqB,QAAQgB,QAAQ,0BAChBhB,QAAQgB,QAAQ,YAG3BopB,EAAa3nB,EAAM4nB,gBACnBC,EAAgB7nB,EAAM8nB,mBAGtBlqB,EAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGsR,YACHtR,EAAGuR,QAAU,KACbvR,EAAGmqB,eAAiBJ,EAAWK,MAC/BpqB,EAAGqqB,cAAgBrqB,EAAGmqB,eAAe,GACrCnqB,EAAGsqB,kBAAoBL,EAAcG,MACrCpqB,EAAGuqB,iBAAmBvqB,EAAGsqB,kBAAkB,GAC3CtqB,EAAGwqB,gBAAkBxqB,EAAGqqB,cAActjB,IAAM,IAAM/G,EAAGuqB,iBAAiBxjB,IACtE/G,EAAG+nB,YAEH,IAAIM,GAAY,WA+Bd,QAASA,GAAUoC,GACjB,GAAIC,GAAOzqB,KACP0qB,EAAaC,EAAMlG,eAEvBgG,GAAKD,OAASA,EAEdC,EAAKG,YACLH,EAAKI,qBACLJ,EAAKK,oBACLL,EAAKM,6BACLN,EAAKO,cACLP,EAAKQ,qBACLR,EAAKS,wBAA0B,EAAE,GACjCT,EAAKU,kBACLV,EAAKW,UACLX,EAAKY,aAAeC,KAAM,SAE1Bb,EAAKc,iBAAkB,EACvBd,EAAKe,gBAAkBhB,EAAOiB,WAE9BhB,EAAKiB,kBAAoBjB,EAAKe,gBAC9Bf,EAAK9kB,KAAO,EAGZ8kB,EAAKnB,kBAAoB,WACvBmB,EAAKc,iBAAmBd,EAAKc,gBAC7BlT,EAAEoS,GAAMkB,QAAQpmB,EAAOqmB,mBAEzBnB,EAAKoB,eAAiB,WACpB,MAAO3rB,MAAK4rB,KAAKrB,EAAKD,OAAOuB,aAAatB,EAAKuB,YAAavB,EAAKc,iBAInEd,EAAKuB,QAAU,WACb,MAAOvB,GAAK9kB,MAEd8kB,EAAKlB,QAAU,SAAShX,GAKtB,MAJAkY,GAAK9kB,KAAOglB,EAAMhG,MAAMpS,EAAG,EAAG,GAC9B0Z,IACAC,IACA7T,EAAEoS,GAAMkB,QAAQpmB,EAAO4mB,UAChB1B,EAAK9kB,KAEd,IAAIumB,GAAa,WAEfzB,EAAK9kB,MAAQ8kB,EAAKiB,kBAAkB,IAAIjB,EAAKe,gBAAkB,IAE7DS,EAAwB,WAE1BxB,EAAKiB,kBAAoBxrB,KAAKgL,MAAMuf,EAAK9kB,MAAM8kB,EAAKe,gBAAgB,GAAK,GAE3Ef,GAAK2B,aAAe,WAIlB,MAHA3B,GAAKiB,kBAAoBf,EAAMhG,MAAM8F,EAAKiB,kBAAkB,EAAG,EAAGjB,EAAKe,iBACvEU,IACA7T,EAAEoS,GAAMkB,QAAQpmB,EAAO4mB,UAChB1B,EAAK9kB,MAEd8kB,EAAK4B,aAAe,WAIlB,MAHA5B,GAAKiB,kBAAoBf,EAAMhG,MAAM8F,EAAKiB,kBAAkB,EAAG,EAAGjB,EAAKe,iBACvEU,IACA7T,EAAEoS,GAAMkB,QAAQpmB,EAAO4mB,UAChB1B,EAAK9kB,MAId8kB,EAAK6B,iBAAmB,WACtB,MAAO7B,GAAKe,iBAEdf,EAAK8B,mBAAqB,WACxB,MAAO9B,GAAKiB,mBAIdjB,EAAK+B,cAAgB,SAAS/D,GAC5B,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOiC,aAItChC,EAAKiC,eAAiB,SAASjE,GAC7B,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOmC,cAItClC,EAAKmC,gBAAkB,SAASnE,GAC9B,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOqC,eAItCpC,EAAKqC,mBAAqB,SAASC,EAAgBC,GACjD,GAAI5B,GAAS4B,GAAavC,EAAKwC,WAC/B,OAAOlZ,GAAEzO,OAAOmlB,EAAKG,SAAU,SAAS5mB,GACtC,GAAI4E,GAAImL,EAAElQ,IAAIunB,EAAQ,SAAS3C,GAC7B,MAAOgC,GAAKyC,cAAczE,EAAUzkB,IAEtC,OAAO+oB,GAAenkB,MAG1B6hB,EAAK0C,WAAa,WAChB,MAAO1C,GAAKG,UAEdH,EAAK2C,mBAAqB,WACxB,MAAO3C,GAAKI,mBAEdJ,EAAK4C,kBAAoB,WACvB,MAAO5C,GAAKK,kBAEdL,EAAK6C,0BAA4B,WAC/B,MAAO7C,GAAKM,0BAEd,IAAIwC,GAAuB,WACzB9C,EAAKK,iBAAmB/W,EAAEzO,OAAOmlB,EAAKG,SAAU,SAAS5mB,GACvD,OAAQymB,EAAKO,WAAWhnB,KAE1BymB,EAAKM,0BAA4BJ,EAAMxH,aAAasH,EAAKK,kBACzDzS,EAAEoS,GAAMkB,QAAQpmB,EAAOioB,sBAEzB/C,GAAKgD,WAAa,SAAS7C,GACzBH,EAAKG,SAAWA,EAAS8C,QACzBjD,EAAKI,kBAAoBF,EAAMxH,aAAasH,EAAKG,UACjD2C,IACAlV,EAAEoS,GAAMkB,QAAQpmB,EAAOooB,eAGzBlD,EAAKmD,QAAU,SAAS9mB,EAAK+mB,GACvBA,IACFpD,EAAKO,eAEPjX,EAAEpL,KAAK7B,EAAK,SAAS9C,GACnBymB,EAAKO,WAAWhnB,IAAM,IAExBupB,KAEF9C,EAAKqD,QAAU,SAAShnB,GACjBA,EAGHiN,EAAEpL,KAAK7B,EAAK,SAAS9C,SACZymB,GAAKO,WAAWhnB,KAHzBymB,EAAKO,cAMPuC,KAIF9C,EAAKsD,gBAAkB,WACrB,MAAQtD,GAAKQ,aAAa,GAAGhnB,OAAS,EAAIwmB,EAAKQ,aAAa,GAAG,GAAKR,EAAKQ,aAAa,GAAG,IAE3FR,EAAKuD,uBAAyB,SAASvF,EAAU9B,GAC/C8D,EAAKW,OAAO3C,GAAU+B,OAAOyD,SAAWtH,GAE1C8D,EAAKyD,uBAAyB,SAASzF,GACrC,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOyD,UAEtCxD,EAAK0D,sBAAwB,SAAS1F,GACpC,MAAOgC,GAAKU,eAAe1C,IAE7BgC,EAAK2D,sBAAwB,SAAS3F,EAAU4F,GAC9C5D,EAAKU,eAAe1C,GAAY4F,EAChC5D,EAAKhlB,QAEPglB,EAAK6D,uBAAyB,SAASC,GACrC9D,EAAKS,uBAAyBqD,EAAMb,SAEtCjD,EAAK+D,uBAAyB,WAC5B,MAAO/D,GAAKS,uBAAuBwC,SAErCjD,EAAKgE,kBAAoB,WACvB,GAAIC,MACAzD,EAAeR,EAAKkE,gBAIxB,OAHA5a,GAAEpL,KAAK8hB,EAAK+D,yBAA0B,SAASI,GAC7CF,EAAMA,EAAIlgB,OAAOyc,EAAa2D,MAEzBF,GAETjE,EAAKoE,cAAgB,SAASrE,GAC5BC,EAAKY,YAAcb,EAErB,IAAIsE,GAAW,SAASzQ,GACtB,GAAIqQ,GAAM3a,EAAEgb,OAAOtE,EAAK0C,aAAcpZ,EAAEib,SACpC3Q,IACFqQ,EAAIO,UAENxE,EAAKgD,WAAWiB,IAEdQ,EAAc,WAChB,GAAIC,GAAgB1E,EAAKgE,oBACrBW,EAAWrb,EAAElQ,IAAIsrB,EAAe,SAAS1G,GAC3C,MAAOgC,GAAKyD,uBAAuBzF,KAEjChf,KACAmhB,EAAWH,EAAK0C,YACpBpZ,GAAEpL,KAAKiiB,EAAU,SAAS5mB,GACxByF,EAAKzF,MACL+P,EAAEpL,KAAKwmB,EAAe,SAAS1G,GAC7Bhf,EAAKzF,GAAIykB,GAAYgC,EAAKyC,cAAczE,EAAUzkB,MAGtD,IAAIqrB,GAAgC,SAASC,EAAIC,GAE/C,IAAK,GADDC,GAAa,EACR3mB,EAAE,EAAG4mB,EAAON,EAAclrB,OAAUwrB,EAAF5mB,EAAQA,IAAK,CACtD,GAAI4f,GAAW0G,EAActmB,GACzB8d,EAAMyI,EAASvmB,GACf6mB,EAAKjmB,EAAK6lB,GAAK7G,GACfkH,EAAKlmB,EAAK8lB,GAAK9G,GACfmH,EAA0B,mBAAPF,GACnBG,EAA0B,mBAAPF,EAcvB,IAVEH,EAHGI,GAAaC,EAEPD,GAAYC,EACR,EACJD,EACI,EAEA,GANAjJ,EAAI+I,EAAIC,GAQnBG,SAASN,KAEXA,GAAc/E,EAAKU,eAAe1C,IAEjB,IAAf+G,EACF,MAGJ,MAAOA,GAET/E,GAAKgD,WAAW9C,EAAMjE,WAAW+D,EAAK0C,aAAckC,IAEtD5E,GAAKhlB,KAAO,WACV,GAAI+kB,GAASC,EAAKY,WACE,WAAhBb,EAAOc,KACT4D,IACyB,OAAhB1E,EAAOc,MAChBwD,EAAStE,EAAOnM,OAKpBoM,EAAK5B,SAAW,SAAS2B,EAAQnF,GAC/BA,EAAQsF,EAAM/G,OAAOyB,EAAO,EAC5B,IAAIoD,GAAWiC,GASf,OARAD,GAAKW,OAAO3C,IAAYzkB,GAAIykB,EACtBhf,QACA+gB,OAAQnS,EAAE0X,UAAWC,EAAoBxF,GACzCyF,gBACNxF,EAAKQ,aAAa5F,GAAO3a,KAAK+d,GAC9BgC,EAAKU,eAAe1C,GAAY,EAEhCpQ,EAAEoS,GAAMkB,QAAQpmB,EAAO2qB,WAAYzH,SAAUA,IACtCA,GAETgC,EAAK0F,YAAc,SAAS1H,GAC1B,GAAI2H,GAAQ3F,EAAKW,OAAO3C,SACjBgC,GAAKW,OAAO3C,SACZgC,GAAKU,eAAe1C,EAE3B,IAAI4H,GAAc5F,EAAK6F,wBAAwB7H,GAAU,EACzD,IAAK4H,EAEE,CACL,GAAIE,GAAeF,EAAYrmB,QAAQye,EAIvC,OAHA4H,GAAYG,OAAOD,EAAc,GAEjClY,EAAEoS,GAAMkB,QAAQpmB,EAAOkrB,cAAeL,MAAOA,EAAO3H,SAAUA,KACvD,EANP,OAAO,GAWXgC,EAAKkE,eAAiB,SAAS+B,GAC7B,MAAQA,MAAc,EAAOjG,EAAKQ,aAAe5S,EAAE0X,QAAO,KAAUtF,EAAKQ,eAE3ER,EAAKwC,UAAY,WACf,MAAOlZ,GAAE4c,QAAQlG,EAAKkE,mBAExBlE,EAAK6F,wBAA0B,SAAS7H,EAAUiI,GAChD,GAAIrL,IAAQ,CAQZ,OAPAtR,GAAE6c,KAAKnG,EAAKQ,aAAc,SAAS4F,GACjC,MAAIA,GAAI7mB,QAAQye,GAAY,IAC1BpD,EAAQwL,GACD,IAEF,IAEDH,KAAc,EAAOrL,EAAQA,EAAMqI,SAE7CjD,EAAKqG,UAAY,SAASrI,EAAUsI,GAClC,GAAIV,GAAc5F,EAAK6F,wBAAwB7H,GAAU,EACzD,KAAK4H,EACH,OAAO,CAET,IAAIE,GAAeF,EAAYrmB,QAAQye,EACvCsI,GAAepG,EAAMhG,MAAMoM,EAAc,EAAGV,EAAYpsB,OAAO,GAC/DosB,EAAYG,OAAOD,EAAc,GACjCF,EAAYG,OAAOO,EAAc,EAAGtI,EACpC,IAAIuI,GAAeX,EAAY3C,MAAMxtB,KAAK6M,IAAIwjB,EAAcQ,GAAe7wB,KAAK8M,IAAIujB,EAAcQ,GAAgB,EAClH1Y,GAAEoS,GAAMkB,QAAQpmB,EAAO0rB,YAAaD,aAAcA,KAKpDvG,EAAKyG,cAAgB,SAASzI,GAC5B,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAO1B,OAItC2B,EAAK0G,gBAAkB,SAAS1I,GAC9B,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAO4G,SAEtC3G,EAAK4G,gBAAkB,SAAS5I,EAAU2I,GACxC3G,EAAKW,OAAO3C,GAAU+B,OAAO4G,QAAUA,GAIzC3G,EAAK6G,aAAe,SAAS7I,GAC3B,MAAOgC,GAAKW,OAAO3C,GAAUhf,MAE/BghB,EAAKtB,aAAe,SAASV,EAAUhf,GACrC,GAAI8nB,GAAc9G,EAAK+G,wBAAwB/I,EAE/CgC,GAAKW,OAAO3C,GAAUhf,KAAOA,CAE7B,IAAIgoB,GAAmBhH,EAAK0C,aACxBuE,EAA4BjH,EAAK2C,oBACrCrZ,GAAEpL,KAAKoL,EAAElQ,IAAI4F,EAAM8nB,GAAc,SAASvtB,GAClCA,IAAM0tB,IACVD,EAAiB/mB,KAAK1G,KAG1BymB,EAAKgD,WAAWgE,GAEhBhH,EAAKW,OAAO3C,GAAUwH,cACtB,IAAIA,GAAcxF,EAAKW,OAAO3C,GAAUwH,WACxClc,GAAEpL,KAAK8hB,EAAKW,OAAO3C,GAAUhf,KAAM,SAASgK,GAC1Cwc,EAAYsB,EAAY9d,IAAUA,IAEpC4E,EAAEoS,GAAMkB,QAAQpmB,EAAOosB,gBAAiBlJ,SAAUA,KAEpDgC,EAAKyC,cAAgB,SAASzE,EAAUmJ,GACtC,MAAOnH,GAAKW,OAAO3C,GAAUwH,YAAY2B,IAE3CnH,EAAKoH,qBAAuB,SAASpJ,GACnC,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOsH,gBAItCrH,EAAK+G,wBAA0B,SAAS/I,GACtC,GAAI9a,GAAM8c,EAAKsH,mBAAmBtJ,EAClC,OAAO,UAAS7f,GACd,MAAOA,GAAE+E,KAGb8c,EAAKsH,mBAAqB,SAAStJ,GACjC,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOwH,cAEtCvH,EAAKwH,mBAAqB,SAASxJ,EAAU9a,GAC3C8c,EAAKW,OAAO3C,GAAU+B,OAAOwH,aAAerkB,GAI9C8c,EAAKyH,iBAAmB,SAASzJ,GAC/B,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAOzB,WAEtC0B,EAAK0H,8BAAgC,SAAS1J,GAC5C,MAAOgC,GAAKW,OAAO3C,GAAU+B,OAAO4H,0BAItC3H,EAAK4H,UAAY,WACfte,EAAEpL,KAAK8hB,EAAKwC,YAAa,SAASxE,GAChCgC,EAAKtB,aAAaV,QAEpBgC,EAAKgD,gBAjZT,GAAIloB,GAAS+sB,iBACT3H,EAAQ5H,gBACRwP,EAAUC,kBAEVC,GACFhH,WAAY,EACZM,aAAc,IACd2G,QAAQ,GAGNC,GACFC,kBAAmB,GAGjB5C,GACFlH,MAAO,OACPkJ,aAAc,UACdvF,YAAa,GACbE,aAAc,GACdE,cAAe,EACfoB,SAAU4E,OACVzB,QAAS,SAASxoB,GAChB,MAAOA,GAAE,SAEXmgB,WAAW,EACXqJ,0BAA0B,EA4X5B,QACEU,kBAAmBP,EAAQO,kBAC3BC,eAAgBR,EAAQQ,eACxB9J,mBAAoBsJ,EAAQtJ,mBAC5B+J,UAAWT,EAAQS,UACnBzO,OAAQ,SAAyB0O,EAA2BzI,GAC1DA,EAASnS,EAAE0X,UAAW0C,EAAwBjI,OAC9CA,EAASnS,EAAE0X,OAAOvF,EAAQmI,EAC1B,IAAIjL,GAAY,GAAIU,GAAUoC,GAC1BhY,EAAW,GAAI0gB,GAAqBD,EAA2BvL,GAAYyL,WAAY,QAAST,OAAOlI,EAAOkI,SAC9GhE,GACF0E,QAAS1L,EACT2L,QAAS7gB,EACTqW,SAAU,SAAS2B,EAAQnF,GACzB,GAAIoD,GAAWf,EAAUmB,SAAS2B,EAAQnF,EAC1C,OAAOoD,IAET0H,YAAa,SAAS1H,GACpBf,EAAUyI,YAAY1H,IAExBqI,UAAW,SAASrI,EAAUnW,GAC5BoV,EAAUoJ,UAAUrI,EAAUnW,IAEhC2f,mBAAoB,SAASxJ,EAAU9a,GACrC+Z,EAAUuK,mBAAmBxJ,EAAU9a,IAEzCwb,aAAc,SAASV,EAAUhf,GAC/Bie,EAAUyB,aAAaV,EAAUhf,IAEnCuf,WAAY,SAASP,EAAU6C,EAAMgI,GACnC9gB,EAASwW,WAAWP,EAAU6C,EAAMgI,IAEtCpK,eAAgB,SAASqK,EAAiBC,GACxChhB,EAAS0W,eAAeqK,EAAiBC,IAE3ClK,kBAAmB,WACjB5B,EAAU4B,qBAEZmK,MAAO,WACL,MAAOjhB,GAASihB,SAElBnF,uBAAwB,SAASC,GAC/B7G,EAAU4G,uBAAuBC,IAEnC9oB,KAAM,WACJiiB,EAAUjiB,QAEZopB,cAAe,SAASrE,GACtB9C,EAAUmH,cAAcrE,IAE1BiD,WAAY,SAAS7C,GACnBlD,EAAU+F,WAAW7C,IAEvBuD,sBAAuB,SAAS1F,GAC9B,MAAOf,GAAUyG,sBAAsB1F,IAEzC2F,sBAAuB,SAAS3F,EAAU4F,GACxC3G,EAAU0G,sBAAsB3F,EAAU4F,IAE5C9E,QAAS,SAAShX,GAChB,MAAOmV,GAAU6B,QAAQhX,IAE3B6Z,aAAc,WACZ,MAAO1E,GAAU0E,gBAEnBC,aAAc,WACZ,MAAO3E,GAAU2E,gBAEnBhE,kBAAmB,WACjB7V,EAAS6V,qBAEXe,iBAAkB,WAChB5W,EAAS4W,oBAEXsK,iBAAkB,SAAS1G,EAAW2G,GACpCnhB,EAASkhB,iBAAiB1G,EAAW2G,IAEvC7G,mBAAoB,SAASC,EAAgBC,GAC3C,MAAOtF,GAAUoF,mBAAmBC,EAAgBC,IAEtDK,kBAAmB,WACjB,MAAO3F,GAAU2F,qBAEnBO,QAAS,SAAS9mB,GAChB4gB,EAAUkG,QAAQ9mB,IAEpBgnB,QAAS,SAAShnB,GAChB4gB,EAAUoG,QAAQhnB,IAEpBurB,UAAW,WACT3K,EAAU2K,aAEZhB,gBAAiB,SAAS5I,EAAU2I,GAClC1J,EAAU2J,gBAAgB5I,EAAU2I,IAkBxC,OAfA/Y,GAAEqP,GAAW7d,GAAGtE,EAAO0rB,WAAY,WACjC5Y,EAAEqW,GAAK/C,QAAQpmB,EAAO0rB,cAExB5Y,EAAE7F,GAAU3I,GAAGtE,EAAOquB,mBAAoB,WACxCvb,EAAEqW,GAAK/C,QAAQpmB,EAAOquB,sBAExBvb,EAAEqP,GAAW7d,GAAGtE,EAAOkrB,aAAc,SAASlkB,EAAK9C,GACjD4O,EAAEqW,GAAK/C,QAAQpmB,EAAOkrB,cAAehI,SAAUhf,EAAKgf,aAEtDpQ,EAAE7F,GAAU3I,GAAGtE,EAAOsuB,wBAAyB,SAAStnB,EAAK9C,GAC3D4O,EAAEqW,GAAK/C,QAAQpmB,EAAOsuB,2BAExBxb,EAAE7F,GAAU3I,GAAGtE,EAAOuuB,wBAAyB,SAASvnB,EAAK9C,GAC3D4O,EAAEqW,GAAK/C,QAAQpmB,EAAOuuB,2BAEjBpF,OAKTwE,EAAuB,WAgBrB,QAASA,GAAqBD,EAA2BvL,EAAW8C,GAClEuJ,kBAAkB1rB,KAAKrI,KAAM0nB,EAAW8C,EACxC,IAAIC,GAAOzqB,IACXA,MAAKg0B,yBACLh0B,KAAKi0B,eACLj0B,KAAKk0B,yBACLl0B,KAAKm0B,kBACLn0B,KAAKo0B,UACLp0B,KAAKq0B,eACLr0B,KAAKs0B,gBACLt0B,KAAKu0B,eACLv0B,KAAKw0B,oBACLx0B,KAAKy0B,SACLz0B,KAAK00B,aACL10B,KAAK20B,kBACL30B,KAAK40B,0BAA4BjK,EAAMhF,UAAU,OAAQ8E,EAAKoK,gBAC9D70B,KAAK80B,2BAEL90B,KAAK+0B,kBAAoB,GAEzB/0B,KAAK4a,UAAYpX,EAAGuC,OAAOktB,GAC3BjzB,KAAK4a,UAAU7R,QAAQ,YAAY,GAAMnF,UAAU,KAAK+F,SACxD3J,KAAK4a,UAAU5U,OAAO,MACtB,WACMwkB,EAAOkI,SACTjI,EAAKiK,aAAelxB,EAAGuC,OAAOktB,GAA2BjtB,OAAO,SAASC,MAAM,kBAAmB,eAGtG,IAAI+uB,GAAexxB,EAAGuC,OAAOktB,GAA2BjtB,OAAO,OAAO+C,QAAQ,0BAA0B,IACxG,WACE0hB,EAAK6J,gBAAkBU,EAAahvB,OAAO,OAAO+C,QAAQksB,GAA4B,GAAMhvB,MAAM,WAAY,YAC9GwkB,EAAK2J,UAAY3J,EAAK6J,gBAAgBtuB,OAAO,OAAOC,MAAM,WAAY,YAAYA,MAAM,WAAY,UACpGwkB,EAAK4J,eAAiB5J,EAAK6J,gBAAgBtuB,OAAO,OAAOC,MAAM,WAAY,YAAYA,MAAM,WAAY,UAChGA,MAAM,MAAO,OAAOA,MAAM,OAAO,OACjCA,MAAM,UAAU,WAE3B,WACEwkB,EAAK8J,eAAiBS,EAAahvB,OAAO,OAAO+C,QAAQmsB,GAA2B,GACpFzK,EAAK0K,sBAAwB1K,EAAK8J,eAAevuB,OAAO,OAAO+C,QAAQqsB,GAAwB,GACxFnvB,MAAM,SAAUwkB,EAAK4K,qBACrBpvB,MAAM,aAAc,UAE3BwkB,EAAK+J,oBAAsB/J,EAAK8J,eAAetgB,OAC/CwW,EAAKgK,SAAWhK,EAAK8J,eAAevuB,OAAO,OAAO+C,QAAQusB,GAAiB,GAG3E7K,EAAK8K,mBAAqB9K,EAAK8J,eAAevuB,OAAO,OAAOC,MAAM,WAAY,YAAYA,MAAM,WAAY,UACnGA,MAAM,MAAO,OAAOA,MAAM,OAAO,OAC1CwkB,EAAK+J,oBAAoB5gB,iBAAiB,SAAU,WAClD6W,EAAK+K,2BACL/K,EAAKgL,wBAEP,IAAIC,GAAWv0B,GACf,WACE,GAAIw0B,GAAYC,EAAiBC,EAC7BC,EADuCC,IAE3C1d,GAAEoS,EAAKgK,SAASxgB,QAAQ+hB,MACtBn1B,QAAS,cACTyR,UAAWnK,OAAQ,QAAS8tB,GAAG,gBAAiBC,GAAG,aAAcC,SAAU9d,EAAE+d,SAC7EnwB,OAASud,QAAS6S,EAAiBC,OAAQ,QAC3CzV,MAAO7Z,MAAO,kBACd8Z,MAAOyV,OAAO,EAAMjgB,MAAO,IAAKtP,MAAO,iBACvCzB,QACEsb,KAAM,WACJxI,EAAErY,MAAM4wB,KAAK,iBAAiB5a,KAAKyU,EAAKsK,oBAE1CrhB,OAAQ,WACN2E,EAAErY,MAAM4wB,KAAK,iBAAiB5a,KAAKyU,EAAKsK,sBAI9C,IAAIyB,GAAa,SAASC,GACxBpe,EAAE,IAAIge,GAAiBK,SACvBre,EAAEoe,GAAK9K,QAAQ,mBAEbgL,EAAe,SAASF,GAC1Bpe,EAAE,IAAIge,GAAiBK,SACvBre,EAAEoe,GAAK9K,QAAQ,kBAEbiL,EAAoB,WACtBjB,EAAa9C,OACb+C,EAAkB/C,OAClBgD,GAAYc,EAAad,GACzBA,EAAWhD,OAEXiD,GAA4Be,aAAaf,GACzC/hB,EAAEpL,KAAKotB,EAAuB,SAASe,GACjCA,IACFA,EAAK7wB,MAAMqwB,OAAS,GACpBQ,EAAK7wB,MAAM8wB,OAAS,MAGxBhB,KAEF50B,GAAW,WACTy1B,KAEFlB,EAAY,SAASnpB,GACnB,GAAIyX,GAAS2G,EAAM3G,OAAOzX,GACtBoX,EAASgH,EAAMhH,OAAOpX,GACtByqB,EAAkBvM,EAAKwM,mBACvB7G,EAAQ,WACV,GAAI8G,GAAqBlgB,OAAOmgB,kBAC5BC,EAAgBvE,MAQpB,OAPA9e,GAAEpL,KAAKquB,EAAiB,SAASK,EAAK5O,GACpC,GAAI6O,GAAO3T,EAAS0T,CAChBC,IAAQ,GAAYJ,EAAPI,IACfJ,EAAqBI,EACrBF,EAAgB3O,KAGb2O,IAET,KAAKhH,EAEH,WADAwG,IAGF,IAAIjK,GAAejF,EAAU8E,cAAc4D,EAC3C,IAAIzM,EAASqT,EAAgB5G,GAASzD,EAEpC,WADAiK,IAGF,IAAInL,GAAa/D,EAAU6E,qBACvBgL,EAAY9L,EAAa/D,EAAUmE,gBACvC,IAAI7H,EAASuT,EAAY9L,EAEvB,WADAmL,IAIF,IAAIY,GAAat3B,KAAKuI,MAAMub,EAASuT,EACrC,IAAIC,IAAe5B,GAAmBxF,IAAUuF,EAAY,CAE1DG,GAA4Be,aAAaf,GAEzCc,GACA,IAAIa,GAAU/P,EAAU2F,oBAAoBmK,GACxCE,EAAajN,EAAKwJ,YAAY7D,GAAOqH,EACzC,KAAKC,EAEH,MAGFrf,GAAE,IAAIge,GAAiBK,SAAS5V,OAChC8U,EAAkB4B,EAClB7B,EAAavF,EACbyF,EAAW6B,EAAWjB,IACtBhM,EAAKsK,kBAAoBrN,EAAUyJ,gBAAgBf,GAAOsH,EAAW9uB,GACrE4tB,EAAWX,GACXC,EAA2B6B,WAAW,WACpC5B,EAAwBhiB,EAAElQ,IAAI4mB,EAAKwJ,YAAa,SAAS2D,EAAOnP,GAC9D,GAAIqO,GAAOc,EAAMH,GAAShB,GAU1B,OATIK,KACErO,IAAa2H,GACf0G,EAAK7wB,MAAMqwB,OAAS,oBACpBQ,EAAK7wB,MAAM8wB,OAAS,SAEpBD,EAAK7wB,MAAMqwB,OAAS,oBACpBQ,EAAK7wB,MAAM8wB,OAAS,SAGjBD,KAER,UAITrM,EAAK8K,mBAAmBthB,OAAOL,iBAAiB,YAAa8hB,GAC7DjL,EAAK8K,mBAAmBthB,OAAOL,iBAAiB,WAAYzS,GAE5DspB,EAAKgK,SAASxuB,MAAM,YAAa,aAEnCoS,EAAE2c,EAAa/gB,QAAQ4jB,MAAM,WAC3Bxf,EAAEoS,EAAK2J,UAAUngB,QAAQ2c,KAAK,IAAInG,EAAKqN,0BAA0BC,OAAOC,OAAO,GAAG,IACjF,WACD3f,EAAEoS,EAAK2J,UAAUngB,QAAQ2c,KAAK,IAAInG,EAAKqN,0BAA0BC,OAAOE,QAAQ,OAGlF,WACE5f,EAAEqP,GAAW7d,GAAGtE,EAAOkrB,aAAc,SAASlkB,EAAK9C,GACjD,GAAIgf,GAAWhf,EAAKgf,eACbgC,GAAKyN,UAAUzP,SACfgC,GAAKuJ,sBAAsBvL,SAC3BgC,GAAKqK,wBAAwBrM,GACpCgC,EAAK0N,iBAAiB1P,GACtBgC,EAAK2N,kBAAkB3P,GACvBgC,EAAK4N,mBAAmB5P,GAExBgC,EAAK6N,uBACL7N,EAAK8N,eACL9N,EAAK+N,oBACL/N,EAAKgO,qBACLhO,EAAKiO,iBACLjO,EAAKkO,gBACLjR,EAAUjiB,SAEZ4S,EAAEqP,GAAW7d,GAAGtE,EAAO0rB,WAAY,SAAS1kB,EAAK9C,GAC/CghB,EAAK6N,uBACL7N,EAAKgL,qBAAqBhsB,EAAKunB,aAAc,OAAO,GACpDvG,EAAK+N,oBACL/N,EAAKgO,qBACL/Q,EAAUjiB,SAGZ4S,EAAEqP,GAAW7d,GAAGtE,EAAO2qB,UAAW,SAASjmB,EAAErB,GAE3C6hB,EAAKmO,UAAUhwB,EAAE6f,UACjBgC,EAAKgL,qBAAqB5C,OAAW,OAAO,GAC5CpI,EAAK6N,uBACL7N,EAAK+N,oBACL/N,EAAKgO,qBACLhO,EAAKiO,mBAKPrgB,EAAEqP,GAAW7d,GAAGtE,EAAOosB,eAAgB,SAAS1nB,EAAErB,GAEhD6hB,EAAKmO,UAAUhwB,EAAE6f,UACjBgC,EAAKgL,qBAAqB7sB,EAAE6f,SAAUoK,QAAW,GACjDpI,EAAKoO,6BAA6BjwB,EAAE6f,UACpCgC,EAAK+N,kBAAkB5vB,EAAE6f,UACzBgC,EAAKkO,gBACLlO,EAAK8N,iBAMPlgB,EAAEqP,GAAW7d,GAAGtE,EAAOqmB,iBAAkB,SAAS3hB,EAAErB,GAClD6hB,EAAKgL,qBAAqB5C,OAAWA,QAAW,GAChDpI,EAAKkO,kBAGPtgB,EAAEqP,GAAW7d,GAAGtE,EAAO4mB,SAAU,SAASliB,EAAErB,GAC1C6hB,EAAKgL,qBAAqB5C,OAAWA,QAAW,GAChDpI,EAAKqO,cACLrO,EAAKkO,kBAIPtgB,EAAEqP,GAAW7d,GAAGtE,EAAOioB,qBAAsB,WAC3C/C,EAAKgL,qBAAqB5C,OAAWA,QAAW,GAChDpI,EAAKkO,qBAjQX,GAAIpzB,GAAS+sB,iBACT3H,EAAQ5H,gBAGRkS,EAA6B,2BAC7BC,EAA4B,0BAC5BI,EAAkB,sBAClBF,EAAyB,6BAIzB2D,EAAuB,2BAEvB1C,EAAkB,qBA4uBtB,OApfA1L,GAAAA,WAAcuI,EAAsBa,mBACpCb,EAAqB5O,UAAUuU,6BAA+B,SAASpQ,GACrE,GAAIuQ,GAAWh5B,KAAKi5B,WAAWxQ,EAC/B,IAAIuQ,GAAYA,EAASE,YAAa,CACpC,GAAIzvB,GAAOzJ,KAAK0nB,UAAU4J,aAAa7I,GACnC0Q,EAAcH,EAASE,YAAYzvB,GAAMxF,OACzCm1B,EAAkBl5B,KAAKuI,MAAM,IAAM0wB,EAAc1vB,EAAKxF,OAC1DjE,MAAK80B,wBAAwBrM,GAAY2Q,IAG7ClG,EAAqB5O,UAAU+U,yBAA2B,SAAS5Q,GACjE,MAAOzoB,MAAK80B,wBAAwBrM,IAEtCyK,EAAqB5O,UAAUkR,yBAA2B,WACxD,GACI8D,IADYt5B,KAAK0nB,UAAU6E,qBAAuBvsB,KAAK0nB,UAAUmE,iBACjD7rB,KAAKw0B,oBAAoB+E,wBAE7C,OADAv5B,MAAKw5B,kBAAoBx5B,KAAKw0B,oBAAoBiF,WAAYz5B,KAAKw0B,oBAAoBiF,WAAaH,EAAcI,MAAQJ,EAAcK,MACjI35B,KAAKw5B,kBAEdtG,EAAqB5O,UAAUsV,mBAAqB,WAClD,MAAQ55B,MAAKw5B,kBAAoBx5B,KAAKw1B,4BAExCtC,EAAqB5O,UAAUuV,iBAAmB,WAChD,MAAOr2B,GAAGuC,OAAO/F,KAAK20B,mBAAqB30B,KAAKy0B,SAASxgB,SAE3Dif,EAAqB5O,UAAU+D,kBAAoB,WACjDroB,KAAK20B,kBAAoB1V,SAAS6a,0BAEpC5G,EAAqB5O,UAAU8E,iBAAmB,WAChDppB,KAAKy0B,SAASxgB,OAAOiR,YAAYllB,KAAK20B,mBACtC30B,KAAK20B,kBAAoB9B,MACzB,IAAIpI,GAAOzqB,IACXqY,GAAErY,KAAKy0B,SAASxgB,QAAQ8lB,MAAM,WAC5BtP,EAAKqO,cACLrO,EAAKgL,qBAAqB5C,OAAWA,QAAW,MAIpDK,EAAqB5O,UAAU0E,WAAa,SAASP,EAAU6C,EAAMgI,GACnES,kBAAkBzP,UAAU0E,WAAW3gB,KAAKrI,KAAMyoB,EAAU6C,EAAMgI,GAClEtzB,KAAKk0B,sBAAsBl0B,KAAKi5B,WAAWxQ,GAAUuR,mBACrDh6B,KAAK44B,UAAUnQ,GACfzoB,KAAKy1B,qBAAqBhN,EAAUoK,QAAW,GAC/C7yB,KAAKu4B,eACLv4B,KAAK64B,6BAA6BpQ,GAClCzoB,KAAKw4B,kBAAkB/P,IAEzByK,EAAqB5O,UAAU4E,eAAiB,SAASqK,EAAiBC,GACxEO,kBAAkBzP,UAAU4E,eAAe7gB,KAAKrI,KAAMuzB,EAAiBC,GACvExzB,KAAK44B,UAAUrF,GACfvzB,KAAKy1B,qBAAqBlC,EAAiBV,QAAW,GACtD7yB,KAAKu4B,eACLv4B,KAAK64B,6BAA6BtF,GAClCvzB,KAAKw4B,kBAAkBjF,IAIzBL,EAAqB5O,UAAU2V,YAAc,WAC3C,MAAOj6B,MAAKo0B,WAEdlB,EAAqB5O,UAAU4V,gBAAkB,WAC/C,MAAOl6B,MAAKq0B,gBAEdnB,EAAqB5O,UAAUqU,cAAgB,WAC7C34B,KAAKy0B,SAASxuB,MAAM,YAAajG,KAAKm6B,mBAAmB,MACpDl0B,MAAM,aAAcjG,KAAKq1B,oBAAoB,MAElDr1B,KAAKu1B,mBAAmBtvB,MAAM,YAAajG,KAAKm6B,mBAAmB,MAC9Dl0B,MAAM,aAAcjG,KAAKq1B,oBAAoB,MAClDr1B,KAAKm1B,sBAAsBlvB,MAAM,SAAUjG,KAAKq1B,oBAAsB,OAExEnC,EAAqB5O,UAAUoU,eAAiB,WAC9C14B,KAAKi6B,cAAch0B,MAAM,QAASjG,KAAKo6B,oBAAoB,MACtDn0B,MAAM,SAAUjG,KAAKq6B,qBAAqB,MAC/Cr6B,KAAKk6B,kBAAkBj0B,MAAM,QAASjG,KAAKo6B,oBAAoB,MAC1Dn0B,MAAM,SAAUjG,KAAKq6B,qBAAqB,OAIjDnH,EAAqB5O,UAAU8T,kBAAmB,SAASpL,GACzDA,EAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,YAAcD,EAC5EA,KAAexe,OAAOwe,EACtB,IAAIsN,GAAMt6B,KAAKo0B,UACX3J,EAAOzqB,IACX+T,GAAEpL,KAAKqkB,EAAW,SAASvE,GACzB6R,EAAI12B,UAAU6mB,EAAK8P,yBAAyB9R,IAAW9e,YAG3DupB,EAAqB5O,UAAUkU,kBAAoB,SAASxL,EAAWplB,EAAG4yB,GACxE,GAAIF,GAAMt6B,KAAKo0B,SACf,IAAiB,mBAANxsB,GACT0yB,EAAI12B,UAAU5D,KAAKu6B,yBAAyBvN,IAAY/mB,MAAM,MAAO2B,EAAE,UAClE,CACLolB,EAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,YAAcD,EAC5EA,KAAexe,OAAOwe,EACtB,IAAIyN,GAAaz6B,KAAK06B,oBAClBjQ,EAAOzqB,KACP26B,EAAmB36B,KAAKo6B,oBACxBQ,EAAuBD,EAAmB36B,KAAK40B,yBACnD7gB,GAAEpL,KAAKqkB,EAAW,SAASvE,GACzB,GAAIoS,GAAYJ,EAAWhS,GAEvBqS,GADoBrQ,EAAKsQ,sBAAsBtS,GAClCgC,EAAK/C,UAAUwJ,cAAczI,IAC1CuS,EAAkBF,CAClBA,GAAW72B,OAASwmB,EAAKwQ,mBAAqBT,IAChDQ,EAAkBF,EAAWz6B,UAAU,EAAEoqB,EAAKwQ,iBAAiB,GAAG,OAEpElnB,EAAEpL,KAAK2xB,EAAI12B,UAAU6mB,EAAK8P,yBAAyB9R,IAAY,SAASxU,GACtEoE,EAAEpE,GAAM+hB,KAAK,aAEfsE,EAAI12B,UAAU6mB,EAAK8P,yBAAyB9R,IAAW9e,QACvD,IAAIuxB,GAAOZ,EAAIt0B,OAAO,QACnBC,MAAM,WAAW,YACjB8C,QAAQ0hB,EAAKsQ,sBAAsBtS,IAAW,GAC9C1f,QAAQ,mCAAmC,GAC3CA,QAAQ,8BAA8B,GACtCA,QAAQ,yBAAyB,GACjCA,QAAQ,YAAY,GACpB9C,MAAM,cAAewkB,EAAKoK,gBAC1B5uB,MAAM,cAAe,QACrB2Q,KAAKokB,GACL/0B,MAAM,MAAO40B,EAAU,MACvBhxB,GAAG,YAAa,WACf4gB,EAAK0Q,UAAU1S,IAEjBpQ,GAAE6iB,EAAKjnB,QAAQ+hB,MAAOn1B,SAAU+V,KAAOkkB,EAAW72B,OAASwmB,EAAKwQ,iBAAmBH,EAAW,oBAAsB,gBAC5GxoB,UAAW2jB,GAAG,eAAgBC,GAAG,cAAeC,SAAU9d,EAAE+d,SAC5DnwB,OAASud,QAAS,wDAClB3C,MAAO7Z,MAAO,cAExB,IAAIoyB,GAAkB3O,EAAK4O,yBAAyB5Q,EACrB,oBAApB2Q,IACTkB,EAAIt0B,OAAO,QACRC,MAAM,WAAW,YACjB8C,QAAQ0hB,EAAKsQ,sBAAsBtS,IAAW,GAC9C1f,QAAQ,yBAAyB,GACjCA,QAAQ,YAAY,GACpB9C,MAAM,cAAewkB,EAAKoK,gBAC1Bje,KAAKwiB,EAAkB,KACvBnzB,MAAM,MAAO40B,EAAU,MACvB50B,MAAM,OAAQ20B,EAAqB,UAO9C1H,EAAqB5O,UAAUwT,uBAAyB,SAASrP,GAC/D,MAAO,yBAAyBkC,EAAM/G,OAAO6E,EAAU,KAEzDyK,EAAqB5O,UAAU+T,mBAAqB,SAASrL,GAC3D,GAAIsN,GAAMt6B,KAAKo0B,SACfpH,GAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,YAAcD,EAC5EA,KAAexe,OAAOwe,EACtB,IAAIvC,GAAOzqB,IACX+T,GAAEpL,KAAKqkB,EAAW,SAASvE,GACzB6R,EAAI12B,UAAU,IAAI6mB,EAAKqN,uBAAuBrP,IAAW9e,YAG7DupB,EAAqB5O,UAAUmU,mBAAqB,SAASzL,GAC3D,GAAIsN,GAAMt6B,KAAKo0B,SACfpH,GAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,YAAcD,EAC5EA,KAAexe,OAAOwe,EACtB,IAAIyN,GAAaz6B,KAAK06B,oBAClBjQ,EAAOzqB,KACP26B,EAAmB36B,KAAKo6B,mBAC5BrmB,GAAEpL,KAAKqkB,EAAW,SAASvE,GACzB,GAAI2S,GAAe3Q,EAAKqN,uBAAuBrP,EAC/C6R,GAAI12B,UAAU,IAAIw3B,GAAczxB,QAChC,IAAIgwB,GAAOgB,EAAmB,EAC1BlQ,GAAK/C,UAAUwK,iBAAiBzJ,MAClC,WACE,GAAI4S,GAAUf,EAAIt0B,OAAO,QAAQ+C,QAAQ,YAAY,GAAM9C,MAAM,YAAY,QAAQA,MAAM,QAAS,WAAWA,MAAM,SAAU,WAC9H8C,QAAQqyB,GAAc,GAAMryB,QAAQ0hB,EAAKqN,0BAA0B,GAAMjuB,GAAG,QAAS,WACpF4gB,EAAK/C,UAAUyI,YAAY1H,KAE5BxiB,MAAM,WAAY,YAAYA,MAAM,OAAQ0zB,EAAK,MAAM1zB,MAAM,MAAOw0B,EAAWhS,GAAU,KAC1F4S,GAAQzkB,KAAK,KACbyB,EAAEgjB,EAAQpnB,QAAQ4jB,MAAM,WACtBwD,EAAQp1B,MAAM,YAAa,QAAQA,MAAM,QAAS,YACjD,WACDo1B,EAAQp1B,MAAM,YAAY,QAAQA,MAAM,QAAS,aAChD+vB,MACen1B,SAAU+V,KAAM,mBAChBtE,UAAW2jB,GAAG,gBAAiBC,GAAG,aAAcC,SAAU9d,EAAE+d,SAC5DnwB,OAASud,QAAS,wDAClB3C,MAAO7Z,MAAO,aACd8Z,MAAOyV,OAAO,EAAMjgB,MAAO,IAAKtP,MAAO,iBAG3D2yB,GAAQ,IAENlP,EAAK/C,UAAUyK,8BAA8B1J,KAC/C,WACE,GAAI6S,IAAQ,0BAA2B,0BAA2B,sBAC9DC,GAAS,oCAAqC,kCAAmC,oCACjFpQ,GAAkB,EAAG,GAAI,GACzBqQ,EAAuBrQ,EAAenhB,QAAQygB,EAAK/C,UAAUyG,sBAAsB1F,IACnF4S,EAAUf,EAAIt0B,OAAO,MACzBq1B,GAAQr6B,KAAK,MAAOs6B,EAAKE,IAAuBv1B,MAAM,SAAS,WAC/DoS,EAAEgjB,EAAQpnB,QAAQ+hB,MACAn1B,SAAU+V,KAAM,WACd,MAAO2kB,GAAMC,KAEflpB,UAAW2jB,GAAG,gBAAiBC,GAAG,aAAcC,SAAU9d,EAAE+d,SAC5DnwB,OAASud,QAAS,wDAClB3C,MAAO7Z,MAAO,aACd8Z,MAAOyV,OAAO,EAAMjgB,MAAO,IAAKtP,MAAO,cAEzDq0B,EAAQtyB,QAAQqyB,GAAc,GAAMryB,QAAQ0hB,EAAKqN,0BAA0B,GAAMjuB,GAAG,QAAS,WAC3F2xB,GAAwBA,EAAuB,GAAK,EACpD/Q,EAAK/C,UAAU0G,sBAAsB3F,EAAU0C,EAAeqQ,IAC9DH,EAAQr6B,KAAK,MAAOs6B,EAAKE,MAE1Bv1B,MAAM,WAAY,YAAYA,MAAM,OAAQ0zB,EAAK,MAAM1zB,MAAM,MAAOw0B,EAAWhS,GAAU,YAOlGyK,EAAqB5O,UAAUwU,YAAc,SAAS2C,GACpDz7B,KAAKy0B,SAAS7wB,UAAU,OAAO5D,KAAK07B,mBAAmBz1B,MAAM,QAASjG,KAAK0nB,UAAU6E,qBAAqB,OAE5G2G,EAAqB5O,UAAU6T,iBAAmB,SAAS1P,GACzDzoB,KAAKy0B,SAAS7wB,UAAU,OAAO5D,KAAK27B,qBAAqBlT,IAAW9e,UAEtEupB,EAAqB5O,UAAUsX,eAAiB,SAASnT,EAAUoT,GACjE,GAAInU,GAAY1nB,KAAK0nB,UACjBje,EAAOie,EAAU4J,aAAa7I,GAE9B8I,GADS7J,EAAUqK,mBAAmBtJ,GACxBf,EAAU8J,wBAAwB/I,IAChDuQ,EAAWh5B,KAAKi5B,WAAWxQ,EAC/B,IAAKuQ,EAAL,CAGA,GAAIvO,GAAOzqB,IAEXA,MAAKi0B,YAAYxL,KACjB,IAAIqT,GAAa97B,KAAK07B,kBAClBK,EAAmB/7B,KAAK27B,qBAAqBlT,GAC7CwL,EAAcj0B,KAAKi0B,YAAYxL,GAE/BuT,EAAYx4B,EAAGuC,OAAO81B,GAAUj4B,UAAU,OAAOm4B,GAAkBtyB,KAAKA,EAC5EuyB,GAAUpyB,QAAQ5D,OAAO,OAAO+C,QAAQgzB,GAAkB,GAAMhzB,QAAQ+yB,GAAY,GACjF96B,KAAK,kBAAkB,sBACvBA,KAAK,sBAAsB,QAC3BA,KAAK,UAAW,OAAO0mB,EAAU4E,mBAAmB,IAAI5E,EAAU8E,cAAc/D,IAChFxiB,MAAM,QAASyhB,EAAU6E,qBAAqB,MAAMtmB,MAAM,SAAUyhB,EAAU8E,cAAc/D,GAAU,MACzGuT,EAAUtyB,OAAOC,QAEH+d,GAAUyJ,gBAAgB1I,EACxCuT,GAAUrzB,KAAK,SAASC,EAAEC,GACxB,GACI7E,GAAKutB,EAAY3oB,EACrBqrB,GAAYjwB,IAAOyyB,IAAKz2B,KAAM4I,EAAGA,KAEnCozB,EAAUp4B,UAAU,KAAK+F,SACzB3J,KAAKk0B,sBAAsB8E,EAASgB,gBAAgBvR,GAAYuQ,EAASiD,MAAMD,EAAWtU,EAAU4E,mBAAoB5E,EAAU8E,cAAc/D,IAChJgC,EAAKuJ,sBAAsBvL,GAAYuT,IAEzC9I,EAAqB5O,UAAUsU,UAAY,SAAS5L,GAClD,GAAI6O,EAGFA,GAFE77B,KAAK20B,kBAEI1V,SAAS6a,yBAET95B,KAAKy0B,SAASxgB,OAE3B+Y,EAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,YAAcD,EAC5EA,KAAexe,OAAOwe,EACtB,IAAIvC,GAAOzqB,IACX+T,GAAEpL,KAAKqkB,EAAW,SAASvE,GACzBgC,EAAKmR,eAAenT,EAAUoT,KAE5B77B,KAAK20B,mBACP30B,KAAK65B,mBAAmB5lB,OAAOiR,YAAY2W,GAE7ClE,WAAW,WACTtf,EAAEoS,GAAMkB,QAAQpmB,EAAOquB,qBACtB,IAILV,EAAqB5O,UAAUmR,qBAAuB,SAASzI,EAAW1hB,EAAM4wB,EAAOC,GACrFn8B,KAAKy0B,SAASxgB,OAAOyF,QAAU,OAC/BsT,EAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,YAAcD,EAC5EA,KAAexe,OAAOwe,EACtB,IAAIwM,GAAmBx5B,KAAK45B,qBACxBwC,EAAiB,GAAG5C,EAAiB,GAAKA,EAAiB,IAC3D6C,EAAkBn8B,KAAKuI,MAAM+wB,EAAiB,GAAK4C,EACvD5C,GAAmBzlB,EAAElQ,MAAMu4B,EAAgB,EAAEA,GAAiB,SAASnxB,GACrE,MAAO/K,MAAK8M,IAAI/B,EAAIoxB,EAAgBD,EAAgB,IAEtD,IAAI3R,GAAOzqB,KACPg3B,EAAkBh3B,KAAKi3B,mBACvBrM,EAAW5qB,KAAK0nB,UAAU4F,4BAC1BgP,EAASt8B,KAAKu8B,cAAclvB,OAAOC,KAAKsd,GAAU3mB,OACtD8P,GAAEpL,KAAKqkB,EAAW,SAASvE,GACzB,GAAI7gB,EACC0D,IAAiB,QAATA,IACX1D,EAAIovB,EAAgBvO,GAEtB,IAAI+T,GAAS/R,EAAK/C,UAAUqK,mBAAmBtJ,IAC1C4T,IAAoB5R,EAAKgS,sBAAyBP,IACjDzR,EAAKuJ,sBAAsBjoB,eAAe0c,IAC5CgC,EAAKuJ,sBAAsBvL,GAAU9f,KAAK,SAASC,EAAEC,GACnD,GAAI6zB,GAAQJ,EAAO1R,EAAShiB,EAAE4zB,KAC1BG,EAAO38B,KAAKiG,MAAMyT,QAClBkjB,GAAavV,MAAMqV,IAAUA,EAAQlD,EAAiB,IAAMkD,EAAQlD,EAAiB,MAAQ2C,EAAe,OAAS,SACrHQ,KAASC,IACX58B,KAAKiG,MAAMyT,QAAUkjB,GAEjBtxB,GAAiB,SAATA,GAAiC,SAAbsxB,IAChC58B,KAAKiG,MAAM0zB,KAAO+C,EAAQ,MAEtBpxB,GAAiB,QAATA,GAAgC,SAAbsxB,IAC/B58B,KAAKiG,MAAMoxB,IAAMzvB,EAAE,UAM7B5H,KAAKy8B,qBAAuBJ,EAC5Br8B,KAAKy0B,SAASxgB,OAAOyF,QAAU,SAGjCwZ,EAAqB5O,UAAUoP,iBAAmB,SAAS1G,EAAW2G,GACpE,GAAIlJ,GAAOzqB,IACXgtB,GAAiC,mBAAdA,GAA4BhtB,KAAK0nB,UAAUuF,eAAiBze,OAAOwe,GACtFjZ,EAAEpL,KAAKqkB,EAAW,SAAShpB,GACzBymB,EAAKwO,WAAWj1B,GAAI64B,qBAAuBlJ,IAE7C3zB,KAAKu4B,gBAEPrF,EAAqB5O,UAAUiU,aAAe,SAASuE,GACrD,GAAIrR,GAAazrB,KAAK0nB,UAAU4E,mBAC5B7B,EAAOzqB,KACP+8B,IACJtS,GAAKiK,aAAa9wB,UAAU,KAAK+F,SACjCoK,EAAEpL,KAAK3I,KAAKk4B,UAAW,SAASc,EAAUvQ,GACxC,IAAIuQ,EAAS6D,qBAAwBC,EAArC,CAGA,GAAIE,GAAchE,EAASgB,eACvBiD,IAIJ,IAHAlpB,EAAEpL,KAAK8hB,EAAKyJ,sBAAsB8I,GAAc,SAASE,EAAWzU,GAClEpQ,EAAE0X,OAAOkN,EAAcC,MAEpBH,EAAShxB,eAAeixB,GAAc,CACzC,GAAIG,GAAK1S,EAAKiK,aAAa1uB,OAAO,MAC9Bo3B,EAAeD,EAAGn3B,OAAO,MAAMC,MAAM,cAAe,OAAOA,MAAM,iBAAkB,OAChFD,OAAO,QAAQ+C,QAAQ,2BAA2B,EACzDq0B,GAAaxmB,KAAKoiB,EAASqE,iBAC3B,IAAIC,GAAiBH,EAAGn3B,OAAO,MAC3Bu3B,EAAavE,EAASwE,aAAaP,EAAcxR,EAAYhB,EAAK/C,UAAU8E,cAAc/D,GAC9F6U,GAAerpB,OAAOiR,YAAYqY,GAClC5S,EAAMpF,iBAAiB/hB,EAAGuC,OAAOw3B,GAAa,KAAKx0B,QAAQ,+BAA+B,GAC1Fg0B,EAASC,IAAe,OAI9B9J,EAAqB5O,UAAU6W,UAAY,SAAS1S,GAClDzoB,KAAKk6B,kBAAkBj0B,MAAM,UAAU,QACvC,IAAIoqB,GAAcrwB,KAAK0nB,UAAU4I,wBAAwB7H,GACrDgV,EAAcpN,EAAY,GAAIqN,EAAWrN,EAAYA,EAAYpsB,OAAO,GACxE05B,EAAiB39B,KAAK06B,oBACtBkD,IACJ7pB,GAAEpL,KAAK0nB,EAAa,SAASrsB,GAC3B45B,EAAW55B,GAAM25B,EAAe35B,KAElCqsB,EAAYG,OAAOH,EAAYrmB,QAAQye,GAAW,EAClD,IAAIoV,GAAmB9pB,EAAElQ,IAAIwsB,EAAa,SAASrsB,GACjD,MAAO45B,GAAW55B,KAEhB85B,EAAoB99B,KAAKq6B,qBACzB0D,GAAelL,OAAWA,OAC9BkL,GAAY,GAAKpT,EAAMhG,MAAMiZ,EAAWH,GAAc,EAAGK,GACzDC,EAAY,GAAKpT,EAAMhG,MAAMiZ,EAAWF,GAAY19B,KAAKg+B,uBAAuBN,GAAa,EAAGI,EAEhG,IAAIrT,GAAOzqB,KACPi+B,EAAkB5lB,EAAEoS,EAAKyP,kBAAkBjmB,cACxC2pB,GAAWnV,GAElB,SAAUA,GACR,GAAIyV,GAAU,GACVC,EAAc,SAAS5xB,GACrBA,EAAI6xB,iBACN7xB,EAAI6xB,kBAEF7xB,EAAI8xB,gBACN9xB,EAAI8xB,gBAEN,IAAIC,GAAU3T,EAAMhG,MAAMgG,EAAMhH,OAAOpX,GAAMwxB,EAAY,GAAIA,EAAY,GACzEtT,GAAK+N,kBAAkB/P,EAAU6V,GACjC96B,EAAGI,UAAU6mB,EAAK8P,yBAAyB9R,IAAW1f,QAAQgwB,GAAsB,GAEpFmF,EAAUnqB,EAAEwqB,YAAYV,EAAkBS,GAC1CvqB,EAAEpL,KAAKi1B,EAAY,SAASvG,EAAKrzB,GAC/BqzB,GAAO,IAAK6G,EAAU7N,EAAYpsB,QAAUosB,EAAY6N,IAAYl6B,GACpEqzB,GAAO,IAAK6G,EAAU,GAAK7N,EAAY6N,EAAQ,IAAMl6B,GACrDymB,EAAK+N,kBAAkBx0B,EAAIqzB,KAG/B4G,GAAgBp0B,GAAG,YAAas0B,EAChC,IAAIK,GAAiB,SAASjyB,GAC5B0xB,EAAgBnd,OAChBmd,EAAgBQ,IAAI,YAAaN,GAC7BD,EAAU,IACZzT,EAAK/C,UAAUoJ,UAAUrI,EAAUyV,GAGvC7lB,GAAE4G,UAAUyf,IAAI,UAAWF,IAC1B/V,IAELyK,EAAqB5O,UAAUmP,MAAQ,SAASkL,GAC9C,GAAIlU,GAAOzqB,KACP4+B,EAAOvmB,EAAErY,KAAK4a,UAAU3G,QAAQ4qB,SAChCxzB,EAAM7H,EAAGuC,OAAOkZ,SAAS8F,gBAAgB,6BAA8B,OAgF3E,OA/EA1Z,GAAIrK,KAAK,QAAShB,KAAKo6B,oBAAsBp6B,KAAKm6B,mBAAqB,MACvEn6B,KAAKu4B,cAAa,GAClBv4B,KAAKw4B,kBAAkB3F,OAAWA,OAAW8L,GAC7CtzB,EAAIrK,KAAK,SAAUqX,EAAErY,KAAK4a,UAAU3G,QAAQtN,SAAS,MACrD,WACE8jB,EAAK2J,UAAUxwB,UAAU,0BAA0B+E,KAAK,WACtD,GAAIm2B,GAAWt7B,EAAGuC,OAAO/F,MACrB6lB,EAAOiZ,EAAS74B,MAAM,gBAAkB,QACxC84B,EAASD,EAAS74B,MAAM,eACxB+4B,EAAOF,EAAS74B,MAAM,cAAgB,OACtCg5B,EAAM5mB,EAAEymB,EAAS7qB,QAAQ4qB,SACzBjoB,EAAOkoB,EAASloB,MACpBvL,GAAIrF,OAAO,QAAQC,MAAM,cAAe4f,GAAM5f,MAAM,cAAe84B,GAAQ94B,MAAM,YAAa+4B,GACzFh+B,KAAK,YAAa2pB,EAAMxjB,UAAU83B,EAAItF,KAAOiF,EAAKjF,KAAKsF,EAAI5H,IAAMuH,EAAKvH,MACtEpxB,MAAM,qBAAsB,WAC5B2Q,KAAKA,QAGd,WACE6T,EAAKgL,qBAAqB5C,OAAWA,QAAW,GAAM,GACtDpI,EAAKgK,SAAS7wB,UAAU,mBAAmB+E,KAAK,WAC9C,GAAIu2B,GAAW17B,EAAGuC,OAAO/F,MACrBm/B,EAAYD,EAASjrB,OAAOslB,wBAC5B6F,GAAYl5B,MAAOi5B,EAAUj5B,MAAOS,OAAQw4B,EAAUx4B,QACtDs4B,EAAM5mB,EAAE6mB,EAASjrB,QAAQ4qB,SACzB5X,EAAI5b,EAAIrF,OAAO,KAAKhF,KAAK,YAAa2pB,EAAMxjB,UAAU83B,EAAItF,KAAOiF,EAAKjF,KAAMsF,EAAI5H,IAAMuH,EAAKvH,KAC/F6H,GAASt7B,UAAU,KAAK+E,KAAK,WAC3BgiB,EAAM3F,mBAAmBxhB,EAAGuC,OAAO/F,MAAOinB,IAE5C,IAAIoY,IAAkBv0B,MAAOo0B,EAASj5B,MAAM,iBAAkBC,MAAOg5B,EAASj5B,MAAM,iBAChFo5B,GAAev0B,OACjBmc,EAAEjhB,OAAO,QAAQhF,KAAK,QAASo+B,EAASl5B,MAAM,MAAMlF,KAAK,SAAUo+B,EAASz4B,OAAO,MAC9EV,MAAM,OAAQ,QAAQA,MAAM,SAAUo5B,EAAev0B,OAAO7E,MAAM,eAAgBo5B,EAAen5B,SAI1GukB,EAAKgL,qBAAqB5C,OAAWA,QAAW,MAElD,WACEpI,EAAKiK,aAAa9wB,UAAU,MAAM+E,KAAK,WACrCnF,EAAGuC,OAAO/F,MAAM4D,UAAU,MAAM+E,KAAK,WACnCnF,EAAGuC,OAAO/F,MAAM4D,UAAU,sDAAsD+E,KAAK,WACnF,GAAI0P,EAAErY,MAAM4W,OAAO0oB,OAAOr7B,OAAQ,CAEhC,GAAI66B,GAAWt7B,EAAGuC,OAAO/F,MACrB6lB,EAAOiZ,EAAS74B,MAAM,gBAAkB,QAIxC84B,EAASD,EAAS74B,MAAM,eACxB+4B,EAAOF,EAAS74B,MAAM,cAAgB,OACtC2Q,EAAOkoB,EAASloB,OAChBqoB,EAAM5mB,EAAEymB,EAAS7qB,QAAQ4qB,QAC7BxzB,GAAIrF,OAAO,QAAQC,MAAM,cAAe4f,GAAM5f,MAAM,cAAe84B,GAChE94B,MAAM,YAAa+4B,GACnBh+B,KAAK,YAAa2pB,EAAMxjB,UAAU83B,EAAItF,KAAOiF,EAAKjF,KAAMsF,EAAI5H,IAAMuH,EAAKvH,MACvEpxB,MAAM,qBAAsB,WAC5B2Q,KAAKA,OACH,IAAmC,QAA/B5W,KAAKwlB,QAAQ+Z,cAAyB,CAC/C,GAAIta,GAAMzhB,EAAGuC,OAAO/F,MAChBi/B,EAAM5mB,EAAE4M,EAAIhR,QAAQ4qB,SACpB5X,EAAI5b,EAAIrF,OAAO,KAAKhF,KAAK,YAAa2pB,EAAMxjB,UAAU83B,EAAItF,KAAOiF,EAAKjF,KAAMsF,EAAI5H,IAAMuH,EAAKvH,MAC3F8H,EAAYla,EAAIhR,OAAOslB,wBACvB6F,GAAYl5B,MAAOi5B,EAAUj5B,MAAOS,OAAQw4B,EAAUx4B,QACtD04B,GAAkBv0B,MAAOma,EAAIhf,MAAM,iBAAkBC,MAAO+e,EAAIhf,MAAM,iBACtEo5B,GAAev0B,OACjBmc,EAAEjhB,OAAO,QAAQhF,KAAK,QAASo+B,EAASl5B,MAAM,MAAMlF,KAAK,SAAUo+B,EAASz4B,OAAO,MAC9EV,MAAM,OAAQ,QAAQA,MAAM,SAAUo5B,EAAev0B,OAAO7E,MAAM,eAAgBo5B,EAAen5B,OAExG+e,EAAIrhB,UAAU,KAAK+E,KAAK,WACtBgiB,EAAM3F,mBAAmBxhB,EAAGuC,OAAO/F,MAAOinB,eAOtDjnB,KAAKu4B,eACLv4B,KAAKw4B,oBACEntB,EAAI4I,QAENif,IAiEb/wB,GAAMsM,SAAQ,GAAM,mBACpBtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,SAASE,GAC1C,GAAI4C,GAAM5C,EAASI,QAAQyC,SAASpM,OAAO,SAASiI,GAChD,MAAOA,GAAEvD,QAAQ,QAAU,IAK3ByH,GADiB5C,EAASI,QAAQsB,IAC5BkB,EAAIA,EAAIxN,OAAS,GAAGlC,QAAQ,SAAU,IAGhDqB,GAAOmM,aAAa,sBAAuB,oBAAqB,WAC5D,GAAIkY,GAAO1nB,EAAGuqB,iBAAiBxjB,IAAI1G,WAAa,KAAOL,EAAGqqB,cAActjB,IAAI1G,UAC5Eo/B,GAAc/X,KAEjBtlB,EAAMsM,SAAQ,IAInB,IAAIgxB,GAAS,GACTxX,EAAW,SAAStd,GACtB,GAAI80B,GAAQ90B,EACZ,OAAOA,GACL,IAAK,eACHgf,EAAU7I,OACV8I,EAAe/I,OACfgJ,EAAS/I,MACT,MACF,KAAK,UACH6I,EAAU9I,OACV+I,EAAe9I,OACf+I,EAAShJ,MACT,MACF,KAAK,SACH8I,EAAU7I,OACV8I,EAAe/I,OACfgJ,EAAS/I,SAOX0e,EAAgB,SAAS/X,GAEzB,GAAiC,KAA3B1nB,EAAGuqB,iBAAiBxjB,KAAwC,KAAxB/G,EAAGqqB,cAActjB,IAEzD,WADAmhB,GAAS,eAIX,IAAIsC,GAAkB9C,CACtB8C,GAAkBA,EAAgB9G,MAAM,KAErC8G,EAAgBtmB,OAAS,KAC1BlE,EAAG+nB,aAAe,6EAClBG,EAAS,YAET9lB,EAAMsM,SAAQ,GACdtM,EAAMygB,aAAa2H,GACnBpoB,EAAMygB,aAAa2H,GAAiB5b,KAAK,SAASE,GAC9C,GAAII,GAAUJ,EAASI,OACvB2Y,GAAiB3Y,GACjBgZ,EAAS,WACT9lB,EAAMsM,SAAQ,OA95C5BkZ,EAAoBrmB,SAAW,QAAS,SAAU,eAAgB,WAAY,SAAU,KAAM,UAAW,IAdzG,IAAIC,IACAC,SAAU,IACVC,YAAa,0CACbG,WAAY+lB,EACZ9lB,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,cAAemmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAw9ClC4K,kBACCpC,UAAW,sBACXO,aAAc,yBACdQ,WAAY,uBACZyO,KAAM,iBACN9T,iBAAkB,6BAClB+T,eAAgB,2BAChBhO,eAAgB,2BAChBhE,aAAc,yBACdiS,WAAY,uBACZC,gBAAiB,4BACjBC,gBAAiB,4BACjBC,qBAAsB,iCACtBC,qBAAsB,iCACtBC,sBAAuB,kCACvBC,WAAY,uBACZC,oBAAqB,8CACrBvM,mBAAoB,+BACpBwM,qBAAsB,0CACtBjU,SAAU,qBACVkU,mBAAoB,+BACpB7S,qBAAsB,6BAEvB8S,mBAAqB,WACpB,GAAI3V,GAAQyL,OAAOrT,gBACfwd,EAAkC,SAASC,GAC9C,GAAIC,GAAU,MACVC,EAAY/V,EAAMxH,cAAc,YAAa,cAAe,SAAU,sBAAuB,UAAW0P,SACxG8N,EAAe,WACfC,EAAY,WACf,GAAKJ,EAIE,CACN,GAAIK,GAASlW,EAAMxH,cAAc,QAAS,UAAW,WAAY0P,QACjE,OAAO,UAAShlB,GACf,MAAOgzB,GAAOhzB,IANf,MAAO,UAASA,GACf,QAAsB,mBAANA,QASfizB,EAAW,OACXC,EAAW,OACXC,EAAmBrW,EAAMxH,cAAc,cAAe,gBAAiB0P,QAE3E,OAAO,UAASnD,EAAIC,GACnB,GAAIsR,GAAWtW,EAAM1H,KAAKyd,EAAUhR,EAAG+Q,IAAYC,EAAU/Q,EAAG8Q,IAChE,IAAiB,IAAbQ,EACH,MAAOA,EAGR,IAAIC,GAAgBvW,EAAM1H,KAAK2d,EAAUlR,EAAGiR,IAAiBC,EAAUjR,EAAGgR,IAC1E,IAAsB,IAAlBO,EACH,MAAOA,EAGR,IAAIC,GAAYxW,EAAM1H,KAAK+d,EAAiBtR,EAAGoR,IAAaE,EAAiBrR,EAAGmR,IAChF,IAAkB,IAAdK,EACH,MAAOA,EAGR,IAAIC,GAAYzW,EAAM1H,KAAK+d,EAAiBtR,EAAGqR,IAAaC,EAAiBrR,EAAGoR,IAChF,OAAkB,KAAdK,EACIA,EAGD,IAILC,GACHC,YAAWpoB,MAAO,YAAapO,MAAO,UAAWy2B,QAAS,KAC1DC,SACCC,KACCC,WACCxoB,MAAO,YACPpO,MAAO,MACP62B,aAAc,iBAEfC,QACC1oB,MAAO,YACPpO,MAAO,UACP62B,aAAc,QAEfE,aACC3oB,MAAO,YACPpO,MAAO,UACP62B,aAAc,iBAEfG,qBACC5oB,MAAO,YACPpO,MAAO,UACP62B,aAAc,qBAGhBI,MACCC,aACC9oB,MAAO,UACPpO,MAAO,UACP62B,aAAc,qBAEfM,eACC/oB,MAAO,UACPpO,MAAO,UACP62B,aAAc,wBAGhBO,MACCF,aACC9oB,MAAO,iBACPpO,MAAO,QACP62B,aAAc,wBAEfM,eACC/oB,MAAO,mBACPpO,MAAO,QACP62B,aAAc,4BAIjBA,aAAc,sBAEXQ,EAAkD9pB,EAAE0X,QAAO,KAAQsR,EACvEc,GAAgDX,QAAQY,UACvDC,KACCnpB,MAAO,cACPpO,MAAO,QACP62B,aAAc,YAGhB,IAAIW,GAA4BjqB,EAAE0X,QAAO,KAAQsR,EAwBjD,OAvBAiB,GAA0Bd,QAAQY,UACjCG,UACCrpB,MAAO,cACPpO,MAAO,QACP62B,aAAc,qBAEfa,SACCtpB,MAAO,cACPpO,MAAO,UACP62B,aAAc,oBAEfc,OACCvpB,MAAO,cACPpO,MAAO,QACP62B,aAAc,uBAEfe,QACCxpB,MAAO,oBACPpO,MAAO,QACP62B,aAAc,YAKfW,0BAA2BA,EAC3BH,gDAAiDA,EACjDQ,8BAA+BpC,GAAgC,GAC/DqC,oDAAqDrC,GAAgC,OAGvF/N,kBAAoB,WAgHnB,QAASqQ,GAA6BvP,GACrCwP,EAAaz6B,KAAKrI,KAAMszB,GACxBtzB,KAAKsrB,KAAOwH,CACZ,IAAIrI,GAAOzqB,KACP+iC,GAAa,UAAU,UAAU,UAAU,UAC7C,UAAU,UAAU,UAAU,UAC9B,UAAU,UAAU,UAAU,UAC9B,UAAU,UAAU,UAAU,UAC9B,UAAU,UAAU,UAAU,UAC9B,UAAU,UAAU,UAAU,UAC9B,UAAU,UAAU,UAAU,UAC9B,UAAU,UAAU,WAKlBC,EAAe,SAASl4B,EAAOm4B,GAClC,GAAIC,GAAevY,EAAM9F,iBAAiB,QAAQ7jB,KAAK,OAAQ8J,GAC3Dq4B,EAAY,SAAUC,GACzB,MAAO,UAASx6B,GACf,MAAO0qB,GAAO+P,YAAYz6B,KAAOw6B,IAEhCH,EACHxY,GAAK6Y,eACJH,UAAWA,EACXjqB,MAAOgqB,EACPvB,aAAcsB,IAGhB3P,GAAOxoB,MAAQwoB,EAAOxoB,UACtBiJ,EAAEpL,KAAK2qB,EAAOxoB,MAAO,SAASA,EAAOm4B,GACpCD,EAAal4B,EAAOm4B,KAErBxY,EAAK6Y,cAAcC,EAAiB,SAAS36B,GAC5C,MAAiC,OAA1B0qB,EAAO+P,YAAYz6B,IACxB,OAEH5I,KAAKiuB,SAAWqF,EAAOrF,UAAY,SAASyB,EAAGC,GAC9C,GAAI6T,GAAOlQ,EAAO+P,YAAY3T,GAC1B+T,EAAOnQ,EAAO+P,YAAY1T,EAO9B,OANoB,gBAAT6T,KACVA,EAAOA,EAAKpjC,YAEO,gBAATqjC,KACVA,EAAOA,EAAKrjC,YAETojC,IAASC,EACL,EACY,OAATD,EACHxsB,OAAOmgB,kBACK,OAATsM,EACHzsB,OAAO0sB,kBAEPF,EAAKG,cAAcF,IAG5BhZ,EAAKwR,MAAQ,SAAShV,EAAGwE,EAAYgB,GASpC,MARAxF,GAAEte,KAAK,SAASC,EAAEC,GACjB,GAAIo6B,GAAW3P,EAAO+P,YAAYz6B,EAClC,KAAK0qB,EAAOxoB,MAAMiB,eAAek3B,IAA0B,OAAbA,EAAmB,CAChE,GAAIW,GAAYb,EAAUvkB,KAC1B8U,GAAOxoB,MAAMm4B,GAAYW,EACzBZ,EAAaY,EAAWX,MAGnBH,EAAaxe,UAAU2X,MAAM5zB,KAAKrI,KAAMinB,EAAGwE,EAAYgB,IAG/DhC,EAAK+S,aAAe,SAASP,EAAcxR,EAAYgB,GACtD,GAAI6N,GAAM92B,GAAGuC,OAAOkZ,SAAS4kB,cAAc,OAU3C,OATA9vB,GAAEpL,KAAK8hB,EAAKqZ,WAAY,SAASC,GAChC,GAAI9G,EAAa8G,EAAKC,SAAU,CAC/B,GAAIzG,GAAawG,EAAKvG,aAAa/R,EAAYgB,EAC3C8Q,IACHjD,EAAIrmB,OAAOiR,YAAYqY,MAI1B5S,EAAMpF,iBAAiB+U,EAAK,KAAKr0B,MAAM,gBAAiB,QACjDq0B,EAAIrmB,QAKb,QAASgwB,GAA0B3Q,GAClCwP,EAAaz6B,KAAKrI,KAAMszB,GACxBtzB,KAAKsrB,KAAOyH,EACZ/yB,KAAKkkC,SAAW5Q,EAAO4Q,QACvB,IAAIH,GAAO/jC,KAAKmkC,iBACfjrB,MAAOyR,EAAM9F,iBAAiB,QAC9Bqf,SAAU5Q,EAAO4Q,SACjBE,WAAY9Q,EAAO8Q,WACnBC,YAAa/Q,EAAO+Q,YACpBn9B,MAAOosB,EAAOpsB,MACdo9B,SAAUhR,EAAOgR,UAElBtkC,MAAKsjC,cAAcC,EAAiB,SAAS36B,GAC5C,MAAOye,OAAMze,EAAE0qB,EAAO4Q,YACpB,OACHlkC,KAAKiuB,SAAWqF,EAAOrF,UAAY5V,EAAEksB,MAAMC,EAAkBxkC,MAC7DA,KAAKw9B,aAAe,SAASP,EAAcxR,EAAYgB,GACtD,MAAQwQ,GAAa8G,IAAS/jC,KAAKykC,SAASV,GAAMvG,aAAa/R,EAAYgB,IAAiBpU,EAAE,SAAS,IAKzG,QAASqsB,GAAqBpR,GAC7BwP,EAAaz6B,KAAKrI,KAAMszB,EACxB,IAAI7I,GAAOzqB,IACXyqB,GAAKa,KAAO0H,EACZvI,EAAKyZ,SAAW5Q,EAAO4Q,QACvB,IAAIH,GAAO/jC,KAAK2kC,iBACfT,SAAU5Q,EAAO4Q,SACjBE,WAAY9Q,EAAO8Q,WACnBl9B,MAAOosB,EAAOpsB,MACdV,KAAM8sB,EAAO9sB,KACb89B,SAAUhR,EAAOgR,UAElBtkC,MAAKsjC,cAAcC,EAAiB,SAAS36B,GAC5C,MAAOye,OAAMze,EAAE0qB,EAAO4Q,YACpB,OACHlkC,KAAKiuB,SAAWqF,EAAOrF,UAAY5V,EAAEksB,MAAMC,EAAkBxkC,MAC7DA,KAAKw9B,aAAe,SAASP,EAAcxR,EAAYgB,GACtD,MAAQwQ,GAAa8G,IAAS/jC,KAAKykC,SAASV,GAAMvG,aAAa/R,EAAYgB,IAAiBpU,EAAE,SAAS,IAKzG,QAASusB,GAA8BtR,GAErCA,EADGA,GAAUA,EAAOuR,gCACXxsB,EAAE0X,UAAWuD,EAAQwR,EAAS3C,iDAE9B9pB,EAAE0X,UAAWuD,EAAQwR,EAASxC,2BAEpChP,GAAUA,EAAOyR,2BACpB/kC,KAAKiuB,SAAW6W,EAASnC,8BAEzB3iC,KAAKiuB,SAAW6W,EAASlC,oDAE1BE,EAAaz6B,KAAKrI,KAAMszB,EACxB,IACI7I,GAAOzqB,IACXyqB,GAAKa,KAAOrC,CAEZ,IAAI+b,GAAsB,SAASC,EAAWt3B,EAAKhD,GAClD,GAWIuO,GAAOiJ,EAAO+iB,EAAQ3D,EAXtB4B,EAA2B,mBAARx1B,IAAwC,mBAAVhD,GAAwB,SAAUw6B,EAAMC,GAC5F,MAAIA,KAAWC,EACP,SAASz8B,GACf,MAA0B,mBAAZA,GAAEu8B,IAGV,SAASv8B,GACf,MAAOA,GAAEu8B,KAAUC,IAGnBz3B,EAAKhD,GAASkoB,MAEjB,QAAQoS,EAAU/rB,OACjB,IAAK,YACJA,EAAQyR,EAAM9F,iBAAiB,QAC/B1C,GAAS3b,KAAMy+B,EAAUn6B,MAAO5E,MAAO,OAAQS,OAAQ,QACvDu+B,KACA3D,EAAU5W,EAAM/G,OAAOqhB,EAAU1D,QAAS,EAC1C,MACD,KAAK,cACJroB,EAAQyR,EAAM9F,iBAAiB,QAC/B1C,GAAS3b,KAAMy+B,EAAUn6B,MAAO5E,MAAO,OAAQS,OAAQ,SAAUiB,EAAG,UACpEs9B,KACA3D,EAAU5W,EAAM/G,OAAOqhB,EAAU1D,QAAS,EAC1C,MACD,KAAK,oBACJroB,EAAQyR,EAAM9F,iBAAiB,WAC/B1C,GAASmjB,OAAQ,0BACjBJ,GAAU5+B,eAAe,MAAOE,KAAQy+B,EAAUn6B,OAClDy2B,EAAU5W,EAAM/G,OAAOqhB,EAAU1D,QAAS,EAC1C,MACD,KAAK,iBACJroB,EAAQyR,EAAM9F,iBAAiB,WAC/B1C,GAASmjB,OAAQ,0BACjBJ,GAAU5+B,eAAe,MAAOE,KAAQy+B,EAAUn6B,OAClDy2B,EAAU5W,EAAM/G,OAAOqhB,EAAU1D,QAAS,EAC1C,MACD,KAAK,mBACJroB,EAAQyR,EAAM9F,iBAAiB,WAC/B1C,GAASmjB,OAAQ,4BACjBJ,GAAU5+B,eAAe,MAAOE,KAAQy+B,EAAUn6B,OAClDy2B,EAAU5W,EAAM/G,OAAOqhB,EAAU1D,QAAS,EAC1C,MACD,KAAK,UACJroB,EAAQqsB,EACRL,GAAUM,gBAAgBP,EAAUn6B,MAAO26B,gBAAgB,QAASC,gBAAgB,OACpFnE,EAAU5W,EAAM/G,OAAOqhB,EAAU1D,QAAS,GAG5C,GAAIoE,GAAWlb,EAAK6Y,eACnBH,UAAWA,EACXjqB,MAAOA,EACPiJ,MAAOA,EACP+iB,OAAQA,EACR3D,QAASA,EACTI,aAAcsD,EAAUtD,aACxB9E,oBAAwD,mBAA3BoI,GAAUtD,cAExC,OAAOgE,IAEJC,IACJ7xB,GAAEpL,KAAK2qB,EAAOkO,QAAS,SAASqE,EAAQl4B,GACvCoG,EAAEpL,KAAKk9B,EAAQ,SAASZ,EAAWt6B,GAClCi7B,EAAcl7B,KAAKs6B,EAAoBC,EAAWt3B,EAAKhD,QAGzDoJ,EAAEpL,KAAK2qB,EAAAA,WAAgB,SAAS2R,GAC/BD,EAAoBC,KAErBxa,EAAK+S,aAAe,SAASP,EAAcxR,EAAYgB,GACtD,GAAI6N,GAAM92B,GAAGuC,OAAOkZ,SAAS4kB,cAAc,OAU3C,OATA9vB,GAAEpL,KAAK8hB,EAAKqZ,WAAY,SAASC,GAChC,GAAI9G,EAAa8G,EAAKC,SAAU,CAC/B,GAAIzG,GAAawG,EAAKvG,aAAa/R,EAAYgB,EAC3C8Q,IACHjD,EAAIrmB,OAAOiR,YAAYqY,MAI1B5S,EAAMpF,iBAAiB+U,EAAK,KAAKr0B,MAAM,gBAAiB,QACjDq0B,EAAIrmB,QAEZwW,EAAKyO,YAAc,SAASzvB,GAC3B,GAAIq8B,KAIJ,OAHA/xB,GAAEpL,KAAKi9B,EAAe,SAAS5B,GAC9B8B,EAAeA,EAAat3B,OAAOic,EAAKsb,QAAQ/B,GAASgC,WAAWv8B,MAE9DsK,EAAEkyB,KAAKH,IAuGhB,QAASI,GAAkB5S,EAAQ0Q,GAClCmC,EAAU99B,KAAKrI,KAAMszB,EAAQ0Q,GAC7BhkC,KAAKkkC,SAAW5Q,EAAO4Q,SACvBlkC,KAAKokC,WAAa9Q,EAAO8Q,WACzBpkC,KAAKomC,oBACLpmC,KAAKmiB,MAAM3b,KAAO,SAASoC,GAC1B,MAAIye,OAAMze,EAAE0qB,EAAO4Q,WACX5Q,EAAOgR,SAEPhR,EAAO9sB,MAGhBxG,KAAKskC,SAAWhR,EAAOgR,QAEvB,IAAIp9B,GAAQ,SAAS+D,GACpB,MAAqB,QAAjBqoB,EAAOpsB,MACHhH,KAAKmmC,MAAMnmC,KAAK8M,IAAI9M,KAAKyH,IAAIsD,GAAI,KAEjCA,GAGLq7B,EAAY,SAASr7B,GACxB,GAAIyjB,KAEJ,OADAA,GAAI4E,EAAO4Q,UAAYj5B,EAChByjB,EAGR1uB,MAAKumC,qBAAuB,SAASnC,GACpC,GAAIoC,GAAoBzyB,EAAElQ,IAAIugC,EAAYl9B,GACtCu/B,EAAgB,SAAS79B,GAC5B,GAAI6K,GAAQvM,EAAM0B,EAAE0qB,EAAO4Q,WACvBwC,EAAWxmC,KAAKyH,IAAI8L,EAAM+yB,EAAkB,IAAMtmC,KAAKyH,IAAI6+B,EAAkB,GAAGA,EAAkB,GACtG,OAAkB,KAAXE,GAEJC,EAAa,SAAS/9B,GACzB,OAAQye,MAAMze,EAAE0qB,EAAO4Q,WAAa,IAAO,IAAMuC,EAAc79B,IAAO,KAEnEg+B,EAAkB,SAASh+B,GAC9B,OAAQye,MAAMze,EAAE0qB,EAAO4Q,WAAa,MAAQuC,EAAc79B,IAAM,IAEjE5I,MAAKmiB,MAAMxb,OAASigC,EACpB5mC,KAAKmiB,MAAMva,EAAI++B,GAGhB3mC,KAAK6mC,eAAiB,SAAS5f,GAC9B,GAAIwD,GAAOzqB,KACP+M,EAAMiK,OAAOmgB,kBACbnqB,EAAMgK,OAAO0sB,iBAOjB,OANAzc,GAAEte,KAAK,SAASC,EAAEC,GACjB,GAAI4K,GAAQ7K,EAAE6hB,EAAKyZ,UACf4C,EAAazf,MAAM5T,EACvB1G,GAAM7M,KAAK6M,IAAIA,EAAK+5B,EAAa9vB,OAAOmgB,kBAAoB1jB,GAC5DzG,EAAM9M,KAAK8M,IAAIA,EAAK85B,EAAa9vB,OAAO0sB,kBAAoBjwB,MAErD1G,EAAKC,IAGdhN,KAAK+mC,sBAAwB,WAC5B,GAA+B,mBAApB/mC,MAAKokC,WACf,MAAOpkC,MAAKomC,mBAEZ,IAAI1X,KAGJ,OAFAA,GAAI,GAAoC,mBAAvB1uB,MAAKokC,WAAW,GAAqBpkC,KAAKomC,oBAAoB,GAAKpmC,KAAKokC,WAAW,GACpG1V,EAAI,GAAoC,mBAAvB1uB,MAAKokC,WAAW,GAAqBpkC,KAAKomC,oBAAoB,GAAKpmC,KAAKokC,WAAW,GAC7F1V,GAGT1uB,KAAKw9B,aAAe,SAAS/R,EAAYgB,GACxC,GAAKzsB,KAAKgnC,eAAV,CAGA,GAAI1M,GAAM92B,GAAGuC,OAAOkZ,SAAS4kB,cAAc,QACvCO,EAAapkC,KAAK+mC,uBACtB,KAAK3C,EACJ,MAAO9J,GAAIrmB,MAEZ,IAAIgzB,GAAqBlzB,EAAElQ,IAAIugC,EAAY,SAASn5B,GACnD,GAAIi8B,GAAuBhnC,KAAKwL,IAAI,GAAIif,EAAM/G,OAAO0P,EAAO6T,0BAA0B,GACtF,OAAOjnC,MAAKgL,MAAMD,EAAIi8B,GAAwBA,GAE/C5M,GAAIt0B,OAAO,QAAQ4Q,KAAKqwB,EAAmB,IAAIl+B,QAAQ,mDAAmD,GACvG9C,MAAM,WAAY,YAAYA,MAAM,SAAU,MAGjD,KAAK,GAFDmhC,GAAO,GACP/7B,EAAMivB,EAAIt0B,OAAO,OAAOhF,KAAK,QAASomC,EAAK,MAAMpmC,KAAK,SAAUyrB,EAAY,MAAM1jB,QAAQ,4BAA4B,GACjHF,EAAE,EAAMu+B,GAAHv+B,EAASA,IAAK,CAC3B,GAAI+b,GAAI/b,EAAEu+B,EACNx+B,GAAK,EAAEgc,GAAGwf,EAAW,GAAKxf,EAAEwf,EAAW,GACvC3wB,EAAQ6yB,EAAU19B,GAClBjC,EAAS8lB,EAAYzF,SAAShnB,KAAKmiB,MAAMxb,OAAO8M,IAAQ,GAC5DpI,GAAIrF,OAAO,QACThF,KAAK,QAAS,OACdA,KAAK,SAAU2F,EAAO,MACtB3F,KAAK,IAAMyrB,EAAY9lB,EAAQ,MAC/B3F,KAAK,OAAQsyB,EAAO9sB,MACpBxF,KAAK,IAAK6H,EAAE,MAKf,MAHAyxB,GAAIt0B,OAAO,QAAQ4Q,KAAKqwB,EAAmB,IAAIl+B,QAAQ,mDAAmD,GACvG9C,MAAM,WAAY,YAAYA,MAAM,SAAUwmB,EAAc,EAAI,MACnE9B,EAAMpF,iBAAiB+U,EAAK,KAAKr0B,MAAM,gBAAiB,QACjDq0B,EAAIrmB,SAEZjU,KAAKi8B,MAAQ,SAAShV,EAAGwE,EAAYgB,GAChB,IAAhBxF,EAAE,GAAGhjB,SAGTjE,KAAKomC,oBAAsBpmC,KAAK6mC,eAAe5f,GAC/CjnB,KAAKumC,qBAAqBvmC,KAAK+mC,yBAC/BZ,EAAU7hB,UAAU2X,MAAM5zB,KAAKrI,KAAMinB,EAAGwE,EAAYgB,KAMtD,QAAS4a,GAAkB/T,EAAQ0Q,GAClCmC,EAAU99B,KAAKrI,KAAMszB,EAAQ0Q,GAC7BhkC,KAAKkkC,SAAW5Q,EAAO4Q,SACvBlkC,KAAKokC,WAAa9Q,EAAO8Q,WACzBpkC,KAAKomC,oBACLpmC,KAAKqkC,YAAc/Q,EAAO+Q,YAC1BrkC,KAAKskC,SAAWhR,EAAOgR,QAEvB,IAAIgC,GAAY,SAASr7B,GACxB,GAAIyjB,KAEJ,OADAA,GAAI4E,EAAO4Q,UAAYj5B,EAChByjB,GAEJxnB,EAAQ,SAAS+D,GACpB,MAAqB,QAAjBqoB,EAAOpsB,MACHhH,KAAKmmC,MAAMnmC,KAAK8M,IAAI/B,EAAG,KAEvBA,EAITjL,MAAKumC,qBAAuB,SAASnC,GACpC,GAAIoC,GAAoBzyB,EAAElQ,IAAIugC,EAAYl9B,GACtCogC,EAAgB,SAAS1+B,GAC5B,GAAIye,MAAMze,EAAE0qB,EAAO4Q,WAClB,MAAO5Q,GAAOgR,QAEd,IAAI7wB,GAAQvM,EAAM0B,EAAE0qB,EAAO4Q,WAExBwC,IADcF,EAAkB,GAAIA,EAAkB,KAC1C/yB,EAAM+yB,EAAkB,KAAOA,EAAkB,GAAGA,EAAkB,IAGtF,OAFAnC,cAAe7gC,GAAG+jC,IAAIjU,EAAO+Q,YAAY,IAAIjkC,WAC3CoD,GAAG+jC,IAAIjU,EAAO+Q,YAAY,IAAIjkC,YACzBuqB,EAAM5D,WAAW2f,EAAUpT,EAAO+Q,YAAY,GAAI/Q,EAAO+Q,YAAY,IAE7ErkC,MAAKmiB,MAAM3b,KAAO8gC,GAGnBtnC,KAAK6mC,eAAiB,SAAS5f,GAC9B,GAAIwD,GAAOzqB,KACP+M,EAAMiK,OAAOmgB,kBACbnqB,EAAMgK,OAAO0sB,iBAOjB,OANAzc,GAAEte,KAAK,SAASC,EAAEC,GACjB,GAAI4K,GAAQ7K,EAAE6hB,EAAKyZ,UACf4C,EAAazf,MAAM5T,EACvB1G,GAAM7M,KAAK6M,IAAIA,EAAK+5B,EAAa9vB,OAAOmgB,kBAAoB1jB,GAC5DzG,EAAM9M,KAAK8M,IAAIA,EAAK85B,EAAa9vB,OAAO0sB,kBAAoBjwB,MAErD1G,EAAKC,IAGdhN,KAAKw9B,aAAe,SAAS/R,EAAYgB,GACxC,GAAKzsB,KAAKgnC,eAAV,CAGA,GAAI1M,GAAM92B,GAAGuC,OAAOkZ,SAAS4kB,cAAc,QACvCO,EAAapkC,KAAKokC,YAAcpkC,KAAKomC,mBACzC,KAAKhC,EACJ,MAAO9J,GAAIrmB,MAEZ,IAAIgzB,GAAqBlzB,EAAElQ,IAAIugC,EAAY,SAASn5B,GACnD,GAAIi8B,GAAuBhnC,KAAKwL,IAAI,GAAIif,EAAM/G,OAAO0P,EAAO6T,0BAA0B,GACtF,OAAOjnC,MAAKgL,MAAMD,EAAIi8B,GAAwBA,GAE/C5M,GAAIt0B,OAAO,QAAQ4Q,KAAKqwB,EAAmB,IAAIl+B,QAAQ,mDAAmD,GACvG9C,MAAM,WAAY,YAAYA,MAAM,SAAUwmB,EAAc,EAAI,EAAI,KAGvE,KAAK,GAFD2a,GAAO,GACP/7B,EAAMivB,EAAIt0B,OAAO,OAAOhF,KAAK,QAASomC,EAAK,MAAMpmC,KAAK,SAAUyrB,EAAY,MAAM1jB,QAAQ,4BAA4B,GACjHF,EAAE,EAAMu+B,GAAHv+B,EAASA,IAAK,CAC3B,GAAI+b,GAAI/b,EAAEu+B,EACNx+B,GAAK,EAAEgc,GAAGwf,EAAW,GAAKxf,EAAEwf,EAAW,GACvC3wB,EAAQ6yB,EAAU19B,EACtByC,GAAIrF,OAAO,QACThF,KAAK,QAAS,OACdA,KAAK,SAAUyrB,EAAY,MAC3BzrB,KAAK,OAAQhB,KAAKmiB,MAAM3b,KAAKiN,IAC7BzS,KAAK,IAAK6H,EAAE,MAKf,MAHAyxB,GAAIt0B,OAAO,QAAQ4Q,KAAKqwB,EAAmB,IAAIl+B,QAAQ,mDAAmD,GACvG9C,MAAM,WAAY,YAAYA,MAAM,SAAUwmB,EAAc,EAAI,EAAI,MACvE9B,EAAMpF,iBAAiB+U,EAAK,KAAKr0B,MAAM,gBAAiB,QACjDq0B,EAAIrmB,SAEZjU,KAAKi8B,MAAQ,SAAShV,EAAGwE,EAAYgB,GACpCzsB,KAAKumC,qBAAqBvmC,KAAKokC,aAAepkC,KAAKomC,oBAAsBpmC,KAAK6mC,eAAe5f,KAC7Fkf,EAAU7hB,UAAU2X,MAAM5zB,KAAKrI,KAAMinB,EAAGwE,EAAYgB,IAKtD,QAAS+a,GAAgBlU,EAAQ0Q,GAChCmC,EAAU99B,KAAKrI,KAAMszB,EAAQ0Q,GAE7BhkC,KAAKw9B,aAAe,SAAS/R,EAAYgB,GACxC,GAAKzsB,KAAKgnC,eAAV,CAGA,GAAI1M,GAAM92B,GAAGuC,OAAOkZ,SAAS4kB,cAAc,QACvC4D,EAAUnN,EAAIt0B,OAAO,OAAO+C,QAAQ,0BAA0B,GAC9DsC,EAAMo8B,EAAQzhC,OAAO,OAAOhF,KAAK,QAASyqB,EAAW,MAAMzqB,KAAK,SAAUyrB,EAAY,MAAM1jB,QAAQ,4BAA4B,EAOpI,OANA/I,MAAKi8B,MAAM5wB,EAAKogB,EAAYgB,GACxBzsB,KAAK2hC,cACRrH,EAAIt0B,OAAO,QAAQ4Q,KAAK5W,KAAK2hC,cAAc54B,QAAQ,mDAAmD,GACnG9C,MAAM,WAAY,YAAYA,MAAM,SAAUwmB,EAAc,EAAI,EAAI,MAExE9B,EAAMpF,iBAAiB+U,EAAK,KAAKr0B,MAAM,gBAAiB,QACjDq0B,EAAIrmB,SAxpBb,GAAI0W,GAAQ5H,gBACR+hB,EAAWxE,mBAEXxN,EAAoB,oBACpBC,EAAiB,iBACjB9J,EAAqB,qBACrB+J,EAAY,YAEZuS,EAAO,OACPF,EAAM,IAENrL,EAAerP,EAAMlG,gBAErB+f,EAAmB,SAAS9U,EAAIC,GACnC,GAAI+X,GAAKjiB,WAAWiK,EAAG1vB,KAAKkkC,UAAW,IACnCyD,EAAKliB,WAAWkK,EAAG3vB,KAAKkkC,UAAW,IACnC0D,EAAWvgB,MAAMqgB,GACjBG,EAAWxgB,MAAMsgB,EACrB,OAAIC,IAAYC,EACR,EACID,GAAaC,EAQdD,EACH5wB,OAAOmgB,kBAEPngB,OAAO0sB,kBAVLiE,EAALD,EACI,GACGA,EAAKC,EACR,EAEA,GAQNpE,EAAmB,SAASJ,EAAWra,GAC1C,OACEqa,UAAWA,EACXjqB,MAAOyR,EAAM9F,iBAAiB,QAC9B1C,OAAQ3b,KAAM,UAAWN,MAAO,OAAQS,OAAO,QAC/Cg7B,aAAc7Y,EACdgf,WACC3E,UAAWA,EACXjqB,MAAOyR,EAAM9F,iBAAiB,QAC9B1C,OAAQvZ,EAAG,uBACXs8B,QAAS5+B,eAAe,MAAOC,OAAS,WACxCo7B,aAAc7Y,MAIdga,EAAe,WAClB,QAASA,GAAaxP,GACrBtzB,KAAKykC,YACLzkC,KAAKg9B,YAAchD,IACnBh6B,KAAK2hC,aAAerO,EAAOqO,aAC3B3hC,KAAK68B,qBAAsB,EAE5B,GAAIkL,GAAYpd,EAAMlG,eAoDtB,OAlDAqe,GAAaxe,UAAU+Y,eAAiB,WACvC,MAAOr9B,MAAK2hC,cAEbmB,EAAaxe,UAAU0V,aAAe,WACrC,MAAOh6B,MAAKg9B,aAEb8F,EAAaxe,UAAU0jB,QAAU,SAAS1U,GACzC,GAAI0Q,GAAU+D,GAEd,OADA/nC,MAAKykC,SAAST,GAAW,GAAImC,GAAU7S,EAAQ0Q,GACxCA,GAERlB,EAAaxe,UAAUgf,cAAgB,SAAShQ,GAC/C,GAAI0Q,GAAU+D,GAEd,OADA/nC,MAAKykC,SAAST,GAAW,GAAIwD,GAAgBlU,EAAQ0Q,GAC9CA,GAERlB,EAAaxe,UAAU6f,gBAAkB,SAAS7Q,GACjD,GAAI0Q,GAAU+D,GAEd,OADA/nC,MAAKykC,SAAST,GAAW,GAAIqD,GAAkB/T,EAAQ0Q,GAChDA,GAERlB,EAAaxe,UAAUqgB,gBAAkB,SAASrR,GACjD,GAAI0Q,GAAU+D,GAEd,OADA/nC,MAAKykC,SAAST,GAAW,GAAIkC,GAAkB5S,EAAQ0Q,GAChDA,GAERlB,EAAaxe,UAAU2jB,WAAa,SAASjE,SACrChkC,MAAKykC,SAAST,IAEtBlB,EAAaxe,UAAUwf,SAAW,WACjC,GAAIrZ,GAAOzqB,KACPkoC,EAAW76B,OAAOC,KAAKtN,KAAKykC,UAC5B0D,EAAQp0B,EAAElQ,IAAIqkC,EAAU,SAASlkC,GAAM,MAAOymB,GAAKga,SAASzgC,KAC5DokC,EAAer0B,EAAEgb,OAAOoZ,EAAO,SAAS13B,GAAK,MAAOA,GAAE8wB,SAC1D,OAAO6G,IAERtF,EAAaxe,UAAU2X,MAAQ,SAAShV,EAAGwE,EAAYgB,GACtD,GAAIwQ,KAQJ,OAPAlpB,GAAEpL,KAAK3I,KAAK8jC,WAAY,SAASC,GAChC,GAAIsE,GAAkBtE,EAAKz+B,OAAO2hB,EAC9BohB,GAAgB,GAAGpkC,OAAS,IAC/Bg5B,EAAa8G,EAAKC,UAAW,GAE9BD,EAAK9H,MAAMoM,EAAiB5c,EAAYgB,KAElCwQ,GAER6F,EAAaxe,UAAUyhB,QAAU,SAAS/B,GACzC,MAAOhkC,MAAKykC,SAAST,IAEflB,IAqFRD,GAA6Bve,UAAYjX,OAAOkX,OAAOue,EAAaxe,WAsBpE2f,EAA0B3f,UAAYjX,OAAOkX,OAAOue,EAAaxe,WAsBjEogB,EAAqBpgB,UAAYjX,OAAOkX,OAAOue,EAAaxe,WA6G5DsgB,EAA8BtgB,UAAYjX,OAAOkX,OAAOue,EAAaxe,UAErE,IAAI6hB,GAAY,WACf,QAASA,GAAU7S,EAAQ0Q,GAC1BhkC,KAAKgkC,QAAUA,EACfhkC,KAAKmjC,UAAY7P,EAAO6P,WAAa,SAASv6B,GAAK,OAAO,GAC1D5I,KAAKkZ,MAAgC,mBAAjBoa,GAAOpa,MAAwByR,EAAM9F,iBAAiB,QAAUyO,EAAOpa,MAC3FlZ,KAAKuhC,QAAoC,mBAAnBjO,GAAOiO,QAA0BvhC,KAAKgkC,QAAU1Q,EAAOiO,QAC7EvhC,KAAK2hC,aAAerO,EAAOqO,aAC3B3hC,KAAK68B,oBAAsBvJ,EAAOuJ,oBAElC78B,KAAKmiB,MAAQmR,EAAOnR,UACpBniB,KAAKmiB,MAAMjc,MAAQykB,EAAM/G,OAAO5jB,KAAKmiB,MAAMjc,MAAO,QAClDlG,KAAKmiB,MAAMxb,OAASgkB,EAAM/G,OAAO5jB,KAAKmiB,MAAMxb,OAAQ,QACpD3G,KAAKmiB,MAAMlX,EAAI0f,EAAM/G,OAAO5jB,KAAKmiB,MAAMlX,EAAG,GAC1CjL,KAAKmiB,MAAMva,EAAI+iB,EAAM/G,OAAO5jB,KAAKmiB,MAAMva,EAAG,GAE1C5H,KAAKklC,OAAS5R,EAAO4R,WAErBllC,KAAK8nC,SAAW/zB,EAAElQ,IAAIyvB,EAAOwU,SAAU,SAAShkC,GAC/C,MAAO,IAAIqiC,GAAUriC,KAIvB,GAAIwkC,GAAc,SAASC,EAAUC,EAAW/c,EAAYgB,GAE3D,GAAIgc,IAAc,QAAS,KACvBC,GAAe,SAAU,IAO7B,OANAH,GAAW9iB,WAAW8iB,EAAU,IAAI,IAChCE,EAAWz+B,QAAQw+B,GAAa,GACnCD,GAAoB9c,EACVid,EAAY1+B,QAAQw+B,GAAa,KAC3CD,GAAoB9b,GAEd8b,EAAS,IAGbI,EAAc,SAAS//B,EAAGC,EAAG0/B,EAAUC,EAAW/c,EAAYgB,GACjE,GAAIiC,GAAM6Z,CAIV,IAHmB,kBAAR7Z,KACVA,EAAMA,EAAI9lB,EAAEC,IAEM,gBAAR6lB,IAAoBA,EAAI1kB,QAAQ,KAAO,GACjD,GAAkB,WAAdw+B,EACH9Z,EAAM3a,EAAElQ,IAAI6qB,EAAIjL,MAAM,KAAM,SAASmlB,GACpC,GAAIC,GAAWD,EAAGnlB,MAAM,KACpBqlB,EAAOR,EAAYO,EAAS,GAAI,IAAKpd,EAAYgB,GACjDsc,EAAOT,EAAYO,EAAS,GAAI,IAAKpd,EAAYgB,EACrD,OAAOqc,GAAK,IAAIC,IACdrlB,KAAK,SACF,CAAA,GAAkB,MAAd8kB,EAAmB,CAE7B,IAAK,GADD/kB,GAAQiL,EAAIjL,MAAM,OACb5a,EAAE,EAAG4mB,EAAOhM,EAAMxf,OAAUwrB,EAAF5mB,EAAQA,IAAK,CAC/C,GAAImgC,GAAIvlB,EAAM5a,GAAG02B,eACP,MAANyJ,GAAmB,MAANA,KAChBvlB,EAAM5a,EAAE,GAAKy/B,EAAY7kB,EAAM5a,EAAE,GAAI,IAAK4iB,EAAYgB,GACtDhJ,EAAM5a,EAAE,GAAKy/B,EAAY7kB,EAAM5a,EAAE,GAAI,IAAK4iB,EAAYgB,GACtD5jB,GAAK,GAGP,MAAO4a,GAAMC,KAAK,KAElBgL,EAAM4Z,EAAY5Z,EAAK8Z,EAAW/c,EAAYgB,GAGhD,MAAOiC,GA+BR,OA5BAyX,GAAU7hB,UAAU2X,MAAQ,SAAShV,EAAGwE,EAAYgB,GACnD,GAAIvT,GAAQlZ,KAAKkZ,MACb+vB,EAAO/vB,IAAUqsB,EAAOte,EAAI0D,EAAM3F,mBAAmB9L,EAAO+N,GAC5Die,EAASllC,KAAKklC,OACd/iB,EAAQniB,KAAKmiB,KACjBA,GAAMlX,EAAIkX,EAAMlX,GAAK,EACrBkX,EAAMva,EAAIua,EAAMva,GAAK,EACrBmM,EAAEpL,KAAKwZ,EAAO,SAASvU,EAAKD,GAC3Bs7B,EAAKjoC,KAAK2M,EAAK,SAAS/E,EAAEC,GACzB,MAAO8/B,GAAY//B,EAAGC,EAAG+E,EAAKD,EAAK8d,EAAYgB,OAGjD1Y,EAAEpL,KAAKu8B,EAAQ,SAASt3B,EAAKD,GAC5Bs7B,EAAKhjC,MAAM0H,EAAKC,KAEjBmG,EAAEpL,KAAK3I,KAAK8nC,SAAU,SAASr3B,GAC9BA,EAAEwrB,MAAMhV,EAAGwE,EAAYgB,MAGzB0Z,EAAU7hB,UAAUhf,OAAS,SAAS2hB,GACrC,MAAOA,GAAE3hB,OAAOtF,KAAKmjC,YAEtBgD,EAAU7hB,UAAU0hB,WAAa,SAASv8B,GACzC,MAAOA,GAAKnE,OAAOtF,KAAKmjC,YAEzBgD,EAAU7hB,UAAU0iB,aAAe,WAClC,OAAQhnC,KAAK68B,qBAEPsJ,IAmOR,OAhHAD,GAAkB5hB,UAAYjX,OAAOkX,OAAO4hB,EAAU7hB,WAyFtD+iB,EAAkB/iB,UAAYjX,OAAOkX,OAAO4hB,EAAU7hB,WAqBtDkjB,EAAgBljB,UAAYjX,OAAOkX,OAAO4hB,EAAU7hB,YAGnDwO,kBAAmBA,EACnBC,eAAgBA,EAChB9J,mBAAoBA,EACpB+J,UAAWA,EACXkW,YAAa,SAAS5d,EAAMgI,GAC3B,MAAIhI,KAASwH,EACL,GAAI+P,GAA6BvP,GAC9BhI,IAASyH,EACZ,GAAIkR,GAA0B3Q,GAC3BhI,IAASrC,EACZ,GAAI2b,GAA8BtR,GAC/BhI,IAAS0H,EACZ,GAAI0R,GAAqBpR,GAEzB,GAAIwP;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCf/O,kBAAoB,WAKnB,QAASA,GAAkBrM,EAAW8C,GACrCxqB,KAAKk4B,aACLl4B,KAAKmpC,UAAW,EAChBnpC,KAAK0nB,UAAYA,EACjB1nB,KAAKwqB,OAASA,EACdxqB,KAAKopC,cAAgBze,EAAM/G,OAAO4G,EAAO4e,cAAe,GACxDppC,KAAKi7B,iBAAmBtQ,EAAM/G,OAAO4G,EAAOyQ,iBAAkB,IAC9Dj7B,KAAKqpC,uBAAyB,GAE9B,SAAgC5e,GAC/B,GAAI0I,GAAa1I,EAAKoK,eAClByU,EAAkB3e,EAAMhF,WAAWzlB,KAAKwL,IAAI,GAAG+e,EAAKwQ,kBAAkB,GAAG76B,WAAY+yB,GACrFoW,EAA4B5e,EAAMhF,UAAU,OAAQwN,GACpDqW,EAAe,EACnB/e,GAAKkQ,iBAAmB2O,EAAkBE,EAAeD,GACvDvpC,MAnBJ,GACI2qB,IADS2H,iBACDvP,iBACRwP,EAAUC,iBAsHd,OAnGAuB,GAAkBzP,UAAUoX,gBAAkB,WAC7C,MAAO,kBAER3H,EAAkBzP,UAAUqX,qBAAuB,SAASlT,GAC3D,MAAOzoB,MAAK07B,kBAAkBjT,GAE/BsL,EAAkBzP,UAAUyW,sBAAwB,SAAStS,GAC5D,MAAO,8CAA8CA,GAEtDsL,EAAkBzP,UAAUiW,yBAA2B,SAAS9R,GAE/D,MAAO,IAAIzoB,KAAK+6B,sBAAsBtS,GAAUhF,MAAM,KAAKC,KAAK,MAEjEqQ,EAAkBzP,UAAUmlB,wBAA0B,SAAShhB,GAC9D,MAAO,2BAA2BA,GAEnCsL,EAAkBzP,UAAUuQ,aAAe,WAC1C,MAAO70B,MAAKwqB,OAAO2I,YAEpBY,EAAkBzP,UAAU0E,WAAa,SAASP,EAAU6C,EAAMgI,GACjE,GAAIoW,GAAenX,EAAQ2W,YAAY5d,EAAMgI,EAC7CtzB,MAAKk4B,UAAUzP,GAAYihB,EACvBA,EAAazb,UAChBjuB,KAAK0nB,UAAUsG,uBAAuBvF,EAAUihB,EAAazb,WAG/D8F,EAAkBzP,UAAU4E,eAAiB,SAASqK,EAAiBC,GACtE,GAAIwF,GAAWh5B,KAAKk4B,UAAU1E,EAC9BxzB,MAAKk4B,UAAU3E,GAAmByF,EAC9BA,EAAS/K,UACZjuB,KAAK0nB,UAAUsG,uBAAuBuF,EAAiByF,EAAS/K,WAGlE8F,EAAkBzP,UAAU2U,WAAa,SAASxQ,GACjD,MAAOzoB,MAAKk4B,UAAUzP,IAEvBsL,EAAkBzP,UAAUqlB,aAAe,WAC1C,GAAIjb,MACA9mB,EAAI5H,KAAKopC,cACT3e,EAAOzqB,IAWX,OAVA+T,GAAEpL,KAAK3I,KAAK0nB,UAAUiH,iBAAkB,SAAStJ,GAC3B,IAAjBA,EAAMphB,SAGV8P,EAAEpL,KAAK0c,EAAO,SAASrhB,GACtB0qB,EAAI1qB,GAAM4D,EACVA,GAAI6iB,EAAKuT,uBAAuBh6B,KAEjC4D,GAAK6iB,EAAK4e,0BAEJ3a,GAERqF,EAAkBzP,UAAU2S,iBAAmB,WAC9C,MAAOj3B,MAAKg3B,iBAAmBh3B,KAAKs4B,wBAErCvE,EAAkBzP,UAAUgU,qBAAuB,WAClD,GAAIsR,GAAO5pC,KAAK2pC,eACZlf,EAAOzqB,IAKX,OAJA+T,GAAEpL,KAAKihC,EAAM,SAASvS,EAAKrzB,GAC1B4lC,EAAK5lC,GAAMqzB,EAAM5M,EAAK/C,UAAUkF,gBAAgB5oB,KAEjDhE,KAAKg3B,gBAAkB4S,EAChBA,GAER7V,EAAkBzP,UAAUoW,kBAAoB,WAC/C,MAAO16B,MAAKi3B,oBAEblD,EAAkBzP,UAAU0Z,uBAAyB,SAASvV,GAC7D,MAAOzoB,MAAK0nB,UAAUgF,eAAejE,GAAY,EAAEzoB,KAAK0nB,UAAUkF,gBAAgBnE,IAEnFsL,EAAkBzP,UAAUulB,SAAW,SAAS19B,GAC/C,MAAyB,gBAAVA,GAAqBA,GAAOnM,KAAK0nB,UAAU6E,qBAAqBvsB,KAAK0nB,UAAUmE,kBAAoB,IAEnHkI,EAAkBzP,UAAUiY,cAAgB,SAASt4B,GACpD,GAAIszB,GAAYv3B,KAAK0nB,UAAU6E,qBAAuBvsB,KAAK0nB,UAAUmE,gBACrE,OAAO9X,GAAElQ,IAAIkQ,EAAEjM,MAAM,EAAE7D,GAAS,SAASgH,GAAK,MAAOA,GAAEssB,KAExDxD,EAAkBzP,UAAU6V,iBAAmB,WAC9C,MAAOn6B,MAAK0nB,UAAU2F,oBAAoBppB,QAAQjE,KAAK0nB,UAAU6E,qBAAuBvsB,KAAK0nB,UAAUmE,mBAExGkI,EAAkBzP,UAAU+Q,kBAAoB,WAC/C,GAAIuI,GAAa59B,KAAK2pC,eAClBG,EAAc9pC,KAAK0nB,UAAUuF,WACjC,IAA2B,IAAvB6c,EAAY7lC,OACf,MAAO,EAEP,IAAIy5B,GAAaoM,EAAYA,EAAY7lC,OAAO,EAChD,OAAO25B,GAAWF,GAAc19B,KAAKg+B,uBAAuBN,IAG9D3J,EAAkBzP,UAAU8V,kBAAoB,WAC/C,MAAOp6B,MAAK26B,kBAEb5G,EAAkBzP,UAAU+V,mBAAqB,WAChD,MAAOr6B,MAAKq1B,qBAEbtB,EAAkBzP,UAAU5Q,OAAS,WACpC,KAAM,qCAEAqgB,KAER,WACI,YAOA,SAASlxB,KAaL,QAASknC,GAAmB5nC,EAAOC,EAAQtC,EAAUsD,EAAQf,GAEzD,GAAI3C,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAId,IAAIzC,GAAKC,IACTD,GAAG0X,QAAUpV,EAAaE,WAC1BxC,EAAGiqC,YACHjqC,EAAGyJ,QACHzJ,EAAG+X,OAAS,GACZ/X,EAAG+Q,aAAe,WACdpR,QAAQgB,QAAQ,sBAAsB6Q,YAAY,+BAClD7R,QAAQgB,QAAQ,4BAA4B6Q,YAAY,qCAI5D,IAAI04B,EAGJ9nC,GAAMsM,SAAQ,GACdtM,EAAMgf,gBAAgBphB,EAAG0X,SAAS9I,KAAK,SAASE,GAC5C9O,EAAGiqC,SAAWn7B,EAASI,QAAQ+6B,SAC/BjqC,EAAGyJ,KAAOqF,EAASI,QAAQwC,IAC3B3R,EAAS,WACLmqC,EAAUvqC,QAAQgB,QAAQ,uBAAuBwpC,WAC7CC,QAAU,IAEd/mC,EAAOoM,OAAO,YAAa,WACvBy6B,EAAQG,MAAMtyB,OAAO/X,EAAG+X,QAAQ1T,SAEpCjC,EAAMsM,SAAQ,IACf,GAAG,KA7Bds7B,EAAmBzoC,SAAW,QAAS,SAAU,WAAY,SAAU,eAfvE,IAAIC,IACAC,SAAU,IACVC,YAAa,wCACbG,WAAYmoC,EACZloC,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,aAAcsB,MAuDjC,WACI,YAOA,SAASwnC,KAcL,QAASC,GAAkBnoC,EAAOgB,EAAWf,EAAQtC,EAAUsD,EAAQf,EAAc6V,EAAWyF,EAASpa,EAAQF,EAAS0Q,GAEtH,GAAIrU,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAKd,IAAI+nC,GACA1kC,EAAUnG,QAAQgB,QAAQ,kBAG1BX,EAAKyqC,EAAoBxqC,KAAMqC,EAGnCtC,GAAG6P,OAAS,WACR,GAAI1J,GAAQ7C,EAAQ+F,UACyB,SAAzC1J,QAAQgB,QAAQ,SAASM,KAAK,YAAmBkF,GAAS,KAC9DL,EAAQK,MAAOA,GACfL,EAAQc,OAAOtD,EAAQuD,YAAc,IACjC2jC,GAASA,EAAQ36B,UAIzBlQ,QAAQgB,QAAQ2C,GAAShC,KAAK,SAC1B0S,EAAEwD,SAASxX,EAAG6P,OAAQ,MAE1BlQ,QAAQgB,QAAQ2C,GAAShC,KAAK,QAC1B,WACI+B,EAAOwH,OAAO,WACV7K,EAAG0qC,gBAAiB,EACpB1qC,EAAG2qC,mBAAoB,MAMnCvoC,EAAMsM,SAAQ,GACdk8B,EAASxoC,EAAOpC,EAAI,SAAS0J,GAGzB1J,EAAG6P,QAGH,IAAIs1B,GAAS0F,GAGbL,GAAUM,EAAgBphC,EAAMy7B,EAAQhtB,EAAWxY,QAAQgB,QAAQ,mBAGnEoqC,EAAkBP,EAASxqC,EAAIqD,GAG/B2nC,EAAqBR,EAASxqC,EAAIqD,EAAQjB,EAAOrC,EAAUiU,GAG3Di3B,EAAqBT,EAASxqC,EAAIqD,EAAQtD,GAG1CmrC,EAAiBV,EAASxqC,EAAIqD,EAAQtD,EAAUqC,EAAOwb,GAGvDutB,EAAiBX,EAASxqC,EAAIqD,GAG9B+nC,EAAeZ,EAASx2B,GAGxBq3B,EAAmBb,EAASxqC,EAAIsD,GAGhCgoC,EAAkBd,EAASpnC,EAAW4Q,GAGtC5R,EAAMsM,SAAQ,KAItB,QAASy8B,GAAiBI,EAAOvrC,EAAIqD,GAGjCA,EAAOoM,OAAO,gBAAiB,WAC3B,GAAI9P,QAAQ4C,YAAYvC,EAAGwrC,YAEvB,YADAxrC,EAAGyrC,iBAAmB,GAG1BF,GAAM/yB,YACN,IAAIkzB,IAAWC,MAAM,EACrBJ,GAAM/wB,MAAM,yBACPnO,QAAQ,SAASkM,GACd,MAAmB,IAAfvY,EAAGwrC,eAAkBjzB,GAAIE,gBAC2C,GAApEF,EAAI7O,OAAOhH,KAAK88B,cAAcv1B,QAAQjK,EAAGwrC,WAAWhM,gBACpDjnB,EAAIvS,SACJ/F,KAAK0rC,OAAS,GAEdpzB,EAAIE,aAETizB,GACPH,EAAM7yB,WACa,IAAf1Y,EAAGwrC,WAAgBxrC,EAAG4rC,iBAAmB,GACxC5rC,EAAG4rC,iBAAmB,IAAIF,EAAQC,MAAO,cAIlDtoC,EAAOoM,OAAO,mBAAoB,WAC9B,IAAI9P,QAAQ4C,YAAYvC,EAAG6rC,eAA3B,CACAN,EAAM/yB,YACN,IAAIkzB,IAAWC,MAAM,EACrBJ,GAAM/wB,MAAM,4BACPnO,QAAQ,SAASkM,GACd,MAAsB,IAAlBvY,EAAG6rC,kBAAqBtzB,GAAIE,gBACyC,GAArEF,EAAI7O,OAAOzF,GAAGu7B,cAAcv1B,QAAQjK,EAAG6rC,cAAcrM,gBACrDjnB,EAAIvS,SACJ/F,KAAK0rC,OAAS,GAEdpzB,EAAIE,aAEbizB,GACHH,EAAM7yB,WACgB,IAAlB1Y,EAAG6rC,cAAmB7rC,EAAG8rC,oBAAsB,GAC9C9rC,EAAG8rC,oBAAsB,IAAIJ,EAAQC,MAAO,eAGzD,QAASN,GAAmBE,EAAOvrC,EAAIsD,GACnCtD,EAAG+rC,mBAAqB/rC,EAAGgsC,oBAAoB,GAC/ChsC,EAAGisC,oBACEvpC,KAAK,aAAcoa,IAAI,WACpB9c,EAAGisC,kBAAkBjiC,SAAShE,QAC9B,IAAIkmC,KACJlsC,GAAGisC,kBAAkBjiC,SAChBmiC,aAAa,QACb9/B,QAAQ,SAAS0D,GACd9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,YAC5BuyB,GACPX,EAAMa,UAAUF,MAEnBxpC,KAAK,aAAcoa,IAAI,WACpB,GAAIovB,KACJlsC,GAAGisC,kBAAkBjiC,SAChBmiC,aAAa,QACb9/B,QAAQ,SAAS0D,GACd9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,SAC5BuyB,GACPX,EAAMa,UAAUF,MAEnBxpC,KAAK,0BAA2Boa,IAAI,WACjCyuB,EAAM/yB,aACNxY,EAAGisC,kBAAkBjiC,SAAShE,SAC9BhG,EAAGisC,kBAAkBjiC,SAChBmiC,aAAa,QACb9/B,QAAS,SAASkM,GACfA,EAAIvS,WAEZulC,EAAM7yB,WACN1Y,EAAG2qC,mBAAoB,KAE1BjoC,KAAK,4BAA6Boa,IAAI,WACnCyuB,EAAM/yB,aACNxY,EAAGisC,kBAAkBjiC,SAChBmiC,aAAa,QACb9/B,QAAS,SAASkM,GACfA,EAAIE,aAEZ8yB,EAAM7yB,WACN1Y,EAAG2qC,mBAAoB,KAE1BjoC,KAAK,iBAAkBoa,IAAI,WAExB,GAAmB,UAAf9c,EAAGwC,WAAP,CACA,GAAIxC,EAAGwC,WAAWyH,SAAQ,GAAc,CACpC,GAAIoiC,GAAarsC,EAAGwC,WAAWkY,OAAO,GAAK,QACvC9E,EAAQ5V,EAAGisC,kBAAkBjiC,SAASmiC,aAAa,QAAQroC,IAAI,SAASwoC,GACxE,MAAOA,GAAE5iC,OAAOhH,OACjBihB,KAAK,KACJtN,EAAM,gDAAkDg2B,EAAa,MAAQz2B,CACjFtS,GAAQipC,KAAKl2B,GAEjBrW,EAAG2qC,mBAAoB,MAG/B3qC,EAAGwsC,iBACE9pC,KAAK,aAAcoa,IAAI,WACpB9c,EAAGwsC,eAAexiC,SAAShE,QAE3B,IAAIkmC,KACJlsC,GAAGwsC,eAAexiC,SACbmiC,aAAa,QACb9/B,QAAQ,SAAS0D,GACd9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,YAC5BuyB,GACPX,EAAMa,UAAUF,MAEnBxpC,KAAK,aAAcoa,IAAI,WACpB,GAAIovB,KACJlsC,GAAGwsC,eAAexiC,SACbmiC,aAAa,QACb9/B,QAAQ,SAAS0D,GACd9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,SAC5BuyB,GACPX,EAAMa,UAAUF,MAEnBxpC,KAAK,6BAA8Boa,IAAI,WACpCyuB,EAAM/yB,aACNxY,EAAGwsC,eAAexiC,SAAShE,SAC3BhG,EAAGwsC,eAAexiC,SACbmiC,aAAa,QACb9/B,QAAS,SAASkM,GACfA,EAAIvS,WAEZulC,EAAM7yB,WACN1Y,EAAG0qC,gBAAiB,KAEvBhoC,KAAK,+BAAgCoa,IAAI,WACtCyuB,EAAM/yB,aACNxY,EAAGwsC,eAAexiC,SACbmiC,aAAa,QACb9/B,QAAS,SAASkM,GACfA,EAAIE,aAEZ8yB,EAAM7yB,WACN1Y,EAAG2qC,mBAAoB,KAE1BjoC,KAAK,iBAAkBoa,IAAI,WACxBxZ,EAAQipC,KAAK,qDAAqDvsC,EAAGwsC,eAAexiC,SAASN,OAAOhH,MACpG1C,EAAG0qC,gBAAiB,KAG5B1qC,EAAGysC,aACEC,UAAc,WACXnB,EAAMtwB,MACNswB,EAAMlxB,UAEVsyB,QAAY,WACRpB,EAAMtwB,IAAKswB,EAAMjzB,EAAE,aAAc,KAErCs0B,qBAAwB,WACpB,GAAIC,GAAYtB,EAAMjzB,EAAE,kCACpBw0B,EAAYD,EAAU/oC,IAAI,SAASiM,GAAO,MAAOA,GAAKrG,OAAOhH,OAC7DqqC,EAAeF,EAAUV,aAAa,OAE1CZ,GAAM/yB,aACNu0B,EAAaxnC,OAAO,SAASuD,EAAGgD,GAC5B,GAAIkhC,GAAmBlhC,EAAQqgC,aAAa,QAAQroC,IAAI,SAASiM,GAAO,MAAOA,GAAKrG,OAAOhH,MAI3F,OAHAoqC,GAAUzgC,QAAQ,SAAS4gC,GACvB,MAAwC,IAApCD,EAAiB/iC,QAAQgjC,IAAsB,EAAnD,UAEG,IACR5gC,QAAS,SAASkM,GACjBA,EAAIvS,WAERulC,EAAM7yB,YAEVw0B,kBAAqB,WACjB,GACIt3B,GADAm3B,EAAexB,EAAMjzB,EAAE,oCAG3By0B,GAAankC,KAAK,SAASE,EAAGyP,GAC1B,GAAI40B,GAAe50B,EAAI4zB,aAAa,QAAQroC,IAAK,SAASiM,GAAO,MAAOA,GAAKrG,OAAOhH,MAC1EkT,GAAH,GAAH9M,EAAcqkC,EAENv3B,EAAMrQ,OAAO,SAASkjB,GAC1B,MAAO0kB,GAAaljC,QAAQwe,IAAO,GACpC0kB,KAGX5B,EAAM/yB,aACN+yB,EAAMjzB,EAAE,yBACHjM,QAAQ,SAAS6H,GACV0B,EAAM3L,QAAQiK,EAAKxK,OAAOhH,OAAO,GACjCwR,EAAKlO,WAGjBulC,EAAM7yB,YAGV00B,iBAAoB,WAChB,GAAIlB,KACJX,GAAMjzB,EAAE,qCACHjM,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QAAQ9/B,QAAQ,SAAS0D,GACvC9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,YAC5B1Z,OACRisC,GACHX,EAAMa,UAAUF,IAEpBmB,iBAAoB,WAChB,GAAInB,KACJX,GAAMjzB,EAAE,qCACHjM,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QAAQ9/B,QAAQ,SAAS0D,GACvC9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,SAC5B1Z,OACRisC,GACHX,EAAMa,UAAUF,IAEpBoB,cAAiB,WACb,GAAIpB,KACJX,GAAMjzB,EAAE,kCACHjM,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QAAQ9/B,QAAQ,SAAS0D,GACvC9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,YAC5B1Z,OACRisC,GACHX,EAAMa,UAAUF,IAEpBqB,cAAiB,WACb,GAAIrB,KACJX,GAAMjzB,EAAE,kCACHjM,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QAAQ9/B,QAAQ,SAAS0D,GACvC9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,SAC5B1Z,OACRisC,GACHX,EAAMa,UAAUF,IAEpBsB,qBAAyB,WACrBjC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,qCACH6zB,aAAa,QACb9/B,QAAS,SAASkM,GACfA,EAAIvS,WAEZulC,EAAM7yB,YAEV+0B,wBAA4B,WACxBlC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,kCACH6zB,aAAa,QACb9/B,QAAS,SAASkM,GACfA,EAAIvS,WAEZulC,EAAM7yB,YAEVg1B,eAAmB,WACfnC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,4BACHjM,QAAS,SAASkM,GACfA,EAAIvS,WAEZulC,EAAM7yB,YAEVi1B,YAAgB,WACZpC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,yBACHjM,QAAS,SAASkM,GACfA,EAAIvS,WAEZulC,EAAM7yB,YAEVk1B,iBAAqB,WACjBrC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,qCACHjM,QAAS,SAASkM,GACfA,EAAIE,aAEZ8yB,EAAM7yB,YAEVm1B,cAAkB,WACdtC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,kCACHjM,QAAS,SAASkM,GACfA,EAAIE,aAEZ8yB,EAAM7yB,YAEVo1B,uBAA2B,WACvBvC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,4BACHjM,QAAS,SAASkM,GACfA,EAAIA,EAAIw1B,SAAS/jC,SAAS,WAAW,cAE7CuhC,EAAM7yB,YAEVs1B,oBAAwB,WACpBzC,EAAM/yB,aACN+yB,EAAMjzB,EAAE,yBACHjM,QAAS,SAASkM,GACfA,EAAIA,EAAIw1B,SAAS/jC,SAAS,WAAW,cAE7CuhC,EAAM7yB,YAEVu1B,UAAa,WACT1C,EAAM/yB,aACN+yB,EAAMjzB,EAAE,4BACHjM,QAAS,SAASkM,GACfA,EAAIA,EAAIw1B,SAAS/jC,SAAS,WAAW,cAE7CuhC,EAAMjzB,EAAE,yBACHjM,QAAS,SAASkM,GACfA,EAAIA,EAAIw1B,SAAS/jC,SAAS,WAAW,cAE7CuhC,EAAM7yB,YAEVw1B,YAAgB,WACZ3C,EAAM/yB,aACN+yB,EAAMjzB,EAAE,iBACHjM,QAAS,SAASkM,GACfA,EAAIE,aAEZ8yB,EAAM7yB,YAEVy1B,aAAiB,WACb,GAAIjC,KACJX,GAAMjzB,EAAE,gCAAgCjM,QAAQ,SAAS0D,GACrD9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,SAC5BuyB,GACHX,EAAMa,UAAUF,KAI5B,QAASzB,GAAoBzqC,EAAIsC,GA+B7B,MA7BAtC,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGwsC,gBAAiB,EACpBxsC,EAAG0qC,eACH1qC,EAAGisC,kBACHjsC,EAAG2qC,mBAAoB,EACvB3qC,EAAGgsC,oBACHhsC,EAAG+rC,mBACH/rC,EAAGouC,kBACHpuC,EAAGquC,iBACHruC,EAAGsuC,cACHtuC,EAAGuuC,aACHvuC,EAAGwuC,cACHxuC,EAAGyuC,YACHzuC,EAAG0uC,cACH1uC,EAAG2uC,kBACH3uC,EAAGwrC,WACHxrC,EAAG4rC,iBAAmB,GACtB5rC,EAAG6rC,cACH7rC,EAAG8rC,oBAAsB,GACzB9rC,EAAGgF,eACHhF,EAAGoE,cAAgB,GACnBpE,EAAGsqB,kBACHtqB,EAAGuqB,iBACHvqB,EAAGmqB,eACHnqB,EAAGqqB,cACHrqB,EAAGysC,YACHzsC,EAAG8L,QACH9L,EAAGyoB,KACHzoB,EAAGkV,MACIlV,EAEX,QAASsrC,GAAkBC,EAAOnoC,EAAW4Q,GASzC,QAAS46B,KACL,GAAIC,EAAsC,YAAtBA,GAAe,EACnC,IAAI9nC,GAAMwkC,EAAMjzB,EAAE,kCAAkCxU,IAAI,SAASyU,GAAM,MAAOA,GAAI7O,OAAOzF,GAAGkQ,eAC5F/Q,GAAU6Q,iBAAiB,qBAAsB,SAAUlN,GAG/D,QAAS+nC,KACL,GAAIC,EAA4C,YAAzBA,GAAkB,EACzC,IAAIhoC,GAAMwkC,EAAMjzB,EAAE,qCAAqCxU,IAAI,SAASyU,GAAM,MAAOA,GAAI7O,OAAOzF,GAAGkQ,eAC/F/Q,GAAUe,oBAAoB,qBAAsB,SAAU4C,GAGlE,QAASioC,KACLH,GAAe,CAEf,IAAI3C,EACJX,GAAM/yB,aACe,MAAjBy2B,EACA1D,EAAMjzB,EAAE,kCACCjM,QAAS,SAASkM,GACfA,EAAIE,WACJyzB,EAAO3zB,EAAItU,OAAS0V,QAAQ,YAC7BuyB,GAEXX,EAAMjzB,EAAE,yBACHjM,QAAS,SAASkM,GACfA,EAA8B,IAAxBtY,KAAKgK,QAAQsO,EAAItU,MAAa,WAAa,aAClDgrC,GAEX1D,EAAMa,UAAUF,GAChBX,EAAM7yB,WAEV,QAASw2B,KACLH,GAAkB,CAElB,IAAI7C,EACJX,GAAM/yB,aACkB,MAApB22B,EACA5D,EAAMjzB,EAAE,qCACCjM,QAAS,SAASkM,GACfA,EAAIE,WACJyzB,EAAO3zB,EAAItU,OAAS0V,QAAQ,YAC7BuyB,GAEXX,EAAMjzB,EAAE,4BACHjM,QAAS,SAASkM,GACfA,EAA8B,IAAxBtY,KAAKgK,QAAQsO,EAAItU,MAAa,WAAa,aAClDkrC,GAEX5D,EAAMa,UAAUF,GAChBX,EAAM7yB,WAvDV,GAAIu2B,GAAmD,MAAhC7rC,EAAUgS,mBAA8B,KAAOhS,EAAUgS,mBAAmBrO,IAC/FooC,EAAyD,MAAnC/rC,EAAU0D,sBAAiC,KAAO1D,EAAU0D,sBAAsBC,IACxG8nC,GAAe,EACfE,GAAkB,CAqEtB,OAdA3rC,GAAUqS,sBAAsB9F,IAAI,SAASC,GACzCq/B,EAA8B,MAAXr/B,EAAmB,KAAOA,EAAU7I,IACvDioC,MAEJ5rC,EAAUsM,yBAAyBC,IAAI,SAASC,GAC5Cu/B,EAAiC,MAAXv/B,EAAmB,KAAOA,EAAU7I,IAC1DmoC,MAGJF,IACAE,IACA3D,EAAMzhC,GAAG,SAAU,wBAAyBkK,EAAEwD,SAASo3B,EAAmB,MAC1ErD,EAAMzhC,GAAG,SAAU,2BAA4BkK,EAAEwD,SAASs3B,EAAsB,OAG5EM,UAAWR,EACXS,aAAcP,GAItB,QAAShE,GAAgBphC,EAAMy7B,EAAQhtB,EAAWm3B,GAG9C,MAAOn3B,IACH0C,UAAWy0B,EACXx0B,SAAUpR,EACVxD,MAAOi/B,EACPoK,qBAAqB,EACrBC,sBAAsB,EACtBC,mBAAmB,EACnBC,YAAY,EACZ/qC,QAAS,IACToW,QAAS,GACTC,QACItY,KAAM,SACNuY,KAAK,KAKjB,QAAS4vB,KAeL,QAEI7xB,SAAU,OACV9S,OACIypC,sBAAuB,UACvBC,6BAA8B,UAC9BC,6BAA8B,MAC9BC,wBAAyB,QAI7B92B,SAAU,OACV9S,OACIyT,QAAW,gBACX/S,OAAU,mCACVT,MAAS,mCACT2T,YAAa,gBACbb,cAAe,YAGnBD,SAAU,2BACV9S,OACIkT,mBAAoB,cACpBF,cAAe,SACfG,eAAgB,EAChBC,eAAgB,aAGpBN,SAAU,oCACV9S,OACIoT,eAAgB,UAChBD,eAAgB,MAGpBL,SAAU,wBACV9S,OACIkT,mBAAoB,UACpBE,eAAgB,UAChBJ,cAAe,QACf6P,MAAS,WACT1P,eAAgB,mBAGpBL,SAAU,iCACV9S,OACIoT,eAAgB,UAChBD,eAAgB,MAGpBL,SAAU,8BACV9S,OACI4T,YAAa,OACbZ,cAAe,SACfE,mBAAoB,UACpBrO,MAAQ,UACRuO,eAAgB,oBAChB1S,OAAU,OACVT,MAAS,QACTgT,MAAS,iBACT4P,MAAS,gBAGb/P,SAAU,OACV9S,OACIyT,QAAW,gBACXJ,aAAc,cACdpT,MAAS,mBAKrB,QAAS+kC,GAAiBK,EAAOvrC,EAAIqD,EAAQtD,EAAUqC,EAAOwb,GAG1D,GAAIpY,GAAS,SAAUoY,GACnB,GAAImyB,GAAW,GAAInyB,GAAQO,OACvB6xB,EAAU,GAAIpyB,GAAQO,OACtB8xB,EAAY,GAAIryB,GAAQO,OACxB+xB,EAAU,GAAItyB,GAAQO,OACtBgyB,EAAc,GAAIvyB,GAAQO,OAC1BiyB,EAAa,GAAIxyB,GAAQO,OACzBkyB,EAAe,GAAIzyB,GAAQO,OAC3BmyB,EAAa,GAAI1yB,GAAQO,OACzBoyB,EAAY,WACZR,EAASQ,YACTP,EAAQO,YACRN,EAAUM,YACVL,EAAQK,YACRJ,EAAYI,YACZH,EAAWG,YACXF,EAAaE,YACbD,EAAWC,aAEXC,EAAO,SAAStmC,GAChB6lC,EAASpgC,IAAIzF,GACbimC,EAAYxgC,IAAIzF,IAEhBumC,EAAM,SAASvmC,GACf8lC,EAAQrgC,IAAIzF,GACZkmC,EAAWzgC,IAAIzF,IAEfof,EAAQ,SAASpf,GACjB+lC,EAAUtgC,IAAIzF,GACdmmC,EAAa1gC,IAAIzF,GAErB,QACI6lC,SAAUA,EACVC,QAASA,EACTC,UAAWA,EACXC,QAASA,EACTC,YAAaA,EACbC,WAAYA,EACZC,aAAcA,EACdC,WAAYA,EACZE,KAAMA,EACNC,IAAKA,EACLnnB,MAAOA,EACPinB,UAAWA,IAEhB3yB,EAGH2tB,GACKzhC,GAAG,QAAS,wBAAyBtE,EAAOyqC,UAAUtxB,UACtD7U,GAAG,QAAS,2BAA4BtE,EAAO6qC,aAAa1xB,UAC5D7U,GAAG,YAAa,wBAAyBtE,EAAOuqC,SAASpxB,UACzD7U,GAAG,YAAa,2BAA4BtE,EAAO2qC,YAAYxxB,UAC/D7U,GAAG,WAAY,wBAAyBtE,EAAOwqC,QAAQrxB,UACvD7U,GAAG,WAAY,2BAA4BtE,EAAO4qC,WAAWzxB,UAC7D7U,GAAG,SAAU,wBAAyBtE,EAAO0qC,QAAQvxB,UACrD7U,GAAG,SAAU,2BAA4BtE,EAAO8qC,WAAW3xB,SAIhE,IAAI0uB,KACJ9B,GAAMjzB,EAAE,gCACHjM,QAAQ,SAAS6H,GAAOjU,KAAKiU,EAAKjQ,OAAU0V,QAAS,SAAY0zB,EAGtE,IAAIqD,IACAC,gBAAiB,SAASzmC,GACtBlK,EAAGwsC,eAAexiC,SAAWE,EAAEgR,QAC/B,IAAI01B,GAAK1mC,EAAE6Z,cACP8sB,EAASlxC,QAAQgB,QAAQ,iBAO7B,OANAkwC,GAAO/vB,OACPzd,EAAOwH,OAAO,WACV7K,EAAG0qC,gBAAiB,IAExBmG,EAAO7qB,KAAK4T,KAAMgX,EAAG16B,MAAM,GAAIohB,IAAKsZ,EAAGz6B,MAAM,KAC7C06B,EAAOhgB,KAAK,UAAUha,KAAK7W,EAAGwsC,eAAexiC,SAASN,OAAOhH,MACtDzC,MAEX6wC,mBAAoB,SAAS5mC,GACzBlK,EAAGisC,kBAAkBjiC,SAAWE,EAAEgR,QAClC,IAAI01B,GAAK1mC,EAAE6Z,cACP8sB,EAASlxC,QAAQgB,QAAQ,oBAO7B,OANAkwC,GAAO/vB,OACPzd,EAAOwH,OAAO,WACV7K,EAAG2qC,mBAAoB,IAE3BkG,EAAO7qB,KAAK4T,KAAMgX,EAAG16B,MAAM,GAAIohB,IAAKsZ,EAAGz6B,MAAM,KAC7C06B,EAAOhgB,KAAK,UAAUha,KAAK7W,EAAGisC,kBAAkBjiC,SAASN,OAAOhH,MACzDzC,MAEX8wC,gBAAiB,SAAS7mC,GACtB,GAAkC,WAA9BA,EAAEgR,SAASxR,OAAOsnC,SAClBhxC,EAAG8L,QAAU5B,EAAEgR,SAASja,KAAK,WAC7BjB,EAAGixC,mBAAqB/mC,EAAEgR,SAASixB,aAAa,QAC3CroC,IAAI,SAASiM,GAAQ,MAAOA,GAAKrG,OAAOzF,KAC7CZ,EAAOwH,aACN,CACD,GAAI4d,IACA/lB,KAAMwH,EAAEgR,SAASxR,OAAOhH,KACxBwuC,SAAUhnC,EAAEgR,SAASi2B,cAAc,6BAA6BjtC,OAChEktC,KAAMlnC,EAAEgR,SAASi2B,cAAc,6BAA6BjtC,OAC5DmtC,KAAMnnC,EAAEgR,SAASi2B,cAAc,6BAA6BjtC,OAC5DotC,KAAMpnC,EAAEgR,SAASi2B,cAAc,6BAA6BjtC,OAC5DqtC,KAAMrnC,EAAEgR,SAASi2B,cAAc,6BAA6BjtC,OAEhEukB,GAAK+oB,UAAY/oB,EAAK2oB,KAAO3oB,EAAK4oB,KAAO5oB,EAAK6oB,KAAO7oB,EAAK8oB,KAC1DvxC,EAAGyoB,KAAOA,EACVplB,EAAOwH,SAEX,MAAO5K,OAEXwxC,gBAAiB,WAIb,MAHApuC,GAAOwH,OAAO,WACV7K,EAAGyoB,KAAOzoB,EAAG8L,QAAU9L,EAAGixC,mBAAqB,OAE5ChxC,MAEXyxC,cAAe,SAASxnC,GACpB,GAAIgiC,MACA9jC,EAAwC,WAA9B8B,EAAEgR,SAASxR,OAAOsnC,SAAyB,SAAW,QAEpEzF,GAAM/yB,aACNtO,EAAEgR,SAASixB,aAAa,QACnB9/B,QAAQ,SAAS0D,GACd9P,KAAKisC,OAAOn8B,EAAK9L,OAAS0V,QAAQ,WAClC5J,EAAK9P,KAAKmI,UAAU4d,KAChB5M,mBAAmBrJ,EAAKrG,OAAOqB,MAC/BuO,eAAgBvJ,EAAKrG,OAAOqB,MAC5BsO,eAAgB,GAChBs4B,iBAAkB,OAEtBzF,OAAOA,EAAQ9jC,OAAOA,IAC9BmjC,EAAM7yB,WACN6yB,EAAMa,UAAUF,IAEpB0F,cAAe,SAAS1nC,GACpB,GAAIgiC,MACA9jC,EAAwC,WAA9B8B,EAAEgR,SAASxR,OAAOsnC,SAAyB,SAAW,SAChEhrB,GACA5M,mBAAoB,GACpBE,eAAgB,GAChBD,eAAgB,GAChBs4B,iBAAkB,GAEtBpG,GAAM/yB,aACNtO,EAAEgR,SAASixB,aAAa,QACnB9/B,QAAQ,SAAS0D,GACd9P,KAAKisC,OAAOn8B,EAAK9L,OAAS0V,QAAQ,QAClC5J,EAAK3H,KAAUlC,MAAMjG,KAAK+lB,OAC1BkmB,OAAOA,EAAQlmB,IAAIA,EAAK5d,OAAOA,IACvCmjC,EAAM7yB,WACN6yB,EAAMa,UAAUF,IAEpB2F,cAAe,SAAS3nC,GACpB,GAAIgiC,KACJhiC,GAAEgR,SAASixB,aAAa,QACnB9/B,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QACb9/B,QAAQ,SAAS0D,GACd9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,YAChC1Z,OACJisC,GACPX,EAAMa,UAAUF,IAEpB4F,cAAe,SAAS5nC,GACpB,GAAIgiC,KACJhiC,GAAEgR,SAASixB,aAAa,QACnB9/B,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QACb9/B,QAAQ,SAAS0D,GACd9P,KAAK8P,EAAK9L,OAAS0V,QAAQ,SAChC1Z,OACJisC,GACPX,EAAMa,UAAUF,KAKpB6F,IAEArvC,KAAM,WACNsvC,SAAU,WACNxsC,EAAO0qC,QAAQvgC,IAAI+gC,EAAUC,iBAC7BnrC,EAAO8qC,WAAW3gC,IAAI+gC,EAAUI,oBAChCtrC,EAAOgrC,KAAK,SAAStmC,GACjBwmC,EAAUK,gBAAgB7mC,KAE9B1E,EAAOirC,IAAI,SAASvmC,GAChBwmC,EAAUe,gBAAgBvnC,MAGlC+nC,WAAY,WAGRzsC,EAAO+qC,YACPhF,EAAMa,UAAUiB,MAKpB3qC,KAAM,sBACNsvC,SAAU,WACN,GAAI9F,KACJX,GAAMjzB,EAAE,qCACHjM,QAAQ,SAAS6H,GACdA,EAAKi4B,aAAa,QAAQ9/B,QAAS,SAAS6lC,GACxCjyC,KAAKiyC,EAAKjuC,OAAU0V,QAAS,YAC9BuyB,IACJA,GACPX,EAAMa,UAAUF,GAChBX,EAAMzhC,GAAG,SAAU,QAASqoC,IAAG,GAAO,SAASjoC,GAC3CwmC,EAAUgB,cAAcxnC,KAE5BqhC,EAAMzhC,GAAG,WAAW,QAAQqoC,IAAG,GAAO,SAASjoC,GAC3CwmC,EAAUkB,cAAc1nC,KAE5B1E,EAAOgrC,KAAK,SAAStmC,GACjBwmC,EAAUK,gBAAgB7mC,KAE9B1E,EAAOirC,IAAI,SAASvmC,GAChBwmC,EAAUe,gBAAgBvnC,MAIlC+nC,WAAY,WAGR1G,EAAMa,UAAUiB,GAChB9B,EAAM7M,IAAI,SAAU,QACpB6M,EAAM7M,IAAI,WAAY,WAK1Bh8B,KAAM,sBACNsvC,SAAU,WAKNxsC,EAAOgrC,KAAK,SAAStmC,GACjBwmC,EACKK,gBAAgB7mC,GAChBwnC,cAAcxnC,KAGvB1E,EAAOirC,IAAI,SAASvmC,GAChBwmC,EACKe,gBAAgBvnC,GAChB0nC,cAAc1nC,MAG3B+nC,WAAY,WACRzsC,EAAO+qC,cAKfvwC,GAAGgsC,oBAAsB+F,EACzB/xC,EAAG+rC,mBAAqB/rC,EAAGgsC,oBAAoB,GAG/C3oC,EAAOoM,OAAO,wBAAyB,SAAS8T,EAAM1W,GAC9ClN,QAAQkd,UAAUhQ,IAAOA,EAAKolC,aAC9BtyC,QAAQkd,UAAU0G,IAAOA,EAAKyuB,aAI1C,QAAS/G,GAAqBM,EAAOvrC,EAAIqD,EAAQtD,GAG7C,GAAIqyC,KACI1vC,KAAM,WACN2D,QAAO,eACP0E,MAAO,UACPsnC,MAAO,cAEP3vC,KAAM,WACN2D,QAAO,cACP0E,MAAO,UACPsnC,MAAO,cAEP3vC,KAAM,WACN2D,QAAO,cACP0E,MAAO,UACPsnC,MAAO,cAEP3vC,KAAM,WACN2D,QAAO,cACP0E,MAAO,SACPsnC,MAAO,cAEP3vC,KAAM,WACN2D,QAAO,cACP0E,MAAO,UACPsnC,MAAO,cAEXC,GACApB,SAAakB,EAAO,GACpBG,WAAaH,EAAO,GACpBI,WAAaJ,EAAO,GACpBK,WAAaL,EAAO,GACpBM,WAAaN,EAAO,GAIxBryC,GAAS,WACLqyC,EAAO/lC,QAAQ,SAAS0D,GACpBpQ,QAAQgB,QAAQ,IAAMoP,EAAAA,UAAYiW,IAAI,eAAgBjW,EAAKhF,QAE/D,IAAImhC,KACJX,GAAMoH,MAAM,gCACPtmC,QAAQ,SAAS6lC,GACdjyC,KAAKiyC,EAAKjuC,OAAS8G,MAAQunC,EAASJ,EAAKxoC,KAAK,aAAaqB,MAAO6nC,QAAQ,IAC3E1G,GACPX,EAAMa,UAAUF,KAGpBlsC,EAAGwuC,cAAgB4D,EAGnBpyC,EAAG6yC,WAAa,SAAS9iC,EAAM+iC,GAC3B,GAAI/iC,EAAKsiC,OAASS,EAAlB,CACA/iC,EAAKsiC,MAAQS,CACb,IAAIT,EACJ,QAAOS,GACH,IAAK,YACDT,GAAStnC,MAAQgF,EAAKhF,MAAO6nC,QAAQ,EACrC,MACJ,KAAK,OACDP,GAAStnC,MAAQ,UAAW6nC,QAAQ,EACpC,MACJ,KAAK,OACDP,GAAStnC,MAAQ,UAAW6nC,QAAQ,GAK5CjzC,QAAQgB,QAAQ,IAAMoP,EAAAA,UAAYiW,IAAI,eAAgBqsB,EAAMtnC,MAG5D,IAAImhC,KACJX,GAAMoH,MAAM,kBAAkB5iC,EAAKrN,KAAK,MACnC2J,QAAQ,SAAS6lC,GAEdjyC,KAAKisC,OAAOgG,EAAKjuC,MAAQhE,KAAKoyC,QAC9BnG,OAAOA,EAAQmG,MAAMA,IAC7B9G,EAAMa,UAAUF,KAKxB,QAASd,GAAeG,EAAOv3B,GAC3Bu3B,EAAMzhC,GAAG,MAAOkK,EAAEwD,SAAS,SAAStN,GAChC,GAAItE,GAAOzF,KAAK8M,IAAI/C,EAAE8L,GAAGpQ,OAAQ,GAC7BsmC,KACApmB,EAAO3lB,KAAK4rB,KAAK5rB,KAAK8M,IAAI,GAAGrH,EAAM,IACnCmtC,EAAU5yC,KAAK4rB,KAAK5rB,KAAK8M,IAAI,EAAErH,EAAM,IACzC2lC,GAAM/wB,QAAQnO,QAAQ,SAAS6H,GAC3BjU,KAAKisC,OAAOh4B,EAAKjQ,OACb2uC,QAAU1+B,EAAK8+B,SAAS/yC,KAAK2F,KAC7BqtC,QAASntB,EACTitB,QAAQA,KAEX7G,OAAOA,EAAQtmC,KAAKA,EAAMkgB,KAAKA,EAAMitB,QAAQA,IAClDxH,EAAMa,UAAUF,IACjB,MAGP,QAASlB,GAAqBO,EAAOvrC,EAAIqD,EAAQjB,EAAOrC,EAAUiU,GAC9D,QAASk/B,KACL,GAAIC,GAAgB5H,EAAMjzB,EAAE,qCACxB86B,IAGJD,GAAcvqC,KAAK,SAASwD,EAAO8H,GAC1BvU,QAAQ4C,YAAY6wC,EAAKl/B,EAAKxK,OAAOqB,QAAUqoC,EAAKl/B,EAAKxK,OAAOqB,OAAS,EACzEqoC,EAAKl/B,EAAKxK,OAAOqB,QAAU,IAIpChL,EAAS,WACL,IAAK,GAAI+I,GAAE,EAAGA,EAAE9I,EAAGyuC,YAAYvqC,OAAQ4E,IAAI,CACvC,GAAIiC,GAAQ/K,EAAGyuC,YAAY3lC,GAAGiC,KAC9B/K,GAAGyuC,YAAY3lC,GAAGuqC,IAAM1zC,QAAQkd,UAAUu2B,EAAKroC,IAAUqoC,EAAKroC,GAAS,KAKnFwgC,EAAMzhC,GAAG,SAAUkK,EAAEwD,SAAS07B,EAAqB,MACnD3H,EAAMzhC,GAAG,WAAYkK,EAAEwD,SAAS07B,EAAqB,MAGrD9wC,EAAMqf,+BAA+B7S,KAAK,SAASE,GAC/C,GAAIw/B,KAAmB5rC,KAAM,YAAYA,KAAM,WAAWA,KAAM,oBAC5D/C,SAAQkd,UAAU/N,EAASI,QAAQhL,UACnCoqC,EAAgBA,EAAc7/B,OAAQK,EAASI,QAC1CpL,IAAI,SAASiM,GAAQ,OAAQrN,KAAQqN,OAG9C/P,EAAGsuC,cAAgBA,EACnBtuC,EAAGuuC,aAAevuC,EAAGsuC,cAAc,GACnCjrC,EAAOoM,OAAO,kBAAmB,WAC7B,GAAIy8B,KACJ,QAAOlsC,EAAGuuC,aAAa7rC,MACnB,IAAK,UACD1C,EAAGyuC,cAAgB/rC,KAAK,WAAYqI,MAAM,UAAWsoC,IAAI,IACzD9H,EAAMjzB,EAAE,4BACHjM,QAAQ,SAAS6H,GACdg4B,EAAOh4B,EAAKjQ,OAAS8G,MAAM,aAEnCwgC,EAAMa,UAAUF,EAChB,MACJ,KAAK,SACDlsC,EAAGyuC,cAAgB/rC,KAAK,OAAQqI,MAAM,SAAUsoC,IAAI,IAAK3wC,KAAK,SAAUqI,MAAM,QAASsoC,IAAI,IAC3F9H,EAAMjzB,EAAE,4BACHjM,QAAQ,SAAS6H,GACd,IACI,GAAIo/B,GAASp/B,EAAKxK,KAAK,WAAW,GAAG,EACrCwiC,GAAOh4B,EAAKjQ,OAAS8G,MAAiB,SAATuoC,EAAmB,SAAY,SAC/D,MAAMppC,GACHgiC,EAAOh4B,EAAKjQ,OAAS8G,MAAO,cAGxCwgC,EAAMa,UAAUF,EAChB,MACJ,KAAK,mBACDlsC,EAAGyuC,cAAgB/rC,KAAK,QAASqI,MAAM,QAASsoC,IAAI,IAAK3wC,KAAK,MAAOqI,MAAM,MAAOsoC,IAAI,IACtF9H,EAAMjzB,EAAE,4BACHjM,QAAQ,SAAS6H,GACd,IACI,GAAIq/B,GAAMt8B,OAAO/C,EAAKxK,KAAK,WAAW,GAAG,GACzCwiC,GAAOh4B,EAAKjQ,OAAS8G,MAAO,OAAW,IAAMwoC,EAAO,IAAO,IAAQ,KAAO,IAAMA,GAAQ,IAAO,OAClG,MAAMrpC,GACHgiC,EAAOh4B,EAAKjQ,OAAS8G,MAAO,cAGxCwgC,EAAMa,UAAUF,EAChB,MACJ,SACI9pC,EAAMsf,wBAAwB1hB,EAAGuuC,aAAa7rC,MAAMkM,KAAK,SAASE,GAC9D9O,EAAGyuC,YAAc3/B,EAASI,QAAQsB,IAC7B1M,IAAI,SAASoG,GAAI,MAAOA,GAAE,GAAK,IAAMA,EAAE,KACvC3E,OAAO,SAASiI,EAAG1E,EAAG0qC,GAAK,MAAOA,GAAEvpC,QAAQuD,KAAO1E,IACnDhF,IAAI,SAASoG,GAAK,GAAInG,GAAImG,EAAEwZ,MAAM,IAC/B,QAAShhB,KAAQqB,EAAE,GAAIgH,MAAShH,EAAE,GAAKsvC,IAAI,IAO/C,KAAK,GALD5pC,GAAOqF,EAASI,QAAQyC,SACxBnB,EAAM1B,EAASI,QAAQsB,IACvBgK,EAAQ+wB,EAAMjzB,EAAE,4BAGXxP,EAAE,EAAGA,EAAE0R,EAAMtW,OAAQ4E,IAAI,CAC9B,GAAI7E,GAAKuW,EAAM1R,GAAG7E,IAClBioC,GAAOjoC,IAAO8G,MAAM,UACpB,KAAK,GAAI0oC,GAAG,EAAGA,EAAGhqC,EAAKvF,OAAQuvC,IACvBxvC,GAAIwF,EAAKgqC,KACTvH,EAAOjoC,IAAO8G,MAAMyF,EAAIijC,GAAI,KAIxClI,EAAMa,UAAUF,KAI5BgH,QAIZlzC,EAAG0zC,WAAa,SAAS3jC,EAAM/J,GAC3BulC,EAAM/yB,aACN+yB,EAAM/wB,MAAM,4BACPnO,QAAQ,SAAS6H,GACVA,EAAKhO,MAAM,qBAAqB6J,EAAKhF,OAAOmJ,EAAK,EAAS,SAAS,gBAE/Eq3B,EAAM7yB,YAId,QAASqyB,GAAkBQ,EAAOvrC,EAAIqD,GAClCrD,EAAGouC,oBAAsB1rC,KAAM,SAASA,KAAM,qBAC9C1C,EAAGquC,iBAAmBruC,EAAGouC,kBAAkB,GAC3C/qC,EAAOoM,OAAO,sBAAuB,SAASuL,GAC1C,GAAIR,GAAQ+wB,EAAM/wB,MAAM,2BAExB,QADA+wB,EAAM/yB,aACEwC,EAAOtY,MAGX,IAAK,OACD8X,EAAMnO,QAAQ,SAAS6H,GACnBA,EAAK3B,SAAS2B,EAAKxK,KAAK,UAE5B,MAGJ,KAAK,mBACD8Q,EAAMnO,QAAQ,SAAS6H,GACnB,IACI,GAAIq/B,GAAMt8B,OAAO/C,EAAKxK,KAAK,WAAW,GAAG,GACzC6pC,GAAMA,EAAIzvC,IAAI,EAAG,IAAK,KAAO,KAC7BoQ,EAAK3B,UACD1K,EAAG0rC,EACHroC,EAAI/K,KAAKwL,IAAI4nC,EAAK,GAAK,IAAQ,MAEtC,MAAMrpC,GACHgK,EAAK3B,UAAUrH,EAAE,IAAIrD,EAAE,MAG/B,MAGJ,KAAK,SACD2S,EACKjV,OAAO,SAAS6G,EAAO8H,GACpB,IAAK,MAAkD,QAA1CA,EAAKxK,KAAK,WAAW,GAAG,GAAG81B,cACxC,MAAMt1B,GAAI,OAAO,KAEpBmC,QAAQ,SAAS6H,EAAM9H,GACpB,GAAIH,GAAI,GACJC,EAAI,IACJynC,EAAQ,IAAOvnC,EAAM,GACrBlB,EAAI,MAASe,EAAEC,EAAIynC,GAASxzC,KAAKyzC,IAAID,GACrC9rC,EAAI,OAASoE,EAAEC,EAAIynC,GAASxzC,KAAK0zC,IAAIF,EACzCz/B,GAAK3B,UACDrH,EAAGA,EACHrD,EAAGA,MAGf2S,EACKjV,OAAO,SAAS6G,EAAO8H,GACpB,MAAOvU,SAAQ4C,YAAY2R,EAAKxK,KAAK,WAAW,MAEnD2C,QAAQ,SAAS6H,EAAM9H,GACpB,GAAIH,GAAI,IACJC,EAAI,IACJynC,EAAQ,IAAOvnC,EAAM,GACrBlB,EAAI,OAASe,EAAEC,EAAIynC,GAASxzC,KAAKyzC,IAAID,GACrC9rC,EAAI,GAAKoE,EAAEC,EAAIynC,GAASxzC,KAAK0zC,IAAIF,EACrCz/B,GAAK3B,UACDrH,EAAGA,EACHrD,EAAGA,MAGf2S,EACKjV,OAAO,SAAS6G,EAAO8H,GACpB,IAAK,MAAkD,UAA1CA,EAAKxK,KAAK,WAAW,GAAG,GAAG81B,cACxC,MAAMt1B,GAAI,OAAO,KAEpBmC,QAAQ,SAAS6H,EAAM9H,GACpB,GAAIH,GAAI,IACJC,EAAI,IACJynC,EAAQ,IAAOvnC,EAAM,GACrBlB,EAAI,MAASe,EAAEC,EAAIynC,GAASxzC,KAAKyzC,IAAID,GACrC9rC,EAAI,MAAQoE,EAAEC,EAAIynC,GAASxzC,KAAK0zC,IAAIF,EACxCz/B,GAAK3B,UACDrH,EAAGA,EACHrD,EAAGA,MAKvB0jC,EAAM7yB,aAId,QAASkyB,GAASxoC,EAAOpC,EAAI8zC,GAGzB1xC,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,WAGjCxM,EAAMmO,uBAAuBvQ,EAAGwC,YAAYoM,KAAK,SAASE,GACtD,GAAIvK,GAAeuK,EAASI,QAAQsB,GAGpCpO,GAAMwf,kBAAkB9S,EAASI,SAASN,KAAK,SAASE,GACpD,GAAIilC,GAAcp0C,QAAQib,SAAS9L,EAASI,SAAS4L,QAGrDi5B,GAAYv5B,MACPjV,OAAO,SAASwK,GAAQ,MAA8B,YAAvBA,EAAKrG,KAAKsnC,WACzCltC,IAAI,SAAS8G,GACV,GAAIlB,GAAOkB,EAAMlB,IACjBA,GAAKiQ,QAAU,UACfjQ,EAAKqB,MAAQ,UACbrB,EAAKkpC,QAAUlpC,EAAKspC,OACpBtpC,EAAKupC,QAAU,GACfvpC,EAAKqpC,QAAU,EACfrpC,EAAKsqC,MAAQ9oC,EAAGN,EAAM2H,SAASrH,EAAGrD,EAAG+C,EAAM2H,SAAS1K,GACpD6B,EAAKoC,QAAU7L,KAAKsF,OAAO,SAASwK,GAAO,MAAOA,GAAK,KAAKnF,EAAMlB,KAAKzF,MACxEM,GAGPwvC,EAAYv5B,MACPjV,OAAO,SAASwK,GAAS,MAA8B,WAAtBA,EAAKrG,KAAKsnC,WAC3CltC,IAAI,SAAS8G,GACV,GAAIlB,GAAOkB,EAAMlB,IASjB,OARAA,GAAKiQ,QAAU,UACfjQ,EAAKqB,MAAQ,oBACbrB,EAAKkpC,QAAUlpC,EAAKspC,OACpBtpC,EAAKupC,QAAU,GACfvpC,EAAKqpC,QAAU,EACfnoC,EAAMqpC,OAAgC,SAAtBrpC,EAAMlB,KAAKsnC,SAC3BpmC,EAAMspC,WAAoC,SAAtBtpC,EAAMlB,KAAKsnC,SAC/BpmC,EAAMupC,UAAmC,SAAtBvpC,EAAMlB,KAAKsnC,SACvBpmC,IAIfmpC,EAAYpB,MACP7uC,IAAI,SAAS8G,GACV,GAAIlB,GAAOkB,EAAMlB,IAQjB,OAPAA,GAAKiQ,QAA0B,cAAfjQ,EAAK0qC,SAA0B,UAAY,OAC3D1qC,EAAKqB,MAAQ,oBACbrB,EAAKkpC,QAAU,EACflpC,EAAKupC,QAAU,GACfroC,EAAMqpC,QAAS,EACfrpC,EAAMspC,YAAa,EACnBtpC,EAAMupC,WAAY,EACXvpC,IAIfkpC,EAAGC,SAruCnBxJ,EAAkBhpC,SAAW,QAAS,YAAa,SAAU,WAAY,SAAU,eAAgB,YAAa,UAAW,SAAU,UAAW,IAhBhJ,IAAIC,IACAC,SAAU,IACVC,YAAa,sCACbC,SACAE,WAAY0oC,EACZzoC,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAhBX7B,QACKC,OAAO,aACP4B,UAAU,YAAa8oC,MAkwChC,WACI,YAQA,SAAS35B,KAcL,QAAS0jC,GAAgBjyC,EAAOC,GAE5B,GAAIsd,GAAUvd,EAAMwe,aAEhB5gB,EAAKC,IACTD,GAAGs0C,QAAU30B,EAAQe,aACrB1gB,EAAGogB,KAAOT,EAAQgB,UAClB3gB,EAAGu0C,UAAW,EAEdv0C,EAAG2Q,MAAQ,WACP,GAAI+M,GAAUiC,EAAQhP,MAAM3Q,EAAGogB,KAC3BzgB,SAAQkd,UAAUa,GAClBA,EAAQ9O,KAAK,WACL5O,EAAGogB,KAAKJ,cACR3d,EAAOI,GAAG,cAEVzC,EAAGu0C,UAAW,IAItBlyC,EAAOI,GAAG,eAftB4xC,EAAgB9yC,SAAW,QAAS,SAjBpC,IAAIC,IACAC,SAAU,IACVC,YAAa,kCACbM,SAAS,EACTH,WAAYwyC,EACZvyC,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAjBX7B,QACKC,OAAO,aACP4B,UAAU,UAAWmP,MA+C9B,WACI,YAOA,SAASA,KAEL,GAAInP,IACAC,SAAU,IACVC,YAAa,oCACbM,SAAS,EAGb,OAAOR,GAbX7B,QACKC,OAAO,aACP4B,UAAU,WAAYmP,MAgB/B,WACI,YAMA,SAAS6jC,KAcL,QAASC,GAAkBpyC,GACvB,GAAIrC,GAAKC,IACTD,GAAG2Q,MAAQ,WACPtO,EAAOI,GAAG,UAGlBgyC,EAAkBlzC,SAAW,SAlB7B,IAAIC,IACAC,SAAU,IACVC,YAAa,sCACbM,SAAS,EACTH,WAAY4yC,EACZ3yC,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAhBX7B,QACKC,OAAO,aACP4B,UAAU,YAAagzC,MA2BhC,WACI,YAOA,SAASE,KAaL,QAASC,GAAkBvyC,EAAOgB,EAAWf,EAAQtC,EAAUsD,EAAQG,EAAQlB,EAAc0R,GA4CzF,QAAS3P,KAEL,IAAI1E,QAAQ4C,YAAY2nC,KACxBA,EAAQ0K,eACRlrC,EAAO+H,EAAQjB,IACI,GAAf9G,EAAKxF,QAAT,CACA,GAAI2E,GAAIa,EAAK5F,IAAI,SAAS+E,GACtB,MAAOA,GAAE,KAET2qC,EAAI9pC,EAAK5F,IAAI,SAAS+E,GACtB,MAAOA,GAAE,IAIblJ,SAAQgB,QAAQk0C,GAAGC,UAAUC,IAAIh9B,QAAU,SAASi9B,EAAUtrC,GAC1D,GAAI2G,GAAWqV,WAAWhc,EAAK,IAC3BurC,EAAYvvB,WAAWhc,EAAK,GAChC,OAAmB,OAAf/F,GACoC,IAAhCA,EAAYsG,QAAQP,EAAK,KAAkB,EAE/C4d,MAAMjX,IAAaiX,MAAM2tB,IAAmB,EACxCA,GAAaj1C,EAAGk1C,cACpBD,EAAaj1C,EAAGm1C,aAAe,GAC/B9kC,GAAYrQ,EAAGo1C,aACf/kC,EAAYrQ,EAAGq1C,YAAc,IAGrCt1C,EAAS,WACLC,EAAGk1C,aAAel1C,EAAGs1C,kBAAoBn1C,KAAKuI,MAAMvI,KAAK6M,IAAIkvB,MAAM,KAAMrzB,IACzE7I,EAAGm1C,aAAen1C,EAAGu1C,kBAAoBp1C,KAAK4rB,KAAK5rB,KAAK8M,IAAIivB,MAAM,KAAMrzB,IACxE7I,EAAGo1C,YAAcp1C,EAAG+U,iBAAmB5U,KAAKuI,MAAMvI,KAAK6M,IAAIkvB,MAAM,KAAMsX,IACvExzC,EAAGq1C,YAAcr1C,EAAGiV,iBAAmB9U,KAAKuI,MAAMvI,KAAK8M,IAAIivB,MAAM,KAAMsX,IACvEtJ,EAAQsL,UAAU9rC,GAClBwgC,EAAQG,MAAMhmC,UAtEtB,GALAhB,EAAOoyC,IAAI,WAAY,WACnBz1C,EAAG01C,YAAY,QACftyC,EAAUkc,oBAGV3f,QAAQ4C,YAAYD,EAAaE,YAEjC,WADAH,GAAOI,GAAG,aAId,IAAIynC,GACAz4B,EACA/H,EACA/F,EAAkD,MAAnCP,EAAU0D,sBAAiC,KAAO1D,EAAU0D,sBAAsBC,IAGjG/G,EAAKC,IACTD,GAAGwC,WAAaF,EAAaE,WAC7BxC,EAAGuF,OACHvF,EAAGiqC,YACHjqC,EAAGk1C,aAAel1C,EAAGs1C,kBAAoB,EACzCt1C,EAAGm1C,aAAen1C,EAAGu1C,kBAAoB,GACzCv1C,EAAGo1C,YAAcp1C,EAAG+U,iBAAmB,EACvC/U,EAAGq1C,YAAcr1C,EAAGiV,iBAAmB,GACvCjV,EAAG+X,OAAS,GAGZ/X,EAAG01C,YAAc,SAASnwC,GACtB5B,EAAc,IACd,IAAIgyC,GAAIzL,EAAQl2B,EAAE,MACdzO,OAAU,YACXzB,IAAI,SAASiM,GACZ,MAAOA,GAAK,GAAG1P,WAAW8T,eAE9BwhC,GAAIh2C,QAAQmE,IAAI6xC,EAAG,SAAS/qC,GACxB,OAAQA,KAEZxH,EAAUe,oBAAoB,kBAAmBoB,EAAQowC,GACzDzL,EAAQG,MAAMhmC,QA2ClBjC,EAAMsM,SAAQ,GACdtM,EAAMuM,WAAW3O,EAAGwC,YAAYoM,KAAK,WACjCxM,EAAMmO,uBAAuBvQ,EAAGwC,YAAYoM,KAAK,SAASE,GACtD2C,EAAU3C,EAASI,QACnBlP,EAAGiqC,SAAWx4B,EAAQw4B,SACtBlqC,EAAS,WAGLmqC,EAAUvqC,QAAQgB,QAAQ,sBAAsBwpC,WAC5CC,QAAU,IAIdhnC,EAAUsM,yBAAyBC,IAAI,SAASC,GAC5CjM,EAAciM,EAAU7I,IACxB/G,EAAGk1C,aAAel1C,EAAGs1C,kBACrBt1C,EAAGm1C,aAAen1C,EAAGu1C,kBACrBv1C,EAAGo1C,YAAcp1C,EAAG+U,iBACpB/U,EAAGq1C,YAAcr1C,EAAGiV,iBACpBjV,EAAG+X,OAAS,GACZ1U,EAAOwH,SACPq/B,EAAQG,MAAMhmC,QAIlB,IAAIuxC,IAAO,CACXvyC,GAAOoM,OAAO,YAAauE,EAAEwD,SAAS,WAClC,MAAIo+B,QACAA,GAAO,OAGX1L,GAAQG,MAAMtyB,OAAO/X,EAAG+X,QAAQ1T,QACjC,MACHA,IACAjC,EAAMsM,SAAQ,IACf,GAAG,OA9GlBimC,EAAkBpzC,SAAW,QAAS,YAAa,SAAU,WAAY,SAAU,SAAU,eAAgB,IAnB7G,IAAIC,IACAC,SAAU,IACVC,YAAa,sCACbG,WAAY8yC,EACZ7yC,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,YAAakzC,MA6IhC,WACI,YAOA,SAASmB,KAaL,QAASC,KACL,GAAI91C,GAAKC,IACVD,GAAG+1C,SAEMrzC,KAAM,qBACN4b,KAAM,gEACN1b,IAAK,KAGLF,KAAM,mBACN4b,KAAM,gEACN1b,IAAK,KAGLF,KAAM,qBACN4b,KAAM,gEACN1b,IAAK,KAGLF,KAAM,YACN4b,KAAM,gEACN1b,IAAK,KAhCjB,GAAIpB,IACAC,SAAU,IACVC,YAAa,gCACbG,WAAYi0C,EACZh0C,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,SAAUq0C,MA6C7B,WACI,YAOA,SAASG,KAaL,QAASC,MAXT,GAAIz0C,IACAC,SAAU,IACVC,YAAa,oCACbG,WAAYo0C,EACZn0C,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,WAAYw0C,MAuB/B,WACI,YAOA,SAASE,KAcL,QAASC,GAAiB/zC,EAAOE,EAAcD,EAAQtC,GAGnDqC,EAAMsd,aAAa/P,IAAI,WACnB5P,EAAS,WACLC,EAAGo2C,WAAY,KAIvB,IAAIz2B,GAAUvd,EAAMwe,YACpBjB,GAAQC,QAAQjQ,IAAI,WAChB5P,EAAS,WACLC,EAAGq2C,UAAW,MAGtB12B,EAAQE,SAASlQ,IAAI,WACjB5P,EAAS,WACLC,EAAGq2C,UAAW,KAItB,IAAIr2C,GAAKC,IACTD,GAAGq2C,UAAW,EACdr2C,EAAGo2C,WAAY,EAEfp2C,EAAG6Q,WAAa,WACZxO,EAAOI,GAAG,SACND,WAAYJ,EAAM8Z,mBAI1Blc,EAAG8Q,YAAc,WACb1O,EAAM2O,gBAGV/Q,EAAGs2C,YAAc,WACd32B,EAAQQ,SACR9d,EAAOk0C,aAAa,YA7B3BJ,EAAiB50C,SAAW,QAAS,eAAgB,SAAU,WApB/D,IAAIC,IACAC,SAAU,IACVC,YAAa,oCACbC,SACAE,WAAYs0C,EACZr0C,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAhBX7B,QACKC,OAAO,aACP4B,UAAU,WAAY00C,MA4D/B,WACI,YAOA,SAASA,KAaL,QAASM,MAXT,GAAIh1C,IACAC,SAAU,IACVC,YAAa,sCACbG,WAAY20C,EACZ10C,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,YAAa00C,MAuBhC,WACI,YAOA,SAAS1zC,KAaL,QAASi0C,GAAqBr0C,EAAOC,GACjC,GAAIrC,GAAKC,IACTD,GAAGmQ,YACHnQ,EAAG8C,QAAU,SAASC,EAAMP,GACxBJ,EAAM+Z,cAAc3Z,GACpBH,EAAOI,GAAGM,GACNP,WAAYA,IAIpB,IAAIk0C,IACAC,OAAW,sBACXC,UAAa,eACbC,SAAY,gBACZC,aAAgB,oBAChBC,QAAW,sBACXC,SAAY,qBACZC,QAAY,4BACZC,SAAY,6BACZC,SAAY,cACZC,SAAY,8BACZC,SAAY,kBACZC,SAAY,kBACZC,QAAY,aACZC,SAAY,cAIhBx3C,GAAGmQ,SAAW/N,EAAMwe,aAAaD,UAAUxQ,SAASrM,IAAI,SAASiM,GACzD,OAAQrN,KAAMzC,KAAK8P,GAAO9L,GAAI8L,IAC/B2mC,GApBXD,EAAqBl1C,SAAW,QAAS,SArBzC,IAAIC,IACAC,SAAU,IACVC,YAAa,4CACbG,WAAY40C,EACZ30C,aAAc,KACdC,kBAAkB,EAGtB,OAAOP,GAfX7B,QACKC,OAAO,aACP4B,UAAU,eAAgBgB,MAmDnC,WACI,YAOA,SAASi1C,GAAS77B,EAAYvZ,EAAQiB,EAASo0C,EAAmBt1C,GAG9DkB,EAAQq0C,QAAU,SAA4BznC,EAAS0nC,EAAUC,EAAYC,EAAc76B,GAChFA,IACHA,EAAQ,GAAI86B,OAAO7nC,GACnB+M,EAAM26B,SAAWA,EACjB36B,EAAM46B,WAAaA,EACnB56B,EAAM66B,aAAiBA,GAAgB,GAE3CJ,EAAmBz6B,GAIvB,IAAIyhB,GAAM9iB,EAAW65B,IAAI,oBAAqB,SAASxuC,EAAO+wC,GAG1D51C,EAAMsM,SAAQ,GAGd/O,QAAQgB,QAAQk0C,GAAGC,UAAUC,IAAIh9B,UAG7BigC,EAAQC,eAAiB71C,EAAMwe,aAAaD,UAAUX,gBACrD3d,EAAOk0C,aAAa,WACpBtvC,EAAMq3B,mBAKf1iB,GAAW65B,IAAI,WAAY/W,GAb/B+Y,EAASl2C,SAAW,aAAc,SAAU,UAAW,oBAAqB,SAtB5E5B,QACKC,OAAO,aACPs4C,IAAIT,MAoCb,WACI,YAOA,SAASU,GAAaC,EAAgBC,GAGlCD,EACK/F,MAAM,QACHh8B,IAAK,QACLiiC,SAAU,YACVL,cAAc,IAEjB5F,MAAM,WACHh8B,IAAK,IACLiiC,SAAU,eACVL,cAAc,IAEjB5F,MAAM,QACHh8B,IAAK,QACLiiC,SAAU,YACVL,cAAc,IAEjB5F,MAAM,cACHh8B,IAAK,cACLiiC,SAAU,kBACVL,cAAc,IAEjB5F,MAAM,SACHh8B,IAAK,sBACLiiC,SAAU,aACVL,cAAc,IAEjB5F,MAAM,YACHh8B,IAAK;AACLiiC,SAAU,gBACVL,cAAc,IAEjB5F,MAAM,WACHh8B,IAAK,wBACLiiC,SAAU,eACVL,cAAc,IAEjB5F,MAAM,QACHh8B,IAAK,qBACLiiC,SAAU,YACVL,cAAc,IAEjB5F,MAAM,OACHh8B,IAAK,oBACLiiC,SAAU,WACVL,cAAc,IAEjB5F,MAAM,SACHh8B,IAAK,sBACLiiC,SAAU,aACVL,cAAc,IAEjB5F,MAAM,WACHh8B,IAAK,wBACLiiC,SAAU,eACVL,cAAc,IAEjB5F,MAAM,YACHh8B,IAAK,yBACLiiC,SAAU,gBACVL,cAAc,IAEjB5F,MAAM,aACHh8B,IAAK,0BACLiiC,SAAU,iBACVL,cAAc,IAEjB5F,MAAM,YACHh8B,IAAK,yBACLiiC,SAAU,gBACVL,cAAc,IAEjB5F,MAAM,aACHh8B,IAAK,0BACLiiC,SAAU,iBACVL,cAAc,IAEjB5F,MAAM,WACHh8B,IAAK,wBACLiiC,SAAU,eACVL,cAAc,IAGtBI,EAAmBE,UAAU,KAnEjCJ,EAAa52C,SAAW,iBAAkB,sBAvB1C5B,QACKC,OAAO,aACP6qB,OAAO0tB,MA8FhB,WACI,YAEAx4C,SACKC,OAAO,aACP44C,SAAS,SAAUh1C,QACnBg1C,SAAS,KAAM/0C,IACf+0C,SAAS,YAAargC,WACtBqgC,SAAS,UAAW56B,SACpB46B,SAAS,SAAU78B,QACnB68B,SAAS,QAASvnC,OAClBunC,SAAS,IAAKlgC,GACdkgC,SAAS,IAAKxkC,GAGnBiD,OAAOsN,UAAUzgB,IAAM,SAAU20C,EAAQC,EAAQC,EAASC,GACtD,OAAQ34C,KAAOw4C,IAAWG,EAAUD,IAAYD,EAASD,GAAUE,MAG3E,WACI,YAOA,SAASluB,GAAOouB,GAEZA,EAAaC,cAAa,GAiB9BruB,EAAOlpB,SAAW,gBAxBlB5B,QACKC,OAAO,aACP6qB,OAAOA,MAShB9qB,QAAQC,OAAO,aAAas4C,KAAK,iBAAkB,SAASa,GAAiBA,EAAeC,IAAI,sCAAsC,sHACtID,EAAeC,IAAI,4CAA4C,ksBAC/DD,EAAeC,IAAI,oCAAoC,k+DACvDD,EAAeC,IAAI,oCAAoC,o9CACvDD,EAAeC,IAAI,gCAAgC,87DACnDD,EAAeC,IAAI,sCAAsC,o9CACzDD,EAAeC,IAAI,sCAAsC,4gFACzDD,EAAeC,IAAI,oCAAoC,yPACvDD,EAAeC,IAAI,kCAAkC,gkCACrDD,EAAeC,IAAI,sCAAsC,woTACzDD,EAAeC,IAAI,wCAAwC,s4CAC3DD,EAAeC,IAAI,0CAA0C,m6EAC7DD,EAAeC,IAAI,wCAAwC,i5CAC3DD,EAAeC,IAAI,8BAA8B,u0CACjDD,EAAeC,IAAI,kCAAkC,8KACrDD,EAAeC,IAAI,gCAAgC;AACnDD,EAAeC,IAAI,oCAAoC,oTACvDD,EAAeC,IAAI,wCAAwC,uVAC3DD,EAAeC,IAAI,gCAAgC,oIACnDD,EAAeC,IAAI,0CAA0C,s2GAC7DD,EAAeC,IAAI,wCAAwC,8bAC3DD,EAAeC,IAAI,kCAAkC,6cACrDD,EAAeC,IAAI,gCAAgC","file":"scripts/app-2db2af85f2.js","sourcesContent":["(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape', [\n            'ngAnimate',\n            'ngCookies',\n            'ngTouch',\n            'ngSanitize',\n            'ngMessages',\n            'ngAria',\n            'ngResource',\n            'ui.router',\n            'ui.bootstrap',\n            'ui-rangeSlider',\n            'ui.bootstrap.contextMenu',\n            'toastr'\n        ]);\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTray', tray);\n\n    /** @ngInject */\n    function tray() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/tray/tray.html',\n            scope: {\n                caption: '@',\n                content: '@',\n                change: '&'\n\n            },\n            controller: TrayController,\n            controllerAs: 'vm',\n            bindToController: true,\n            replace: true,\n            transclude: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function TrayController($timeout) {\n\n\n            var vm = this;\n            vm.trayClass = Math.random().toString(36).substring(3);\n            vm.iconClass = Math.random().toString(36).substring(3);\n            \n\n            var isLocked = true;\n            vm.toggle = function(){\n                var elTray = angular.element(\".\"+vm.trayClass);\n                var elIcon = angular.element(\".\"+vm.iconClass);\n                var elContent = angular.element(\".\"+vm.content);\n\n                isLocked = !isLocked;\n                elIcon\n                    .addClass(isLocked ? 'fa-lock' : 'fa-unlock-alt')\n                    .removeClass(isLocked ? 'fa-unlock-alt' : 'fa-lock');\n\n                elTray.attr(\"locked\", isLocked ? \"true\" : \"false\");\n\n                if (isLocked) {\n                    elContent\n                        .removeClass(\"tray-content-block-collapsed\");\n                    elTray\n                        .unbind(\"mouseover\", mouseOver)\n                        .unbind(\"mouseout\", mouseOut)\n                        .removeClass(\"tray-collapsed\");\n                    $timeout(function(){\n                        vm.change();\n                    });\n                        \n                } else {\n                    elContent\n                        .addClass(\"tray-content-block-collapsed\");\n                    elTray\n                        .addClass(\"tray-collapsed\")\n                        .bind(\"mouseover\", mouseOver)\n                        .bind(\"mouseout\", mouseOut);\n                    $timeout(function(){\n                        vm.change();\n                    });\n                }\n            };\n\n            \n\n            var mouseOver = function(){\n                angular.element(\".\"+vm.trayClass)\n                    .removeClass(\"tray-collapsed\");\n            }\n            var mouseOut = function(){\n                angular.element(\".\"+vm.trayClass)\n                    .addClass(\"tray-collapsed\");\n            }\n        }\n    }\n\n})();\n\n\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTools', tools);\n\n    /** @ngInject */\n    function tools() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/tools/tools.html',\n            controller: ToolsController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function ToolsController(osApi, $state, $stateParams) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.tools = [{\n                name: 'Markers + Patients',\n                route: 'markers',\n                img: 'markers.png',\n                copy: 'Link copy number variation and mutation data to patients.'\n            }, {\n                name: 'Timelines',\n                route: 'timelines',\n                img: 'timelines.png',\n                copy: ''\n            }, {\n                name: 'Pathways',\n                route: 'pathways',\n                img: 'pathways.png',\n                copy: 'Map patient specific expression levels on a hand curated network of genes.'\n            }, {\n                name: 'PLSR',\n                route: 'plsr',\n                img: 'plsr.png',\n                copy: 'Use linear regression to correlate genes with clinical features using RNA expression.'\n            }, {\n                name: 'PCA',\n                route: 'pca',\n                img: 'pca.png',\n                copy: 'Two dimensional view of per sample expression data.'\n            }, {\n                name: 'Survival',\n                route: 'survival',\n                img: 'survival.png',\n                copy: 'Compare survival rates of selected patients against the remaining population in a Kaplan Meier plot.'\n            }, {\n                name: 'Patient Data',\n                route: 'history',\n                img: 'history.png',\n                copy: ''\n            }, {\n                name: 'Oncoprint',\n                route: 'oncoprint',\n                img: 'metadata.png',\n                copy: ''\n            }, {\n                name: 'MetaData',\n                route: 'metadata',\n                img: 'metadata.png',\n                copy: ''\n            }];\n            vm.explore = function(tool, datasource) {\n                $state.go(tool, {\n                    datasource: datasource\n                });\n            };\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osToolMenu', toolmenu);\n\n    /** @ngInject */\n    function toolmenu() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/toolmenu/toolmenu.html',\n            controller: ToolMenuController,\n            controllerAs: 'vm',\n            scope:{\n                datasource: '@',\n                change: '&'\n            },\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function ToolMenuController(osApi, $state) {\n\n      \n            var mouseOver = function(){\n                angular.element(\".tool-menu\")\n                    .removeClass(\"tray-collapsed-left\");\n            }\n\n            var mouseOut = function(){\n                angular.element(\".tool-menu\")\n                    .addClass(\"tray-collapsed-left\");\n            }\n\n            var elTray = angular.element(\".tool-menu\");\n                elTray\n                    .bind(\"mouseover\", mouseOver)\n                    .bind(\"mouseout\", mouseOut);\n            \n            var vm = this;\n            vm.tools = [{\n                name: 'Markers + Patients',\n                route: 'markers',\n                img: 'markers.png',\n                copy: 'Link copy number variation and mutation data to patients.'\n            }, {\n                name: 'Timelines',\n                route: 'timelines',\n                img: 'timelines.png',\n                copy: ''\n            }, {\n                name: 'Pathways',\n                route: 'pathways',\n                img: 'pathways.png',\n                copy: 'Map patient specific expression levels on a hand curated network of genes.'\n            }, {\n                name: 'PLSR',\n                route: 'plsr',\n                img: 'plsr.png',\n                copy: 'Use linear regression to correlate genes with clinical features using RNA expression.'\n            }, {\n                name: 'PCA',\n                route: 'pca',\n                img: 'pca.png',\n                copy: 'Two dimensional view of per sample expression data.'\n            }, {\n                name: 'Survival',\n                route: 'survival',\n                img: 'survival.png',\n                copy: 'Compare survival rates of selected patients against the remaining population in a Kaplan Meier plot.'\n            }, {\n                name: 'Patient Data',\n                route: 'history',\n                img: 'history.png',\n                copy: ''\n            }, {\n                name: 'Oncoprint',\n                route: 'oncoprint',\n                img: 'history.png',\n                copy: ''\n            }, {\n                name: 'MetaData',\n                route: 'metadata',\n                img: 'metadata.png',\n                copy: ''\n            }];\n            vm.explore = function(tool) {\n                vm.change();\n                $state.go(tool, {\n                    datasource: vm.datasource\n                });\n            };\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTimelines', timelines);\n\n    /** @ngInject */\n    function timelines() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/timelines/timelines.html',\n            controller: TimelinesController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function TimelinesController(osApi, osHistory, $state, $scope, $stateParams, $window, $document, moment, d3) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Variables\n            var dataProcessed;\n            var dataPatients;\n            var dataEvents;\n            var d3ScaleX;\n            var d3ScaleY;\n            var minZoom = 0;\n\n\n            // View Model\n            var vm = this;\n                vm.selShow = false;\n                vm.selPatient;\n                vm.selEvent;\n                vm.selFields = [];\n                vm.datasource = $stateParams.datasource;\n                vm.optCohortModes;\n                vm.optCohortMode;\n                vm.timescaleunit;\n                vm.timescales;\n                vm.timescale;\n                vm.features;\n                vm.feature;\n                vm.filters;\n                vm.filter;\n                vm.events;\n                vm.sorts;\n                vm.sort;\n                vm.align;\n                vm.optCohortModes = [{name:\"Highlight\"},{name:\"Filter\"}];\n                vm.optCohortMode = vm.optCohortModes[0];\n          \n            // Elements\n            var elChart = angular.element(\"#timelines-chart\");\n            var d3Chart = d3.select(\"#timelines-chart\").append(\"svg\")\n                .attr(\"id\", \"chart\")\n                .style({width:'100%'});\n            var d3Axis = d3Chart.append(\"g\")\n                .attr({\"class\":\"axis\"})\n                .style({'shape-rendering': 'crispEdges',\"stroke-width\": \"1.0\", \"stroke\": \"#000\",\"fill\": \"none\"});\n            var d3BarsSvg = d3Chart.append(\"svg\")  // Used To Clip Overflow\n                .attr({\"class\":\"bars-svg\"});\n            var d3BarsBackground = d3BarsSvg.append(\"rect\") // Serves As Hit Area For Zoom\n                .attr({\"width\": elChart.width(), \"height\": $window.innerHeight - 75 - 10 - 130-50 })\n                .style({fill:\"#FFFFFF\"}); //,\"cursor\": \"move\" });\n            var d3Bars = d3BarsSvg.append(\"g\")\n                .attr({\"class\":\"bars\"});  // Container For Bars\n\n            // History Integration\n            var selectedIds = (osHistory.getPatientSelection() == null) ? null : osHistory.getPatientSelection().ids;\n            function saveSelected() {\n                selectedIds = d3Bars.selectAll(\".timeline-selected\")[0].map( function (p) { return p.__data__.id; }  )\n                if (selectedIds.length==0) selectedIds = d3Bars.selectAll()[0].map( function (p) { return p.__data__.id; }  )\n                osHistory.addPatientSelection(\"Patient History\", \"Manual Selection\",\n                    selectedIds\n                );\n                if (vm.optCohortMode.name==\"Filter\") draw();\n            }\n\n            var zoom;\n            var zoomed = function(){\n                if (d3.event.shiftKey) return;\n\n                var scale = minZoom * d3.event.scale;\n                if (scale<minZoom) scale = minZoom;\n                var translate= d3.event.translate[1];\n\n                var ch = $window.innerHeight - 75 - 10 - 130- 50;\n                var rh = (dataProcessed.patients.length*20) * scale;\n                var dh = ch - rh;   // Delta height - Used For Offset\n\n                if (translate>0) translate=0;\n                if (translate<dh) translate=dh;\n\n                zoom.translate([d3.event.translate[0],translate]);\n                var rowH = (20 * scale);\n                var rowsVisible = (ch / rowH);\n                var rowOffset = Math.abs(translate / rowH);\n                  brush.y(d3.scale.linear().range([0,ch]).domain([rowOffset, rowOffset+rowsVisible]))\n\n                \n                d3Bars.attr(\"transform\",\"translate(1,\"+translate+\")scale(1,\" + scale + \")\");\n            };\n\n            var brush;\n            var brushing = false;\n            var onBrushStart = function(){\n                if (!d3.event.sourceEvent.shiftKey) {\n                    d3.event.target.clear();\n                    d3.select(this).call(d3.event.target);\n                }else{\n                    brushing = true;\n                }\n            }\n            var onBrush = function(){\n                if (!brushing) return;\n                var extent = brush.extent();\n                var lower = Math.floor(extent[0][1]);\n                var upper = Math.floor(extent[1][1]);\n                d3Bars.selectAll(\"g.timeline\")\n                    .each( function(d, i){\n                        d3.select(this.firstChild).classed(\"timeline-selected\", (i>=lower && i<=upper) );\n                    });\n            }\n            var onBrushEnd = function(){\n                if (!brushing) return;\n                brushing = false;\n                d3.event.target.clear();\n                d3.select(this).call(d3.event.target);    \n                saveSelected();\n            }\n\n\n            var draw = function(){\n\n                // Helpers\n                var hRow = 20;\n                var hChart = $window.innerHeight - 75 - 10 - 130;\n                var wChart = $window.innerWidth - 300;\n                if (wChart > 760)  wChart -= 140;\n                if (angular.element(\".tray-right\").attr(\"locked\")==\"false\"){\n                    wChart += 300;\n                } \n                \n                dataProcessed = processData(dataPatients, vm.align, vm.sort);\n                d3ScaleX = d3.scale.linear().domain( dataProcessed.bounds ).range([10, wChart-10]).nice();\n                d3ScaleY = d3.scale.linear().domain([0, dataProcessed.patients.length]).range(0,hChart-50).nice();\n                minZoom = (hChart-50) / (dataProcessed.patients.length * 20)\n                \n                // Chart\n                d3Chart.attr( {'height': hChart+\"px\"})\n                d3BarsSvg.attr( {'height' : (hChart-50)+\"px\", 'width':wChart+\"px\"} );\n                d3BarsBackground.attr( {'height' : (hChart-50)+\"px\", 'width':wChart+\"px\"} );\n                d3Bars.attr(\"transform\",\"scale(1,\" + minZoom + \")\");\n\n                // Rows\n                var rows = d3Bars.selectAll(\"g.timeline\").data( dataProcessed.patients );\n                    rows.exit().remove();\n                    rows.enter().append(\"g\").attr({ 'class' : 'timeline' })\n                        .on(\"mousedown\", function(){\n                            if (!d3.event.shiftKey) d3Bars.selectAll(\".timeline-selected\").classed(\"timeline-selected\", false);\n                        })\n                        \n                    // rows\n                        .attr({\n                            'width': wChart,\n                            'height': hRow,\n                            'transform': function(d, i) { return \"translate(0,\" +  (i * hRow)+ \")\"; }\n                        })\n                        .append(\"rect\")\n                        .attr({\n                            'class': 'timeline-row',\n                            'width': 0,\n                            'height': hRow\n                        });\n\n\n                    if (vm.optCohortMode.name==\"Highlight\" && selectedIds){\n                        rows\n                            .each( function(d){\n                                var selected = (selectedIds.indexOf(d.id)>=0);\n                                var e = d3.select(this.firstChild);\n                                e.classed(\"timeline-selected\", selected );\n                        });\n                    }else{\n                        rows\n                            .each( function(){\n                                var e = d3.select(this.firstChild);\n                                e.classed(\"timeline-selected\", false );\n                        });\n                    }\n\n                // Columns\n                var cols = rows.selectAll(\"rect.event\").data( function(d) { return d.filteredEvents; });\n                    cols.exit().remove();\n                    cols.enter().append(\"rect\").attr({'class':'event'})\n                        .on(\"mouseover\", function(){\n                                var event = dataEvents[this.__data__.id];\n                                vm.selPatient = event.PatientID;\n                                vm.selEvent = event.Name;\n                                var fields = [];\n                                for(var field in event.Fields) {\n                                    if (event.Fields[field]!=null){\n                                        if ( field==\"date\" && angular.isArray(event.Fields[field]) ){\n                                            fields.push( {name:\"Start Date\", value:event.Fields[field][0] })\n                                            fields.push( {name:\"End Start\", value:event.Fields[field][1] })\n                                        }else{\n                                            fields.push(\n                                                {name:field, value:event.Fields[field]}\n                                            );\n                                        }\n                                    }\n                                }\n                                vm.selShow = true;\n                                vm.selFields = fields;\n                                $scope.$apply();\n                            })\n                            .on(\"mouseout\", function(){\n                                vm.selShow = false;\n                                $scope.$apply();\n                            });\n                    cols.transition()\n                        .style({'fill':function(d){ return d.color; }})\n                        .attr({\n                            'height':function(d){ return (d.name == \"Radiation\" || d.name==\"Drug\") ? hRow/2 : hRow; },\n                            'width':function(d){ return (d.endValue==null) ? 3 : (d3ScaleX(d.endValue) - d3ScaleX(d.startValue)); },\n                            'x': function(d) { return Math.round(d3ScaleX(d.startValue)); },\n                            'y': function(d) { return ((d.name == \"Radiation\") ? hRow/2 : 0); }\n                        });\n\n                    var daysToUnit = function(d){\n                        if (Math.abs(d)==0) return d;\n                        if (Math.abs(d)<30) return d+\" Days\";\n                        if (Math.abs(d)<360) return Math.round( (d/30.4) * 10 ) / 10 + \" Months\";\n                        return Math.round( (d/365) * 10 ) / 10 + \" Years\";\n                    }\n                    var tlScale = d3.svg.axis()\n                        .scale(d3ScaleX)\n                        .orient(\"bottom\")\n                        .ticks(8);\n\n                    if (vm.timescale.name=='Log'){\n                        tlScale = tlScale.tickFormat(function (d) { \n                            return daysToUnit(Math.round((d<0 ? -1 : 1) * (Math.pow(2, (Math.abs(d)))-1) *100)/100);\n                        });\n                    }else{\n                        tlScale = tlScale.tickFormat(function (d) {\n                            return daysToUnit(d);\n                        });\n                    }\n\n                // Brush\n                brush = d3.svg.brush()\n                    .x(d3ScaleX)\n                    .y(d3.scale.linear().range([0,hChart]).domain([0, dataProcessed.patients.length]))\n                    .on(\"brush\", onBrush)\n                    .on(\"brushstart\", onBrushStart)\n                    .on(\"brushend\", onBrushEnd);\n                d3BarsBackground.call(brush);\n\n                // Clear Selections On MouseDown\n                d3BarsBackground.on(\"mousedown\", function(){\n                    if (!d3.event.shiftKey) d3Bars.selectAll(\".timeline-selected\").classed(\"timeline-selected\", false);\n                });\n\n                // Zoom\n                zoom = d3.behavior.zoom()\n                    .x( d3ScaleX )\n                    .y( d3ScaleY )\n                    .translate([0,0])\n                    .scale(1, minZoom )\n                    .on(\"zoom\", zoomed);\n                d3BarsBackground.call(zoom);\n\n\n                // Axis\n                d3Axis.attr({\n                    \"class\": \"timeline-axis\",\n                    \"width\": 100,\n                    transform: function() { return \"translate(0,\" +  (hChart-50) + \")\"; }\n                });\n                d3Axis.call( tlScale );\n                \n            };\n\n\n\n            // Populates ProcessedData Object With Values Consistant With ViewState\n            var processData = function (data, align, sort){\n\n                    var processedData = {};\n\n                    // Store List Of Active Events\n                    processedData.events = vm.events.filter( function(events) { return events.selected; });\n\n                    // Remove Patients That Don't Have Align Property + Possibly !Selected\n                    processedData.patients = data.filter(function(patient){\n                        if (vm.filter.name==\"Only Alive\" && patient.dead) return false;\n                        if (vm.filter.name==\"Only Dead\" && !patient.dead) return false;\n                        if (!patient.hasOwnProperty(\"__\"+this.align)) return false;\n                        if (this.filter && this.ids){\n                            if (this.ids.indexOf(patient.id)==-1) return false;\n                        }\n                        return true;\n\n                    }, {'align':align.name, 'filter':(vm.optCohortMode.name==\"Filter\"), 'ids':selectedIds});\n\n                    // Sort Patients On Align Property    \n                    if (sort.name==\"Survival\"){\n                        processedData.patients = processedData.patients.sort(function(a,b){\n                            if (a.dead==b.dead){\n                                return (a.calcEvents[sort.index].value>b.calcEvents[sort.index].value) ? 1 : -1;\n                            }else{\n                                return (a.dead) ? 1 : -1;\n                            }\n                            \n                        }, sort);\n                    }else{\n                        processedData.patients = processedData.patients.sort(function(a,b){\n                            return (a.calcEvents[sort.index].value>b.calcEvents[sort.index].value) ? 1 : -1;\n                        }, sort);\n                    }\n\n\n                    // Adjust Start + End Dates To Align Property\n                    processedData.patients.forEach(function(patient){\n\n                        patient.filteredEvents = patient.dateEvents.filter(function(dateEvent){\n                            for (var i=0; i<this.length; i++){\n                                if (this[i].name==dateEvent.name) return true;\n                            }\n                            return false;\n                        }, processedData.events);\n\n                        patient.filteredEvents.forEach(function(evt){\n                            evt.startValue = vm.timescale.timeFn(evt.start + this);\n                            evt.endValue = (evt.end!=null) ? vm.timescale.timeFn(evt.end + this) : null;\n                        }, -patient[\"__\"+this[\"align\"].name].start)\n\n                    }, {\"align\":align, \"events\":processedData.events});\n\n                    // Calculate Event Bounds Min, Max\n                    processedData.bounds = processedData.patients.reduce( function( prev, current ) {\n                        // Min Max For Individual Patients\n                        var patientMinMax = current.filteredEvents.reduce(function( prev, current ) {\n                            \n                            return [\n                                Math.min(current.startValue, prev[0]),\n                                Math.max((current.endValue==null) ? current.startValue : current.endValue, prev[1])\n                            ]\n\n                        }, [Infinity, -Infinity]);\n                        \n                        return [\n                            Math.min(patientMinMax[0], prev[0]),\n                            Math.max(patientMinMax[1], prev[1])\n                        ]   \n                    }, [Infinity, -Infinity] );\n                    return processedData;\n            };\n\n\n\n            // Initialize\n            (function(){\n\n                var color = function(d){\n                    var status = d.name;\n                    var rv = \n                        (status===\"Birth\") ?  \"#17becf\" : \n                        (status===\"Diagnosis\") ? \"#8c564b\" :\n                        (status===\"Pathology\") ? \"#7f7f7f\" :\n                        (status===\"Progression\") ? \"#1f77b4\" :\n                        (status===\"Absent\") ? \"#000000\" :\n                        (status===\"Status\") ? \"#bcbd22\" :\n                        (status===\"Radiation\") ? \"#e7969c\" :\n                        (status===\"Procedure\") ? \"#ff7f0e\" :\n                        (status===\"Encounter\") ? \"#d62728\" :\n                        (status===\"Drug\") ? \"#9467bd\" :\n                        \"black\";\n                        return rv;\n                };   \n\n                // Data Clean Up Functions\n                var processEventData = function(events){\n                    return Object.keys(events).map(function(v) {\n                            var rv =  { \"name\": v, \"selected\": true };\n                            rv.color = rv.__color = color(rv);\n                            return rv;\n                    });\n                };\n\n                var processFeatureData = function(patients){\n                    return patients[0].calcEvents.map(function(d, i) {\n                        return { \"name\": d.name, \"index\": i }\n                    });\n                };\n\n                var processPatientData = function(patients, dead){\n\n                    patients = Object.keys(patients).map(function(key) {\n                        var val = patients[key];\n                        val.id = key;\n                        return val;\n                    });\n                    for (var i = 0; i < patients.length; i++) {\n\n                        // Create References For Faster Subsequent Lookups\n                        var p = patients[i];\n                        var m = moment;\n                        var mf = \"YYYY-MM-DD\";\n\n\n                        // Map Start Dates\n                        var dateSingle =\n                            p.dateEvents\n                            .filter(function(d) {\n                                return d.eventOrder === 'single'\n                            })\n                            .map(function(d) {\n                                return {\n                                    \"start\": m(d.date, mf).unix(),\n                                    \"end\": null,\n                                    \"name\": d.name, \n                                    \"id\":d.eventID\n                                };\n                            });\n\n                        // Map Start + End Dates\n                        var endDates = p.dateEvents\n                            .filter(function(d) { return d.eventOrder==='end'; })\n                            .map(function(d){ return {\"end\":m(d.date, mf).unix(), \"id\":d.eventID}; });\n                        var startDates = p.dateEvents\n                            .filter(function(d) { return d.eventOrder==='start'; })\n                            .map(function(d){ return {\"start\":m(d.date, mf).unix(),\"name\":d.name, \"id\":d.eventID}; });\n                        startDates\n                            .forEach(function(sd){ sd.end = endDates\n                                .filter(function(ed) { return ed.id==sd.id} )[0].end });\n\n                        // Join Single + Multiple Date Events\n                        p.dateEvents = (startDates.length>0) ? startDates.concat(dateSingle) : dateSingle;\n                        p.dateEvents.forEach(function(d){\n                            d.color = color(d);\n                            p[\"__\"+d.name] = d;\n                            if (d.name==\"Status\"){\n                                p.dead = (dead.indexOf(d.id)!=-1);\n                            }\n                            \n                         });\n                    }\n                    return patients;\n                };\n\n                osApi.setBusy(true)(\"Loading Dataset\");\n                osApi.setDataset(vm.datasource).then(function() {\n                    osApi.getTimelines().then(function(response) {\n\n                        // TimeScales\n                        vm.timescales = [\n                            {name:'Log', \n                                timeFn: function(val){\n                                    return (val<0 ? -1 : 1) * Math.log(Math.abs((val*1000)/86400000)+1)/Math.log(2)\n                            }},\n                            {name:'Linear', \n                                timeFn: function(val){\n                                    return moment.duration(val*1000).asDays()\n                            }}\n                        ];\n                        vm.timescale = vm.timescales[0];\n\n                        // Clean Data + Set Default VM\n                        dataPatients = processPatientData(response.payload.pts, response.payload.eventTypes.Status.status.Dead);\n                        dataEvents = response.payload.events;\n                        vm.sorts = processFeatureData(dataPatients);\n                        \n                        vm.filters = [\n                            {name:'Alive + Dead'},\n                            {name:'Only Alive'},\n                            {name:'Only Dead'}\n                        ];\n                        vm.filter = vm.filters[0];\n\n\n                        var features = processFeatureData(dataPatients);\n                        features.unshift({index:-1, name:'None'});\n                        vm.features =  features;\n                        vm.feature = vm.features[0];\n                        vm.events = processEventData(response.payload.eventTypes);\n\n                        // Set Defaults Align By Drug, Order By Survial, Hide Birth\n                        vm.sort = vm.sorts[1];\n                        vm.events.forEach(function(e){\n                            if (e.name==\"Birth\") { e.selected = false; e.color = \"#FEFEFE\"; }\n                            if (e.name==\"Diagnosis\") this.align = e;\n                        }, vm);\n\n                        // Register Watch\n                        $scope.$watchGroup(['vm.feature', 'vm.sort', 'vm.align', 'vm.timescale', 'vm.filter'], draw);\n                        angular.element($window).bind('resize', draw);\n                      \n                        $scope.$watch(\"vm.optCohortMode\", draw );   // Triggers Inital Draw\n\n                        // History\n                        osHistory.onPatientSelectionChange.add(function(selection) {\n                            selectedIds = selection.ids;\n                            draw();\n                        });\n                        osApi.setBusy(false);\n                    });\n                });\n            })();\n\n\n            // Event Handlers\n            vm.resize = function(){\n                draw();\n            }\n            vm.updateEventColor = function(item){\n                item.selected = !item.selected;\n                item.color = (item.selected) ? item.__color : \"#FEFEFE\";\n                draw();\n            }\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osTest', test);\n\n    /** @ngInject */\n    function test() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/test/test.html',\n            controller: TestController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function TestController(osApi) {\n\n            // View Model\n            var vm = this;\n            vm.message = \"Robert\";\n            vm.datasets = [];\n            \n            osApi.setBusy(true);\n            osApi.getDataSetNames().then(function(response){\n\n                vm.datasets = response.payload.datasets;\n\n                osApi.setBusy(false);\n            });\n        }\n    }\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osSurvival', survival);\n\n    /** @ngInject */\n    function survival() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/survival/survival.html',\n            controller: SurvivalController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function SurvivalController(osApi, osHistory, $state, $timeout, $scope, $stateParams) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n\n            // Set Dataset \n            osApi.setBusy(true);\n            osApi.setDataset(vm.datasource).then(function() {\n                // If No Patients Are Selected, Fetch All Patients\n                if (osHistory.getPatientSelection()==null){\n                    osApi.getPatientHistoryTable(vm.datasource).then(function(response) {\n                        draw(response.payload.tbl.map( function (d) { return d[0]; }));\n                    });\n                }else{\n                    draw(osHistory.getPatientSelection().ids);\n                }\n            });\n\n            // Register History Component\n            osHistory.onPatientSelectionChange.add(function(selection){\n                draw(selection.ids)\n            });\n\n            // Draw\n            var draw = function(ids){\n                osApi.setBusy(true);\n                osApi.getCalculatedSurvivalCurves(ids, \"\").then(function(r){\n                    angular.element(\"#survival-img\").attr('src',r.payload);\n                    osApi.setBusy(false);\n                });\n            }\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osSubnav', login);\n\n\n    /** @ngInject */\n    function login() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/subnav/subnav.html',\n            replace: true,\n            controller: SubnavController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function SubnavController(osApi, $state) {\n            \n            var vm = this;\n            vm.tool = \"Pathways\";\n            vm.filter = \"DemoDZ\";\n\n            vm.toolsClick = function(){\n                $state.go(\"tools\", {\n                    datasource: vm.datasource\n                });\n            };\n            \n            vm.cohortClick = function() {\n                osApi.toggleFilter();\n            };\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPca3d', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/pca3d/pca3d.html',\n            controller: Pca3dController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function Pca3dController(osApi, $state, $stateParams, $timeout, $scope, d3, THREE, $window) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // State\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneSets = [];\n            vm.geneSet = null;\n            vm.toggleFilter = function() {\n                angular.element(\".container-filters\").toggleClass(\"container-filters-collapsed\");\n                angular.element(\".container-filter-toggle\").toggleClass(\"container-filter-toggle-collapsed\");\n            }\n            var rawData;\n\n            // Elements\n            var elChart = angular.element(\"#pca-chart\");\n\n\n            // Initalizae\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx.mrna\") >= 0\n                });\n\n                mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n                osApi.setBusyMessage(\"Creating PCA Matrix\");\n                osApi.getPCA(vm.datasource, mtx).then(function() {\n                    osApi.setBusyMessage(\"Loading Gene Sets\");\n                    osApi.getGeneSetNames().then(function(response) {\n\n                        // Load Gene Sets\n                        vm.geneSets = response.payload;\n                        vm.geneSet = vm.geneSets[0];\n                        $scope.$watch('vm.geneSet', function() {\n                            update();\n                        });\n                    });\n                });\n            });\n\n            // API Call To Calculate PCA\n            var update = function() {\n                osApi.setBusyMessage(\"Calculating PCA\");\n                osApi.getCalculatedPCA2(vm.geneSet).then(function(response) {\n                    osApi.setBusyMessage(\"Rendering PCA\");\n                    var payload = response.payload;\n                    vm.pc1 = response.payload[\"importance.PC1\"];\n                    vm.pc2 = response.payload[\"importance.PC2\"];\n                    var scores = payload.scores;\n                    var ids = payload.ids;\n                    rawData = scores.map(function(d, i){\n                        d.id = ids[i];\n                        return d;\n                    }, payload.ids);\n                    draw()\n                    osApi.setBusy(false);\n                });\n            };\n\n            var scene = new THREE.Scene();\n            var camera = new THREE.PerspectiveCamera( 50, $window.innerWidth / $window.innerHeight, 0.1, 1000 );\n            camera.position.z = 60;\n            \n            var renderer = $window.WebGLRenderingContext ? new THREE.WebGLRenderer({ antialias: true }) : new THREE.CanvasRenderer();\n            renderer.setPixelRatio( $window.devicePixelRatio );\n            renderer.setSize( $window.innerWidth, $window.innerHeight );\n            elChart.append( renderer.domElement );\n\n\n\n            var draw = function(){\n                var sphereThree = [];\n                var numSphere = rawData.length;\n                var sphereGeometry = new THREE.SphereGeometry(.1, 8, 8);\n                var sphereMaterial = new THREE.MeshBasicMaterial({color: '#59a5fb'});//rgb(255, 0, 0)'});\n                for(var idSphere = 0; idSphere < numSphere; idSphere++){\n                    sphereThree[idSphere] = new THREE.Mesh(sphereGeometry, sphereMaterial);\n                    var datum = rawData[idSphere];\n                    sphereThree[idSphere].position.x = datum[0];\n                    sphereThree[idSphere].position.y = datum[1];\n                    sphereThree[idSphere].position.z = datum[2];\n                    scene.add(sphereThree[idSphere]);\n                }\n                render();\n            }\n            \n\n            var render = function () {\n\n//                requestAnimationFrame( render );\n\n                // if( !options.fixed ) {\n                //     mesh.rotation.x += 0.005;\n                //     mesh.rotation.y += 0.005;\n                // }\n\n\n                renderer.render( scene, camera );\n\n            };\n\n            function animate() {\n\n  requestAnimationFrame( animate );\n  controls.update();\n\n}\n\n\n\n  var controls = new THREE.OrbitControls( camera );\n  controls.addEventListener( 'change', render );\n    \n        \nanimate();\n            \n\n           \n            \n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPlsr', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/plsr/plsr.html',\n            controller: PlsrController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function PlsrController(osApi, osHistory, $state, $stateParams, $timeout, $scope, d3, moment, $sce, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var d3Chart = d3.select(\"#plsr-chart\").append(\"svg\").attr(\"id\", \"chart\");\n            var d3Tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip plsr-tooltip\")\n\n            // Properties\n            var width, height, xScale, yScale, xMax, yMax, brush;\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.deathMinFilter = vm.deathMinValue = 45;\n            vm.deathMaxFilter = vm.deathMaxValue = 66;\n            vm.survivalMinFilter = vm.survivalMinValue = 3;\n            vm.survivalMaxFilter = vm.survivalMaxValue = 7;\n            vm.geneSets = [];\n            vm.geneSet = null;            \n            vm.frame;\n            vm.tip = null;\n\n\n            // History Integration\n            var selectedIds = (osHistory.getGeneSelection() == null) ? null : osHistory.getGeneSelection().ids;\n            function saveSelected() {\n                osHistory.addGeneSelection(\"PLSR\", \"Manual Selection\",\n                    d3Chart.selectAll(\".plsr-node-selected\")[0].map(function(node){ \n                        return node.__data__.name.toUpperCase()\n                    })\n                );\n            }\n            function setSelected() {\n                if (selectedIds == null) {\n                    d3Chart.selectAll(\".plsr-node-selected\").classed(\"plsr-node-selected\", false);\n                } else {\n                    d3Chart.selectAll(\"circle\").classed(\"plsr-node-selected\", function() {\n                        return (selectedIds.indexOf(this.__data__.name) >= 0)\n                    });\n                }\n            }\n     \n            \n\n            \n\n            // Initialize\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx.mrna\") >= 0\n                });\n                mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n                osApi.setBusyMessage(\"Creating PLSR Matrix\");\n                osApi.getPLSR(vm.datasource, mtx).then(function() {\n                    osApi.setBusyMessage(\"Loading Gene Sets\");\n                    osApi.getGeneSetNames().then(function(response) {\n\n                        // Load Gene Sets\n                        vm.geneSets = response.payload;\n                        vm.geneSet = vm.geneSets[0];\n                        osApi.setBusyMessage(\"Loading Patients\");\n                        osApi.getSummarizedPLSRPatientAttributes().then(function(response) {\n\n                            // Load Min Max Values\n                            var payload = response.payload;\n                            vm.deathMinValue = Math.floor(payload.AgeDx[0] / 365.24);\n                            vm.deathMaxValue = Math.floor(payload.AgeDx[4] / 365.24);\n                            vm.survivalMinValue = Math.floor(payload.Survival[0] / 365.24);\n                            vm.survivalMaxValue = Math.floor(payload.Survival[4] / 365.24);\n                            $scope.$watch('vm.geneSet', function() {\n                                vm.update();\n                            });\n\n                            // History\n                            osHistory.onGeneSelectionChange.add(function(selection) {\n                                selectedIds = selection.ids;\n                                $scope.$apply();\n                                setSelected();\n                            });\n                        });\n                    });\n                });\n            });\n\n\n            // API Call To Calculate PLSR\n            vm.update = function() {\n                osApi.setBusyMessage(\"Calculating PLSR\");\n\n\n\n                var factors = [{\n                    name: \"Survival\",\n                    low: Number(vm.survivalMinFilter) * 365.24,\n                    high: Number(vm.survivalMaxFilter) * 365.24\n                }, {\n                    name: \"AgeDx\",\n                    low: Number(vm.deathMinFilter) * 365.24,\n                    high: Number(vm.deathMaxFilter) * 365.24\n                }];\n\n                osApi.getCalculatedPLSR(vm.geneSet, factors).then(function(response) {\n                    osApi.setBusyMessage(\"Rendering PLSR\");\n\n                    // Clean Up Data\n                    var payload = response.payload;\n                    var genes = payload.loadings.map(function(item, index) {\n                        item.name = this[index];\n                        return item;\n                    }, payload.loadingNames);\n                    var vectors = payload.vectors.map(function(item, index) {\n                        item.name = this[index];\n                        return item;\n                    }, payload.vectorNames);\n                    var abs = payload.maxValue * 1.2;\n                    draw(abs, vectors, genes);\n                    osApi.setBusy(false);\n                });\n\n                function setScale() {\n                    width = $window.innerWidth - 100; \n                    height = $window.innerHeight - 190;\n                    if (angular.element(\".tray\").attr(\"locked\")==\"true\") width -= 300;\n\n                    d3Chart\n                        .attr(\"width\", '100%')\n                        .attr(\"height\", height);\n                    xScale = d3.scale.linear()\n                        .domain([-xMax, xMax])\n                        .range([0, width]).nice();\n\n                    yScale = d3.scale.linear()\n                        .domain([-yMax, yMax])\n                        .range([height, 0]).nice();\n                }\n\n                // Render\n                function draw(abs, vectors, genes) {\n\n                    xMax = abs * .9;\n                    yMax = abs * .9;\n                    setScale();\n\n                    // Brush\n                    brush = d3.svg.brush()\n                        .x(xScale)\n                        .y(yScale)\n                        .on(\"brushend\", function() {\n                            var bv = brush.extent();\n                            d3Chart.selectAll(\"circle\")\n                                .classed(\"plsr-node-selected\", function(d) {\n                                    return (d[0] > bv[0][0] && d[0] < bv[1][0] && d[1] > bv[0][1] && d[1] < bv[1][1]);\n                                });\n                            d3.select(this).transition().duration(300)\n                                .call(brush.extent([\n                                    [0, 0],\n                                    [0, 0]\n                                ]));\n                            saveSelected();\n                        });\n\n                    d3Chart.call(brush);\n\n                    // Circles\n                    var circles = d3Chart.selectAll(\"circle\").data(genes, function(d) { return d; });\n                    circles.enter()\n                        .append(\"circle\")\n                        .attr({\n                            \"class\": \"plsr-node\",\n                            \"cx\":  width * .5,\n                            \"cy\": height * .5,\n                            \"r\": 3\n                        })\n                        .style(\"fill-opacity\", \"0\")\n                        .on(\"mouseover\", function(d) {\n                            d3Tooltip.transition()        \n                                .duration(200)      \n                                .style(\"opacity\", 1);      \n                            d3Tooltip.html(d.name)  \n                                .style(\"left\", (d3.event.pageX+15) + \"px\")     \n                                .style(\"top\", (d3.event.pageY-15) + \"px\"); \n                        })\n                        .on(\"mouseout\", function() {\n                            d3Tooltip.transition()      \n                                .duration(500)      \n                                .style(\"opacity\", 0); \n                        })\n                        .on(\"click\", function(d) {\n                            angular.element('#plsr-webpage').modal();\n                            var url = \"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\" + d.name;\n                            $scope.$apply(function() {\n                                vm.frame = $sce.trustAsResourceUrl(url);\n                            });\n                        });\n                    circles.transition()\n                        .duration(750)\n                        .delay(function(d, i) {\n                            return i / 300 * 500;\n                        })\n                        .attr(\"cx\", function(d) {\n                            return xScale(d[0]);\n                        })\n                        .attr(\"cy\", function(d) {\n                            return yScale(d[1]);\n                        })\n                        .style(\"fill-opacity\", 1);\n\n                     circles.exit()\n                        .transition()\n                        .duration(600)\n                        .delay(function(d, i) {\n                            return i / 300 * 500;\n                        })\n                        .attr(\"cx\", width * .5)\n                        .attr(\"cy\", height * .5)\n                        .style(\"fill-opacity\", \"0\")\n                        .remove();\n\n                    // Lines\n                    var lines = d3Chart.selectAll(\"line\").data(vectors)\n                    lines.enter()\n                        .append(\"line\")\n                        .attr({\n                            \"class\": \"line\",\n                            \"stroke-width\": 3,\n                            \"x1\": xScale(0),\n                            \"y1\": yScale(0),\n                            \"x2\": xScale(0),\n                            \"y2\": yScale(0)\n                        })\n                        .style(\"stroke\", function(d) {\n                            return (d.name.indexOf(\"Age\")) ? \"#1396de\" : \"#38347b\"\n                        });\n                    lines.transition()\n                        .duration(900)\n                        .attr({\n                            \"x1\": xScale(0),\n                            \"y1\": yScale(0),\n                            \"x2\": function(v) { return xScale(v[0]); },\n                            \"y2\": function(v) { return yScale(v[1]); }\n                        });\n                    lines.exit().remove();\n\n                    // Text\n                    var text = d3Chart.selectAll(\"text\").data(vectors);\n                    text.enter()\n                        .append(\"text\")\n                        .attr({\n                            \"class\": \"text\",\n                            \"x\": width * .5,\n                            \"y\": height * .5,\n                            \"text-anchor\": function(v) { return (v[0] > 0) ? \"start\" : \"end\" }\n                        })\n                        .text(function(v) { return v.name; })\n                        .style({\n                            \"fill\": \"black\",\n                            \"text-anchor\": \"middle\"\n                        });\n\n                    text.transition()\n                        .duration(900)\n                        .attr({\n                            \"x\": function(v) { return xScale(v[0]); },\n                            \"y\": function(v) { return yScale(v[1]); }\n                        });\n\n                    text.exit().remove();\n                    setSelected();\n                }\n\n                vm.resize = function () {\n                    setScale();\n\n                    d3Chart.selectAll(\"circle\")\n                        .attr({\n                            \"cx\": function(d) { return xScale(d[0]); },\n                            \"cy\": function(d) { return yScale(d[1]); }\n                        });\n\n                    d3Chart.selectAll(\"text\")\n                       .attr({\n                            \"x\": function(v) { return xScale(v[0]); },\n                            \"y\": function(v) { return yScale(v[1]); }\n                        });\n\n                    d3Chart.selectAll(\"line\")\n                        .attr({\n                            \"x1\": xScale(0),\n                            \"y1\": yScale(0),\n                            \"x2\": function(v) { return xScale(v[0]); },\n                            \"y2\": function(v) { return yScale(v[1]); }\n                        });\n                };\n\n                // Listen For Resize\n                angular.element($window).bind('resize', \n                    _.debounce(vm.resize, 300)\n                );\n            };\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPca', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/pca/pca.html',\n            controller: PcaController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function PcaController(osApi, osHistory, $state, $stateParams, $timeout, $scope, d3, moment, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var d3Chart = d3.select(\"#pca-chart\").append(\"svg\").attr(\"id\", \"chart\");\n            var d3xAxis = d3Chart.append(\"g\");\n            var d3yAxis = d3Chart.append(\"g\");\n            var d3Tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip pca-tooltip\")\n\n            // Properties\n            var width, height, xScale, yScale, xMax, yMax, xAxis, yAxis;\n            var rawData;\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneSets = [];\n            vm.geneSet = null;\n            vm.search = \"\";\n\n            // History Integration\n            var selectedIds = (osHistory.getPatientSelection() == null) ? null : osHistory.getPatientSelection().ids;\n            function saveSelected() {\n                osHistory.addPatientSelection(\"PCA\", \"Manual Selection\",\n                    d3Chart.selectAll(\".pca-node-selected\")[0].map(function(node) {\n                        return node.__data__.id.toUpperCase();\n                    })\n                );\n            }\n            function setSelected() {\n                if (selectedIds == null) {\n                    d3Chart.selectAll(\".pca-node-selected\").classed(\"pca-node-selected\", false);\n                } else {\n                    d3Chart.selectAll(\"circle\").classed(\"pca-node-selected\", function() {\n                        return (selectedIds.indexOf(this.__data__.id) >= 0)\n                    });\n                }\n            }\n\n            // Initialize\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx.mrna\") >= 0\n                });\n\n                mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n                osApi.setBusyMessage(\"Creating PCA Matrix\");\n                osApi.getPCA(vm.datasource, mtx).then(function() {\n\n                    osApi.setBusyMessage(\"Loading Gene Sets\");\n                    osApi.getGeneSetNames().then(function(response) {\n\n                        // Load Gene Sets\n                        vm.geneSets = response.payload;\n                        vm.geneSets.unshift(\"All\");\n                        vm.geneSet = vm.geneSets[0];\n\n                        $scope.$watch('vm.geneSet', function() {\n                            update();\n                        });\n\n                        // History\n                        osHistory.onPatientSelectionChange.add(function(selection) {\n                            selectedIds = selection.ids;\n                            vm.search = \"\";\n                            $scope.$apply();\n                            setSelected();\n                        });\n                    });\n                });\n            });\n\n            // API Call To Calculate PCA\n            var update = function() {\n                osApi.setBusyMessage(\"Calculating PCA\");\n                osApi.getCalculatedPCA((vm.geneSet==\"All\") ? null : vm.geneSet).then(function(response) {\n                    osApi.setBusyMessage(\"Rendering PCA\");\n                    var payload = response.payload;\n                    vm.pc1 = Math.round(response.payload[\"importance.PC1\"] * 100);\n                    vm.pc2 = Math.round(response.payload[\"importance.PC2\"] * 100);\n                    // Error Patient Ids From Server Are Different Than \n                    var scores = payload.scores;\n                    var ids = payload.ids;\n                    rawData = scores.map(function(d, i) {\n                        d.id = ids[i];\n                        return d;\n                    }, payload.ids);\n                    draw();\n                    osApi.setBusy(false);\n                });\n            };\n\n            function setScale() {\n                width = $window.innerWidth - 100;\n                height = $window.innerHeight - 190;\n                if (angular.element(\".tray\").attr(\"locked\") == \"true\") width -= 300;\n\n                d3Chart\n                    .attr(\"width\", '100%')\n                    .attr(\"height\", height);\n                xScale = d3.scale.linear()\n                    .domain([-xMax, xMax])\n                    .range([0, width]).nice();\n\n                yScale = d3.scale.linear()\n                    .domain([-yMax, yMax])\n                    .range([height, 0]).nice();\n            }\n\n            // Render\n            function draw() {\n\n                var dataset = rawData;\n\n                var max, min;\n                max = Math.abs(d3.max(dataset, function(d) {\n                    return +d[0];\n                }));\n                min = Math.abs(d3.min(dataset, function(d) {\n                    return +d[0];\n                }));\n                xMax = ((max > min) ? max : min) * 1.2;\n                max = Math.abs(d3.max(dataset, function(d) {\n                    return +d[1];\n                }));\n                min = Math.abs(d3.min(dataset, function(d) {\n                    return +d[1];\n                }));\n                yMax = ((max > min) ? max : min) * 1.2;\n\n                setScale();\n\n                xAxis = d3.svg.axis()\n                    .scale(xScale)\n                    .orient(\"top\")\n                    .ticks(5);\n\n                yAxis = d3.svg.axis()\n                    .scale(yScale)\n                    .orient(\"left\")\n                    .ticks(5);\n\n                // Brush\n                var brush = d3.svg.brush()\n                    .x(xScale)\n                    .y(yScale)\n                    .on(\"brushend\", function() {\n                        var bv = brush.extent();\n                        d3Chart.selectAll(\"circle\")\n                            .classed(\"pca-node-selected\", function(d) {\n                                return (d[0] > bv[0][0] && d[0] < bv[1][0] && d[1] > bv[0][1] && d[1] < bv[1][1]);\n                            });\n                        d3.select(this).transition().duration(300)\n                            .call(brush.extent([\n                                [0, 0],\n                                [0, 0]\n                            ]));\n                        saveSelected();\n                    });\n\n                d3Chart.call(brush);\n\n                var circles = d3Chart.selectAll(\"circle\").data(rawData, function(d) {\n                    return d;\n                });\n\n                circles.enter()\n                    .append(\"circle\")\n                    .attr({\n                        \"class\": \"pca-node\",\n                        \"cx\": width * .5,\n                        \"cy\": height * .5,\n                        \"r\": 3\n                    })\n                    .style(\"fill-opacity\", \"0\")\n                    .on(\"mouseover\", function(d) {\n                        d3Tooltip.transition()\n                            .duration(200)\n                            .style(\"opacity\", 1);\n                        d3Tooltip.html(d.id)\n                            .style(\"left\", (d3.event.pageX + 10) + \"px\")\n                            .style(\"top\", (d3.event.pageY - 5) + \"px\");\n                    })\n                    .on(\"mouseout\", function() {\n                        d3Tooltip.transition()\n                            .duration(500)\n                            .style(\"opacity\", 0);\n                    })\n                    .transition()\n                    .duration(750)\n                    .delay(function(d, i) {\n                        return i / 300 * 500;\n                    })\n                    .attr(\"cx\", function(d) {\n                        return xScale(d[0]);\n                    })\n                    .attr(\"cy\", function(d) {\n                        return yScale(d[1]);\n                    })\n                    .style(\"fill-opacity\", 1);\n\n                circles.exit()\n                    .transition()\n                    .duration(600)\n                    .delay(function(d, i) {\n                        return i / 300 * 500;\n                    })\n                    .attr(\"cx\", width * .5)\n                    .attr(\"cy\", height * .5)\n                    .style(\"fill-opacity\", \"0\")\n                    .remove();\n\n\n                d3yAxis\n                    .attr(\"class\", \"axis\")\n                    .attr(\"transform\", \"translate(0, \" + yScale(0) + \")\")\n                    .call(xAxis)\n                    .append(\"text\")\n                    .text(\"PC1\");\n\n                d3xAxis\n                    .attr(\"class\", \"axis\")\n                    .attr(\"transform\", \"translate(\" + xScale(0) + \", 0)\")\n                    .call(yAxis)\n                    .append(\"text\")\n                    .attr(\"y\", 10)\n                    .attr(\"dy\", \".71em\")\n                    .text(\"PC2\");\n\n                setSelected();\n            }\n\n            vm.resize = function() {\n                setScale();\n                xAxis.scale(xScale);\n                yAxis.scale(yScale);\n                d3yAxis.attr(\"transform\", \"translate(0, \" + yScale(0) + \")\").call(xAxis);\n                d3xAxis.attr(\"transform\", \"translate(\" + xScale(0) + \", 0)\").call(yAxis);\n                d3Chart.selectAll(\"circle\")\n                    .attr(\"cx\", function(d) {\n                        return xScale(d[0]);\n                    })\n                    .attr(\"cy\", function(d) {\n                        return yScale(d[1]);\n                    })\n            };\n\n            // Listen For Resize\n            angular.element($window).bind('resize',\n                _.debounce(vm.resize, 300)\n            );\n\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osPathways', pathways);\n\n    /** @ngInject */\n    function pathways() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/pathways/pathways.html',\n            controller: PathwaysController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function PathwaysController(osApi, osHistory, $state, $stateParams, $scope, $sce, $window, moment, cytoscape, _) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n            var markersNetwork;\n            var vm = this;\n            \n            // Elements\n            var elChart = angular.element(\"#gbm-chart\");\n            var csChart;\n\n            // History Integration\n            var skipSave = false;\n            var selectedIds = (osHistory.getGeneSelection() == null) ? null : osHistory.getGeneSelection().ids;\n            function saveSelected() {\n\n                if (skipSave) { skipSave = false; return; }\n                var ids = csChart.$('node[nodeType=\"gene\"]:selected').map(function(ele){ return ele.data().id.toUpperCase() });\n                osHistory.addGeneSelection(\"Pathways\", \"Manual Selection\", ids );\n            }\n            function setSelected() {\n\n                skipSave = true;\n                csChart.startBatch();\n                if (selectedIds == null) {\n                    csChart.$('node[nodeType=\"gene\"]:selected')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                } else {\n                    csChart.$('node[nodeType=\"gene\"]')\n                        .forEach( function(ele){\n                            ele[ (this.indexOf(ele.id())==-1) ? \"deselect\" : \"select\"]();\n                        }, selectedIds);\n                }\n                csChart.endBatch();\n            }\n            \n            vm.datasource = $stateParams.datasource;\n            vm.search = \"\";\n            vm.frame;\n            vm.tip = null;\n            vm.linkTitle = \"\";\n            vm.links = [];\n\n            vm.resize = function(){\n                var width = $window.innerWidth;\n                if (width > 760)  width -= 140;\n                if (angular.element(\".tray\").attr(\"locked\")==\"true\") width -= 300;\n                elChart.width( width );\n                elChart.height($window.innerHeight - 90);\n                if (csChart){\n                    csChart.resize();\n                    csChart.center();\n                } \n            }\n\n            // Listen For Resize\n            angular.element($window).bind('resize', \n                _.debounce(vm.resize, 300)\n            );\n\n            $scope.$watch('vm.search', function() {\n                if (angular.isUndefined(csChart)) return;\n                var term = vm.search.toUpperCase();\n                var len = term.length;\n                csChart.startBatch()\n                csChart.nodes().map(function(ele) {\n                    if (len == 0) {\n                        ele.unselect();\n                    } else if (ele.attr(\"name\").substr(0, len) === term) {\n                        ele.select();\n                    } else {\n                        ele.unselect();\n                    }\n                });\n                csChart.endBatch();\n            });\n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.setDataset(vm.datasource).then(function() {\n\n                osApi.getPathway().then(function(response) {\n\n                    markersNetwork = angular.fromJson(response.payload);\n                    csChart = cytoscape({\n                            container: elChart,\n                            elements: markersNetwork.elements,\n                            style: getStyle(),\n                            minZoom: .2,\n                            maxZoom: 5,\n                            layout: {\n                                name: \"preset\",\n                                fit: true\n                            }\n                        })\n                        .on('select', 'node', _.debounce(saveSelected, 300))\n                        .on('click', 'node', function() {\n                            //if (e.cyTarget.data().nodeType!=\"gene\") return;\n                            //angular.element('#gbm-webpage').modal();\n                            //$window.open(\"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\" + e.cyTarget.data().id);\n                            // $scope.$apply(function() {\n                            //     vm.frame = $sce.trustAsResourceUrl(url);\n                            // });\n                        })\n                        .on('click', 'edge', function() {\n                            // links =[\n                            //     { name: \"PubMed Article\", url:\"https://www.ncbi.nlm.nih.gov/pubmed/?term=\" + e.cyTarget.data().pmid },\n                            //     { name: \"PubMed Search\",  url:\"http://www.ncbi.nlm.nih.gov/pubmed/?term=(GENE \"+e.cyTarget.data().source+\") AND (GENE \"+e.cyTarget.data().target+\")\"}\n                            //     { name: e.cyTarget.data().source+\"Gene Card\", url: \"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().source}\n                            //     { name: e.cyTarget.data().target+\"Gene Card\", url: \"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().target}\n                            // ];\n                            //$window.open(\"https://www.ncbi.nlm.nih.gov/pubmed/?term=\" + e.cyTarget.data().pmid);\n                            //$window.open(\"http://www.ncbi.nlm.nih.gov/pubmed/?term=(GENE \"+e.cyTarget.data().source+\") AND (GENE \"+e.cyTarget.data().target+\")\");\n                            //$window.open(\"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().source);\n                            //$window.open(\"https://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+e.cyTarget.data().target);\n                            // $scope.$apply(function() {\n                            //     vm.frame = $sce.trustAsResourceUrl(url);\n                            // });\n\n                        }).on('mouseover', 'edge', function(e) {\n                            $scope.$apply(function() {\n                                vm.tip = e.cyTarget.data().source + \" Extract\";\n                            });\n\n                            e.cyTarget.style({\n                                'width': '4px'\n                            });\n                        }).on('mouseout', 'edge', function(e) {\n                            $scope.$apply(function() {\n                                vm.tip = null;\n                            });\n                            e.cyTarget.style({\n                                'width': '2px'\n                            });\n                        }).on('mouseover', 'node', function(e) {\n                            $scope.$apply(function() {\n                                vm.tip = e.cyTarget.data().name + \" Gene Card\";\n                            });\n                        }).on('mouseout', 'node', function() {\n                            $scope.$apply(function() {\n                                vm.tip = null;\n                            });\n                        })\n\n                    // Register History Component\n                    osHistory.onGeneSelectionChange.add(function(selection){\n                        selectedIds = selection.ids;\n                        setSelected();\n                    });\n                    setSelected();\n                    osApi.setBusy(false);\n                });\n            });\n\n\n            function getStyle() {\n                var darkblue = 'rgb(5, 108, 225)';\n                var red = 'red'; //rgb(230, 44, 28)';\n                var purple = 'rgb(56, 52,123)';\n                var green = 'green'; //'rgb(56, 52,123)';//'rgb(28, 230,116)';//'green';\n                return [{\n                        'selector': 'node',\n                        'style': {\n                            'content': 'data(label)',\n                            'text-valign': 'center',\n                            'text-halign': 'center',\n                            'shape': 'ellipse',\n                            'width': '60px',\n                            'height': '50px',\n                            'color': darkblue,\n                            'background-color': 'rgb(250, 250, 250)',\n                            'border-width': '2px',\n                            'border-color': darkblue\n\n                        }\n                    }, {\n                        'selector': 'edge',\n                        'style': {\n                            'width': '2px',\n                            'line-color': darkblue,\n                            'line-style': 'solid'\n                        }\n                    },\n                    // Boxes\n                    {\n                        'selector': 'node[nodeType=\"class\"], node[nodeType=\"family\"], node[nodeType=\"complex\"]',\n                        'style': {\n                            'content': '',\n                            'background-color': 'white',\n                            'shape': 'roundrectangle'\n\n                        }\n                    },\n                    // Blue Activiates & Indirect Activates\n                    {\n                        'selector': 'edge[edgeType=\"activates\"], edge[edgeType=\"indirectly activates\"]',\n                        'style': {\n                            'line-color': green,\n                            'target-arrow-shape': 'triangle',\n                            'target-arrow-color': green\n                        }\n                    },\n                    // Inhibits & Ubiquitinylates\n                    {\n                        'selector': 'edge[edgeType=\"inhibits\"], edge[edgeType=\"ubiquitinylates\"]',\n                        'style': {\n                            'line-color': red,\n                            'target-arrow-shape': 'tee',\n                            'target-arrow-color': red\n                        }\n                    },\n                    // Fusion\n                    {\n                        'selector': 'edge[edgeType=\"fusion\"]',\n                        'style': {\n                            'line-color': green\n                        }\n                    },\n                    // Hide\n                    {\n                        'selector': 'edge[edgeType=\"contains\"]',\n                        'style': {\n                            'display': 'none'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"process\"]',\n                        'style': {}\n                    }, {\n                        'selector': 'node[nodeType=\"gene\"]:selected',\n                        'style': {\n                            'overlay-opacity': '0.5',\n                            'overlay-color': 'red'\n                        }\n                    },\n\n                    // Legacy ... Not sure if it's being used\n                    {\n                        'selector': 'node[nodeType=\"rtk\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(224, 209, 178)',\n                            'border-color': 'black',\n                            'border-width': '0px',\n                            'font-size': '48px',\n                            'shape': 'roundrectangle',\n                            'width': '40px',\n                            'height': '160px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"kinase\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(255, 206, 194)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"dimer\"]',\n                        'style': {\n                            'content': '',\n                            'background-color': 'rgb(234, 219, 188)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '0px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"loop\"]',\n                        'style': {\n                            'content': '',\n                            'background-color': 'rgb(255, 255, 255)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px',\n                            'border-style': 'dotted'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"gtpase\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(194, 194, 255)',\n                            'shape': 'ellipse',\n                            'width': '160px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"adaptor\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(77, 184, 255)',\n                            'shape': 'ellipse',\n                            'width': '60px',\n                            'height': '120px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"GEF\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(77, 184, 255)',\n                            'shape': 'ellipse',\n                            'width': '60px',\n                            'height': '60px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"process\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(255, 255, 255)',\n                            'shape': 'roundrectangle',\n                            'width': '100px',\n                            'height': '40px',\n                            'font-size': '24px',\n                            'border-color': 'black',\n                            'border-width': '0px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"TF\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'background-color': 'rgb(255, 206, 94)',\n                            'shape': 'diamond',\n                            'width': '160px',\n                            'height': '60px',\n                            'font-size': '48px',\n                            'border-color': 'black',\n                            'border-width': '1px'\n                        }\n                    }, {\n                        'selector': 'node[nodeType=\"gene fusion\"]',\n                        'style': {\n                            'content': 'data(label)',\n                            'shape': 'roundrectangle',\n                            'font-size': '24px',\n                            'border-color': 'red',\n                            'border-width': '3px'\n                        }\n                    }, {\n                        'selector': 'edge:selected',\n                        'style': {\n                            'overlay-color': 'grey',\n                            'overlay-opacity': '0.3'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"recruits\"]',\n                        'style': {\n                            'width': '2px'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"fusion\"]',\n                        'style': {\n                            'line-color': purple\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"recruits\"]',\n                        'style': {\n                            'line-color': 'red',\n                            'width': '1px',\n                            'line-style': 'dashed',\n                            'target-arrow-shape': 'triangle',\n                            'target-arrow-color': 'black'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"cycles\"]',\n                        'style': {\n                            'line-color': 'black',\n                            'width': '1px',\n                            'line-style': 'dashed',\n                            'target-arrow-shape': 'triangle',\n                            'source-arrow-shape': 'triangle',\n                            'target-arrow-color': 'green',\n                            'source-arrow-color': 'red'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"associates\"]',\n                        'style': {\n                            'line-color': 'black',\n                            'width': '1px',\n                            'line-style': 'solid'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"activation\"]',\n                        'style': {\n                            'line-color': 'green',\n                            'width': '1px'\n                        }\n                    }, {\n                        'selector': 'edge[edgeType=\"inhibition\"]',\n                        'style': {\n                            'line-color': 'red',\n                            'width': '1px'\n                        }\n                    }\n                ]\n\n            }\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .service('osSound', osSound);\n\n    /** @ngInject */\n    function osSound() {\n\n        var _beep = new Audio(\"data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=\");\n        function beep() { _beep.play(); }\n\n        return {\n            beep: beep\n        }\n    }\n})();\n\n (function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .factory('osSocket', oncoscape);\n\n    /** @ngInject */\n    function oncoscape(SockJS, $rootScope, $q, $log, $location) {\n       \n        // Object To Store Call Back Promises\n        var callbacks = {};\n        var dataSource;\n        var getDataSource = function() { \n            return dataSource; \n        }\n        var setDataSource = function(value){\n            dataSource = value;\n        }\n\n        // Request Ids Used To Coorelate Request With Callback\n        var requestId = 1;\n        var getRequestId = function() { \n            if (requestId==9999) requestId = 1;\n            return requestId++; \n        }\n\n        // Create Sock JS Instace\n        var socket = new SockJS(\n            $location.protocol()+\"://\"+$location.host()+\":\"+ (($location.port()==\"3002\") ? 80 : $location.port()) +'/oncoscape','',\n            {\n                'debug': false,\n                'devel': false\n            }\n        );\n\n        // Handle Messages From Socket & Resolve Promise\n        socket.onmessage = function(event) {\n            var data = angular.fromJson(event.data);\n            if (angular.isDefined(callbacks[data.cmd])) {\n                var callback = callbacks[data.cmd];\n                delete callbacks[data.cmd];\n                callback.resolve(data);\n            } else {\n\n                $log.error(\"Unhandled message: %o\", data);\n            }\n        };\n\n        // Formulate Request\n        var request = function(request) {\n\n            // Add Additional Information To Request Per Chinook Protocol\n            request.callback = getRequestId();\n            request.status = \"request\";\n            request.payload = request.payload || \"\";\n            request.ds = getDataSource();\n\n            // Store Promise In Callback Object\n            var deferred = $q.defer();\n            callbacks[request.callback] = deferred;\n\n            // Ensure Socket Is Open Before Sending\n            if (socket.readyState===0){\n                socket.onopen = function(){\n                    socket.send(angular.toJson(request));    \n                };\n            }else{\n                socket.send(angular.toJson(request));\n            }\n\n            // Return Promise\n            return deferred.promise.then(function(response) {\n                request.response = response;\n                return response;\n            });\n        }\n\n        // Return Object\n        return {\n            request: request,\n            setDataSource: setDataSource\n        };\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .service('osHistory', osHistory);\n\n    /** @ngInject */\n    function osHistory(moment, signals, osSound) {\n\n        var _historyMax = 50;\n        var _geneSelections = [];\n        var _geneSelection = null;\n        var _patientSelections = [];\n        var _patientSelection = null;\n        var _onPatientSelectionChange = new signals.Signal();\n        var _onGeneSelectionChange = new signals.Signal();\n\n        var clear = function(){\n            _geneSelections = [];\n            _geneSelection = null;\n            _patientSelections = [];\n            _patientSelection = null;\n        }\n       \n       /* Gene */\n        var getGeneSelections = function(){\n            return _geneSelections;\n        };\n        var addGeneSelection = function(tool, desc, ids){\n            var m = moment();\n            var selection = {tool:tool, desc:desc, ids:ids, date:m.unix(), time:m.format(\"H:mm\")};\n            _geneSelection = selection;\n            _geneSelections.unshift(selection);\n            if (_geneSelections.length>_historyMax) _geneSelections.pop()\n        };\n        var setGeneSelection = function(selection){\n            _geneSelection = selection;\n            _onGeneSelectionChange.dispatch(selection);\n        };\n        var getGeneSelection = function(){\n            return _geneSelection;\n        };\n        var getGeneSelectionLast = function(){\n            var i = _geneSelections.indexOf(_geneSelection) - 1;\n            if (i<0){\n                osSound.beep();\n                return null;\n            } \n            _geneSelection = _geneSelections[i];\n            return _geneSelection;\n        };\n        var getGeneSelectionNext = function(){\n            var i = _geneSelections.indexOf(_geneSelection) + 1;\n            if (i>=_geneSelections.length){\n                osSound.beep();\n                return null;\n            } \n            _geneSelection = _geneSelections[i];\n            return _geneSelection;\n        };\n\n\n        /* Patients */\n        var getPatientSelections = function(){\n            return _patientSelections;\n        };\n        var addPatientSelection = function(tool, desc, ids){\n            var m = moment();\n            var selection = {tool:tool, desc:desc, ids:ids, date:m.unix(), time:m.format(\"H:mm\")};\n            _patientSelection = selection;\n            _patientSelections.unshift(selection);\n            if (_patientSelections.length>_historyMax) _patientSelections.pop()\n        };\n        var setPatientSelection = function(selection){\n            _patientSelection = selection;\n            _onPatientSelectionChange.dispatch(selection);\n        };\n        var getPatientSelection = function(){\n            return _patientSelection;\n        };\n        var getPatientSelectionLast = function(){\n            var i = _patientSelections.indexOf(_patientSelection) - 1;\n            if (i<0){\n                osSound.beep();\n                return null;\n            } \n            _patientSelection = _patientSelections[i];\n            return _patientSelection;\n        };\n        var getPatientSelectionNext = function(){\n            var i = _patientSelections.indexOf(_patientSelection) + 1;\n            if (i>=_patientSelections.length){\n                osSound.beep();\n                return null;\n            } \n            _patientSelection = _patientSelections[i];\n            return _patientSelection;\n        };\n\n        angular.element(document).keypress(function(e) {\n            var selection;\n            if (!e.ctrlKey) return;\n            switch (e.keyCode)\n            {\n                case 11:\n                    selection = getGeneSelectionLast();\n                    if (selection!=null) _onGeneSelectionChange.dispatch(selection);\n                    break;\n                case 12:\n                    selection = getGeneSelectionNext();\n                    if (selection!=null) _onGeneSelectionChange.dispatch(selection);\n                    break;\n                case 46:\n                    selection = getPatientSelectionLast();\n                    if (selection!=null) _onPatientSelectionChange.dispatch(selection);\n                    break;\n                case 44:\n                    selection = getPatientSelectionNext();\n                    if (selection!=null) _onPatientSelectionChange.dispatch(selection);\n                    break;\n            }\n        });\n        var removeListeners = function(){\n          \n        }\n\n        return {\n            \n            onPatientSelectionChange: _onPatientSelectionChange,\n            onGeneSelectionChange: _onGeneSelectionChange,\n\n            addGeneSelection: addGeneSelection,\n            setGeneSelection: setGeneSelection,\n            getGeneSelection: getGeneSelection,\n            getGeneSelections: getGeneSelections,\n            getGeneSelectionLast: getGeneSelectionLast,\n            getGeneSelectionNext: getGeneSelectionNext,\n\n            addPatientSelection: addPatientSelection,\n            setPatientSelection: setPatientSelection,\n            getPatientSelection: getPatientSelection,\n            getPatientSelections: getPatientSelections,\n            getPatientSelectionLast: getPatientSelectionLast,\n            getPatientSelectionNext: getPatientSelectionNext,\n\n            removeListeners: removeListeners,\n            clear: clear\n        }\n    }\n})();\n(function() {\n  'use strict';\n/*\n    angular\n        .module('oncoscape')\n        .provider({\n            $exceptionHandler:\n*/\n        /** @ngInject */\n/*        \n        function exceptionFactory(){\n        \tvar handler = function (exception, cause){\n                window.alert(\"Oh Snap!  An error occured.  View console for details\")\n                console.log(exception);\n                exception.stack();\n                if (angular.isDefined(cause)) console.log(cause);\n        \t}\n            this.$get = function() { return handler; };\n        }\n       });\n*/\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .service('osApi', oncoscape);\n\n    /** @ngInject */\n    function oncoscape(osSocket, $http, signals, $location) {\n\n        var _dataSource;\n        var onDataSource = new signals.Signal();\n        function getDataSource(){ return _dataSource; }\n        function setDataSource(value){\n            osSocket.setDataSource(value);\n            _dataSource = value;\n            onDataSource.dispatch(_dataSource);\n        }\n        \n        /*** User Api ***/\n        function userApi(){\n\n            // Events\n            var onLogin = new signals.Signal(); // Fired When Data Changes\n            var onLogout = new signals.Signal(); // Fired When Selection changes\n            var _user = {\n                \"name\":\"\",\n                \"password\":\"\",\n                \"domain\":{\"name\":\"Guest\"},\n                \"authenticated\":false,\n                \"token\": null,\n                \"datasets\": []\n            };\n            var _domains = [\n                { \"name\": \"Guest\" },\n                { \"name\": \"FHCRC\" },\n                { \"name\": \"UW\" }\n            ];\n            var logout = function(){\n                _user.name = \"\";\n                _user.password = \"\";\n                _user.domain = {\"name\":\"Guest\"};\n                _user.authenticated = false;\n                _user.token = null;\n                _user.datasets = [];\n\n                onLogout.dispatch();\n            }\n            var login = function(user){\n                _user = user;\n           \n                var req = {\n                    method: 'POST',\n                    url: $location.protocol()+\"://\"+$location.host()+\":\"+ (($location.port()==\"3002\") ? 80 : $location.port()) +'/login',\n                    data: {\n                        username: _user.name,\n                        password: _user.password,\n                        domain: _user.domain.name\n                    }\n                };\n                return $http(req).then(function(res) {\n                    if (res.data.success) {\n                        _user.authenticated = true;\n                        _user.token = res.data.token;\n                        _user.datasets = res.data.datasets;\n                        onLogin.dispatch(_user);\n                    } else {\n                        _user.authenticated = false;\n                        _user.token =null;\n                    }\n                });\n            }\n            return {\n                getDomains: function(){ return _domains; },\n                getUser: function() { return _user; },\n                login: login,\n                logout: logout,\n                onLogin: onLogin,\n                onLogout: onLogout\n            }\n        }\n        var _userApi = userApi();\n        function getUserApi() { return _userApi; }\n\n        /*** UI Functions ***/\n        function setBusy(value) {\n            if (value) {\n                angular.element(\".loader-modal\").show();\n            } else {\n                angular.element(\".loader-modal\").hide();\n            }\n            return setBusyMessage;\n        }\n        function setBusyMessage() {\n            //console.log(value);\n        }\n        function showFilter() {\n            angular.element(\"#filter-dropdown\").slideToggle();\n        }\n        function hideFilter() {\n            angular.element(\"#filter-dropdown\").slideToggle();\n        }\n        function toggleFilter(){\n            angular.element(\"#filter-dropdown\").slideToggle();\n        }\n\n        \n        /*** R Service Calls ***/\n        function setDataset(dataPackage) {\n            osSocket.setDataSource(dataPackage);\n            return osSocket.request({\n                cmd: \"specifyCurrentDataset\",\n                payload: dataPackage\n            });\n        }\n        \n        function getDataManifest(dataPackage) {\n            return osSocket.request({\n                cmd: \"getDataManifest\",\n                payload: dataPackage\n            });\n        }\n        function getPatientHistoryTable(dataPackage) {\n            return osSocket.request({\n                cmd: \"getPatientHistoryTable\",\n                payload: {\n                    datasetName: dataPackage,\n                    durationFormat: \"byYear\"\n                }\n            });\n        }\n        function getPatientHistoryDxAndSurvivalMinMax() {}\n        function getSampleDataFrame() {}\n        function getGeneSetNames() {\n            return osSocket.request({\n                cmd: \"getGeneSetNames\"\n            });\n        }\n        function getSampleCategorizationNames() {\n            return osSocket.request({\n                cmd: 'getSampleCategorizationNames'\n            });\n        }\n        function getSampleCategorization(names) {\n            return osSocket.request({\n                cmd: 'getSampleCategorization',\n                payload: names\n            });\n        }\n        function getMarkersNetwork(payload) {\n            // Payload is return From Set DataSource\n            return osSocket.request({\n                cmd: \"getMarkersNetwork\",\n                payload: payload\n            })\n        }\n        function getDrugGeneInteractions() {}\n        function getCanonicalizePatientIDsInDataset(patientIds) {\n            return osSocket.request({\n                cmd: \"getCanonicalizePatientIDsInDataset\",\n                payload: patientIds\n            });\n        }\n        function getGeneSetGenes() {}\n        function getOncoprintDataSelection() {}\n        function getPCA(dataPackage, matrixName) {\n            var payload = {\n                dataPackage: dataPackage,\n                matrixName: matrixName\n            };\n            return osSocket.request({\n                cmd: \"createPCA\",\n                payload: payload\n            });\n        }\n        function getCalculatedPCA(geneSet) {\n            var payload = {\n                genes: geneSet\n            };\n\n            return osSocket.request({\n                cmd: \"calculatePCA\",\n            \n                payload: payload\n            });\n        }\n        function getCalculatedPCA2(geneSet) {\n            var payload = {\n                genes: geneSet\n            };\n            return osSocket.request({\n                cmd: \"calculatePCA2\",\n                payload: payload\n            });\n        }\n        function getPLSR(dataPackage, matrixName) {\n            var payload = {\n                dataPackage: dataPackage,\n                matrixName: matrixName\n            };\n            return osSocket.request({\n                cmd: \"createPLSR\",\n                payload: payload\n            });\n        }\n        function getCalculatedPLSR(geneSet, factors) {\n            var payload = {\n                genes: geneSet,\n                factorCount: factors.length,\n                factors: factors\n            };\n            return osSocket.request({\n                cmd: \"calculatePLSR\",\n                payload: payload\n            });\n        }\n        function getSummarizedPLSRPatientAttributes(attrs) {\n            attrs = attrs || ['AgeDx', 'Survival'];\n            return osSocket.request({\n                cmd: 'summarizePLSRPatientAttributes',\n                payload: attrs\n            });\n        }\n        function getCalculatedSurvivalCurves(patientIds, title) {\n            return osSocket.request({\n                cmd: \"calculateSurvivalCurves\",\n                payload: {\n                    sampleIDs: patientIds,\n                    title: title\n                }\n            });\n        }\n        function getTimelines() {\n            return osSocket.request({\n                cmd: \"createTimelines\"\n            });\n        }\n        function getCalculatedTimelines() {}\n        function getModuleModificationDate() {\n            return osSocket.request({\n                cmd: \"getModuleModificationDate\",\n                payload: 'gbmPathways'\n            });\n        }\n        function getPathway() {\n            return osSocket.request({\n                cmd: \"getPathway\",\n                payload: 'g.gbmPathways.json'\n            });\n        }\n        function getMrnaData(entities, features) {\n            return osSocket.request({\n                cmd: \"get_mRNA_data\",\n                payload: {\n                    entities: entities,\n                    features: features\n                }\n            });\n        }\n        function getCnvData(entities, features) {\n            return osSocket.request({\n                cmd: \"get_cnv_data\",\n                payload: {\n                    entities: entities,\n                    features: features\n                }\n            });\n        }\n        function getMutationData(entities, features) {\n            return osSocket.request({\n                cmd: \"get_mutation_data\",\n                payload: {\n                    entities: entities,\n                    features: features\n                }\n            });\n        }\n        function getOncoprint(geneSetAndPatients) {\n            return osSocket.request({\n                cmd: \"oncoprint_data_selection\",\n                payload: {\n                    patientIdsAndGenes: geneSetAndPatients\n                }\n            });\n        }\n\n        return {\n            setDataSource: setDataSource,\n            getDataSource: getDataSource,\n            onDataSource: onDataSource,\n            getUserApi: getUserApi,\n            showFilter: showFilter,\n            hideFilter: hideFilter,\n            toggleFilter: toggleFilter,\n            setBusy: setBusy,\n            setBusyMessage: setBusyMessage,\n            setDataset: setDataset,\n            getDataManifest: getDataManifest,\n            getPatientHistoryTable: getPatientHistoryTable,\n            getPatientHistoryDxAndSurvivalMinMax: getPatientHistoryDxAndSurvivalMinMax,\n            getSampleDataFrame: getSampleDataFrame,\n            getGeneSetNames: getGeneSetNames,\n            getSampleCategorizationNames: getSampleCategorizationNames,\n            getSampleCategorization: getSampleCategorization,\n            getMarkersNetwork: getMarkersNetwork,\n            getPathway: getPathway,\n            getDrugGeneInteractions: getDrugGeneInteractions,\n            getCanonicalizePatientIDsInDataset: getCanonicalizePatientIDsInDataset,\n            getGeneSetGenes: getGeneSetGenes,\n            getOncoprintDataSelection: getOncoprintDataSelection,\n            getPCA: getPCA,\n            getCalculatedPCA: getCalculatedPCA,\n            getCalculatedPCA2: getCalculatedPCA2,\n            getPLSR: getPLSR,\n            getCalculatedPLSR: getCalculatedPLSR,\n            getSummarizedPLSRPatientAttributes: getSummarizedPLSRPatientAttributes,\n            getCalculatedSurvivalCurves: getCalculatedSurvivalCurves,\n            getTimelines: getTimelines,\n            getCalculatedTimelines: getCalculatedTimelines,\n            getMrnaData: getMrnaData,\n            getCnvData: getCnvData,\n            getMutationData: getMutationData,\n            getModuleModificationDate: getModuleModificationDate,\n            getOncoprint: getOncoprint\n        }\n    }\n})();\n/*\n * Copyright (c) 2015 Memorial Sloan-Kettering Cancer Center.\n *\n * This library is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS\n * FOR A PARTICULAR PURPOSE. The software and documentation provided hereunder\n * is on an \"as is\" basis, and Memorial Sloan-Kettering Cancer Center has no\n * obligations to provide maintenance, support, updates, enhancements or\n * modifications. In no event shall Memorial Sloan-Kettering Cancer Center be\n * liable to any party for direct, indirect, special, incidental or\n * consequential damages, including lost profits, arising out of the use of this\n * software and its documentation, even if Memorial Sloan-Kettering Cancer\n * Center has been advised of the possibility of such damage.\n */\n\n/*\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\noncoprint_utils = (function() {\n\tvar exports = {};\n\n\texports.sign = function(number) {\n\t\treturn number?((number<0)?-1:1):0\n\t};\n\n\texports.invert_array = function invert_array(arr) {\n\t\treturn arr.reduce(function(curr, next, index) {\n\t\t\tcurr[next] = index;\n\t\t\treturn curr;\n\t\t}, {});\n\t};\n\n\texports.cssClassToSelector = function(classes) {\n\t\treturn \".\"+classes.split(\" \").join(\".\");\n\t};\n\texports.mouseY = function(evt) {\n\t\treturn exports.ifndef(evt.offsetY, evt.originalEvent && evt.originalEvent.layerY);\n\t};\n\texports.mouseX = function(evt) {\n\t\treturn exports.ifndef(evt.offsetX, evt.originalEvent && evt.originalEvent.layerX);\n\t};\n\texports.ifndef = function(val, replacement) {\n\t\treturn (typeof val === 'undefined') ? replacement : val;\n\t};\n\texports.extends = function(child_class, parent_class) {\n\t\tchild_class.prototype = Object.create(parent_class.prototype);\n\t\tchild_class.prototype.constructor = child_class;\n\t};\n\n\texports.makeIdCounter = function() {\n\t\tvar counter = 0;\n\t\treturn function() {\n\t\t\tcounter += 1;\n\t\t\treturn counter;\n\t\t};\n\t};\n\n\texports.clamp = function(t, a, b) {\n\t\treturn Math.max(Math.min(b,t), a);\n\t};\n\n\texports.makeD3SVGElement = function(tag) {\n\t\treturn d3.select(document.createElementNS('http://www.w3.org/2000/svg', tag));\n\t};\n\n\texports.appendD3SVGElement = function(elt, target, svg) {\n\t\treturn target.select(function() {\n\t\t\treturn this.appendChild(elt.node().cloneNode(true));\n\t\t});\n\t};\n\n\texports.spaceSVGElementsHorizontally = function(group, padding) {\n\t\tvar x = 0;\n\t\tvar elts = exports.d3SelectChildren(group, '*').each(function() {\n\t\t\tif (this.tagName === 'defs') {\n\t\t\t\t// don't adjust spacing for a defs element\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar transform = d3.select(this).attr('transform');\n\t\t\tvar y = transform && transform.indexOf(\"translate\") > -1 && parseFloat(transform.split(\",\")[1], 10);\n\t\t\ty = y || 0;\n\t\t\td3.select(this).attr('transform', exports.translate(x, y));\n\t\t\tx += this.getBBox().width;\n\t\t\tx += padding;\n\t\t});\n\t\treturn group;\n\t};\n\n\texports.textWidth = function(string, font) {\n\t\tvar obj = $('<div>'+string+'</div>')\n\t\t\t\t.css({position: 'absolute', float: 'left',\n\t\t\t\t\t'white-space':'nowrap', visibility: 'hidden',\n\t\t\t\t\tfont: font})\n\t\t\t\t.appendTo($('body'));\n\t\tvar width = obj.width();\n\t\tobj.remove();\n\t\treturn width;\n\t};\n\n\texports.d3SelectChildren = function(parent, selector) {\n\t\treturn parent.selectAll(selector).filter(function() {\n\t\t\treturn this.parentNode === parent.node();\n\t\t});\n\t};\n\n\texports.warn = function(str, context) {\n\t\tconsole.log(\"Oncoprint error in \"+context+\": \"+str);\n\t};\n\n\texports.stableSort = function(arr, cmp) {\n\t\t// cmp returns something in [-1,0,1]\n\n\t\tvar zipped = [];\n\t\t_.each(arr, function(val, ind) {\n\t\t\tzipped.push([val, ind]);\n\t\t});\n\t\tvar stable_cmp = function(a,b) {\n\t\t\tvar res = cmp(a[0], b[0]);\n\t\t\tif (res === 0) {\n\t\t\t\tif (a[1] < b[1]) {\n\t\t\t\t\tres = -1;\n\t\t\t\t} else if (a[1] > b[1]) {\n\t\t\t\t\tres = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn res;\n\t\t};\n\t\tzipped.sort(stable_cmp);\n\t\treturn _.map(zipped, function(x) { return x[0];});\n\t};\n\n\texports.lin_interp = function(t, a, b) {\n\t\tif (a[0] === '#') {\n\t\t\tvar r = [parseInt(a.substring(1,3), 16), parseInt(b.substring(1,3), 16)];\n\t\t\tvar g = [parseInt(a.substring(3,5), 16), parseInt(b.substring(3,5), 16)];\n\t\t\tvar b = [parseInt(a.substring(5,7), 16), parseInt(b.substring(5,7), 16)];\n\t\t\tvar R = Math.round(r[0]*(1-t) + r[1]*t).toString(16);\n\t\t\tvar G = Math.round(g[0]*(1-t) + g[1]*t).toString(16);\n\t\t\tvar B = Math.round(b[0]*(1-t) + b[1]*t).toString(16);\n\n\t\t\tR = R.length < 2 ? '0'+R : R;\n\t\t\tG = G.length < 2 ? '0'+G : G;\n\t\t\tB = B.length < 2 ? '0'+B : B;\n\n\t\t\treturn '#' + R + G + B;\n\t\t} else if (isNaN(a) && a.indexOf('%') > -1) {\n\t\t\tvar A = parseFloat(a, 10);\n\t\t\tvar B = parseFloat(b, 10);\n\t\t\treturn (A*(1-t) + B*t)+'%';\n\t\t} else {\n\t\t\treturn a*(1-t) + b*t;\n\t\t}\n\t};\n\n\texports.translate = function(x,y) {\n\t\treturn \"translate(\" + x + \",\" + y + \")\";\n\t};\n\n\texports.assert = function(bool, msg) {\n\t\tif (!bool) {\n\t\t\tthrow msg;\n\t\t}\n\t}\n\treturn exports;\n})();\n(function() {\n    'use strict';\n    \n    angular\n        .module('oncoscape')\n        .directive('osOncoprint', oncoprint);\n\n    /** @ngInject */\n    function oncoprint() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/oncoprint/oncoprint.html',\n            controller: OncoprintController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function OncoprintController(osApi, $state, $stateParams, $timeout, $scope, d3, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var elControl = angular.element(\"#oncoprintControlsDiv\");\n            var elInstructions = angular.element(\"#oncoprintInstructions\");\n            var elErrors = angular.element(\"#oncoprintErrorSection\");\n            var elLegend = angular.element(\"#legend\");\n\n            // Properties\n            var cohortGene = osApi.getCohortGene();\n            var cohortPatient = osApi.getCohortPatient();\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.geneSets = [];\n            vm.geneSet = null;\n            vm.optCohortGenes = cohortGene.get();\n            vm.optCohortGene = vm.optCohortGenes[0];\n            vm.optCohortPatients = cohortPatient.get();\n            vm.optCohortPatient = vm.optCohortPatients[0];\n            vm.geneAndPatients = vm.optCohortGene.ids + \",\" + vm.optCohortPatient.ids;\n            vm.errorMessage;\n            \n            var Oncoprint = (function() {\n              var events = oncoprint_events;\n              var utils = oncoprint_utils;\n              var RuleSet = oncoprint_RuleSet;\n\n              var defaultOncoprintConfig = {\n                cell_width: 6,\n                cell_padding: 2.5,\n                legend: true,\n              };\n\n              var hiddenOncoprintConfig = {\n                pre_track_padding: 0,\n              };\n\n              var defaultTrackConfig = {\n                label: 'Gene',\n                datum_id_key: 'patient',\n                cell_height: 23,\n                track_height: 20,\n                track_padding: 5,\n                sort_cmp: undefined,\n                tooltip: function(d) {\n                  return d['patient'];\n                },\n                removable: false,\n                sort_direction_changable: false\n              }; \n\n\n\n              function Oncoprint(config) {\n                var self = this;\n                var getTrackId = utils.makeIdCounter();\n\n                self.config = config;\n\n                self.id_order = [];\n                self.inverted_id_order = {};\n                self.visible_id_order = [];\n                self.visible_inverted_id_order = {};\n                self.hidden_ids = {};\n                self.track_groups = [[],[]];\n                self.track_group_sort_order = [0,1];\n                self.sort_direction = {};\n                self.tracks = {};\n                self.sort_config = {type: 'track'};\n\n                self.cell_padding_on = true;\n                self.true_cell_width = config.cell_width;\n\n                self.zoomed_cell_width = self.true_cell_width;\n                self.zoom = 1;\n\n                // Cell Padding\n                self.toggleCellPadding = function() {\n                  self.cell_padding_on = !self.cell_padding_on;\n                  $(self).trigger(events.SET_CELL_PADDING);\n                };\n                self.getCellPadding = function() {\n                  return Math.ceil(self.config.cell_padding*self.getZoom())*(+self.cell_padding_on);\n                };\n\n                // Zoom\n                self.getZoom = function() {\n                  return self.zoom;\n                };\n                self.setZoom = function(z) {\n                  self.zoom = utils.clamp(z, 0, 1);\n                  updateZoomedCellWidth();\n                  updateZoom();\n                  $(self).trigger(events.SET_ZOOM);\n                  return self.zoom;\n                };\n                var updateZoom = function() {\n                  // maps {1, ... , true_cell_width} to [0,1]\n                  self.zoom = (self.zoomed_cell_width-1)/(self.true_cell_width - 1);\n                };\n                var updateZoomedCellWidth = function() {\n                  // maps [0,1] to {1, ... , true_cell_width}\n                  self.zoomed_cell_width = Math.round(self.zoom*(self.true_cell_width-1) + 1);\n                };\n                self.increaseZoom = function() {\n                  self.zoomed_cell_width = utils.clamp(self.zoomed_cell_width+1, 1, self.true_cell_width);\n                  updateZoom();\n                  $(self).trigger(events.SET_ZOOM);\n                  return self.zoom;\n                };\n                self.decreaseZoom = function() {\n                  self.zoomed_cell_width = utils.clamp(self.zoomed_cell_width-1, 1, self.true_cell_width);\n                  updateZoom();\n                  $(self).trigger(events.SET_ZOOM);\n                  return self.zoom;\n                };\n\n                // Cell Width\n                self.getFullCellWidth = function() {\n                  return self.true_cell_width;\n                };\n                self.getZoomedCellWidth = function() {\n                  return self.zoomed_cell_width;\n                };\n\n                // Cell Height\n                self.getCellHeight = function(track_id) {\n                  return self.tracks[track_id].config.cell_height;\n                };\n\n                // Track Height\n                self.getTrackHeight = function(track_id) {\n                  return self.tracks[track_id].config.track_height;\n                };\n\n                // Track Padding\n                self.getTrackPadding = function(track_id) {\n                  return self.tracks[track_id].config.track_padding;\n                };\n\n                // Id Order\n                self.getFilteredIdOrder = function(data_filter_fn, track_ids) {\n                  var tracks = track_ids || self.getTracks();\n                  return _.filter(self.id_order, function(id) {\n                    var d = _.map(tracks, function(track_id) {\n                      return self.getTrackDatum(track_id, id);\n                    });\n                    return data_filter_fn(d);\n                  });\n                };\n                self.getIdOrder = function() {\n                  return self.id_order;\n                };\n                self.getInvertedIdOrder = function() {\n                  return self.inverted_id_order;\n                };\n                self.getVisibleIdOrder = function() {\n                  return self.visible_id_order;\n                };\n                self.getVisibleInvertedIdOrder = function() {\n                  return self.visible_inverted_id_order;\n                };\n                var updateVisibleIdOrder = function() {\n                  self.visible_id_order = _.filter(self.id_order, function(id) {\n                    return !self.hidden_ids[id];\n                  });\n                  self.visible_inverted_id_order = utils.invert_array(self.visible_id_order);\n                  $(self).trigger(events.SET_VISIBLE_ID_ORDER);\n                };\n                self.setIdOrder = function(id_order) {\n                  self.id_order = id_order.slice();\n                  self.inverted_id_order = utils.invert_array(self.id_order);\n                  updateVisibleIdOrder();\n                  $(self).trigger(events.SET_ID_ORDER);\n                };\n                // Hide Ids\n                self.hideIds = function(ids, clear_existing) {\n                  if (clear_existing) {\n                    self.hidden_ids = {};\n                  }\n                  _.each(ids, function(id) {\n                    self.hidden_ids[id] = true;\n                  });\n                  updateVisibleIdOrder();\n                };\n                self.showIds = function(ids) {\n                  if (!ids) {\n                    self.hidden_ids = {};\n                  } else {\n                    _.each(ids, function(id) {\n                      delete self.hidden_ids[id];\n                    });\n                  }\n                  updateVisibleIdOrder();\n                };\n\n                // Sorting\n                self.getTopmostTrack = function() {\n                  return (self.track_groups[0].length > 0 ? self.track_groups[0][0] : self.track_groups[1][0]);\n                };\n                self.setTrackSortComparator = function(track_id, cmp) {\n                  self.tracks[track_id].config.sort_cmp = cmp;\n                };\n                self.getTrackSortComparator = function(track_id) {\n                  return self.tracks[track_id].config.sort_cmp;\n                };\n                self.getTrackSortDirection = function(track_id) {\n                  return self.sort_direction[track_id];\n                };\n                self.setTrackSortDirection = function(track_id, dir) {\n                  self.sort_direction[track_id] = dir;\n                  self.sort();\n                };\n                self.setTrackGroupSortOrder = function(order) {\n                  self.track_group_sort_order = order.slice();\n                };\n                self.getTrackGroupSortOrder = function() {\n                  return self.track_group_sort_order.slice();\n                };\n                self.getTrackSortOrder = function() {\n                  var ret = [];\n                  var track_groups = self.getTrackGroups();\n                  _.each(self.getTrackGroupSortOrder(), function(group_id) {\n                    ret = ret.concat(track_groups[group_id]);\n                  });\n                  return ret;\n                };\n                self.setSortConfig = function(config) {\n                  self.sort_config = config;\n                };\n                var sortById = function(desc) {\n                  var ret = _.sortBy(self.getIdOrder(), _.identity);\n                  if (desc) {\n                    ret.reverse();\n                  }\n                  self.setIdOrder(ret);\n                };\n                var sortByTrack = function() {\n                  var track_id_list = self.getTrackSortOrder();\n                  var cmp_list = _.map(track_id_list, function(track_id) { \n                    return self.getTrackSortComparator(track_id);\n                  });\n                  var data = {};\n                  var id_order = self.getIdOrder();\n                  _.each(id_order, function(id) {\n                    data[id] = {};\n                    _.each(track_id_list, function(track_id) {\n                      data[id][track_id] = self.getTrackDatum(track_id, id);\n                    });\n                  });\n                  var lexicographically_ordered_cmp = function(id1,id2) {\n                    var cmp_result = 0;\n                    for (var i=0, _len = track_id_list.length; i<_len; i++) {\n                      var track_id = track_id_list[i];\n                      var cmp = cmp_list[i];\n                      var d1 = data[id1][track_id];\n                      var d2 = data[id2][track_id];\n                      var d1_undef = (typeof d1 === \"undefined\");\n                      var d2_undef = (typeof d2 === \"undefined\");\n                      if (!d1_undef && !d2_undef) {\n                        cmp_result = cmp(d1, d2);\n                      } else if (d1_undef && d2_undef) {\n                        cmp_result = 0;\n                      } else if (d1_undef) {\n                        cmp_result = 1;\n                      } else {\n                        cmp_result = -1;\n                      }\n                      if (isFinite(cmp_result)) {\n                        // reverse direction unless infinite, which is a signal that an NA is involved\n                        cmp_result *= self.sort_direction[track_id];\n                      }\n                      if (cmp_result !== 0) {\n                        break;\n                      }\n                    }\n                    return cmp_result;\n                  };\n                  self.setIdOrder(utils.stableSort(self.getIdOrder(), lexicographically_ordered_cmp));\n                };\n                self.sort = function() {\n                  var config = self.sort_config;\n                  if (config.type === 'track') {\n                    sortByTrack();\n                  } else if (config.type === 'id') {\n                    sortById(config.desc);\n                  }\n                };\n\n                // Track Creation/Destruction\n                self.addTrack = function(config, group) {\n                  group = utils.ifndef(group, 1);\n                  var track_id = getTrackId();\n                  self.tracks[track_id] ={id: track_id, \n                        data: [], \n                        config: $.extend({}, defaultTrackConfig, config),\n                        id_data_map: {}};\n                  self.track_groups[group].push(track_id);\n                  self.sort_direction[track_id] = 1;\n\n                  $(self).trigger(events.ADD_TRACK, {track_id: track_id});\n                  return track_id;\n                };\n                self.removeTrack = function(track_id) {\n                  var track = self.tracks[track_id];\n                  delete self.tracks[track_id];\n                  delete self.sort_direction[track_id];\n\n                  var track_group = self.getContainingTrackGroup(track_id, true);\n                  if (!track_group) {\n                    return false;\n                  } else {\n                    var old_position = track_group.indexOf(track_id);\n                    track_group.splice(old_position, 1);\n\n                    $(self).trigger(events.REMOVE_TRACK, {track: track, track_id: track_id});\n                    return true;  \n                  }\n                };\n\n                // Track Ordering\n                self.getTrackGroups = function(reference) {\n                  return (reference === true ? self.track_groups : $.extend(true, [], self.track_groups));      \n                };\n                self.getTracks = function() {\n                  return _.flatten(self.getTrackGroups());\n                };\n                self.getContainingTrackGroup = function(track_id, reference) {\n                  var group = false;\n                  _.find(self.track_groups, function(grp) {\n                    if (grp.indexOf(track_id) > -1) {\n                      group = grp;\n                      return true;\n                    }\n                    return false;\n                  });\n                  return (reference === true ? group : group.slice());\n                };\n                self.moveTrack = function(track_id, new_position) {\n                  var track_group = self.getContainingTrackGroup(track_id, true);\n                  if (!track_group) {\n                    return false;\n                  }\n                  var old_position = track_group.indexOf(track_id);\n                  new_position = utils.clamp(new_position, 0, track_group.length-1);\n                  track_group.splice(old_position, 1);\n                  track_group.splice(new_position, 0, track_id);\n                  var moved_tracks = track_group.slice(Math.min(old_position, new_position), Math.max(old_position, new_position) + 1);\n                  $(self).trigger(events.MOVE_TRACK, {moved_tracks: moved_tracks});\n                };\n\n\n                // Track Label\n                self.getTrackLabel = function(track_id) {\n                  return self.tracks[track_id].config.label;\n                };\n\n                // Track Tooltip\n                self.getTrackTooltip = function(track_id) {\n                  return self.tracks[track_id].config.tooltip;\n                };\n                self.setTrackTooltip = function(track_id, tooltip) {\n                  self.tracks[track_id].config.tooltip = tooltip;\n                };\n\n                // Track Data\n                self.getTrackData = function(track_id) {\n                  return self.tracks[track_id].data;\n                };\n                self.setTrackData = function(track_id, data) {\n                  var id_accessor = self.getTrackDatumIdAccessor(track_id);\n\n                  self.tracks[track_id].data = data;\n\n                  var current_id_order = self.getIdOrder();\n                  var current_inverted_id_order = self.getInvertedIdOrder();\n                  _.each(_.map(data, id_accessor), function(id) {\n                    if (!(id in current_inverted_id_order)) {\n                      current_id_order.push(id);\n                    }\n                  });\n                  self.setIdOrder(current_id_order);\n                  \n                  self.tracks[track_id].id_data_map = {};\n                  var id_data_map = self.tracks[track_id].id_data_map;\n                  _.each(self.tracks[track_id].data, function(datum) {\n                    id_data_map[id_accessor(datum)] = datum;\n                  });\n                  $(self).trigger(events.SET_TRACK_DATA, {track_id: track_id});\n                };\n                self.getTrackDatum = function(track_id, datum_id) {\n                  return self.tracks[track_id].id_data_map[datum_id];\n                };\n                self.getTrackDatumDataKey = function(track_id) {\n                  return self.tracks[track_id].config.datum_data_key;\n                };\n\n                // Track Datum Id\n                self.getTrackDatumIdAccessor = function(track_id) {\n                  var key = self.getTrackDatumIdKey(track_id);\n                  return function(d) {\n                    return d[key];\n                  };\n                };\n                self.getTrackDatumIdKey = function(track_id) {\n                  return self.tracks[track_id].config.datum_id_key;\n                };\n                self.setTrackDatumIdKey = function(track_id, key) {\n                  self.tracks[track_id].config.datum_id_key = key;\n                };\n\n                // Track info\n                self.isTrackRemovable = function(track_id) {\n                  return self.tracks[track_id].config.removable;\n                };\n                self.isTrackSortDirectionChangable = function(track_id) {\n                  return self.tracks[track_id].config.sort_direction_changable;\n                };\n\n                // Clearing\n                self.clearData = function() {\n                  _.each(self.getTracks(), function(track_id) {\n                    self.setTrackData(track_id, []);\n                  });\n                  self.setIdOrder([]);\n                }\n              }\n\n              return { \n                CATEGORICAL_COLOR: RuleSet.CATEGORICAL_COLOR,\n                GRADIENT_COLOR: RuleSet.GRADIENT_COLOR,\n                GENETIC_ALTERATION: RuleSet.GENETIC_ALTERATION,\n                BAR_CHART: RuleSet.BAR_CHART,\n                create: function CreateOncoprint(container_selector_string, config) {\n                  config = $.extend({}, defaultOncoprintConfig, config || {});\n                  config = $.extend(config, hiddenOncoprintConfig);\n                  var oncoprint = new Oncoprint(config);\n                  var renderer = new OncoprintSVGRenderer(container_selector_string, oncoprint, {label_font: 'Arial', legend:config.legend});\n                  var ret = {\n                    onc_dev: oncoprint,\n                    ren_dev: renderer,\n                    addTrack: function(config, group) {\n                      var track_id = oncoprint.addTrack(config, group);\n                      return track_id;\n                    },\n                    removeTrack: function(track_id) {\n                      oncoprint.removeTrack(track_id);\n                    },\n                    moveTrack: function(track_id, position) {\n                      oncoprint.moveTrack(track_id, position);\n                    },\n                    setTrackDatumIdKey: function(track_id, key) {\n                      oncoprint.setTrackDatumIdKey(track_id, key);\n                    },\n                    setTrackData: function(track_id, data) {\n                      oncoprint.setTrackData(track_id, data);\n                    },\n                    setRuleSet: function(track_id, type, params) {\n                      renderer.setRuleSet(track_id, type, params);\n                    },\n                    useSameRuleSet: function(target_track_id, source_track_id) {\n                      renderer.useSameRuleSet(target_track_id, source_track_id);\n                    },\n                    toggleCellPadding: function() {\n                      oncoprint.toggleCellPadding();\n                    },\n                    toSVG: function() {\n                      return renderer.toSVG();\n                    },\n                    setTrackGroupSortOrder: function(order) {\n                      oncoprint.setTrackGroupSortOrder(order);\n                    },\n                    sort: function() {\n                      oncoprint.sort();\n                    },\n                    setSortConfig: function(config) {\n                      oncoprint.setSortConfig(config);\n                    },\n                    setIdOrder: function(id_order) {\n                      oncoprint.setIdOrder(id_order);\n                    },\n                    getTrackSortDirection: function(track_id) {\n                      return oncoprint.getTrackSortDirection(track_id);\n                    },\n                    setTrackSortDirection: function(track_id, dir) {\n                      oncoprint.setTrackSortDirection(track_id, dir);\n                    },\n                    setZoom: function(z) {\n                      return oncoprint.setZoom(z);\n                    },\n                    increaseZoom: function() {\n                      return oncoprint.increaseZoom();\n                    },\n                    decreaseZoom: function() {\n                      return oncoprint.decreaseZoom();\n                    },\n                    suppressRendering: function() {\n                      renderer.suppressRendering();\n                    },\n                    releaseRendering: function() {\n                      renderer.releaseRendering();\n                    },\n                    setLegendVisible: function(track_ids, visible) {\n                      renderer.setLegendVisible(track_ids, visible);\n                    },\n                    getFilteredIdOrder: function(data_filter_fn, track_ids) {\n                      return oncoprint.getFilteredIdOrder(data_filter_fn, track_ids);\n                    },\n                    getVisibleIdOrder: function() {\n                      return oncoprint.getVisibleIdOrder();\n                    },\n                    hideIds: function(ids) {\n                      oncoprint.hideIds(ids);\n                    },\n                    showIds: function(ids) {\n                      oncoprint.showIds(ids);\n                    },\n                    clearData: function() {\n                      oncoprint.clearData();\n                    },\n                    setTrackTooltip: function(track_id, tooltip) {\n                      oncoprint.setTrackTooltip(track_id, tooltip);\n                    }\n                  };\n                  $(oncoprint).on(events.MOVE_TRACK, function() {\n                    $(ret).trigger(events.MOVE_TRACK);\n                  });\n                  $(renderer).on(events.FINISHED_RENDERING, function() {\n                    $(ret).trigger(events.FINISHED_RENDERING);\n                  });\n                  $(oncoprint).on(events.REMOVE_TRACK, function(evt, data) {\n                    $(ret).trigger(events.REMOVE_TRACK, {track_id: data.track_id});\n                  });\n                  $(renderer).on(events.CONTENT_AREA_MOUSEENTER, function(evt, data) {\n                    $(ret).trigger(events.CONTENT_AREA_MOUSEENTER);\n                  });\n                  $(renderer).on(events.CONTENT_AREA_MOUSELEAVE, function(evt, data) {\n                    $(ret).trigger(events.CONTENT_AREA_MOUSELEAVE);\n                  });\n                  return ret;\n                }\n              };\n            })();\n          \n            var OncoprintSVGRenderer = (function() {\n                  var events = oncoprint_events;\n                  var utils = oncoprint_utils;\n\n                  var TOOLBAR_CONTAINER_CLASS = 'oncoprint-toolbar-ctr';\n                  var LABEL_AREA_CONTAINER_CLASS = 'oncoprint-label-area-ctr';\n                  var CELL_AREA_CONTAINER_CLASS = 'oncoprint-cell-area-ctr';\n                  var CELL_AREA_CLASS = 'oncoprint-cell-area';\n                  var COLUMN_HIGHLIGHT_CLASS = 'oncoprint-column-highlight'\n                  \n                  var CELL_HOVER_CLASS = 'oncoprint-cell-hover';\n                  var LEGEND_HEADER_CLASS = 'oncoprint-legend-header';\n                  var LABEL_DRAGGING_CLASS = 'oncoprint-label-dragging';\n                  var LABEL_DRAGGABLE_CLASS = 'oncoprint-label-draggable';\n                  var CELL_QTIP_CLASS = 'oncoprint-cell-qtip';\n\n                  function OncoprintSVGRenderer(container_selector_string, oncoprint, config) {\n                    OncoprintRenderer.call(this, oncoprint, config);\n                    var self = this;\n                    this.track_cell_selections = {};\n                    this.track_cells = {};\n                    this.active_rule_set_rules = {};\n                    this.toolbar_container;\n                    this.label_div;\n                    this.label_drag_div;\n                    this.label_container;\n                    this.cell_container;\n                    this.cell_container_node;\n                    this.cell_div;\n                    this.legend_table;\n                    this.document_fragment;\n                    this.percent_altered_max_width = utils.textWidth('100%', self.getLabelFont());\n                    this.altered_data_percentage = {};\n                    \n                    this.cell_tooltip_html = '';\n\n                    this.container = d3.select(container_selector_string);\n                    this.container.classed('noselect', true).selectAll('*').remove();\n                    this.container.append('br');\n                    (function initLegend() {\n                      if (config.legend) {\n                        self.legend_table = d3.select(container_selector_string).append('table').style('border-collapse', 'collapse');\n                      }\n                    })();\n                    var content_area = d3.select(container_selector_string).append('div').classed('oncoprint-content-area', true);\n                    (function initLabelContainer() {\n                      self.label_container = content_area.append('div').classed(LABEL_AREA_CONTAINER_CLASS, true).style('position', 'relative');\n                      self.label_div = self.label_container.append('div').style('position', 'relative').style('overflow', 'hidden');\n                      self.label_drag_div = self.label_container.append('div').style('position', 'absolute').style('overflow', 'hidden')\n                              .style('top', '0px').style('left','0px')\n                              .style('display','none');\n                    })();\n                    (function initCellContainer() {\n                      self.cell_container = content_area.append('div').classed(CELL_AREA_CONTAINER_CLASS, true);\n                      self.cell_column_highlight = self.cell_container.append('div').classed(COLUMN_HIGHLIGHT_CLASS, true)\n                            .style('height', self.getCellAreaHeight())\n                            .style('visibility', 'hidden');\n\n                      self.cell_container_node = self.cell_container.node();\n                      self.cell_div = self.cell_container.append('div').classed(CELL_AREA_CLASS, true);\n\n                    \n                      self.cell_mouseover_div = self.cell_container.append('div').style('position', 'absolute').style('overflow', 'hidden')\n                              .style('top', '0px').style('left','0px');\n                      self.cell_container_node.addEventListener(\"scroll\", function() {\n                        self.calculateVisibleInterval();\n                        self.clipAndPositionCells();\n                      });\n                      var mouseMove, mouseOut;\n                      (function() {\n                        var prev_track, prev_cell_index, prev_dom, highlighted_col_cells = [];\n                        var column_highlight_timeout;\n                        $(self.cell_div.node()).qtip({\n                          content: 'SHARED QTIP',\n                          position: {target: 'event', my:'bottom middle', at:'top middle', viewport: $(window)},\n                          style: { classes: CELL_QTIP_CLASS, border: 'none'},\n                          show: {event: \"cell-mouseover\"},\n                          hide: {fixed: true, delay: 100, event: \"cell-mouseout\"},\n                          events: {\n                            show: function() {\n                              $(this).find('.qtip-content').html(self.cell_tooltip_html);\n                            },\n                            render: function(){\n                              $(this).find('.qtip-content').html(self.cell_tooltip_html);\n                            }\n                          }\n                        });\n                        var hover_cell = function(dom) {\n                          $('.'+CELL_QTIP_CLASS).finish();\n                          $(dom).trigger(\"cell-mouseover\");\n                        };\n                        var unhover_cell = function(dom) {\n                          $('.'+CELL_QTIP_CLASS).finish();\n                          $(dom).trigger(\"cell-mouseout\");\n                        };\n                        var clear_and_unhover = function() {\n                          prev_track = undefined;\n                          prev_cell_index = undefined;\n                          prev_dom && unhover_cell(prev_dom);\n                          prev_dom = undefined;\n                          //self.cell_column_highlight.style('visibility', 'hidden');\n                          column_highlight_timeout && clearTimeout(column_highlight_timeout)\n                          _.each(highlighted_col_cells, function(cell) {\n                            if (cell) {\n                              cell.style.border = '';\n                              cell.style.margin = '';\n                            }\n                          });\n                          highlighted_col_cells = [];\n                        };\n                        mouseOut = function() {\n                          clear_and_unhover();\n                        };\n                        mouseMove = function(evt) {\n                          var mouseX = utils.mouseX(evt);\n                          var mouseY = utils.mouseY(evt);\n                          var track_cell_tops = self.getTrackCellTops();\n                          var track = (function() {\n                            var closest_track_dist = Number.POSITIVE_INFINITY;\n                            var closest_track = undefined;\n                            _.each(track_cell_tops, function(top, track_id) {\n                              var dist = mouseY - top;\n                              if (dist >= 0 && dist < closest_track_dist) {\n                                closest_track_dist = dist;\n                                closest_track = track_id;\n                              }\n                            });\n                            return closest_track;\n                          })();\n                          if (!track) {\n                            clear_and_unhover();\n                            return;\n                          }\n                          var track_height = oncoprint.getCellHeight(track);\n                          if (mouseY > track_cell_tops[track] + track_height) {\n                            clear_and_unhover();\n                            return;\n                          }\n                          var cell_width = oncoprint.getZoomedCellWidth();\n                          var cell_unit = cell_width + oncoprint.getCellPadding();\n                          if (mouseX % cell_unit > cell_width) {\n                            clear_and_unhover();\n                            return;\n                          }\n                          // at this point, we are hovered over a cell position\n                          var cell_index = Math.floor(mouseX / cell_unit);\n                          if (cell_index !== prev_cell_index || track !== prev_track) {\n                            //self.cell_column_highlight.style('visibility', 'hidden');\n                            column_highlight_timeout && clearTimeout(column_highlight_timeout)\n                            // not the same cell as before\n                            clear_and_unhover();\n                            var cell_id = oncoprint.getVisibleIdOrder()[cell_index];\n                            var track_cell = self.track_cells[track][cell_id];\n                            if (!track_cell) {\n                              // track doesn't have a cell there\n                              return;\n                            }\n                            // otherwise, we're over a cell\n                            $('.'+CELL_QTIP_CLASS).finish().hide();\n                            prev_cell_index = cell_index;\n                            prev_track = track;\n                            prev_dom = track_cell.dom;\n                            self.cell_tooltip_html = oncoprint.getTrackTooltip(track)(track_cell.d);\n                            hover_cell(prev_dom);\n                            column_highlight_timeout = setTimeout(function() {\n                              highlighted_col_cells = _.map(self.track_cells, function(cells, track_id) {\n                                var cell = cells[cell_id].dom;\n                                if (cell) {\n                                  if (track_id === track) {\n                                    cell.style.border = \"1px solid #000000\";\n                                    cell.style.margin = \"-1px\";\n                                  } else {\n                                    cell.style.border = \"1px solid #999999\";\n                                    cell.style.margin = \"-1px\";\n                                  }\n                                }\n                                return cell;\n                              });\n                            }, 200);\n                          }\n                        };\n                      })();\n                      self.cell_mouseover_div.node().addEventListener('mousemove', mouseMove);\n                      self.cell_mouseover_div.node().addEventListener('mouseout', mouseOut);\n                      // TODO: magic number\n                      self.cell_div.style('max-width', '1000px');\n                    })();\n                    $(content_area.node()).hover(function() {\n                      $(self.label_div.node()).find('.'+self.getTrackButtonCSSClass()).stop().fadeTo(80,1);\n                    }, function() {\n                      $(self.label_div.node()).find('.'+self.getTrackButtonCSSClass()).stop().fadeOut(500);\n                    });\n                    \n                    (function reactToOncoprint() {\n                      $(oncoprint).on(events.REMOVE_TRACK, function(evt, data) {\n                        var track_id = data.track_id;\n                        delete self.rule_sets[track_id];\n                        delete self.track_cell_selections[track_id];\n                        delete self.altered_data_percentage[track_id];\n                        self.removeTrackCells(track_id);\n                        self.removeTrackLabels(track_id);\n                        self.removeTrackButtons(track_id);\n                        \n                        self.computeTrackCellTops();\n                        self.renderLegend();\n                        self.renderTrackLabels();\n                        self.renderTrackButtons();\n                        self.resizeLabelDiv();\n                        self.resizeCellDiv();\n                        oncoprint.sort();\n                      });\n                      $(oncoprint).on(events.MOVE_TRACK, function(evt, data) {\n                        self.computeTrackCellTops();\n                        self.clipAndPositionCells(data.moved_tracks, 'top', true);\n                        self.renderTrackLabels();\n                        self.renderTrackButtons();\n                        oncoprint.sort();\n                      });\n\n                      $(oncoprint).on(events.ADD_TRACK, function(e,d) {\n                        //this.cell_div.style('display', 'none');\n                        self.drawCells(d.track_id);\n                        self.clipAndPositionCells(undefined, 'top', true);\n                        self.computeTrackCellTops();\n                        self.renderTrackLabels();\n                        self.renderTrackButtons();\n                        self.resizeLabelDiv();\n                        //self.clipCells(true, d.track_id);\n                        //this.cell_div.style('display','inherit');\n                      });\n\n                      $(oncoprint).on(events.SET_TRACK_DATA, function(e,d) {\n                        //this.cell_div.style('display', 'none');\n                        self.drawCells(d.track_id);\n                        self.clipAndPositionCells(d.track_id, undefined, true);\n                        self.computeAlteredDataPercentage(d.track_id);\n                        self.renderTrackLabels(d.track_id);\n                        self.resizeCellDiv();\n                        self.renderLegend();\n                        //self.clipCells(true);\n                        //this.cell_div.style('display','inherit');\n                      });\n\n\n                      $(oncoprint).on(events.SET_CELL_PADDING, function(e,d) {\n                        self.clipAndPositionCells(undefined, undefined, true);\n                        self.resizeCellDiv();\n                      });\n\n                      $(oncoprint).on(events.SET_ZOOM, function(e,d) {\n                        self.clipAndPositionCells(undefined, undefined, true);\n                        self.resizeCells();\n                        self.resizeCellDiv();\n                        //self.cell_highlight.style('width', oncoprint.getZoomedCellWidth() + 'px');\n                      });\n\n                      $(oncoprint).on(events.SET_VISIBLE_ID_ORDER, function() {\n                        self.clipAndPositionCells(undefined, undefined, true);\n                        self.resizeCellDiv();\n                      });\n                    })();\n                  }\n                  utils.extends(OncoprintSVGRenderer, OncoprintRenderer);\n                  OncoprintSVGRenderer.prototype.computeAlteredDataPercentage = function(track_id) {\n                    var rule_set = this.getRuleSet(track_id);\n                    if (rule_set && rule_set.alteredData) {\n                      var data = this.oncoprint.getTrackData(track_id);\n                      var num_altered = rule_set.alteredData(data).length;\n                      var percent_altered = Math.floor(100 * num_altered / data.length);\n                      this.altered_data_percentage[track_id] = percent_altered;\n                    }\n                  };\n                  OncoprintSVGRenderer.prototype.getAlteredDataPercentage = function(track_id) {\n                    return this.altered_data_percentage[track_id];\n                  };\n                  OncoprintSVGRenderer.prototype.calculateVisibleInterval = function() {\n                    var cell_unit = this.oncoprint.getZoomedCellWidth() + this.oncoprint.getCellPadding();\n                    var cell_ctr_rect = this.cell_container_node.getBoundingClientRect();\n                    this.visible_interval = [this.cell_container_node.scrollLeft, this.cell_container_node.scrollLeft + cell_ctr_rect.right - cell_ctr_rect.left];\n                    return this.visible_interval;\n                  };\n                  OncoprintSVGRenderer.prototype.getVisibleInterval = function() {\n                    return (this.visible_interval || this.calculateVisibleInterval());\n                  };\n                  OncoprintSVGRenderer.prototype.cellRenderTarget = function() {\n                    return d3.select(this.document_fragment || this.cell_div.node());\n                  };\n                  OncoprintSVGRenderer.prototype.suppressRendering = function() {\n                    this.document_fragment = document.createDocumentFragment();\n                  };\n                  OncoprintSVGRenderer.prototype.releaseRendering = function() {\n                    this.cell_div.node().appendChild(this.document_fragment);\n                    this.document_fragment = undefined;\n                    var self = this;\n                    $(this.cell_div.node()).ready(function() {\n                      self.resizeCells();\n                      self.clipAndPositionCells(undefined, undefined, true);\n                    });\n                  };\n                  // Rule sets\n                  OncoprintSVGRenderer.prototype.setRuleSet = function(track_id, type, params) {\n                    OncoprintRenderer.prototype.setRuleSet.call(this, track_id, type, params);\n                    this.active_rule_set_rules[this.getRuleSet(track_id).getRuleSetId()] = {};\n                    this.drawCells(track_id);\n                    this.clipAndPositionCells(track_id, undefined, true);\n                    this.renderLegend();\n                    this.computeAlteredDataPercentage(track_id);\n                    this.renderTrackLabels(track_id);\n                  };\n                  OncoprintSVGRenderer.prototype.useSameRuleSet = function(target_track_id, source_track_id) {\n                    OncoprintRenderer.prototype.useSameRuleSet.call(this, target_track_id, source_track_id);\n                    this.drawCells(target_track_id);\n                    this.clipAndPositionCells(target_track_id, undefined, true);\n                    this.renderLegend();\n                    this.computeAlteredDataPercentage(target_track_id);\n                    this.renderTrackLabels(target_track_id);\n                  }\n\n                  // Containers\n                  OncoprintSVGRenderer.prototype.getLabelDiv = function() {\n                    return this.label_div;\n                  };\n                  OncoprintSVGRenderer.prototype.getLabelDragDiv = function() {\n                    return this.label_drag_div;\n                  };\n                  OncoprintSVGRenderer.prototype.resizeCellDiv = function() {\n                    this.cell_div.style('min-width', this.getCellAreaWidth()+'px')\n                        .style('min-height', this.getCellAreaHeight()+'px');\n                    \n                    this.cell_mouseover_div.style('min-width', this.getCellAreaWidth()+'px')\n                        .style('min-height', this.getCellAreaHeight()+'px');\n                    this.cell_column_highlight.style('height', this.getCellAreaHeight() + 'px');\n                  };\n                  OncoprintSVGRenderer.prototype.resizeLabelDiv = function() {\n                    this.getLabelDiv().style('width', this.getLabelAreaWidth()+'px')\n                        .style('height', this.getLabelAreaHeight()+'px');\n                    this.getLabelDragDiv().style('width', this.getLabelAreaWidth()+'px')\n                        .style('height', this.getLabelAreaHeight()+'px');\n                  };\n\n                  // Labels\n                  OncoprintSVGRenderer.prototype.removeTrackLabels =function(track_ids) {\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids); \n                    var div = this.label_div;\n                    var self = this;\n                    _.each(track_ids, function(track_id) {\n                      div.selectAll(self.getTrackLabelCSSSelector(track_id)).remove();\n                    });\n                  }\n                  OncoprintSVGRenderer.prototype.renderTrackLabels = function(track_ids, y, render_whole_labels) {\n                    var div = this.label_div;\n                    if (typeof y !== \"undefined\") {\n                      div.selectAll(this.getTrackLabelCSSSelector(track_ids)).style('top', y+'px');\n                    } else {\n                      track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                      track_ids = [].concat(track_ids);\n                      var label_tops = this.getTrackLabelTops();\n                      var self = this;\n                      var label_area_width = this.getLabelAreaWidth();\n                      var percent_altered_left = label_area_width - this.percent_altered_max_width;\n                      _.each(track_ids, function(track_id) {\n                        var label_top = label_tops[track_id];\n                        var track_label_class = self.getTrackLabelCSSClass(track_id);\n                        var label_text = self.oncoprint.getTrackLabel(track_id);\n                        var disp_label_text = label_text;\n                        if (label_text.length > self.max_label_length && !render_whole_labels) {\n                          disp_label_text = label_text.substring(0,self.max_label_length-3)+'...';\n                        }\n                        _.each(div.selectAll(self.getTrackLabelCSSSelector(track_id)), function(node) {\n                          $(node).qtip('destroy');\n                        });\n                        div.selectAll(self.getTrackLabelCSSSelector(track_id)).remove();\n                        var span = div.append('span')\n                          .style('position','absolute')\n                          .classed(self.getTrackLabelCSSClass(track_id), true)\n                          .classed('oncoprint-track-label-draggable', true)\n                          .classed('oncoprint-track-label-main', true)\n                          .classed('oncoprint-track-label', true)\n                          .classed('noselect', true)\n                          .style('font-family', self.getLabelFont())\n                          .style('font-weight', 'bold')\n                          .text(disp_label_text)\n                          .style('top', label_top+'px')\n                          .on(\"mousedown\", function() {\n                            self.dragLabel(track_id);\n                          });\n                          $(span.node()).qtip( {content: {text: (label_text.length > self.max_label_length ? label_text+'<br> hold to drag' : 'hold to drag') },\n                                  position: {my:'middle right', at:'middle left', viewport: $(window)},\n                                  style: { classes: 'qtip-light qtip-rounded qtip-shadow qtip-lightyellow'},\n                                  show: {event: \"mouseover\"}\n                                });\n                        var percent_altered = self.getAlteredDataPercentage(track_id);\n                        if (typeof percent_altered !== 'undefined') {\n                          div.append('span')\n                            .style('position','absolute')\n                            .classed(self.getTrackLabelCSSClass(track_id), true)\n                            .classed('oncoprint-track-label', true)\n                            .classed('noselect', true)\n                            .style('font-family', self.getLabelFont())\n                            .text(percent_altered + '%')\n                            .style('top', label_top+'px')\n                            .style('left', percent_altered_left+'px');  \n                        }\n                      });\n                    }\n                  };\n\n                  // Buttons\n                  OncoprintSVGRenderer.prototype.getTrackButtonCSSClass = function(track_id) {\n                    return 'oncoprint-track-button'+utils.ifndef(track_id, \"\");\n                  };\n                  OncoprintSVGRenderer.prototype.removeTrackButtons = function(track_ids) {\n                    var div = this.label_div;\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var self = this;\n                    _.each(track_ids, function(track_id) {\n                      div.selectAll('.'+self.getTrackButtonCSSClass(track_id)).remove();\n                    });\n                  };\n                  OncoprintSVGRenderer.prototype.renderTrackButtons = function(track_ids) {\n                    var div = this.label_div;\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var label_tops = this.getTrackLabelTops();\n                    var self = this;\n                    var label_area_width = this.getLabelAreaWidth();\n                    _.each(track_ids, function(track_id) {\n                      var button_class = self.getTrackButtonCSSClass(track_id);\n                      div.selectAll('.'+button_class).remove();\n                      var left = label_area_width - 15;\n                      if (self.oncoprint.isTrackRemovable(track_id)) {\n                        (function() {\n                          var new_btn = div.append('span').classed('noselect', true).style('font-size','12px').style('color', '#87CEFA').style('cursor', 'pointer')\n                          .classed(button_class, true).classed(self.getTrackButtonCSSClass(), true).on('click', function() {\n                            self.oncoprint.removeTrack(track_id);\n                          })\n                          .style('position', 'absolute').style('left', left+'px').style('top', label_tops[track_id]+'px');\n                          new_btn.text('X');\n                          $(new_btn.node()).hover(function() {\n                            new_btn.style('font-size', '15px').style('color', '#0000FF');\n                          }, function() {\n                            new_btn.style('font-size','12px').style('color', '#87CEFA');\n                          }).qtip({\n                                            content: {text: 'Click to remove'},\n                                            position: {my:'bottom middle', at:'top middle', viewport: $(window)},\n                                            style: { classes: 'qtip-light qtip-rounded qtip-shadow qtip-lightyellow' },\n                                            show: {event: \"mouseover\"},\n                                            hide: {fixed: true, delay: 100, event: \"mouseout\"}\n                                            });\n                        })();\n                        left -= 35;\n                      }\n                      if (self.oncoprint.isTrackSortDirectionChangable(track_id)) {\n                        (function() {\n                          var imgs = ['images/decreaseSort.svg', 'images/increaseSort.svg', 'images/nonSort.svg'];\n                          var descs = ['Click to sort in descending order', 'Click to not sort on this track', 'Click to sort in ascending order'];\n                          var sort_direction = [1, -1, 0];\n                          var current_sort_setting = sort_direction.indexOf(self.oncoprint.getTrackSortDirection(track_id));\n                          var new_btn = div.append('img');\n                          new_btn.attr('src', imgs[current_sort_setting]).style('cursor','pointer');\n                          $(new_btn.node()).qtip({\n                                            content: {text: function() {\n                                              return descs[current_sort_setting];\n                                            }},\n                                            position: {my:'bottom middle', at:'top middle', viewport: $(window)},\n                                            style: { classes: 'qtip-light qtip-rounded qtip-shadow qtip-lightyellow' },\n                                            show: {event: \"mouseover\"},\n                                            hide: {fixed: true, delay: 100, event: \"mouseout\"}\n                                            });\n                          new_btn.classed(button_class, true).classed(self.getTrackButtonCSSClass(), true).on('click', function() {\n                            current_sort_setting = (current_sort_setting + 1) % 3;\n                            self.oncoprint.setTrackSortDirection(track_id, sort_direction[current_sort_setting]);//toggleTrackSortDirection(track_id);\n                            new_btn.attr('src', imgs[current_sort_setting]);\n                          })\n                          .style('position', 'absolute').style('left', left+'px').style('top', label_tops[track_id]+'px');\n                        })();\n                      }\n                    });\n                  };\n\n                  // Cells\n                  OncoprintSVGRenderer.prototype.resizeCells = function(new_width) {\n                    this.cell_div.selectAll('svg.'+this.getCellCSSClass()).style('width', this.oncoprint.getZoomedCellWidth()+'px');\n                  };\n                  OncoprintSVGRenderer.prototype.removeTrackCells = function(track_id) {\n                    this.cell_div.selectAll('svg.'+this.getTrackCellCSSClass(track_id)).remove();\n                  };\n                  OncoprintSVGRenderer.prototype.drawTrackCells = function(track_id, fragment) {\n                    var oncoprint = this.oncoprint;\n                    var data = oncoprint.getTrackData(track_id);\n                    var id_key = oncoprint.getTrackDatumIdKey(track_id);\n                    var id_accessor = oncoprint.getTrackDatumIdAccessor(track_id);\n                    var rule_set = this.getRuleSet(track_id);\n                    if (!rule_set) {\n                      return;\n                    }\n                    var self = this;\n\n                    this.track_cells[track_id] = {};\n                    var cell_class = this.getCellCSSClass();\n                    var track_cell_class = this.getTrackCellCSSClass(track_id);\n                    var track_cells = this.track_cells[track_id];\n\n                    var bound_svg = d3.select(fragment).selectAll('svg.'+track_cell_class).data(data);\n                    bound_svg.enter().append('svg').classed(track_cell_class, true).classed(cell_class, true)\n                      .attr('shape-rendering','geometricPrecision')\n                      .attr('preserveAspectRatio','none')\n                      .attr('viewBox', '0 0 '+oncoprint.getFullCellWidth()+' '+oncoprint.getCellHeight(track_id))\n                      .style('width', oncoprint.getZoomedCellWidth()+'px').style('height', oncoprint.getCellHeight(track_id)+'px');\n                    bound_svg.exit().remove();\n\n                    var tooltip = oncoprint.getTrackTooltip(track_id);\n                    bound_svg.each(function(d,i) {\n                      var dom_cell = this;\n                      var id = id_accessor(d);\n                      track_cells[id] = {dom: this, d: d};\n                    });\n                    bound_svg.selectAll('*').remove();\n                    this.active_rule_set_rules[rule_set.getRuleSetId()][track_id] = rule_set.apply(bound_svg, oncoprint.getFullCellWidth(), oncoprint.getCellHeight(track_id));\n                    self.track_cell_selections[track_id] = bound_svg;\n                  };\n                  OncoprintSVGRenderer.prototype.drawCells = function(track_ids) {\n                    var fragment;\n                    if (this.document_fragment) {\n                      //HACK\n                      fragment = document.createDocumentFragment();\n                    } else {\n                      fragment = this.cell_div.node();\n                    }\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var self = this;\n                    _.each(track_ids, function(track_id) {\n                      self.drawTrackCells(track_id, fragment);\n                    });\n                    if (this.document_fragment) {\n                      this.cellRenderTarget().node().appendChild(fragment);\n                    }\n                    setTimeout(function() {\n                      $(self).trigger(events.FINISHED_RENDERING);\n                    }, 0);\n                  };\n\n                  // Positioning\n                  OncoprintSVGRenderer.prototype.clipAndPositionCells = function(track_ids, axis, force, display_all) {\n                    this.cell_div.node().display = 'none';\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : track_ids;\n                    track_ids = [].concat(track_ids);\n                    var visible_interval = this.getVisibleInterval();\n                    var interval_width = 4*(visible_interval[1] - visible_interval[0]);\n                    var interval_number = Math.floor(visible_interval[0] / interval_width);\n                    visible_interval = _.map([-interval_width, 2*interval_width], function(x) { \n                      return Math.max(x + interval_number*interval_width, 0); \n                    });\n                    var self = this;\n                    var track_cell_tops = this.getTrackCellTops();\n                    var id_order = this.oncoprint.getVisibleInvertedIdOrder();\n                    var cell_x = this.getCellXArray(Object.keys(id_order).length);\n                    _.each(track_ids, function(track_id) {\n                      var y;\n                      if (!axis || axis === 'top') {\n                        y = track_cell_tops[track_id];\n                      }\n                      var id_key = self.oncoprint.getTrackDatumIdKey(track_id);\n                      if ((interval_number !== self.prev_interval_number) || force) {\n                        if (self.track_cell_selections.hasOwnProperty(track_id)) {\n                          self.track_cell_selections[track_id].each(function(d,i) {\n                            var new_x = cell_x[id_order[d[id_key]]];\n                            var disp = this.style.display;\n                            var new_disp = ((isNaN(new_x) || new_x < visible_interval[0] || new_x > visible_interval[1]) && !display_all) ? 'none' : 'inherit';\n                            if (disp !== new_disp) {\n                              this.style.display = new_disp;\n                            }\n                            if ((!axis || axis === 'left') && new_disp !== 'none') {\n                              this.style.left = new_x + 'px';\n                            }\n                            if ((!axis || axis === 'top') && new_disp !== 'none') {\n                              this.style.top = y+'px';\n                            }\n                          });\n                        }\n                      }\n                    });\n                    this.prev_interval_number = interval_number;\n                    this.cell_div.node().display = 'block';\n                  };\n\n                  OncoprintSVGRenderer.prototype.setLegendVisible = function(track_ids, visible) {\n                    var self = this;\n                    track_ids = typeof track_ids === \"undefined\" ? this.oncoprint.getTracks() : [].concat(track_ids);\n                    _.each(track_ids, function(id) {\n                      self.getRuleSet(id).exclude_from_legend = !visible;\n                    });\n                    this.renderLegend();\n                  };\n                  OncoprintSVGRenderer.prototype.renderLegend = function(include_all) {\n                    var cell_width = this.oncoprint.getFullCellWidth();\n                    var self = this;\n                    var rendered = {};\n                    self.legend_table.selectAll('*').remove();\n                    _.each(this.rule_sets, function(rule_set, track_id) {\n                      if (rule_set.exclude_from_legend && !include_all) {\n                        return;\n                      }\n                      var rule_set_id = rule_set.getRuleSetId();\n                      var active_rules = {};\n                      _.each(self.active_rule_set_rules[rule_set_id], function(track_map, track_id) {\n                        $.extend(active_rules, track_map);\n                      });\n                      if (!rendered.hasOwnProperty(rule_set_id)) {\n                        var tr = self.legend_table.append('tr');\n                        var label_header = tr.append('td').style('padding-top', '1em').style('padding-bottom', '1em')\n                              .append('span').classed('oncoprint-legend-header', true);\n                        label_header.text(rule_set.getLegendLabel());\n                        var legend_body_td = tr.append('td');\n                        var legend_div = rule_set.getLegendDiv(active_rules, cell_width, self.oncoprint.getCellHeight(track_id));\n                        legend_body_td.node().appendChild(legend_div);\n                        utils.d3SelectChildren(d3.select(legend_div), '*').classed('oncoprint-legend-block-span', true);\n                        rendered[rule_set_id] = true;\n                      }\n                    });\n                  };\n                  OncoprintSVGRenderer.prototype.dragLabel = function(track_id) {\n                    this.getLabelDragDiv().style('display','block');\n                    var track_group = this.oncoprint.getContainingTrackGroup(track_id);\n                    var first_track = track_group[0], last_track=track_group[track_group.length-1];\n                    var all_track_tops = this.getTrackLabelTops();\n                    var track_tops = {};\n                    _.each(track_group, function(id) { \n                      track_tops[id] = all_track_tops[id];\n                    });\n                    track_group.splice(track_group.indexOf(track_id), 1);\n                    var group_track_tops = _.map(track_group, function(id) {\n                      return track_tops[id];\n                    });\n                    var label_area_height = this.getLabelAreaHeight();\n                    var drag_bounds = [undefined, undefined];\n                    drag_bounds[0] = utils.clamp(track_tops[first_track], 0, label_area_height);\n                    drag_bounds[1] = utils.clamp(track_tops[last_track]+this.getRenderedTrackHeight(last_track), 0, label_area_height);\n\n                    var self = this;\n                    var $label_drag_div = $(self.getLabelDragDiv().node());\n                    delete track_tops[track_id];\n\n                    (function(track_id) {\n                      var new_pos = -1;\n                      var moveHandler = function(evt) {\n                        if (evt.stopPropagation) {\n                          evt.stopPropagation();\n                        }\n                        if (evt.preventDefault) {\n                          evt.preventDefault();\n                        }\n                        var mouse_y = utils.clamp(utils.mouseY(evt), drag_bounds[0], drag_bounds[1]);\n                        self.renderTrackLabels(track_id, mouse_y);\n                        d3.selectAll(self.getTrackLabelCSSSelector(track_id)).classed(LABEL_DRAGGING_CLASS, true);\n                        \n                        new_pos = _.sortedIndex(group_track_tops, mouse_y);\n                        _.each(track_tops, function(top, id) {\n                          top += 3*(+(new_pos < track_group.length && track_group[new_pos] == id));\n                          top -= 3*(+(new_pos > 0 && track_group[new_pos-1] == id));\n                          self.renderTrackLabels(id, top);\n                        });\n                      }\n                      $label_drag_div.on(\"mousemove\", moveHandler);\n                      var mouseUpHandler = function(evt) {\n                        $label_drag_div.hide();\n                        $label_drag_div.off(\"mousemove\", moveHandler);\n                        if (new_pos > -1) {\n                          self.oncoprint.moveTrack(track_id, new_pos);\n                        }\n                      };\n                      $(document).one(\"mouseup\", mouseUpHandler);\n                    })(track_id);\n                  };\n                  OncoprintSVGRenderer.prototype.toSVG = function(full_labels) {\n                    var self = this;\n                    var root = $(this.container.node()).offset();\n                    var svg = d3.select(document.createElementNS('http://www.w3.org/2000/svg', 'svg'));\n                    svg.attr('width', this.getLabelAreaWidth() + this.getCellAreaWidth() + 'px');\n                    this.renderLegend(true);\n                    this.renderTrackLabels(undefined, undefined, full_labels);\n                    svg.attr('height', $(this.container.node()).height()+'px');\n                    (function addLabels() {\n                      self.label_div.selectAll('.oncoprint-track-label').each(function() {\n                        var text_elt = d3.select(this);\n                        var font = text_elt.style('font-family') || 'Arial';\n                        var weight = text_elt.style('font-weight'); \n                        var size = text_elt.style('font-size') || '12px';\n                        var pos = $(text_elt.node()).offset();\n                        var text = text_elt.text();\n                        svg.append('text').style('font-family', font).style('font-weight', weight).style('font-size', size)\n                            .attr('transform', utils.translate(pos.left - root.left,pos.top - root.top))\n                            .style('alignment-baseline', 'hanging')\n                            .text(text);  \n                      });\n                    })();\n                    (function addCells() {\n                      self.clipAndPositionCells(undefined, undefined, true, true);\n                      self.cell_div.selectAll('.oncoprint-cell').each(function() {\n                        var cell_elt = d3.select(this);\n                        var cell_rect = cell_elt.node().getBoundingClientRect();\n                        var cell_dim = {width: cell_rect.width, height: cell_rect.height};\n                        var pos = $(cell_elt.node()).offset();\n                        var g = svg.append('g').attr('transform', utils.translate(pos.left - root.left, pos.top - root.top));\n                        cell_elt.selectAll('*').each(function() {\n                          utils.appendD3SVGElement(d3.select(this), g);\n                        });\n                        var outline_styles = {color: cell_elt.style('outline-color'), width: cell_elt.style('outline-width')};\n                        if (outline_styles.color) {\n                          g.append('rect').attr('width', cell_dim.width+'px').attr('height', cell_dim.height+'px')\n                              .style('fill', 'none').style('stroke', outline_styles.color).style('stroke-width', outline_styles.width);\n                        }\n                      });\n                      //styles = {'outline-color':rule_spec.color, 'outline-style':'solid', 'outline-width':'2px'};\n                      self.clipAndPositionCells(undefined, undefined, true);\n                    })();\n                    (function addLegend() {\n                      self.legend_table.selectAll('tr').each(function() {\n                        d3.select(this).selectAll('td').each(function() {\n                          d3.select(this).selectAll('.oncoprint-legend-header,.oncoprint-legend-element').each(function() {\n                            if ($(this).text().trim().length) {\n                              // text type element\n                              var text_elt = d3.select(this);\n                              var font = text_elt.style('font-family') || 'Arial';\n                              if (font !== 'Arial') {\n                                //console.log(this);\n                              }\n                              var weight = text_elt.style('font-weight'); \n                              var size = text_elt.style('font-size') || '12px';\n                              var text = text_elt.text();\n                              var pos = $(text_elt.node()).offset();\n                              svg.append('text').style('font-family', font).style('font-weight', weight)\n                                .style('font-size', size)\n                                .attr('transform', utils.translate(pos.left - root.left, pos.top - root.top))\n                                .style('alignment-baseline', 'hanging')\n                                .text(text);\n                            } else if (this.tagName.toLowerCase() === 'svg') {\n                              var elt = d3.select(this);\n                              var pos = $(elt.node()).offset();\n                              var g = svg.append('g').attr('transform', utils.translate(pos.left - root.left, pos.top - root.top));\n                              var cell_rect = elt.node().getBoundingClientRect();\n                              var cell_dim = {width: cell_rect.width, height: cell_rect.height};\n                              var outline_styles = {color: elt.style('outline-color'), width: elt.style('outline-width')};\n                              if (outline_styles.color) {\n                                g.append('rect').attr('width', cell_dim.width+'px').attr('height', cell_dim.height+'px')\n                                    .style('fill', 'none').style('stroke', outline_styles.color).style('stroke-width', outline_styles.width);\n                              }\n                              elt.selectAll('*').each(function() {\n                                utils.appendD3SVGElement(d3.select(this), g);\n                              });\n                            }\n                          });\n                        });\n                      });\n                    })();\n                    this.renderLegend();\n                    this.renderTrackLabels();\n                    return svg.node();\n                  };\n                  return OncoprintSVGRenderer;\n            })();\n            \n            function displayOncoprint(msg)\n            {\n               $(\"#onc\").empty();\n               $(\"#oncoprintErrorSection\").empty();\n               $(\".oncoprint-label-col1\").empty();\n              \n               if(msg.status == \"error\") {\n                  vm.errorMessage = JSON.parse(msg.payload);\n                  console.log(\"***** errors in dispalyOncoprint\", vm.errorMessage);\n                  setState(\"errors\"); \n                }else{\n                     var genes = msg.payload[1];\n                     var processed_data = msg.payload[0];\n                     var onc = Oncoprint.create('#onc');\n                     onc.suppressRendering();\n                     $.when(processed_data).then(function(){\n                          if(typeof(genes) === \"string\"){\n                            genes = [genes];\n                           }  \n                          var tracks_to_load = genes.length;\n\n                          var track_id = [];\n                          for(var i = 0; i < genes.length; i++){\n                            var gene = genes[i];\n                            function data_gene_map(obj) {\n                                return obj.gene === gene;\n                            }\n                            var data_gene = processed_data.filter(data_gene_map); \n\n                            var addTrackStart = Date.now();\n                            track_id[i] = onc.addTrack({label: gene, removable:true}, 0);\n                            if(i === 0){\n                              onc.setRuleSet(track_id[i], Oncoprint.GENETIC_ALTERATION);\n                            }else{\n                              onc.useSameRuleSet(track_id[i], track_id[0]);\n                            }\n                            onc.setTrackData(track_id[i], data_gene, true);\n                          }            \n                        onc.releaseRendering();\n                        onc.sort();\n                        $('#toggle_whitespace').click(function() {\n                           onc.toggleCellPadding();\n                        });\n                        var z = 1;\n                        $('#reduce_cell_width').click(function() {\n                            z *= 0.5;\n                            onc.setZoom(z);\n                        });  \n                    //move legend to oncoscape label section\n                    var allOncoLegendBlocks = $(\".oncoprint-legend-block\");\n                    var allOncoLegendLabels = $(\".oncoprint-legend-label\");\n                    for(var j = 0; j < allOncoLegendBlocks.length; j++){\n                      allOncoLegendBlocks[j].appendChild(allOncoLegendLabels[j]);\n                    }\n                    $(\".oncoprint-label-col1\").append(allOncoLegendBlocks); \n                    $(\"#oncoprintInstructions\").hide();\n                  });  \n                }           \n            } // displayOncoprint\n           \n\n            // Initialize\n            osApi.setBusy(true)(\"Loading Dataset\");\n            osApi.setDataset(vm.datasource).then(function(response) {\n                var mtx = response.payload.rownames.filter(function(v) {\n                    return v.indexOf(\"mtx\") >= 0\n                });\n        \n                // Patient Data\n                var rawPatientData = response.payload.tbl;\n                var mtx = mtx[mtx.length - 1].replace(\".RData\", \"\");\n   \n  \n                $scope.$watchGroup(['vm.optCohortPatient', 'vm.optCohortGene'], function() {\n                    var msg =  vm.optCohortPatient.ids.toString() + \", \" + vm.optCohortGene.ids.toString();\n                    drawOncoprint(msg);\n                });  \n                 osApi.setBusy(false);\n            });\n\n\n            var _state = \"\";\n            var setState = function(value){\n              if (_state==value) return;\n              switch(value){\n                case \"instructions\":\n                  elControl.hide();\n                  elInstructions.show();\n                  elLegend.hide();\n                  break;\n                case \"control\":\n                  elControl.show();\n                  elInstructions.hide();\n                  elLegend.show();\n                  break;\n                case \"errors\":\n                  elControl.hide();\n                  elInstructions.show();\n                  elLegend.hide();\n                  break;\n              }\n              \n            }\n            \n            // API Call To oncoprint_data_selection\n            var drawOncoprint = function(msg) {\n\n                if ( (vm.optCohortPatient.ids == \"*\") || (vm.optCohortGene.ids == \"*\") ){\n                  setState(\"instructions\");\n                  return;\n                } \n              \n                var geneAndPatients = msg;\n                geneAndPatients = geneAndPatients.split(',');\n\n                if(geneAndPatients.length > 350){\n                  vm.errorMessage = \"ERROR: The total number of Patients and Genes are set to be less than 350.\";\n                  setState(\"errors\");\n                }else{\n                  osApi.setBusy(true);\n                  osApi.getOncoprint(geneAndPatients);\n                  osApi.getOncoprint(geneAndPatients).then(function(response) {\n                      var payload = response.payload;\n                      displayOncoprint(payload);\n                      setState(\"control\");\n                      osApi.setBusy(false);\n                  });\n                }\n            }\n\n        }\n    }\n})();\n\n\n/*\n * Copyright (c) 2015 Memorial Sloan-Kettering Cancer Center.\n *\n * This library is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS\n * FOR A PARTICULAR PURPOSE. The software and documentation provided hereunder\n * is on an \"as is\" basis, and Memorial Sloan-Kettering Cancer Center has no\n * obligations to provide maintenance, support, updates, enhancements or\n * modifications. In no event shall Memorial Sloan-Kettering Cancer Center be\n * liable to any party for direct, indirect, special, incidental or\n * consequential damages, including lost profits, arising out of the use of this\n * software and its documentation, even if Memorial Sloan-Kettering Cancer\n * Center has been advised of the possibility of such damage.\n */\n\n/*\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\noncoprint_events = {\n\tADD_TRACK: 'add_track.oncoprint',\n\tREMOVE_TRACK: 'remove_track.oncoprint',\n\tMOVE_TRACK: 'move_track.oncoprint',\n\tSORT: 'sort.oncoprint',\n\tSET_CELL_PADDING: 'set_cell_padding.oncoprint',\n\tSET_CELL_WIDTH: 'set_cell_width.oncoprint',\n\tSET_TRACK_DATA: 'set_track_data.oncoprint',\n\tSET_ID_ORDER: 'set_id_order.oncoprint',\n\tCELL_CLICK: 'cell_click.oncoprint',\n\tCELL_MOUSEENTER: 'cell_mouseenter.oncoprint',\n\tCELL_MOUSELEAVE: 'cell_mouseleave.oncoprint',\n\tONCOPRINT_MOUSEENTER: 'oncoprint_mouseenter.oncoprint',\n\tONCOPRINT_MOUSELEAVE: 'oncoprint_mouseleave.oncoprint',\n\tSET_PRE_TRACK_PADDING: 'set_pre_track_padding.oncoprint',\n\tTRACK_INIT: 'init.track.oncoprint',\n\tUPDATE_RENDER_RULES: 'update_render_rules.cell_renderer.oncoprint',\n\tFINISHED_RENDERING: 'finished_rendering.oncoprint',\n\tFINISHED_POSITIONING: 'finished_positioning.renderer.oncoprint',\n\tSET_ZOOM: 'set_zoom.oncoprint',\n\tSET_SORT_DIRECTION: 'set_sort_direction.oncoprint',\n\tSET_VISIBLE_ID_ORDER: 'set_visible_ids.oncoprint'\n};\noncoprint_defaults = (function() {\n\tvar utils = window.oncoprint_utils;\n\tvar makeGeneticAlterationComparator = function(distinguish_mutations) {\n\t\tvar cna_key = 'cna';\n\t\tvar cna_order = utils.invert_array(['AMPLIFIED', 'HOMODELETED', 'GAINED', 'HEMIZYGOUSLYDELETED', 'DIPLOID', undefined]);\n\t\tvar mut_type_key = 'mut_type';\n\t\tvar mut_order = (function() {\n\t\t\tif (!distinguish_mutations) {\n\t\t\t\treturn function(m) {\n\t\t\t\t\treturn +(typeof m === 'undefined');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar _order = utils.invert_array(['TRUNC', 'INFRAME', 'MISSENSE', undefined]); \n\t\t\t\treturn function(m) {\n\t\t\t\t\treturn _order[m];\n\t\t\t\t}\n\t\t\t}\n\t\t})();\n\t\tvar mrna_key = 'mrna';\n\t\tvar rppa_key = 'rppa';\n\t\tvar regulation_order = utils.invert_array(['UPREGULATED', 'DOWNREGULATED', undefined]);\n\n\t\treturn function(d1, d2) {\n\t\t\tvar cna_diff = utils.sign(cna_order[d1[cna_key]] - cna_order[d2[cna_key]]);\n\t\t\tif (cna_diff !== 0) {\n\t\t\t\treturn cna_diff;\n\t\t\t}\n\n\t\t\tvar mut_type_diff = utils.sign(mut_order(d1[mut_type_key]) - mut_order(d2[mut_type_key]));\n\t\t\tif (mut_type_diff !== 0) {\n\t\t\t\treturn mut_type_diff;\n\t\t\t}\n\n\t\t\tvar mrna_diff = utils.sign(regulation_order[d1[mrna_key]] - regulation_order[d2[mrna_key]]);\n\t\t\tif (mrna_diff !== 0) {\n\t\t\t\treturn mrna_diff;\n\t\t\t}\n\n\t\t\tvar rppa_diff = utils.sign(regulation_order[d1[rppa_key]] - regulation_order[d2[rppa_key]]);\n\t\t\tif (rppa_diff !== 0) {\n\t\t\t\treturn rppa_diff;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t};\n\t};\n\n\tvar genetic_alteration_config_base = {\n\t\tdefault: [{shape: 'full-rect', color: '#D3D3D3', z_index: -1}],\n\t\taltered: {\n\t\t\t'cna': {\n\t\t\t\t'AMPLIFIED': {\n\t\t\t\t\tshape: 'full-rect',\n\t\t\t\t\tcolor: 'red',\n\t\t\t\t\tlegend_label: 'Amplification'\n\t\t\t\t},\n\t\t\t\t'GAINED': {\n\t\t\t\t\tshape: 'full-rect',\n\t\t\t\t\tcolor: '#FFB6C1',\n\t\t\t\t\tlegend_label: 'Gain'\n\t\t\t\t},\n\t\t\t\t'HOMODELETED':{\n\t\t\t\t\tshape: 'full-rect',\n\t\t\t\t\tcolor: '#0000FF',\n\t\t\t\t\tlegend_label: 'Deep Deletion'\n\t\t\t\t},\n\t\t\t\t'HEMIZYGOUSLYDELETED': {\n\t\t\t\t\tshape: 'full-rect',\n\t\t\t\t\tcolor: '#8FD8D8',\n\t\t\t\t\tlegend_label: 'Shallow Deletion'\n\t\t\t\t}\n\t\t\t},\n\t\t\t'mrna': {\n\t\t\t\t'UPREGULATED': {\n\t\t\t\t\tshape: 'outline',\n\t\t\t\t\tcolor: '#FF9999',\n\t\t\t\t\tlegend_label: 'mRNA Upregulation'\n\t\t\t\t},\n\t\t\t\t'DOWNREGULATED': {\n\t\t\t\t\tshape: 'outline',\n\t\t\t\t\tcolor: '#6699CC',\n\t\t\t\t\tlegend_label: 'mRNA Downregulation'\n\t\t\t\t}\n\t\t\t},\n\t\t\t'rppa': {\n\t\t\t\t'UPREGULATED': {\n\t\t\t\t\tshape: 'small-up-arrow',\n\t\t\t\t\tcolor: 'black',\n\t\t\t\t\tlegend_label: 'Protein Upregulation'\n\t\t\t\t},\n\t\t\t\t'DOWNREGULATED': {\n\t\t\t\t\tshape: 'small-down-arrow',\n\t\t\t\t\tcolor: 'black',\n\t\t\t\t\tlegend_label: 'Protein Downregulation'\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlegend_label: \"Genetic Alteration\",\n\t};\n\tvar genetic_alteration_config_nondistinct_mutations = $.extend(true,{},genetic_alteration_config_base);\n\tgenetic_alteration_config_nondistinct_mutations.altered.mut_type = {\n\t\t'*': {\n\t\t\tshape: 'middle-rect',\n\t\t\tcolor: 'green',\n\t\t\tlegend_label: 'Mutation'\n\t\t}\n\t};\n\tvar genetic_alteration_config = $.extend(true,{},genetic_alteration_config_base);\n\tgenetic_alteration_config.altered.mut_type = {\n\t\t'MISSENSE': {\n\t\t\tshape: 'middle-rect',\n\t\t\tcolor: 'green',\n\t\t\tlegend_label: 'Missense Mutation'\n\t\t},\n\t\t'INFRAME': {\n\t\t\tshape: 'middle-rect',\n\t\t\tcolor: '#9F8170',\n\t\t\tlegend_label: 'Inframe Mutation'\n\t\t},\n\t\t'TRUNC': {\n\t\t\tshape: 'middle-rect',\n\t\t\tcolor: 'black',\n\t\t\tlegend_label: 'Truncating Mutation'\n\t\t},\n\t\t'FUSION':{\n\t\t\tshape: 'large-right-arrow',\n\t\t\tcolor: 'black',\n\t\t\tlegend_label: 'Fusion'\n\t\t}\n\t};\n\t\n\treturn {\n\t\tgenetic_alteration_config: genetic_alteration_config,\n\t\tgenetic_alteration_config_nondistinct_mutations: genetic_alteration_config_nondistinct_mutations,\n\t\tgenetic_alteration_comparator: makeGeneticAlterationComparator(true),\n\t\tgenetic_alteration_comparator_nondistinct_mutations: makeGeneticAlterationComparator(false)\n\t};\n})();\noncoprint_RuleSet = (function() {\n\tvar utils = oncoprint_utils;\n\tvar defaults = oncoprint_defaults;\n\n\tvar CATEGORICAL_COLOR = 'categorical_color';\n\tvar GRADIENT_COLOR = 'gradient_color'; \n\tvar GENETIC_ALTERATION = 'genetic_alteration';\n\tvar BAR_CHART = 'bar_chart';\n\n\tvar CELL = \"cell\";\n\tvar ANY = '*';\n\n\tvar getRuleSetId = utils.makeIdCounter();\n\n\tvar numericalNaNSort = function(d1, d2) {\n\t\tvar f1 = parseFloat(d1[this.data_key], 10);\n\t\tvar f2 = parseFloat(d2[this.data_key], 10);\n\t\tvar f1_isNaN = isNaN(f1);\n\t\tvar f2_isNaN = isNaN(f2);\n\t\tif (f1_isNaN && f2_isNaN) {\n\t\t\treturn 0;\n\t\t} else if (!f1_isNaN && !f2_isNaN) {\n\t\t\tif (f1 < f2) {\n\t\t\t\treturn -1;\n\t\t\t} else if (f1 > f2) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\t\n\t\t} else if (f1_isNaN) {\n\t\t\treturn Number.POSITIVE_INFINITY;\n\t\t} else {\n\t\t\treturn Number.NEGATIVE_INFINITY;\n\t\t}\n\t};\n\tvar makeNARuleParams = function(condition, label) {\n\t\treturn {\n\t\t\t\tcondition: condition,\n\t\t\t\tshape: utils.makeD3SVGElement('rect'),\n\t\t\t\tattrs: {fill: '#eeeeee', width: '100%', height:'100%'},\n\t\t\t\tlegend_label: label,\n\t\t\t\tchildren: [{\n\t\t\t\t\tcondition: condition,\n\t\t\t\t\tshape: utils.makeD3SVGElement('path'),\n\t\t\t\t\tattrs: {d: \"m 0% 0% L 100% 100%\"},\n\t\t\t\t\tstyles: {'stroke-width':'1px', 'stroke':'#555555'},\n\t\t\t\t\tlegend_label: label,\n\t\t\t\t}],\n\t\t\t};\n\t};\n\tvar D3SVGRuleSet = (function() {\n\t\tfunction D3SVGRuleSet(params) {\n\t\t\tthis.rule_map = {};\n\t\t\tthis.rule_set_id = getRuleSetId();\n\t\t\tthis.legend_label = params.legend_label;\n\t\t\tthis.exclude_from_legend = false;\n\t\t};\n\t\tvar getRuleId = utils.makeIdCounter();\n\n\t\tD3SVGRuleSet.prototype.getLegendLabel = function() {\n\t\t\treturn this.legend_label;\n\t\t};\n\t\tD3SVGRuleSet.prototype.getRuleSetId = function() {\n\t\t\treturn this.rule_set_id;\n\t\t};\n\t\tD3SVGRuleSet.prototype.addRule = function(params) {\n\t\t\tvar rule_id = getRuleId();\n\t\t\tthis.rule_map[rule_id] = new D3SVGRule(params, rule_id);\n\t\t\treturn rule_id;\n\t\t}\n\t\tD3SVGRuleSet.prototype.addStaticRule = function(params) {\n\t\t\tvar rule_id = getRuleId();\n\t\t\tthis.rule_map[rule_id] = new D3SVGStaticRule(params, rule_id);\n\t\t\treturn rule_id;\n\t\t};\n\t\tD3SVGRuleSet.prototype.addGradientRule = function(params) {\n\t\t\tvar rule_id = getRuleId();\n\t\t\tthis.rule_map[rule_id] = new D3SVGGradientRule(params, rule_id);\n\t\t\treturn rule_id;\n\t\t};\n\t\tD3SVGRuleSet.prototype.addBarChartRule = function(params) {\n\t\t\tvar rule_id = getRuleId();\n\t\t\tthis.rule_map[rule_id] = new D3SVGBarChartRule(params, rule_id);\n\t\t\treturn rule_id;\n\t\t};\n\t\tD3SVGRuleSet.prototype.removeRule = function(rule_id) {\n\t\t\tdelete this.rule_map[rule_id];\n\t\t};\n\t\tD3SVGRuleSet.prototype.getRules = function() {\n\t\t\tvar self = this;\n\t\t\tvar rule_ids = Object.keys(this.rule_map);\n\t\t\tvar rules = _.map(rule_ids, function(id) { return self.rule_map[id]; });\n\t\t\tvar sorted_rules = _.sortBy(rules, function(r) { return r.z_index; });\n\t\t\treturn sorted_rules;\n\t\t};\n\t\tD3SVGRuleSet.prototype.apply = function(g, cell_width, cell_height) {\n\t\t\tvar active_rules = {};\n\t\t\t_.each(this.getRules(), function(rule) {\n\t\t\t\tvar affected_groups = rule.filter(g);\n\t\t\t\tif (affected_groups[0].length > 0) {\n\t\t\t\t\tactive_rules[rule.rule_id] = true;\n\t\t\t\t}\n\t\t\t\trule.apply(affected_groups, cell_width, cell_height);\n\t\t\t});\n\t\t\treturn active_rules;\n\t\t};\n\t\tD3SVGRuleSet.prototype.getRule = function(rule_id) {\n\t\t\treturn this.rule_map[rule_id];\n\t\t};\n\t\treturn D3SVGRuleSet;\n\t})();\n\n\tfunction D3SVGCategoricalColorRuleSet(params) {\n\t\tD3SVGRuleSet.call(this, params);\n\t\tthis.type = CATEGORICAL_COLOR;\n\t\tvar self = this;\n\t\tvar d3_colors = [\"#3366cc\",\"#dc3912\",\"#ff9900\",\"#109618\",\n\t\t\t\t\"#990099\",\"#0099c6\",\"#dd4477\",\"#66aa00\",\n\t\t\t\t\"#b82e2e\",\"#316395\",\"#994499\",\"#22aa99\",\n\t\t\t\t\"#aaaa11\",\"#6633cc\",\"#e67300\",\"#8b0707\",\n\t\t\t\t\"#651067\",\"#329262\",\"#5574a6\",\"#3b3eac\",\n\t\t\t\t\"#b77322\",\"#16d620\",\"#b91383\",\"#f4359e\",\n\t\t\t\t\"#9c5935\",\"#a9c413\",\"#2a778d\",\"#668d1c\",\n\t\t\t\t\"#bea413\",\"#0c5922\",\"#743411\"];/*_.shuffle(_.filter(d3.scale.category20().range().concat(d3.scale.category20b().range()).concat(d3.scale.category20c().range()),\n\t\t\t\t\t\t\t\t\tfunction(color) {\n\t\t\t\t\t\t\t\t\t\tvar rgb = d3.rgb(color);\n\t\t\t\t\t\t\t\t\t\treturn !(rgb.r === rgb.g && rgb.g === rgb.b);\n\t\t\t\t\t\t\t\t\t}));*/\n\t\tvar addColorRule = function(color, category) {\n\t\t\tvar colored_rect = utils.makeD3SVGElement('rect').attr('fill', color);\n\t\t\tvar condition = (function(cat) {\n\t\t\t\treturn function(d) {\n\t\t\t\t\treturn params.getCategory(d) === cat;\n\t\t\t\t};\n\t\t\t})(category);\n\t\t\tself.addStaticRule({\n\t\t\t\tcondition: condition,\n\t\t\t\tshape: colored_rect,\n\t\t\t\tlegend_label: category\n\t\t\t});\n\t\t};\n\t\tparams.color = params.color || {};\n\t\t_.each(params.color, function(color, category) {\n\t\t\taddColorRule(color, category);\n\t\t});\n\t\tself.addStaticRule(makeNARuleParams(function(d) {\n\t\t\treturn params.getCategory(d) === 'NA';\n\t\t}, 'NA'));\n\n\t\tthis.sort_cmp = params.sort_cmp || function(d1,d2) {\n\t\t\tvar cat1 = params.getCategory(d1);\n\t\t\tvar cat2 = params.getCategory(d2);\n\t\t\tif (typeof cat1 !== 'string') {\n\t\t\t\tcat1 = cat1.toString();\n\t\t\t}\n\t\t\tif (typeof cat2 !== 'string') {\n\t\t\t\tcat2 = cat2.toString();\n\t\t\t}\n\t\t\tif (cat1 === cat2) {\n\t\t\t\treturn 0;\n\t\t\t} else if (cat1 === 'NA') {\n\t\t\t\treturn Number.POSITIVE_INFINITY;\n\t\t\t} else if (cat2 === 'NA') {\n\t\t\t\treturn Number.NEGATIVE_INFINITY;\n\t\t\t} else {\n\t\t\t\treturn cat1.localeCompare(cat2);\n\t\t\t}\n\t\t};\n\t\tself.apply = function(g, cell_width, cell_height) {\n\t\t\tg.each(function(d,i) {\n\t\t\t\tvar category = params.getCategory(d);\n\t\t\t\tif (!params.color.hasOwnProperty(category) && category !== \"NA\") {\n\t\t\t\t\tvar new_color = d3_colors.pop();\n\t\t\t\t\tparams.color[category] = new_color;\n\t\t\t\t\taddColorRule(new_color, category);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn D3SVGRuleSet.prototype.apply.call(this, g, cell_width, cell_height);\n\t\t};\n\n\t\tself.getLegendDiv = function(active_rules, cell_width, cell_height) {\n\t\t\tvar div = d3.select(document.createElement('div'));\n\t\t\t_.each(self.getRules(), function(rule) {\n\t\t\t\tif (active_rules[rule.rule_id]) {\n\t\t\t\t\tvar legend_div = rule.getLegendDiv(cell_width, cell_height);\n\t\t\t\t\tif (legend_div) {\n\t\t\t\t\t\tdiv.node().appendChild(legend_div);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tutils.d3SelectChildren(div, '*').style('padding-right', '20px');\n\t\t\treturn div.node();\n\t\t};\n\t}\n\tD3SVGCategoricalColorRuleSet.prototype = Object.create(D3SVGRuleSet.prototype);\n\n\tfunction D3SVGGradientColorRuleSet(params) {\n\t\tD3SVGRuleSet.call(this, params);\n\t\tthis.type = GRADIENT_COLOR;\n\t\tthis.data_key = params.data_key;\n\t\tvar rule = this.addGradientRule({\n\t\t\tshape: utils.makeD3SVGElement('rect'),\n\t\t\tdata_key: params.data_key,\n\t\t\tdata_range: params.data_range,\n\t\t\tcolor_range: params.color_range,\n\t\t\tscale: params.scale,\n\t\t\tna_color: params.na_color\n\t\t});\n\t\tthis.addStaticRule(makeNARuleParams(function(d) {\n\t\t\treturn isNaN(d[params.data_key]);\n\t\t}, 'NA'));\n\t\tthis.sort_cmp = params.sort_cmp || $.proxy(numericalNaNSort, this);\n\t\tthis.getLegendDiv = function(active_rules, cell_width, cell_height) {\n\t\t\treturn (active_rules[rule] && this.rule_map[rule].getLegendDiv(cell_width, cell_height)) || $('<div>')[0];\n\t\t};\n\t}\n\tD3SVGGradientColorRuleSet.prototype = Object.create(D3SVGRuleSet.prototype);\n\n\tfunction D3SVGBarChartRuleSet(params) {\n\t\tD3SVGRuleSet.call(this, params);\n\t\tvar self = this;\n\t\tself.type = BAR_CHART;\n\t\tself.data_key = params.data_key;\n\t\tvar rule = this.addBarChartRule({\n\t\t\tdata_key: params.data_key,\n\t\t\tdata_range: params.data_range,\n\t\t\tscale: params.scale,\n\t\t\tfill: params.fill,\n\t\t\tna_color: params.na_color\n\t\t});\n\t\tthis.addStaticRule(makeNARuleParams(function(d) {\n\t\t\treturn isNaN(d[params.data_key]);\n\t\t}, 'NA'));\n\t\tthis.sort_cmp = params.sort_cmp || $.proxy(numericalNaNSort, this);\n\t\tthis.getLegendDiv = function(active_rules, cell_width, cell_height) {\n\t\t\treturn (active_rules[rule] && this.rule_map[rule].getLegendDiv(cell_width, cell_height)) || $('<div>')[0];\n\t\t};\n\t}\n\tD3SVGBarChartRuleSet.prototype = Object.create(D3SVGRuleSet.prototype);\n\n\tfunction D3SVGGeneticAlterationRuleSet(params) {\n\t\tif (params && params.dont_distinguish_mutation_color) {\n\t\t\tparams = $.extend({}, params, defaults.genetic_alteration_config_nondistinct_mutations);\n\t\t} else {\n\t\t\tparams = $.extend({}, params, defaults.genetic_alteration_config);\n\t\t}\n\t\tif (params && params.distinguish_mutation_order) {\n\t\t\tthis.sort_cmp = defaults.genetic_alteration_comparator;\n\t\t} else {\n\t\t\tthis.sort_cmp = defaults.genetic_alteration_comparator_nondistinct_mutations;\n\t\t}\n\t\tD3SVGRuleSet.call(this, params);\n\t\tvar vocab = ['full-rect', 'middle-rect', 'large-right-arrow', 'small-up-arrow', 'small-down-arrow'];\n\t\tvar self = this;\n\t\tself.type = GENETIC_ALTERATION;\n\n\t\tvar makeStaticShapeRule = function(rule_spec, key, value) {\n\t\t\tvar condition = typeof key !== 'undefined' && typeof value !== 'undefined' ? (function(_key, _value) {\n\t\t\t\tif (_value === ANY) {\n\t\t\t\t\treturn function(d) {\n\t\t\t\t\t\treturn typeof d[_key] !== 'undefined';\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn function(d) {\n\t\t\t\t\t\treturn d[_key] === _value;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t})(key, value) : undefined;\n\t\t\tvar shape, attrs, styles, z_index;\n\t\t\tswitch (rule_spec.shape) {\n\t\t\t\tcase 'full-rect':\n\t\t\t\t\tshape = utils.makeD3SVGElement('rect');\n\t\t\t\t\tattrs = {fill: rule_spec.color, width: '100%', height: '100%'};\n\t\t\t\t\tstyles = {};\n\t\t\t\t\tz_index = utils.ifndef(rule_spec.z_index, 0);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'middle-rect':\n\t\t\t\t\tshape = utils.makeD3SVGElement('rect');\n\t\t\t\t\tattrs = {fill: rule_spec.color, width: '100%', height: '33.33%', y: '33.33%'};\n\t\t\t\t\tstyles = {};\n\t\t\t\t\tz_index = utils.ifndef(rule_spec.z_index, 1);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'large-right-arrow':\n\t\t\t\t\tshape = utils.makeD3SVGElement('polygon');\n\t\t\t\t\tattrs = {points: \"0%,0% 100%,50% 0%,100%\"};\n\t\t\t\t\tstyles = {'stroke-width':'0px', 'fill': rule_spec.color};\n\t\t\t\t\tz_index = utils.ifndef(rule_spec.z_index, 2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'small-up-arrow':\n\t\t\t\t\tshape = utils.makeD3SVGElement('polygon');\n\t\t\t\t\tattrs = {points: \"50%,0% 100%,25% 0%,25%\"};\n\t\t\t\t\tstyles = {'stroke-width':'0px', 'fill': rule_spec.color};\n\t\t\t\t\tz_index = utils.ifndef(rule_spec.z_index, 3);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'small-down-arrow':\n\t\t\t\t\tshape = utils.makeD3SVGElement('polygon');\n\t\t\t\t\tattrs = {points: \"50%,100% 100%,75% 0%,75%\"};\n\t\t\t\t\tstyles = {'stroke-width':'0px', 'fill': rule_spec.color};\n\t\t\t\t\tz_index = utils.ifndef(rule_spec.z_index, 4);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'outline':\n\t\t\t\t\tshape = CELL;\n\t\t\t\t\tstyles = {'outline-color':rule_spec.color, 'outline-style':'solid', 'outline-width':'2px'};\n\t\t\t\t\tz_index = utils.ifndef(rule_spec.z_index, 5);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tvar new_rule = self.addStaticRule({\n\t\t\t\tcondition: condition,\n\t\t\t\tshape: shape,\n\t\t\t\tattrs: attrs,\n\t\t\t\tstyles: styles,\n\t\t\t\tz_index: z_index,\n\t\t\t\tlegend_label: rule_spec.legend_label,\n\t\t\t\texclude_from_legend: (typeof rule_spec.legend_label === \"undefined\")\n\t\t\t});\n\t\t\treturn new_rule;\n\t\t};\n\t\tvar altered_rules = [];\n\t\t_.each(params.altered, function(values, key) {\n\t\t\t_.each(values, function(rule_spec, value) {\n\t\t\t\taltered_rules.push(makeStaticShapeRule(rule_spec, key, value));\n\t\t\t});\n\t\t});\n\t\t_.each(params.default, function(rule_spec) {\n\t\t\tmakeStaticShapeRule(rule_spec);\n\t\t});\n\t\tself.getLegendDiv = function(active_rules, cell_width, cell_height) {\n\t\t\tvar div = d3.select(document.createElement('div'));\n\t\t\t_.each(self.getRules(), function(rule) {\n\t\t\t\tif (active_rules[rule.rule_id]) {\n\t\t\t\t\tvar legend_div = rule.getLegendDiv(cell_width, cell_height);\n\t\t\t\t\tif (legend_div) {\n\t\t\t\t\t\tdiv.node().appendChild(legend_div);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tutils.d3SelectChildren(div, '*').style('padding-right', '20px');\n\t\t\treturn div.node();\n\t\t};\n\t\tself.alteredData = function(data) {\n\t\t\tvar altered_data = [];\n\t\t\t_.each(altered_rules, function(rule_id) {\n\t\t\t\taltered_data = altered_data.concat(self.getRule(rule_id).filterData(data));\n\t\t\t});\n\t\t\treturn _.uniq(altered_data);\n\t\t};\n\t}\n\tD3SVGGeneticAlterationRuleSet.prototype = Object.create(D3SVGRuleSet.prototype);\n\n\tvar D3SVGRule = (function() {\n\t\tfunction D3SVGRule(params, rule_id) {\n\t\t\tthis.rule_id = rule_id;\n\t\t\tthis.condition = params.condition || function(d) { return true; };\n\t\t\tthis.shape = typeof params.shape === 'undefined' ? utils.makeD3SVGElement('rect') : params.shape;\n\t\t\tthis.z_index = typeof params.z_index === 'undefined' ? this.rule_id : params.z_index;\n\t\t\tthis.legend_label = params.legend_label;\n\t\t\tthis.exclude_from_legend = params.exclude_from_legend;\n\n\t\t\tthis.attrs = params.attrs || {};\n\t\t\tthis.attrs.width = utils.ifndef(this.attrs.width, '100%');\n\t\t\tthis.attrs.height = utils.ifndef(this.attrs.height, '100%');\n\t\t\tthis.attrs.x = utils.ifndef(this.attrs.x, 0);\n\t\t\tthis.attrs.y = utils.ifndef(this.attrs.y, 0);\n\n\t\t\tthis.styles = params.styles || {};\n\n\t\t\tthis.children = _.map(params.children, function(p) {\n\t\t\t\treturn new D3SVGRule(p);\n\t\t\t});\n\t\t}\n\n\t\tvar percentToPx = function(attr_val, attr_name, cell_width, cell_height) {\n\t\t\t// convert a percentage to a local pixel coordinate\n\t\t\tvar width_like = ['width', 'x'];\n\t\t\tvar height_like = ['height', 'y'];\n\t\t\tattr_val = parseFloat(attr_val, 10)/100;\n\t\t\tif (width_like.indexOf(attr_name) > -1) {\n\t\t\t\tattr_val = attr_val*cell_width;\n\t\t\t} else if (height_like.indexOf(attr_name) > -1) {\n\t\t\t\tattr_val = attr_val*cell_height;\n\t\t\t} \n\t\t\treturn attr_val+'';\n\t\t};\n\n\t\tvar convertAttr = function(d, i, attr_val, attr_name, cell_width, cell_height) {\n\t\t\tvar ret = attr_val;\n\t\t\tif (typeof ret === 'function') {\n\t\t\t\tret = ret(d,i);\n\t\t\t}\n\t\t\tif (typeof ret === 'string' && ret.indexOf('%') > -1) {\n\t\t\t\tif (attr_name === 'points') {\n\t\t\t\t\tret = _.map(ret.split(\" \"), function(pt) {\n\t\t\t\t\t\tvar split_pt = pt.split(\",\");\n\t\t\t\t\t\tvar pt_x = percentToPx(split_pt[0], 'x', cell_width, cell_height);\n\t\t\t\t\t\tvar pt_y = percentToPx(split_pt[1], 'y', cell_width, cell_height);\n\t\t\t\t\t\treturn pt_x+\",\"+pt_y;\n\t\t\t\t\t}).join(\" \");\n\t\t\t\t} else if (attr_name === 'd') {\n\t\t\t\t\tvar split = ret.split(/\\s+/);\n\t\t\t\t\tfor (var i=0, _len = split.length; i<_len; i++) {\n\t\t\t\t\t\tvar c = split[i].toLowerCase();\n\t\t\t\t\t\tif (c === 'm' || c === 'l') {\n\t\t\t\t\t\t\tsplit[i+1] = percentToPx(split[i+1], 'x', cell_width, cell_height);\n\t\t\t\t\t\t\tsplit[i+2] = percentToPx(split[i+2], 'y', cell_width, cell_height);\n\t\t\t\t\t\t\ti += 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn split.join(\" \");\n\t\t\t\t} else {\n\t\t\t\t\tret = percentToPx(ret, attr_name, cell_width, cell_height);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret;\n\t\t};\n\n\t\tD3SVGRule.prototype.apply = function(g, cell_width, cell_height) {\n\t\t\tvar shape = this.shape;\n\t\t\tvar elts = shape === CELL ? g : utils.appendD3SVGElement(shape, g);\n\t\t\tvar styles = this.styles;\n\t\t\tvar attrs = this.attrs;\n\t\t\tattrs.x = attrs.x || 0;\n\t\t\tattrs.y = attrs.y || 0;\n\t\t\t_.each(attrs, function(val, key) {\n\t\t\t\telts.attr(key, function(d,i) {\n\t\t\t\t\treturn convertAttr(d, i, val, key, cell_width, cell_height);\n\t\t\t\t});\n\t\t\t});\n\t\t\t_.each(styles, function(val, key) {\n\t\t\t\telts.style(key, val);\n\t\t\t});\n\t\t\t_.each(this.children, function(r) {\n\t\t\t\tr.apply(g, cell_width, cell_height);\n\t\t\t});\n\t\t}\n\t\tD3SVGRule.prototype.filter = function(g) {\n\t\t\treturn g.filter(this.condition);\n\t\t};\n\t\tD3SVGRule.prototype.filterData = function(data) {\n\t\t\treturn data.filter(this.condition);\n\t\t};\n\t\tD3SVGRule.prototype.showInLegend = function() {\n\t\t\treturn !this.exclude_from_legend;\n\t\t};\n\t\treturn D3SVGRule;\n\t})();\n\t\n\n\tfunction D3SVGBarChartRule(params, rule_id) {\n\t\tD3SVGRule.call(this, params, rule_id);\n\t\tthis.data_key = params.data_key;\n\t\tthis.data_range = params.data_range;\n\t\tthis.inferred_data_range;\n\t\tthis.attrs.fill = function(d) {\n\t\t\tif (isNaN(d[params.data_key])) {\n\t\t\t\treturn params.na_color;\n\t\t\t}  else {\n\t\t\t\treturn params.fill;\n\t\t\t}\n\t\t};\n\t\tthis.na_color = params.na_color;\n\n\t\tvar scale = function(x) {\n\t\t\tif (params.scale === 'log') {\n\t\t\t\treturn Math.log10(Math.max(Math.abs(x), 0.1)); \n\t\t\t} else {\n\t\t\t\treturn x;\n\t\t\t}\n\t\t};\n\t\tvar makeDatum = function(x) {\n\t\t\tvar ret = {};\n\t\t\tret[params.data_key] = x;\n\t\t\treturn ret;\n\t\t};\n\n\t\tthis.setUpHelperFunctions = function(data_range) {\n\t\t\tvar scaled_data_range = _.map(data_range, scale);\n\t\t\tvar height_helper = function(d) {\n\t\t\t\tvar datum = scale(d[params.data_key]);\n\t\t\t\tvar distance = Math.abs(datum-scaled_data_range[0]) / Math.abs(scaled_data_range[1]-scaled_data_range[0]);\n\t\t\t\treturn distance * 100;\n\t\t\t};\n\t\t\tvar y_function = function(d) {\n\t\t\t\treturn (isNaN(d[params.data_key]) ? \"0\" : (100 - height_helper(d))) + '%';\n\t\t\t};\n\t\t\tvar height_function = function(d) { \n\t\t\t\treturn (isNaN(d[params.data_key]) ? \"100\" : height_helper(d)) + '%';\n\t\t\t};\n\t\t\tthis.attrs.height = height_function;\n\t\t\tthis.attrs.y = y_function;\n\t\t};\n\n\t\tthis.inferDataRange = function(g) {\n\t\t\tvar self = this;\n\t\t\tvar min = Number.POSITIVE_INFINITY;\n\t\t\tvar max = Number.NEGATIVE_INFINITY;\n\t\t\tg.each(function(d,i) {\n\t\t\t\tvar datum = d[self.data_key];\n\t\t\t\tvar datumIsNaN = isNaN(datum);\n\t\t\t\tmin = Math.min(min, datumIsNaN ? Number.POSITIVE_INFINITY : datum);\n\t\t\t\tmax = Math.max(max, datumIsNaN ? Number.NEGATIVE_INFINITY : datum);\n\t\t\t});\n\t\t\treturn [min, max];\n\t\t};\n\n\t\tthis.getEffectiveDataRange = function() {\n\t\t\tif (typeof this.data_range === \"undefined\") {\n\t\t\t\treturn this.inferred_data_range;\n\t\t\t} else {\n\t\t\t\tvar ret = [];\n\t\t\t\tret[0] = (typeof this.data_range[0] === 'undefined' ? this.inferred_data_range[0] : this.data_range[0]);\n\t\t\t\tret[1] = (typeof this.data_range[1] === 'undefined' ? this.inferred_data_range[1] : this.data_range[1]);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t};\n\t\tthis.getLegendDiv = function(cell_width, cell_height) {\n\t\t\tif (!this.showInLegend()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar div = d3.select(document.createElement('div'));\n\t\t\tvar data_range = this.getEffectiveDataRange();\n\t\t\tif (!data_range) {\n\t\t\t\treturn div.node();\n\t\t\t}\n\t\t\tvar display_data_range = _.map(data_range, function(x) { \n\t\t\t\tvar num_digit_multiplier = Math.pow(10, utils.ifndef(params.legend_num_decimal_digits,2));\n\t\t\t\treturn Math.round(x * num_digit_multiplier) / num_digit_multiplier;\n\t\t\t});\n\t\t\tdiv.append('span').text(display_data_range[0]).classed('oncoprint-legend-label oncoprint-legend-element', true)\n\t\t\t\t\t.style('position', 'relative').style('bottom', '0px');\n\t\t\tvar mesh = 50;\n\t\t\tvar svg = div.append('svg').attr('width', mesh+'px').attr('height', cell_height+'px').classed('oncoprint-legend-element', true)\n\t\t\tfor (var i=0; i<=mesh; i++) {\n\t\t\t\tvar t = i/mesh;\n\t\t\t\tvar d = (1-t)*data_range[0] + t*data_range[1];\n\t\t\t\tvar datum = makeDatum(d);\n\t\t\t\tvar height = cell_height*parseInt(this.attrs.height(datum))/100;\n\t\t\t\tsvg.append('rect')\n\t\t\t\t\t.attr('width', '1px')\n\t\t\t\t\t.attr('height', height+'px')\n\t\t\t\t\t.attr('y', (cell_height-height)+'px')\n\t\t\t\t\t.attr('fill', params.fill)\n\t\t\t\t\t.attr('x', i+'px');\n\t\t\t}\n\t\t\tdiv.append('span').text(display_data_range[1]).classed('oncoprint-legend-label oncoprint-legend-element', true)\n\t\t\t\t\t.style('position', 'relative').style('bottom', cell_height - 3 + 'px');\n\t\t\tutils.d3SelectChildren(div, '*').style('padding-right', '10px');\n\t\t\treturn div.node();\n\t\t};\n\t\tthis.apply = function(g, cell_width, cell_height) {\n\t\t\tif (g[0].length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.inferred_data_range = this.inferDataRange(g);\n\t\t\tthis.setUpHelperFunctions(this.getEffectiveDataRange());\n\t\t\tD3SVGRule.prototype.apply.call(this, g, cell_width, cell_height);\n\t\t};\n\n\t}\n\tD3SVGBarChartRule.prototype = Object.create(D3SVGRule.prototype);\n\n\tfunction D3SVGGradientRule(params, rule_id) {\n\t\tD3SVGRule.call(this, params, rule_id);\n\t\tthis.data_key = params.data_key;\n\t\tthis.data_range = params.data_range;\n\t\tthis.inferred_data_range;\n\t\tthis.color_range = params.color_range;\n\t\tthis.na_color = params.na_color;\n\n\t\tvar makeDatum = function(x) {\n\t\t\tvar ret = {};\n\t\t\tret[params.data_key] = x;\n\t\t\treturn ret;\n\t\t};\n\t\tvar scale = function(x) {\n\t\t\tif (params.scale === 'log') {\n\t\t\t\treturn Math.log10(Math.max(x, 0.1)); \n\t\t\t} else {\n\t\t\t\treturn x;\n\t\t\t}\n\t\t};\n\n\t\tthis.setUpHelperFunctions = function(data_range) {\n\t\t\tvar scaled_data_range = _.map(data_range, scale);\n\t\t\tvar fill_function = function(d) {\n\t\t\t\tif (isNaN(d[params.data_key])) {\n\t\t\t\t\treturn params.na_color;\n\t\t\t\t}\n \t\t\t\tvar datum = scale(d[params.data_key]);\n\t\t\t\tvar data_range = [scaled_data_range[0], scaled_data_range[1]];\n\t\t\t\tvar distance = (datum-scaled_data_range[0]) / (scaled_data_range[1]-scaled_data_range[0]);\n\t\t\t\tcolor_range = [d3.rgb(params.color_range[0]).toString(),\n\t\t\t\t\t\td3.rgb(params.color_range[1]).toString()];\n\t\t\t\treturn utils.lin_interp(distance, params.color_range[0], params.color_range[1]);\n\t\t\t};\n\t\t\tthis.attrs.fill = fill_function;\n\t\t};\n\n\t\tthis.inferDataRange = function(g) {\n\t\t\tvar self = this;\n\t\t\tvar min = Number.POSITIVE_INFINITY;\n\t\t\tvar max = Number.NEGATIVE_INFINITY;\n\t\t\tg.each(function(d,i) {\n\t\t\t\tvar datum = d[self.data_key];\n\t\t\t\tvar datumIsNaN = isNaN(datum);\n\t\t\t\tmin = Math.min(min, datumIsNaN ? Number.POSITIVE_INFINITY : datum);\n\t\t\t\tmax = Math.max(max, datumIsNaN ? Number.NEGATIVE_INFINITY : datum);\n\t\t\t});\n\t\t\treturn [min, max];\n\t\t};\n\n\t\tthis.getLegendDiv = function(cell_width, cell_height) {\n\t\t\tif (!this.showInLegend()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar div = d3.select(document.createElement('div'));\n\t\t\tvar data_range = this.data_range || this.inferred_data_range;\n\t\t\tif (!data_range) {\n\t\t\t\treturn div.node();\n\t\t\t}\n\t\t\tvar display_data_range = _.map(data_range, function(x) { \n\t\t\t\tvar num_digit_multiplier = Math.pow(10, utils.ifndef(params.legend_num_decimal_digits,2));\n\t\t\t\treturn Math.round(x * num_digit_multiplier) / num_digit_multiplier;\n\t\t\t});\n\t\t\tdiv.append('span').text(display_data_range[0]).classed('oncoprint-legend-label oncoprint-legend-element', true)\n\t\t\t\t\t.style('position', 'relative').style('bottom', cell_height / 2 - 3 + 'px');\n\t\t\tvar mesh = 50;\n\t\t\tvar svg = div.append('svg').attr('width', mesh+'px').attr('height', cell_height+'px').classed('oncoprint-legend-element', true);\n\t\t\tfor (var i=0; i<=mesh; i++) {\n\t\t\t\tvar t = i/mesh;\n\t\t\t\tvar d = (1-t)*data_range[0] + t*data_range[1];\n\t\t\t\tvar datum = makeDatum(d);\n\t\t\t\tsvg.append('rect')\n\t\t\t\t\t.attr('width', '1px')\n\t\t\t\t\t.attr('height', cell_height+'px')\n\t\t\t\t\t.attr('fill', this.attrs.fill(datum))\n\t\t\t\t\t.attr('x', i+'px');\n\t\t\t}\n\t\t\tdiv.append('span').text(display_data_range[1]).classed('oncoprint-legend-label oncoprint-legend-element', true)\n\t\t\t\t\t.style('position', 'relative').style('bottom', cell_height / 2 - 3 + 'px');\n\t\t\tutils.d3SelectChildren(div, '*').style('padding-right', '10px');\n\t\t\treturn div.node();\n\t\t};\n\t\tthis.apply = function(g, cell_width, cell_height) {\n\t\t\tthis.setUpHelperFunctions(this.data_range || (this.inferred_data_range = this.inferDataRange(g)));\n\t\t\tD3SVGRule.prototype.apply.call(this, g, cell_width, cell_height);\n\t\t};\n\t}\n\tD3SVGGradientRule.prototype = Object.create(D3SVGRule.prototype);\n\n\tfunction D3SVGStaticRule(params, rule_id) {\n\t\tD3SVGRule.call(this, params, rule_id);\n\n\t\tthis.getLegendDiv = function(cell_width, cell_height) {\n\t\t\tif (!this.showInLegend()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar div = d3.select(document.createElement('div'));\n\t\t\tvar svg_ctr = div.append('div').classed('oncoprint-legend-block', true);\n\t\t\tvar svg = svg_ctr.append('svg').attr('width', cell_width+'px').attr('height', cell_height+'px').classed('oncoprint-legend-element', true);\n\t\t\tthis.apply(svg, cell_width, cell_height);\n\t\t\tif (this.legend_label) {\n\t\t\t\tdiv.append('span').text(this.legend_label).classed('oncoprint-legend-label oncoprint-legend-element', true)\n\t\t\t\t\t\t.style('position', 'relative').style('bottom', cell_height / 2 - 3 + 'px');\n\t\t\t}\n\t\t\tutils.d3SelectChildren(div, '*').style('padding-right', '10px');\n\t\t\treturn div.node();\n\t\t};\n\t}\n\tD3SVGStaticRule.prototype = Object.create(D3SVGRule.prototype);\n\n\treturn {\n\t\tCATEGORICAL_COLOR: CATEGORICAL_COLOR,\n\t\tGRADIENT_COLOR: GRADIENT_COLOR,\n\t\tGENETIC_ALTERATION: GENETIC_ALTERATION,\n\t\tBAR_CHART: BAR_CHART,\n\t\tmakeRuleSet: function(type, params) {\n\t\t\tif (type === CATEGORICAL_COLOR) {\n\t\t\t\treturn new D3SVGCategoricalColorRuleSet(params);\n\t\t\t} else if (type === GRADIENT_COLOR) {\n\t\t\t\treturn new D3SVGGradientColorRuleSet(params);\n\t\t\t} else if (type === GENETIC_ALTERATION) {\n\t\t\t\treturn new D3SVGGeneticAlterationRuleSet(params);\n\t\t\t} else if (type === BAR_CHART) {\n\t\t\t\treturn new D3SVGBarChartRuleSet(params);\n\t\t\t} else {\n\t\t\t\treturn new D3SVGRuleSet();\n\t\t\t}\n\t\t}\n\t};\n})();\n/*\n * Copyright (c) 2015 Memorial Sloan-Kettering Cancer Center.\n *\n * This library is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY, WITHOUT EVEN THE IMPLIED WARRANTY OF MERCHANTABILITY OR FITNESS\n * FOR A PARTICULAR PURPOSE. The software and documentation provided hereunder\n * is on an \"as is\" basis, and Memorial Sloan-Kettering Cancer Center has no\n * obligations to provide maintenance, support, updates, enhancements or\n * modifications. In no event shall Memorial Sloan-Kettering Cancer Center be\n * liable to any party for direct, indirect, special, incidental or\n * consequential damages, including lost profits, arising out of the use of this\n * software and its documentation, even if Memorial Sloan-Kettering Cancer\n * Center has been advised of the possibility of such damage.\n */\n\n/*\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Lesser General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nOncoprintRenderer = (function() {\n\tvar events = oncoprint_events;\n\tvar utils = oncoprint_utils;\n\tvar RuleSet = oncoprint_RuleSet;\n\n\tfunction OncoprintRenderer(oncoprint, config) {\n\t\tthis.rule_sets = {};\n\t\tthis.clipping = true;\n\t\tthis.oncoprint = oncoprint;\n\t\tthis.config = config;\n\t\tthis.upper_padding = utils.ifndef(config.upper_padding, 0);\n\t\tthis.max_label_length = utils.ifndef(config.max_label_length, 20);\n\t\tthis.track_group_separation = 12;\n\n\t\t(function computeLabelAreaWidth(self) {\n\t\t\tvar label_font = self.getLabelFont();\n\t\t\tvar max_label_width = utils.textWidth((Math.pow(10,self.max_label_length)-1).toString(), label_font);\n\t\t\tvar max_percent_altered_width = utils.textWidth('100%', label_font);\n\t\t\tvar buffer_width = 20;\n\t\t\tself.label_area_width = max_label_width + buffer_width + max_percent_altered_width;\n\t\t})(this);\n\t};\n\tOncoprintRenderer.prototype.getCellCSSClass = function() {\n\t\treturn 'oncoprint-cell';\t\n\t};\n\tOncoprintRenderer.prototype.getTrackCellCSSClass = function(track_id) {\n\t\treturn this.getCellCSSClass()+track_id;\n\t};\n\tOncoprintRenderer.prototype.getTrackLabelCSSClass = function(track_id) {\n\t\treturn 'oncoprint-track-label oncoprint-track-label'+track_id;\n\t};\n\tOncoprintRenderer.prototype.getTrackLabelCSSSelector = function(track_id) {\n\t\t// TODO: replace with utils.cssClassToSelector\n\t\treturn \".\"+this.getTrackLabelCSSClass(track_id).split(\" \").join(\".\");\n\t};\n\tOncoprintRenderer.prototype.getTrackCellCtrCSSClass = function(track_id) {\n\t\treturn 'oncoprint-track-cell-ctr'+track_id;\n\t};\n\tOncoprintRenderer.prototype.getLabelFont = function() {\n\t\treturn this.config.label_font;\n\t};\n\tOncoprintRenderer.prototype.setRuleSet = function(track_id, type, params) {\n\t\tvar new_rule_set = RuleSet.makeRuleSet(type, params);\n\t\tthis.rule_sets[track_id] = new_rule_set;\n\t\tif (new_rule_set.sort_cmp) {\n\t\t\tthis.oncoprint.setTrackSortComparator(track_id, new_rule_set.sort_cmp);\n\t\t}\n\t};\n\tOncoprintRenderer.prototype.useSameRuleSet = function(target_track_id, source_track_id) {\n\t\tvar rule_set = this.rule_sets[source_track_id];\n\t\tthis.rule_sets[target_track_id] = rule_set;\n\t\tif (rule_set.sort_cmp) {\n\t\t\tthis.oncoprint.setTrackSortComparator(target_track_id, rule_set.sort_cmp);\n\t\t}\n\t};\n\tOncoprintRenderer.prototype.getRuleSet = function(track_id) {\n\t\treturn this.rule_sets[track_id];\n\t};\n\tOncoprintRenderer.prototype.getTrackTops = function() {\n\t\tvar ret = {};\n\t\tvar y = this.upper_padding;\n\t\tvar self = this;\n\t\t_.each(this.oncoprint.getTrackGroups(), function(group) {\n\t\t\tif (group.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t_.each(group, function(id) {\n\t\t\t\tret[id] = y;\n\t\t\t\ty+= self.getRenderedTrackHeight(id);\n\t\t\t});\n\t\t\ty += self.track_group_separation;\n\t\t});\n\t\treturn ret;\n\t};\n\tOncoprintRenderer.prototype.getTrackCellTops = function() {\n\t\treturn this.track_cell_tops || this.computeTrackCellTops();\n\t};\n\tOncoprintRenderer.prototype.computeTrackCellTops = function() {\n\t\tvar tops = this.getTrackTops();\n\t\tvar self = this;\n\t\t_.each(tops, function(top, id) {\n\t\t\ttops[id] = top + self.oncoprint.getTrackPadding(id);\n\t\t});\n\t\tthis.track_cell_tops = tops;\n\t\treturn tops;\n\t};\n\tOncoprintRenderer.prototype.getTrackLabelTops = function() {\n\t\treturn this.getTrackCellTops();\n\t};\n\tOncoprintRenderer.prototype.getRenderedTrackHeight = function(track_id) {\n\t\treturn this.oncoprint.getTrackHeight(track_id) + 2*this.oncoprint.getTrackPadding(track_id);\n\t};\n\tOncoprintRenderer.prototype.getCellX = function(index) {\n\t\treturn (typeof index === 'number' ? index*(this.oncoprint.getZoomedCellWidth()+this.oncoprint.getCellPadding()) : -1);\n\t};\n\tOncoprintRenderer.prototype.getCellXArray = function(length) {\n\t\tvar cell_unit = this.oncoprint.getZoomedCellWidth() + this.oncoprint.getCellPadding();\n\t\treturn _.map(_.range(0,length), function(x) { return x*cell_unit; });\n\t};\n\tOncoprintRenderer.prototype.getCellAreaWidth = function() {\n\t\treturn this.oncoprint.getVisibleIdOrder().length*(this.oncoprint.getZoomedCellWidth() + this.oncoprint.getCellPadding());\n\t};\n\tOncoprintRenderer.prototype.getCellAreaHeight = function() {\n\t\tvar track_tops = this.getTrackTops();\n\t\tvar track_order = this.oncoprint.getTracks();\n\t\tif (track_order.length === 0) {\n\t\t\treturn 0;\n\t\t} else {\n\t\t\tvar last_track = track_order[track_order.length-1];\n\t\t\treturn track_tops[last_track] + this.getRenderedTrackHeight(last_track);\n\t\t}\n\t};\n\tOncoprintRenderer.prototype.getLabelAreaWidth = function() {\n\t\treturn this.label_area_width;\n\t};\n\tOncoprintRenderer.prototype.getLabelAreaHeight = function() {\n\t\treturn this.getCellAreaHeight();\n\t};\n\tOncoprintRenderer.prototype.render = function() {\n\t\tthrow \"not implemented in abstract class\";\n\t}\n\treturn OncoprintRenderer;\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osMetadata', explore);\n\n    /** @ngInject */\n    function explore() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/metadata/metadata.html',\n            controller: MetadataController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function MetadataController(osApi, $state, $timeout, $scope, $stateParams) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n            // View Model\n            var vm = this;\n            vm.dataset = $stateParams.datasource;\n            vm.colnames = [];\n            vm.rows = [];\n            vm.search = \"\";\n            vm.toggleFilter = function() {\n                angular.element(\".container-filters\").toggleClass(\"container-filters-collapsed\");\n                angular.element(\".container-filter-toggle\").toggleClass(\"container-filter-toggle-collapsed\");\n            }\n\n            // Elements\n            var dtTable;\n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.getDataManifest(vm.dataset).then(function(response) {\n                vm.colnames = response.payload.colnames;\n                vm.rows = response.payload.mtx;\n                $timeout(function() {\n                    dtTable = angular.element('#metadata-datatable').dataTable({\n                        \"paging\": false\n                    });\n                    $scope.$watch('vm.search', function() {\n                        dtTable.api().search(vm.search).draw();\n                    });\n                    osApi.setBusy(false);\n                }, 0, false);\n            });\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osMarkers', markers);\n\n    /** @ngInject */\n    function markers() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/markers/markers.html',\n            scope: {},\n            controller: MarkersController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function MarkersController(osApi, osHistory, $state, $timeout, $scope, $stateParams, cytoscape, signals, moment, $window, _) {\n\n            if (angular.isUndefined($stateParams.datasource)){\n                $state.go(\"datasource\");\n                return;\n            }\n\n            // Elements\n            var cyChart;\n            var elChart = angular.element(\".markers-chart\");\n\n            // Initialize View Model\n            var vm = initializeViewModel(this, $stateParams);\n\n\n            vm.resize = function(){\n                var width = $window.innerWidth;\n                if (angular.element(\".tray\").attr(\"locked\")==\"true\") width -= 300;\n                elChart.width( width );\n                elChart.height($window.innerHeight - 90);\n                if (cyChart) cyChart.resize();\n            }\n\n            // Window Listeners // Todo: Need To Remove On $destroy\n            angular.element($window).bind('resize', \n                _.debounce(vm.resize, 300)\n            );\n            angular.element($window).bind('click', \n                function(){\n                    $scope.$apply(function(){\n                        vm.optCtxGeneShow = false;\n                        vm.optCtxPatientShow = false;\n                    });\n                }\n            );\n       \n            // Load Data\n            osApi.setBusy(true);\n            loadData(osApi, vm, function(data){\n\n                // Resize\n                vm.resize();\n\n                // Initalize Styles\n                var styles = initializeStyles();\n\n                // Initialize Chart\n                cyChart = initializeChart(data, styles, cytoscape, angular.element(\"#markers-chart\"));\n\n                // Initialize Layouts\n                initializeLayouts(cyChart, vm, $scope);\n\n                // Initialize Node Colors\n                initializeNodeColors(cyChart, vm, $scope, osApi, $timeout, _);\n\n                // Initialize Edge Colors\n                initializeEdgeColors(cyChart, vm, $scope, $timeout);\n\n                // Initialize Events\n                initializeEvents(cyChart, vm, $scope, $timeout, osApi, signals);\n\n                // Initalize Search\n                initializeSearch(cyChart, vm, $scope)\n\n                // Initialize Zoom\n                initializeZoom(cyChart, _);\n\n                // Initialize Commands\n                initializeCommands(cyChart, vm, $window);\n\n                // Initialize History\n                initializeHistory(cyChart, osHistory, _);\n                \n                // Ready\n                osApi.setBusy(false);\n            });\n        }\n\n        function initializeSearch(chart, vm, $scope){\n\n            // Search Gene Textbox\n            $scope.$watch(\"vm.searchGene\", function(){\n                if (angular.isUndefined(vm.searchGene)){\n                    vm.geneSearchResult = \"\";\n                    return;\n                } \n                chart.startBatch();\n                var matches = {found:0};\n                chart.nodes('node[nodeType=\"gene\"]')\n                    .forEach(function(ele){\n                        if (vm.searchGene==\"\") { ele.deselect(); return; }\n                        if (ele.data().name.toLowerCase().indexOf(vm.searchGene.toLowerCase())==0){\n                            ele.select(); \n                            this.found += 1;\n                        }else{\n                            ele.deselect();\n                        }\n                    }, matches);\n                chart.endBatch();\n                if (vm.searchGene==\"\") vm.searchGeneResult = \"\";\n                else vm.searchGeneResult = \"(\"+matches.found +\" Matches)\"\n            });\n\n            // Search Patient Textbox\n            $scope.$watch(\"vm.searchPatient\", function(){\n                if (angular.isUndefined(vm.searchPatient)) return;\n                chart.startBatch();\n                var matches = {found:0};\n                chart.nodes('node[nodeType=\"patient\"]')\n                    .forEach(function(ele){\n                        if (vm.searchPatient==\"\") { ele.deselect(); return; }\n                        if (ele.data().id.toLowerCase().indexOf(vm.searchPatient.toLowerCase())==0){\n                            ele.select()\n                            this.found += 1;\n                        }else{\n                            ele.deselect();\n                        }\n                }, matches);\n                chart.endBatch();\n                if (vm.searchPatient==\"\") vm.searchPatientResult = \"\";\n                else vm.searchPatientResult = \"(\"+matches.found +\" Matches)\"\n            });\n        }          \n        function initializeCommands(chart, vm, $window){\n            vm.optInteractiveMode = vm.optInteractiveModes[0];\n            vm.optCommandPatient = [\n                {name:\"Show Edges\", cmd:function(){\n                    vm.optCommandPatient.selected.select();\n                    var degmap = {};\n                    vm.optCommandPatient.selected\n                        .neighborhood('edge')\n                        .forEach(function(item){\n                            this[item.id()] = {display:'element'};\n                        }, degmap);\n                    chart.batchData(degmap);\n                }},\n                {name:\"Hide Edges\", cmd:function(){\n                    var degmap = {};\n                    vm.optCommandPatient.selected\n                        .neighborhood('edge')\n                        .forEach(function(item){\n                            this[item.id()] = {display:'none'};\n                        }, degmap);\n                    chart.batchData(degmap);\n                }},\n                {name:\"Select Associated Genes\", cmd:function(){\n                    chart.startBatch();\n                    vm.optCommandPatient.selected.select();\n                    vm.optCommandPatient.selected\n                        .neighborhood('node')\n                        .forEach( function(ele){\n                            ele.select();\n                        });\n                    chart.endBatch();\n                    vm.optCtxPatientShow = false;\n                }},\n                {name:\"Deselect Associated Genes\", cmd:function(){\n                    chart.startBatch();\n                    vm.optCommandPatient.selected\n                        .neighborhood('node')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                    chart.endBatch();\n                    vm.optCtxPatientShow = false;\n                }},\n                {name:\"View Oncoprint\", cmd:function(){\n\n                    if (vm.datasource==\"DEMOdz\") return;\n                    if (vm.datasource.indexOf(\"TCGA\" == 0)) {\n                        var cbioDsName = vm.datasource.substr(4) + \"_tcga\";\n                        var genes = vm.optCommandPatient.selected.neighborhood('node').map(function(n) {\n                            return n.data().name;\n                        }).join(\"+\");\n                        var url = \"http://www.cbioportal.org/ln?cancer_study_id=\" + cbioDsName + \"&q=\" + genes;\n                        $window.open(url);\n                    }\n                    vm.optCtxPatientShow = false;\n                }}\n            ];\n            vm.optCommandGene = [\n                {name:\"Show Edges\", cmd:function(){\n                    vm.optCommandGene.selected.select();\n                    \n                    var degmap = {};\n                    vm.optCommandGene.selected\n                        .neighborhood('edge')\n                        .forEach(function(item){\n                            this[item.id()] = {display:'element'};\n                        }, degmap);\n                    chart.batchData(degmap);\n                }},\n                {name:\"Hide Edges\", cmd:function(){\n                    var degmap = {};\n                    vm.optCommandGene.selected\n                        .neighborhood('edge')\n                        .forEach(function(item){\n                            this[item.id()] = {display:'none'};\n                        }, degmap);\n                    chart.batchData(degmap);\n                }},\n                {name:\"Select Associated Patients\", cmd:function(){\n                    chart.startBatch();\n                    vm.optCommandGene.selected.select();\n                    vm.optCommandGene.selected\n                        .neighborhood('node')\n                        .forEach( function(ele){\n                            ele.select();\n                        });\n                    chart.endBatch();\n                    vm.optCtxGeneShow = false;\n                }},\n                {name:\"Deselect Associated Patients\", cmd:function(){\n                    chart.startBatch();\n                    vm.optCommandGene.selected\n                        .neighborhood('node')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                    chart.endBatch();\n                    vm.optCtxPatientShow = false;\n                }},\n                {name:\"View Gene Card\", cmd:function(){\n                    $window.open(\"http://www.genecards.org/cgi-bin/carddisp.pl?gene=\"+vm.optCommandGene.selected.data().name);\n                    vm.optCtxGeneShow = false;\n                }}\n            ];\n            vm.optCommands = {\n                 \"zoomReset\" : function(){\n                    chart.fit();\n                    chart.center();\n                },\n                \"zoomFit\" : function(){\n                    chart.fit( chart.$(':selected'), 50 )\n                },\n                \"showPatientsInCommon\": function(){\n                    var geneNodes = chart.$('node[nodeType=\"gene\"]:selected');\n                    var geneNames = geneNodes.map(function(item){ return item.data().name; });\n                    var patientNodes = geneNodes.neighborhood(\"node\");\n\n                    chart.startBatch();\n                    patientNodes.filter(function(i, patient){\n                        var patientGeneNames = patient.neighborhood(\"node\").map(function(item){ return item.data().name; })\n                        geneNames.forEach(function(geneName){\n                            if (patientGeneNames.indexOf(geneName)==-1) return false;\n                        })\n                        return true;\n                    }).forEach( function(ele){\n                        ele.select();\n                    });\n                    chart.endBatch();\n                },\n                \"showGenesInCommon\": function(){\n                    var patientNodes = chart.$('node[nodeType=\"patient\"]:selected');\n                    var genes;\n\n                    patientNodes.each(function(i, ele){\n                        var patientGenes = ele.neighborhood(\"node\").map( function(item){ return item.data().name; });\n                        if (i==0) genes = patientGenes;\n                        else{\n                            genes = genes.filter(function(gene){\n                                return patientGenes.indexOf(gene)>=0;\n                            }, patientGenes)\n                        }\n                    })\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"gene\"]')\n                        .forEach(function(node){\n                            if (genes.indexOf(node.data().name)>=0){\n                                node.select();\n                            }\n                        });\n                    chart.endBatch();\n\n                },\n                \"showPatientEdges\": function(){\n                    var degmap = {};\n                    chart.$('node[nodeType=\"patient\"]:selected')\n                        .forEach(function(node){\n                            node.neighborhood('edge').forEach(function(item){\n                                this[item.id()] = {display:'element'};\n                            }, this);\n                    }, degmap);\n                    chart.batchData(degmap);\n                },\n                \"hidePatientEdges\": function(){\n                    var degmap = {};\n                    chart.$('node[nodeType=\"patient\"]:selected')\n                        .forEach(function(node){\n                            node.neighborhood('edge').forEach(function(item){\n                                this[item.id()] = {display:'none'};\n                            }, this);\n                    }, degmap);\n                    chart.batchData(degmap);\n                },\n                \"showGeneEdges\": function(){\n                    var degmap = {};\n                    chart.$('node[nodeType=\"gene\"]:selected')\n                        .forEach(function(node){\n                            node.neighborhood('edge').forEach(function(item){\n                                this[item.id()] = {display:'element'};\n                            }, this);\n                    }, degmap);\n                    chart.batchData(degmap);\n                },\n                \"hideGeneEdges\": function(){\n                    var degmap = {};\n                    chart.$('node[nodeType=\"gene\"]:selected')\n                        .forEach(function(node){\n                            node.neighborhood('edge').forEach(function(item){\n                                this[item.id()] = {display:'none'};\n                            }, this);\n                    }, degmap);\n                    chart.batchData(degmap);\n                },\n                \"selectConnectedGenes\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"patient\"]:selected')\n                        .neighborhood('node')\n                        .forEach( function(ele){\n                            ele.select();\n                        });\n                    chart.endBatch();\n                },\n                \"selectConnectedPatients\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"gene\"]:selected')\n                        .neighborhood('node')\n                        .forEach( function(ele){\n                            ele.select();\n                        });\n                    chart.endBatch();\n                },\n                \"selectPatients\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"patient\"]')\n                        .forEach( function(ele){\n                            ele.select();\n                        });\n                    chart.endBatch();\n                },\n                \"selectGenes\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"gene\"]')\n                        .forEach( function(ele){\n                            ele.select();\n                        });\n                    chart.endBatch();\n                },\n                \"deselectPatients\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"patient\"]:selected')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                    chart.endBatch();\n                },\n                \"deselectGenes\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"gene\"]:selected')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                    chart.endBatch();\n                },\n                \"invertPatientSelection\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"patient\"]')\n                        .forEach( function(ele){\n                            ele[ele._private.selected?\"deselect\":\"select\"]();\n                        });\n                    chart.endBatch();\n                },\n                \"invertGeneSelection\" : function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"gene\"]')\n                        .forEach( function(ele){\n                            ele[ele._private.selected?\"deselect\":\"select\"]();\n                        });\n                    chart.endBatch();\n                },\n                \"invertAll\": function(){\n                    chart.startBatch();\n                    chart.$('node[nodeType=\"patient\"]')\n                        .forEach( function(ele){\n                            ele[ele._private.selected?\"deselect\":\"select\"]();\n                        });\n                    chart.$('node[nodeType=\"gene\"]')\n                        .forEach( function(ele){\n                            ele[ele._private.selected?\"deselect\":\"select\"]();\n                        });\n                    chart.endBatch();\n                },\n                \"deselectAll\" : function(){\n                    chart.startBatch();\n                    chart.$('node:selected')\n                        .forEach( function(ele){\n                            ele.deselect();\n                        });\n                    chart.endBatch();\n                },\n                \"hideAllEdges\" : function(){\n                    var degmap = {};\n                    chart.$('edge[edgeType!=\"chromosome\"]').forEach(function(item){\n                        this[item.id()] = {display:'none'};\n                    }, degmap);\n                    chart.batchData(degmap);\n                }\n            };\n        }\n        function initializeViewModel(vm, $stateParams){\n\n            vm.datasource = $stateParams.datasource;\n            vm.optCommandGene = false;\n            vm.optCtxGeneShow;\n            vm.optCommandPatient;\n            vm.optCtxPatientShow = false;\n            vm.optInteractiveModes;\n            vm.optInteractiveMode;\n            vm.optPatientLayouts;\n            vm.optPatientLayout;\n            vm.optNodeColors;\n            vm.optNodeColor;\n            vm.optEdgeColors;\n            vm.legandNodes;\n            vm.legandPatient;\n            vm.legandChromosomes;\n            vm.searchGene;\n            vm.searchGeneResult = \"\";\n            vm.searchPatient;\n            vm.searchPatientResult = \"\";\n            vm.optCohortModes;\n            vm.optCohortMode = \"\";\n            vm.optCohortPatients;\n            vm.optCohortPatient;\n            vm.optCohortGenes;\n            vm.optCohortGene;\n            vm.optCommands;\n            vm.patient;\n            vm.gene;\n            vm.frame;\n            return vm;\n        }\n        function initializeHistory(chart, osHistory, _){\n\n            // History Integration\n            // var skipSave = false;\n            var selectedGeneIds = (osHistory.getGeneSelection() == null) ? null : osHistory.getGeneSelection().ids;\n            var selectedPatientIds = (osHistory.getPatientSelection() == null) ? null : osHistory.getPatientSelection().ids;\n            var skipSaveGene = false;\n            var skipSavePatient = false;\n\n            function saveSelectedGenes(){\n                if (skipSaveGene) { skipSaveGene = false; return; }\n                var ids = chart.$('node[nodeType=\"gene\"]:selected').map(function(ele){ return ele.data().id.toUpperCase() });\n                osHistory.addGeneSelection(\"Markers + Patients\", \"Manual\", ids);\n            \n            }\n            function saveSelectedPatients(){\n                if (skipSavePatient) { skipSavePatient = false; return; }\n                var ids = chart.$('node[nodeType=\"patient\"]:selected').map(function(ele){ return ele.data().id.toUpperCase() });\n                osHistory.addPatientSelection(\"Markers + Patients\", \"Manual\", ids);\n            }\n\n            function setSelectedGenes(){\n                skipSaveGene = true;\n\n                var degmap;\n                chart.startBatch();\n                if (selectedGeneIds==null){\n                    chart.$('node[nodeType=\"gene\"]:selected')\n                            .forEach( function(ele){\n                                ele.deselect();\n                                degmap[ele.id()] = {display:'element'};\n                            }, degmap);\n                }else{\n                    chart.$('node[nodeType=\"gene\"]')\n                        .forEach( function(ele){\n                            ele[ (this.indexOf(ele.id())==-1) ? \"deselect\" : \"select\"]();\n                        }, selectedGeneIds);\n                }\n                chart.batchData(degmap);\n                chart.endBatch();\n            }\n            function setSelectedPatients(){\n                skipSavePatient = true;\n\n                var degmap;\n                chart.startBatch();\n                if (selectedPatientIds==null){\n                    chart.$('node[nodeType=\"patient\"]:selected')\n                            .forEach( function(ele){\n                                ele.deselect();\n                                degmap[ele.id()] = {display:'element'};\n                            }, degmap);\n                }else{\n                    chart.$('node[nodeType=\"patient\"]')\n                        .forEach( function(ele){\n                            ele[ (this.indexOf(ele.id())==-1) ? \"deselect\" : \"select\"]();\n                        }, selectedPatientIds);\n                }\n                chart.batchData(degmap);\n                chart.endBatch();\n            }\n\n            osHistory.onGeneSelectionChange.add(function(selection){\n                selectedGeneIds = (selection==null) ? null : selection.ids;\n                setSelectedGenes();\n            });\n            osHistory.onPatientSelectionChange.add(function(selection){\n                selectedPatientIds = (selection==null) ? null : selection.ids;\n                setSelectedPatients();\n            });\n\n            setSelectedGenes();\n            setSelectedPatients();\n            chart.on('select', 'node[nodeType=\"gene\"]', _.debounce(saveSelectedGenes, 300));\n            chart.on('select', 'node[nodeType=\"patient\"]', _.debounce(saveSelectedPatients, 300));\n\n            return {\n                saveGenes: saveSelectedGenes,\n                savePatients: saveSelectedPatients\n            };\n        }\n\n        function initializeChart(data, styles, cytoscape, el){\n            // Initalize Cytoscape Chart\n            // If performance becomes an issue set *Viewport attributes to true\n            return cytoscape({\n                container: el,\n                elements: data,\n                style: styles,\n                hideEdgesOnViewport: false,\n                hideLabelsOnViewport: false,\n                textureOnViewport: false,\n                motionBlur: true,\n                minZoom: .05,\n                maxZoom: 40,\n                layout: {\n                    name: \"preset\",\n                    fit: true\n                }\n            });\n        }\n\n        function initializeStyles(){\n            // Unlike CSS order of operations is determined by order\n            // Play specific attention to use of data() + mapdata() values they are dynamic\n            // Care should be taken not to update styles directly in code, but to use underlying data model\n            // Cytoscape Dynamic Style Properties Include\n            /*\n                display\n                color\n                sizeEle\n                sizeLbl\n                posX\n                posY\n                hobo\n                patient\n            */\n            return [\n            {\n                selector: 'core',\n                style:{\n                    'selection-box-color': '#3993fa',\n                    'selection-box-border-color': '#3993fa',\n                    'selection-box-border-width': '1px',\n                    'selection-box-opacity': '.2'\n                }\n            },\n            {\n                selector: 'node',\n                style: {\n                    'display': \"data(display)\",\n                    'height': \"mapData(sizeEle, 0, 50, 10, 100)\",\n                    'width': \"mapData(sizeEle, 0, 50, 10, 100)\",\n                    'font-size': 'data(sizeLbl)',\n                    'text-valign': 'center'\n                }\n            }, {\n                selector: 'node[nodeType=\"patient\"]',\n                style: {\n                    'background-color': 'data(color)',\n                    'text-halign': 'center',\n                    'border-width': 1,\n                    'border-color': '#FFFFFF'\n                }\n            }, {\n                selector: 'node[nodeType=\"patient\"]:selected',\n                style: {\n                    'border-color': \"#FF0000\",\n                    'border-width': 10\n                }\n            }, {\n                selector: 'node[nodeType=\"gene\"]',\n                style: {\n                    'background-color': \"#FFFFFF\",\n                    'border-color': \"#38347b\",\n                    'text-halign': \"right\",\n                    'label': \"data(id)\",\n                    'border-width': 'data(sizeBdr)'\n                }\n            }, {\n                selector: 'node[nodeType=\"gene\"]:selected',\n                style: {\n                    'border-color': \"#FF0000\",\n                    'border-width': 10\n                }\n            },{\n                selector: 'node[nodeType=\"centromere\"]',\n                style:{\n                    'font-size': '24px',\n                    'text-halign': 'center',\n                    'background-color': \"#3993fa\",\n                    'color':\"#FFFFFF\",\n                    'border-color': 'rgb(19, 150, 222)',\n                    'height': '40px',\n                    'width': '120px',\n                    'shape': 'roundrectangle',\n                    'label': \"  data(id)\"\n                }\n            },{\n                selector: 'edge',\n                style:{\n                    'display': \"data(display)\",\n                    'line-color': \"data(color)\",\n                    'width': \"data(sizeEle)\"\n                }\n            }];\n        }\n\n        function initializeEvents(chart, vm, $scope, $timeout, osApi, signals){\n\n            // Create Signals\n            var events = (function(signals) {\n                var geneOver = new signals.Signal();\n                var geneOut = new signals.Signal();\n                var geneClick = new signals.Signal();\n                var geneCtx = new signals.Signal();\n                var patientOver = new signals.Signal();\n                var patientOut = new signals.Signal();\n                var patientClick = new signals.Signal();\n                var patientCtx = new signals.Signal();\n                var removeAll = function() {\n                    geneOver.removeAll();\n                    geneOut.removeAll();\n                    geneClick.removeAll();\n                    geneCtx.removeAll();\n                    patientOver.removeAll();\n                    patientOut.removeAll();\n                    patientClick.removeAll();\n                    patientCtx.removeAll();\n                }\n                var over = function(e) {\n                    geneOver.add(e);\n                    patientOver.add(e);\n                };\n                var out = function(e) {\n                    geneOut.add(e);\n                    patientOut.add(e);\n                }\n                var click = function(e) {\n                    geneClick.add(e);\n                    patientClick.add(e);\n                }\n                return {\n                    geneOver: geneOver,\n                    geneOut: geneOut,\n                    geneClick: geneClick,\n                    geneCtx: geneCtx,\n                    patientOver: patientOver,\n                    patientOut: patientOut,\n                    patientClick: patientClick,\n                    patientCtx: patientCtx,\n                    over: over,\n                    out: out,\n                    click: click,\n                    removeAll: removeAll\n                };\n            })(signals);\n\n            // Attach Event Signals To Real Events\n            chart\n                .on('click', 'node[nodeType=\"gene\"]', events.geneClick.dispatch)\n                .on('click', 'node[nodeType=\"patient\"]', events.patientClick.dispatch)\n                .on('mouseover', 'node[nodeType=\"gene\"]', events.geneOver.dispatch)\n                .on('mouseover', 'node[nodeType=\"patient\"]', events.patientOver.dispatch)\n                .on('mouseout', 'node[nodeType=\"gene\"]', events.geneOut.dispatch)\n                .on('mouseout', 'node[nodeType=\"patient\"]', events.patientOut.dispatch)\n                .on('cxttap', 'node[nodeType=\"gene\"]', events.geneCtx.dispatch )\n                .on('cxttap', 'node[nodeType=\"patient\"]', events.patientCtx.dispatch );\n                \n\n            // Cache Hide All Edges Structure\n            var hidePatientEdges = {};\n            chart.$('edge[edgeType!=\"chromosome\"]')\n                .forEach(function(node){ this[node.id()] = { display: 'none' };}, hidePatientEdges);\n                    \n            // Define Behaviors\n            var behaviors = {\n                showGeneCtxMenu: function(e){\n                    vm.optCommandGene.selected = e.cyTarget;\n                    var oe = e.originalEvent;\n                    var elMenu = angular.element(\"#gene-ctx-menu\");\n                    elMenu.show();\n                    $scope.$apply(function(){\n                        vm.optCtxGeneShow = true;\n                    });\n                    elMenu.css({left: oe.pageX-20, top: oe.pageY-20});\n                    elMenu.find(\".title\").text(vm.optCommandGene.selected.data().name);\n                    return this;\n                },\n                showPatientCtxMenu: function(e){\n                    vm.optCommandPatient.selected = e.cyTarget;\n                    var oe = e.originalEvent;\n                    var elMenu = angular.element(\"#patient-ctx-menu\");\n                    elMenu.show();\n                    $scope.$apply(function(){\n                        vm.optCtxPatientShow = true;\n                    });\n                    elMenu.css({left: oe.pageX-20, top: oe.pageY-20});\n                    elMenu.find(\".title\").text(vm.optCommandPatient.selected.data().name);\n                    return this;\n                },\n                showPatientInfo: function(e){\n                    if (e.cyTarget.data().nodeType == 'patient') {\n                        vm.patient = e.cyTarget.attr('patient');\n                        vm.patientChromosomes = e.cyTarget.neighborhood(\"node\")\n                            .map(function(item) { return item.data().id });\n                        $scope.$apply();\n                    }else{\n                        var gene = {\n                            name: e.cyTarget.data().name,\n                            mutation: e.cyTarget.neighbourhood(\"edge[edgeType='mutation']\").length,\n                            cnl1: e.cyTarget.neighbourhood(\"edge[edgeType='cnLoss.1']\").length,\n                            cnl2: e.cyTarget.neighbourhood(\"edge[edgeType='cnLoss.2']\").length,\n                            cng1: e.cyTarget.neighbourhood(\"edge[edgeType='cnGain.1']\").length,\n                            cng2: e.cyTarget.neighbourhood(\"edge[edgeType='cnGain.2']\").length\n                        }\n                        gene.mutations = gene.cnl1 + gene.cnl2 + gene.cng1 + gene.cng2;\n                        vm.gene = gene;\n                        $scope.$apply();\n                    }\n                    return this;\n                },\n                hidePatientInfo: function(){\n                    $scope.$apply(function() {\n                        vm.gene = vm.patient = vm.patientChromosomes = null;\n                    });\n                    return this;\n                },\n                showDegreeOne: function(e){\n                    var degmap = {};\n                    var target = (e.cyTarget.data().nodeType == 'patient') ? 'target' : 'source';\n\n                    chart.startBatch();\n                    e.cyTarget.neighborhood('edge')\n                        .forEach(function(item){\n                            this.degmap[item.id()] = {display:'element'};\n                            item[this.target]().css({\n                                'background-color':item.data().color,\n                                'border-color': item.data().color,\n                                'border-width': 60,\n                                'border-opacity': .3\n                            });\n                        }, {degmap:degmap, target:target});\n                    chart.endBatch();\n                    chart.batchData(degmap);\n                },\n                hideDegreeOne: function(e){\n                    var degmap = {};\n                    var target = (e.cyTarget.data().nodeType == 'patient') ? 'target' : 'source';\n                    var css = { \n                        'background-color': \"\",\n                        'border-color': \"\",\n                        'border-width': \"\",\n                        'border-opacity': \"\"\n                    }\n                    chart.startBatch();\n                    e.cyTarget.neighborhood('edge')\n                        .forEach(function(item){\n                            this.degmap[item.id()] = {display:'none'};\n                            item[target]().style(this.css);\n                        }, {degmap:degmap, css:css, target:target});\n                    chart.endBatch();                        \n                    chart.batchData(degmap);\n                },\n                showDegreeTwo: function(e){\n                    var degmap = {};\n                    e.cyTarget.neighborhood('node')\n                        .forEach(function(node){\n                            node.neighborhood('edge')\n                                .forEach(function(item){\n                                    this[item.id()] = {display:'element'};\n                            }, this);\n                        }, degmap);\n                    chart.batchData(degmap);\n                },\n                hideDegreeTwo: function(e){\n                    var degmap = {};\n                    e.cyTarget.neighborhood('node')\n                        .forEach(function(node){\n                            node.neighborhood('edge')\n                                .forEach(function(item){\n                                    this[item.id()] = {display:'none'};\n                            }, this);\n                        }, degmap);\n                    chart.batchData(degmap);\n                }\n            }\n\n            // Use States To Associate Events + Behaviors\n            var states = [\n            {\n                name: 'Commands', //1° When \n                register: function(){\n                    events.geneCtx.add(behaviors.showGeneCtxMenu);\n                    events.patientCtx.add(behaviors.showPatientCtxMenu);\n                    events.over(function(e) {\n                        behaviors.showPatientInfo(e)\n                    });\n                    events.out(function(e) {\n                        behaviors.hidePatientInfo(e);\n                    });\n                },\n                unregister: function(){\n\n                    // Hide All Edges\n                    events.removeAll();\n                    chart.batchData(hidePatientEdges);\n                }\n\n            },\n            {\n                name: 'Selection Highlight', //1° When \n                register: function(){\n                    var degmap = {};\n                    chart.$('node[nodeType=\"patient\"]:selected')\n                        .forEach(function(node) {\n                            node.neighborhood('edge').forEach( function(edge) {\n                                this[edge.id()] = { display: 'element' };\n                            }, degmap)\n                        }, degmap);\n                    chart.batchData(degmap);\n                    chart.on('select', 'node', {ui:true}, function(e){\n                        behaviors.showDegreeOne(e);\n                    });\n                    chart.on('unselect','node',{ui:true}, function(e){\n                        behaviors.hideDegreeOne(e);\n                    });\n                    events.over(function(e) {\n                        behaviors.showPatientInfo(e)\n                    });\n                    events.out(function(e) {\n                        behaviors.hidePatientInfo(e);\n                    });\n\n                },\n                unregister: function(){\n\n                    // Hide All Edges\n                    chart.batchData(hidePatientEdges);\n                    chart.off('select', 'node');\n                    chart.off('unselect', 'node');\n                }\n\n            },\n            {\n                name: 'Roll Over Highlight', //1° On \n                register: function() {\n                    // events.click(function(e) {\n                    //     behaviors\n                    //         .showOncoPrint(e)\n                    // });\n                    events.over(function(e) {\n                        behaviors\n                            .showPatientInfo(e)\n                            .showDegreeOne(e)\n                        \n                    });\n                    events.out(function(e) {\n                        behaviors\n                            .hidePatientInfo(e)\n                            .hideDegreeOne(e)\n                    });\n                },\n                unregister: function() {\n                    events.removeAll();\n                }\n            }\n          ];\n\n            vm.optInteractiveModes = states;\n            vm.optInteractiveMode = vm.optInteractiveModes[0];\n\n            // What Scope To Initialize Behaviors\n            $scope.$watch(\"vm.optInteractiveMode\", function(next, prev) {\n                if (angular.isDefined(prev)) prev.unregister();\n                if (angular.isDefined(next)) next.register();\n            });\n        }\n\n        function initializeEdgeColors(chart, vm, $scope, $timeout){\n\n            // Set Edge Options\n            var colors = [{ \n                    name: 'mutation',\n                    class: 'edgeMutation',\n                    color: '#004358',\n                    state: 'Highlight'\n                }, {\n                    name: 'cnGain.1',\n                    class: 'edgeCnGain1',\n                    color: '#1F8A70',\n                    state: 'Highlight'\n                }, {\n                    name: 'cnLoss.1',\n                    class: 'edgeCnLoss1',\n                    color: '#BEDB39',\n                    state: 'Highlight'\n                }, {\n                    name: 'cnGain.2',\n                    class: 'edgeCnGain2',\n                    color: 'purple', //'#FFE11A',\n                    state: 'Highlight'\n                }, {\n                    name: 'cnLoss.2',\n                    class: 'edgeCnLoss2',\n                    color: '#FD7400',\n                    state: 'Highlight'\n                }];\n            var colorMap = {\n                'mutation' : colors[0],\n                'cnGain.1' : colors[1],\n                'cnLoss.1' : colors[2],\n                'cnGain.2' : colors[3],\n                'cnLoss.2' : colors[4]\n            };\n\n            // Default colors\n            $timeout(function(){\n                colors.forEach(function(item){\n                    angular.element(\".\" + item.class).css(\"border-color\", item.color);\n                });\n                var degmap = {};\n                chart.edges('edge[edgeType!=\"chromosome\"]')\n                    .forEach(function(edge){\n                        this[edge.id()] = {'color':colorMap[edge.data(\"edgeType\")].color, sizeEle:3};\n                    }, degmap);\n                chart.batchData(degmap);\n            });\n\n            vm.optEdgeColors = colors;\n\n            // Update Edge Callback\n            vm.updateEdge = function(item, stateName){\n                if (item.state == stateName) return;\n                item.state = stateName;\n                var state;\n                switch(stateName){\n                    case \"Highlight\":\n                        state = {'color':item.color, sizeEle:3};\n                        break;\n                    case \"Hide\":\n                        state = {'color':'#FFFFFF', sizeEle:0};\n                        break;\n                    case \"Show\":\n                        state = {'color':'#3993fa', sizeEle:3};\n                        break;\n                }\n\n                // Set Legand color\n                angular.element(\".\" + item.class).css(\"border-color\", state.color );\n\n                // update Degree Map\n                var degmap = {};\n                chart.edges('edge[edgeType=\"'+item.name+'\"]')\n                    .forEach(function(edge){\n                        \n                        this.degmap[edge.id()] = this.state;\n                    }, {degmap:degmap, state:state});\n                chart.batchData(degmap);\n\n            }\n        }\n\n        function initializeZoom(chart, _){\n            chart.on('pan', _.debounce(function(e) {\n                var zoom = Math.max(e.cy.zoom(), 1);\n                var degmap = {};\n                var font = Math.ceil(Math.max(12/zoom, 1));\n                var sizeBdr = Math.ceil(Math.max(5/zoom, .5));\n                chart.nodes().forEach(function(node){\n                    this.degmap[node.id()] = {\n                        sizeEle: (node.degree()/this.zoom),\n                        sizeLbl: font,\n                        sizeBdr:sizeBdr\n                    };\n                }, { degmap:degmap, zoom:zoom, font:font, sizeBdr:sizeBdr });\n                chart.batchData(degmap);\n            }, 300));\n        }\n\n        function initializeNodeColors(chart, vm, $scope, osApi, $timeout, _){\n            function calculateSelections(){\n                var selectedNodes = chart.$('node[nodeType=\"patient\"]:selected');\n                var sums = {};\n                \n                // Calculate Sums\n                selectedNodes.each(function(index, node){\n                    if ( angular.isUndefined(sums[node.data().color]) ) sums[node.data().color] = 1;\n                    else sums[node.data().color] += 1;\n                });\n\n                // Populate Legand\n                $timeout(function(){\n                    for (var i=0; i<vm.legandNodes.length; i++){\n                        var color = vm.legandNodes[i].color;\n                        vm.legandNodes[i].cnt = angular.isDefined(sums[color]) ? sums[color] : 0;\n                    }\n                });\n            }\n            // Debounce To Avoid Multiple Calls\n            chart.on('select', _.debounce(calculateSelections, 300));\n            chart.on('unselect', _.debounce(calculateSelections, 300))\n            \n            \n            osApi.getSampleCategorizationNames().then(function(response) {\n                var optNodeColors =  [{name: 'Default'},{name: 'Gender'},{name: 'Age At Diagnosis'}];\n                if (angular.isDefined(response.payload.length)){\n                    optNodeColors = optNodeColors.concat( response.payload\n                        .map(function(item) { return {'name': item} }));\n\n                }\n                vm.optNodeColors = optNodeColors;\n                vm.optNodeColor = vm.optNodeColors[0];\n                $scope.$watch(\"vm.optNodeColor\", function(){\n                    var degmap = {};\n                    switch(vm.optNodeColor.name){\n                        case \"Default\":\n                            vm.legandNodes = [{name:'Patients', color:'#3993fa', cnt:0}];\n                            chart.$('node[nodeType=\"patient\"]')\n                                .forEach(function(node){\n                                    degmap[node.id()] = {color:'#3993fa'};\n                                });\n                            chart.batchData(degmap);\n                            break;\n                        case \"Gender\":\n                            vm.legandNodes = [{name:'Male', color:'purple', cnt:0}, {name:'Female', color:'green', cnt:0}];\n                            chart.$('node[nodeType=\"patient\"]')\n                                .forEach(function(node){\n                                    try{\n                                        var gender = node.data(\"patient\")[0][2];\n                                        degmap[node.id()] = {color: (gender==='male') ? 'purple' :  'green' };\n                                    }catch(e){\n                                        degmap[node.id()] = {color: '#EEEEEE'};\n                                    }\n                                });\n                            chart.batchData(degmap);\n                            break;\n                        case \"Age At Diagnosis\":\n                            vm.legandNodes = [{name:'Young', color:'green', cnt:0}, {name:'Old', color:'red', cnt:0}];\n                            chart.$('node[nodeType=\"patient\"]')\n                                .forEach(function(node){\n                                    try{\n                                        var age = Number(node.data(\"patient\")[0][4]);\n                                        degmap[node.id()] = {color: 'rgb(' + ((255 * age) / 100) + ',' + ((255 * (100 - age)) / 100) + ',0)'};\n                                    }catch(e){\n                                        degmap[node.id()] = {color: '#000000'};\n                                    }\n                                });\n                            chart.batchData(degmap);\n                            break;\n                        default:\n                            osApi.getSampleCategorization(vm.optNodeColor.name).then(function(response) {\n                                vm.legandNodes = response.payload.tbl\n                                    .map(function(e) {return e[0] + \"|\" + e[1]; })\n                                    .filter(function(v, i, s) { return s.indexOf(v) === i; })\n                                    .map(function(e) { var p = e.split(\"|\");\n                                        return { 'name': p[0], 'color': p[1] , cnt:0} });\n\n                                    var rows = response.payload.rownames;\n                                    var tbl = response.payload.tbl;\n                                    var nodes = chart.$('node[nodeType=\"patient\"]');\n\n                                    // Revisit This.  Would be faster to not loop.\n                                    for (var i=0; i<nodes.length; i++){\n                                        var id = nodes[i].id();\n                                        degmap[id] = {color:'#DDDDDD'}\n                                        for (var ii=0; ii<rows.length; ii++){\n                                            if (id==rows[ii]){\n                                                degmap[id] = {color:tbl[ii][1]}\n                                            }\n                                        }\n                                    }\n                                    chart.batchData(degmap);\n                                });\n                            break;\n                        }\n                        calculateSelections();\n                    });\n            });\n\n            vm.updateNode = function(item, select){\n                chart.startBatch();\n                chart.nodes('node[nodeType=\"patient\"]')\n                    .forEach(function(node){ \n                        if (node.style(\"background-color\")==item.color) node[(select)?\"select\":\"deselect\"]();\n                });\n                chart.endBatch();\n            }\n        }\n\n        function initializeLayouts(chart, vm, $scope){\n            vm.optPatientLayouts = [{name: 'Hobo'},{name: 'Age At Diagnosis'}]; //,{name: 'Gender'}\n            vm.optPatientLayout = vm.optPatientLayouts[0];\n            $scope.$watch('vm.optPatientLayout', function(layout){                \n                var nodes = chart.nodes('node[nodeType=\"patient\"]');\n                chart.startBatch();\n                switch (layout.name){\n\n                    // Hobo Chart Positions Are Sent From Server In Initial Dataset + Cached Load\n                    case \"Hobo\":\n                        nodes.forEach(function(node){ \n                            node.position(node.data(\"hobo\")); \n                        });\n                        break;\n\n                    // Age At Dx Comes From Patient Table\n                    case \"Age At Diagnosis\":\n                        nodes.forEach(function(node){\n                            try{\n                                var age = Number(node.data(\"patient\")[0][4]);\n                                age = age.map(0, 100, -3000, 3000);\n                                node.position({\n                                    y: age, \n                                    x: (Math.pow(age, 2) / 5000) - 200\n                                });\n                            }catch(e){\n                                node.position({x:100,y:0});\n                            }\n                        });\n                        break;\n\n                    // Gender Comes From Patient Table\n                    case \"Gender\":\n                        nodes\n                            .filter(function(index, node){\n                                try{ return (node.data(\"patient\")[0][2].toLowerCase()=='male')}\n                                catch(e){ return false; }\n                            })\n                            .forEach(function(node, index){\n                                var a = 10;\n                                var b = 100;\n                                var angle = 0.1 * (index+1);\n                                var x = -1000 + (a+b * angle) * Math.cos(angle);\n                                var y = -1200 + (a+b * angle) * Math.sin(angle);\n                                node.position({\n                                    x: x,\n                                    y: y\n                                });\n                            });\n                        nodes\n                            .filter(function(index, node){\n                                return angular.isUndefined(node.data(\"patient\")[0])\n                            })\n                            .forEach(function(node, index){\n                                var a = 400;\n                                var b = 400;\n                                var angle = 0.1 * (index+1);\n                                var x = -2500 + (a+b * angle) * Math.cos(angle);\n                                var y = 0 + (a+b * angle) * Math.sin(angle);\n                                node.position({\n                                    x: x,\n                                    y: y\n                                });\n                            });\n                        nodes\n                            .filter(function(index, node){\n                                try{ return (node.data(\"patient\")[0][2].toLowerCase()=='female')}\n                                catch(e){ return false; }\n                            })\n                            .forEach(function(node, index){\n                                var a = 400;\n                                var b = 400;\n                                var angle = 0.1 * (index+1);\n                                var x = -1000 + (a+b * angle) * Math.cos(angle);\n                                var y = 1200 + (a+b * angle) * Math.sin(angle);\n                                node.position({\n                                    x: x,\n                                    y: y\n                                });\n                            });\n                        break;\n                }\n                chart.endBatch();\n            });\n        }\n\n        function loadData(osApi, vm, cb){\n            // Today multiple nested data calls are nessisary to obtain all the data to render the chart\n            // Future server refactor should be done to limit number of calls and preformat data\n            osApi.setDataset(vm.datasource).then(function() {\n\n                // Patient Data\n                osApi.getPatientHistoryTable(vm.datasource).then(function(response) {\n                    var dataPatients = response.payload.tbl;\n\n                    // Marker Data\n                    osApi.getMarkersNetwork(response.payload).then(function(response) {\n                        var dataMarkers = angular.fromJson(response.payload).elements;\n\n                        // Process Patient Nodes (Save Hobo Positions + Patient History Info + Color + SizeEle + SizeLbl)\n                        dataMarkers.nodes\n                            .filter(function(item) { return item.data.nodeType === 'patient'; })\n                            .map(function(value) {\n                                var data = value.data;\n                                data.display = \"element\";\n                                data.color = \"#FFFF00\"; //\"rgb(19, 150, 222)\";\n                                data.sizeEle = data.degree;\n                                data.sizeLbl = 12;\n                                data.sizeBdr = 5;\n                                data.hobo = {x: value.position.x, y: value.position.y};\n                                data.patient = this.filter(function(item){ return item[0]===value.data.id });\n                            }, dataPatients);\n\n                        // Process Non Patient Nodes\n                        dataMarkers.nodes\n                            .filter(function(item) {  return  item.data.nodeType != 'patient'; })\n                            .map(function(value){\n                                var data = value.data;\n                                data.display = \"element\";\n                                data.color = \"rgb(19, 150, 222)\";\n                                data.sizeEle = data.degree;\n                                data.sizeLbl = 12;\n                                data.sizeBdr = 5;\n                                value.locked = (value.data.nodeType!==\"gene\");\n                                value.selectable = (value.data.nodeType===\"gene\");\n                                value.grabbable = (value.data.nodeType===\"gene\");\n                                return value;\n                            });\n\n                        // Process Edges\n                        dataMarkers.edges\n                            .map(function(value){\n                                var data = value.data;\n                                data.display = (data.edgeType==\"chromosome\") ? \"element\" : \"none\";\n                                data.color = \"rgb(19, 150, 222)\";\n                                data.sizeEle = 3;\n                                data.sizeLbl = 12;\n                                value.locked = true;\n                                value.selectable = false;\n                                value.grabbable = false;\n                                return value;\n                            });\n\n                        // Call Back\n                        cb(dataMarkers);\n                    });\n                });\n            });\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osLogin', login);\n\n\n    /** @ngInject */\n    function login() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/login/login.html',\n            replace: true,\n            controller: LoginController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function LoginController(osApi, $state) {\n            \n            var userApi = osApi.getUserApi();\n\n            var vm = this;\n            vm.domains = userApi.getDomains();\n            vm.user = userApi.getUser();\n            vm.hasError = false;\n\n            vm.login = function() {\n                var promise = userApi.login(vm.user);\n                if (angular.isDefined(promise)){\n                    promise.then(function() {\n                        if (vm.user.authenticated) {\n                            $state.go(\"datasource\");\n                        } else {\n                            vm.hasError = true;\n                        }\n                    });\n                }else{\n                    $state.go(\"datasource\");\n                }\n                \n            }\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osLoader', login);\n\n    /** @ngInject */\n    function login() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/loader/loader.html',\n            replace: true\n        };\n\n        return directive;\n    }\n\n})();\n\n(function() {\n    'use strict';\n    angular\n        .module('oncoscape')\n        .directive('osLanding', landing);\n\n    /** @ngInject */\n    function landing() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/landing/landing.html',\n            replace: true,\n            controller: LandingController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function LandingController($state) {\n            var vm = this;\n            vm.login = function() {\n                $state.go(\"login\");\n            }\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osHistory', history);\n\n    /** @ngInject */\n    function history() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/history/history.html',\n            controller: HistoryController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function HistoryController(osApi, osHistory, $state, $timeout, $scope, moment, $stateParams, _) {\n\n            $scope.$on(\"$destroy\", function() {\n                vm.applyFilter(\"Exit\");\n                osHistory.removeListeners();\n            });\n\n            if (angular.isUndefined($stateParams.datasource)) {\n                $state.go(\"datasource\");\n                return;\n            }\n            // Properties\n            var dtTable;\n            var rawData;\n            var data;\n            var selectedIds = (osHistory.getPatientSelection() == null) ? null : osHistory.getPatientSelection().ids;\n\n            // View Model\n            var vm = this;\n            vm.datasource = $stateParams.datasource;\n            vm.filter;\n            vm.colnames = [];\n            vm.diagnosisMin = vm.diagnosisMinValue = 1;\n            vm.diagnosisMax = vm.diagnosisMaxValue = 99;\n            vm.survivalMin = vm.survivalMinValue = 0;\n            vm.survivalMax = vm.survivalMaxValue = 10;\n            vm.search = \"\";\n\n\n            vm.applyFilter = function(filter) {\n                selectedIds = null;\n                var o = dtTable._('tr', {\n                    \"filter\": \"applied\"\n                }).map(function(item) {\n                    return item[0].toString().toUpperCase()\n                });\n                o = angular.map(o, function(value) {\n                    return [value];\n                });\n                osHistory.addPatientSelection(\"Patient History\", filter, o);\n                dtTable.api().draw();\n            };\n\n\n            function draw() {\n\n                if (angular.isUndefined(dtTable)) return;\n                dtTable.fnClearTable();\n                data = rawData.tbl;\n                if (data.length == 0) return;\n                var d = data.map(function(d) {\n                    return d[4];\n                });\n                var s = data.map(function(d) {\n                    return d[3];\n                });\n\n                // Override Datatables Default Search Function - More Efficent Than Using Angular Bindings\n                angular.element.fn.DataTable.ext.search = [function(settings, data) {\n                    var survival = parseFloat(data[3]);\n                    var diagnosis = parseFloat(data[4]);\n                    if (selectedIds != null) {\n                        if (selectedIds.indexOf(data[0]) == -1) return false;\n                    }\n                    if (isNaN(survival) || isNaN(diagnosis)) return false;\n                    return (diagnosis >= vm.diagnosisMin &&\n                        diagnosis < (vm.diagnosisMax + 1) &&\n                        survival >= vm.survivalMin &&\n                        survival < (vm.survivalMax + 1));\n\n                }];\n                $timeout(function() {\n                    vm.diagnosisMin = vm.diagnosisMinValue = Math.floor(Math.min.apply(null, d));\n                    vm.diagnosisMax = vm.diagnosisMaxValue = Math.ceil(Math.max.apply(null, d));\n                    vm.survivalMin = vm.survivalMinValue = Math.floor(Math.min.apply(null, s));\n                    vm.survivalMax = vm.survivalMaxValue = Math.floor(Math.max.apply(null, s));\n                    dtTable.fnAddData(data);\n                    dtTable.api().draw();\n                });\n\n            }\n\n            // Load Datasets\n            osApi.setBusy(true);\n            osApi.setDataset(vm.datasource).then(function() {\n                osApi.getPatientHistoryTable(vm.datasource).then(function(response) {\n                    rawData = response.payload;\n                    vm.colnames = rawData.colnames;\n                    $timeout(function() {\n\n                        // Configure Data Table\n                        dtTable = angular.element('#history-datatable').dataTable({\n                            \"paging\": false\n                        });\n\n                        // Register History Component\n                        osHistory.onPatientSelectionChange.add(function(selection) {\n                            selectedIds = selection.ids;\n                            vm.diagnosisMin = vm.diagnosisMinValue;\n                            vm.diagnosisMax = vm.diagnosisMaxValue;\n                            vm.survivalMin = vm.survivalMinValue;\n                            vm.survivalMax = vm.survivalMaxValue;\n                            vm.search = \"\";\n                            $scope.$apply();\n                            dtTable.api().draw();\n                        });\n\n                        // Register Search Watch\n                        var init = true;\n                        $scope.$watch('vm.search', _.debounce(function() {\n                            if (init) {\n                                init = false;\n                                return;\n                            }\n                            dtTable.api().search(vm.search).draw();\n                        }, 1000));\n                        draw();\n                        osApi.setBusy(false);\n                    }, 0, false);\n                });\n            });\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osHelp', help);\n\n    /** @ngInject */\n    function help() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/help/help.html',\n            controller: HelpController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function HelpController() {\n            var vm = this;\n           vm.videos = [\n               {\n                    name: 'Oncoscape + Github',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               },\n               {\n                    name: 'Creating Cohorts',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               },\n               {\n                    name: 'Patients + Markers',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               },\n               {\n                    name: 'Timelines',\n                    desc: 'Description Lorum Ipsum eos et sid al accusamus et iusto odio',\n                    img: ''\n               }\n           ]\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osFooter', footer);\n\n    /** @ngInject */\n    function footer() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/footer/footer.html',\n            controller: FooterController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function FooterController() {\n            //var vm = this;\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osHeader', header);\n\n    /** @ngInject */\n    function header() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/header/header.html',\n            scope: {},\n            controller: HeaderController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function HeaderController(osApi, $stateParams, $state, $timeout) {\n\n            \n            osApi.onDataSource.add(function(){\n                $timeout(function(){\n                    vm.showTools = true;\n                });\n            });\n\n            var userApi = osApi.getUserApi();\n            userApi.onLogin.add(function(){\n                $timeout(function(){\n                    vm.showMenu = true;\n                });\n            })\n            userApi.onLogout.add(function(){\n                $timeout(function(){\n                    vm.showMenu = false;\n                });\n            })\n           \n            var vm = this;\n            vm.showMenu = false;\n            vm.showTools = false;\n              \n            vm.toolsClick = function(){\n                $state.go(\"tools\", {\n                    datasource: osApi.getDataSource()\n                });\n            };\n            \n            vm.cohortClick = function() {\n                osApi.toggleFilter();\n            };\n            \n            vm.logoutClick = function(){\n               userApi.logout();\n               $state.transitionTo(\"landing\");\n            }\n        }\n    }\n\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .directive('osCompare', header);\n\n    /** @ngInject */\n    function header() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/compare/compare.html',\n            controller: CompareController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function CompareController() {\n            //var vm = this;\n        }\n    }\n\n})();\n\n(function() {\n    'use strict';\n    \n    angular\n        .module('oncoscape')\n        .directive('osDatasource', datasource);\n\n    /** @ngInject */\n    function datasource() {\n\n        var directive = {\n            restrict: 'E',\n            templateUrl: 'app/components/datasource/datasource.html',\n            controller: DatasourceController,\n            controllerAs: 'vm',\n            bindToController: true\n        };\n\n        return directive;\n\n        /** @ngInject */\n        function DatasourceController(osApi, $state) {\n            var vm = this;\n            vm.datasets = [];\n            vm.explore = function(tool, datasource) {\n                osApi.setDataSource(datasource);\n                $state.go(tool, {\n                    datasource: datasource\n                });\n            };\n\n            var nameMap = {\n                \"DEMOdz\" : \"Glioblastoma (DEMO)\",\n                \"TCGAbrain\": \"Brain (TCGA)\",\n                \"TCGAbrca\": \"Breast (TCGA)\",\n                \"TCGAcoadread\": \"Colorectal (TCGA)\",\n                \"TCGAgbm\": \"Glioblastoma (TCGA)\",\n                \"TCGAhnsc\": \"Head + Neck (TCGA)\",\n                \"TCGAlgg\" : \"Lower Grade Glioma (TCGA)\",\n                \"TCGAluad\": \"Lung Adenocarcinoma (TCGA)\",\n                \"TCGAlung\": \"Lung (TCGA)\",\n                \"TCGAlusc\": \"Lung Sasquamous Cell (TCGA)\",\n                \"TCGApaad\": \"Pancreas (TCGA)\",\n                \"TCGAprad\": \"Prostate (TCGA)\",\n                \"UWbrain\":  \"Brain (UW)\",\n                \"MSKbrain\": \"Brain (MSK)\"\n            };\n\n            // Load Datasets\n            vm.datasets = osApi.getUserApi().getUser().datasets.map(function(item){\n                    return {name: this[item], id: item}\n                }, nameMap);\n        }\n    }\n})();\n\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .run(runBlock);\n\n    /** @ngInject */\n    function runBlock($rootScope, $state, $window, $exceptionHandler, osApi) { //, $log\n\n        // Route Errors To Angular\n        $window.onerror = function handleGlobalError( message, fileName, lineNumber, columnNumber, error ) {\n            if ( ! error ) {\n                error = new Error( message );\n                error.fileName = fileName;\n                error.lineNumber = lineNumber;\n                error.columnNumber = ( columnNumber || 0 );\n            }\n            $exceptionHandler( error );\n        }\n        \n        // Actions To Take On State Change\n        var off = $rootScope.$on('$stateChangeStart', function(event, toState) {\n\n            // Hide Busy Cursor\n            osApi.setBusy(false);\n\n            // Reset DataTable Custom Filters\n            angular.element.fn.DataTable.ext.search = [];\n\n            // Route unauthenticated users to landing page\n            if (toState.authenticate && !osApi.getUserApi().getUser().authenticated) {\n                 $state.transitionTo(\"landing\");\n                 event.preventDefault();\n            }\n            \n        });\n\n        $rootScope.$on('$destroy', off)\n    }\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .config(routerConfig);\n\n    /** @ngInject */\n    function routerConfig($stateProvider, $urlRouterProvider) {\n\n\n        $stateProvider\n            .state('test',{\n                url: '/test',\n                template: '<os-test>',\n                authenticate: false\n            })\n            .state('landing', {\n                url: '/',\n                template: '<os-landing>',\n                authenticate: false\n            })\n            .state('help', {\n                url: '/help',\n                template: '<os-help>',\n                authenticate: false\n            })\n            .state('datasource', {\n                url: '/datasource',\n                template: '<os-datasource>',\n                authenticate: true\n            })\n            .state('tools', {\n                url: '/tools/{datasource}',\n                template: '<os-tools>',\n                authenticate: true\n            })\n            .state('metadata', {\n                url: '/metadata/{datasource}',\n                template: '<os-metadata>',\n                authenticate: true\n            })\n            .state('history', {\n                url: '/history/{datasource}',\n                template: '<os-history>',\n                authenticate: true\n            })\n            .state('plsr', {\n                url: '/plsr/{datasource}',\n                template: '<os-plsr>',\n                authenticate: true\n            })\n            .state('pca', {\n                url: '/pca/{datasource}',\n                template: '<os-pca>',\n                authenticate: true\n            })\n            .state('pca3d', {\n                url: '/pca3d/{datasource}',\n                template: '<os-pca3d>',\n                authenticate: true\n            })\n            .state('markers', {\n                url: '/markers/{datasource}',\n                template: '<os-markers>',\n                authenticate: true\n            })\n            .state('pathways', {\n                url: '/pathways/{datasource}',\n                template: '<os-pathways>',\n                authenticate: true\n            })\n            .state('timelines', {\n                url: '/timelines/{datasource}',\n                template: '<os-timelines>',\n                authenticate: true\n            })\n            .state('survival', {\n                url: '/survival/{datasource}',\n                template: '<os-survival>',\n                authenticate: true\n            })\n            .state('oncoprint', {\n                url: '/oncoprint/{datasource}',\n                template: '<os-oncoprint>',\n                authenticate: false\n            })\n            .state('compare', {\n                url: '/compare/{datasource}',\n                template: '<os-compare>',\n                authenticate: true\n            });\n\n        $urlRouterProvider.otherwise('/');\n    }\n\n})();\n\n/* global d3:false, $:false, signals:false, cytoscape:false, SockJS:false, document:false, moment:false, _:false, THREE:false */\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .constant('moment', moment)\n        .constant('d3', d3)\n        .constant('cytoscape', cytoscape)\n        .constant('signals', signals)\n        .constant('SockJS', SockJS)\n        .constant('THREE', THREE)\n        .constant('$', $)\n        .constant('_', _);\n\n    // Util Functions\n    Number.prototype.map = function (in_min, in_max, out_min, out_max) {\n        return (this - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;\n    }\n})();\n(function() {\n    'use strict';\n\n    angular\n        .module('oncoscape')\n        .config(config);\n\n    /** @ngInject */\n    function config($logProvider) {\n        // Enable log\n        $logProvider.debugEnabled(true);\n    }\n})();\n\nangular.module(\"oncoscape\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/components/compare/compare.html\",\"<section class=\\\"compare-v50\\\"><os-plsr></os-plsr></section><section class=\\\"compare-v50\\\"><os-pca></os-pca></section>\");\n$templateCache.put(\"app/components/datasource/datasource.html\",\"<section class=\\\"datasource container-fluid\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-8 col-md-6\\\"><h1>Data Sources</h1><p>Oncoscape has analyzed and curated the following datasets hosted by The Cancer Genome Atlas (TCGA). Raw data sets for these and other available disease sites can be found at <a href=\\\"https://tcga-data.nci.nih.gov/tcga/\\\">TCGA Data Portal</a>.</p></div></div><div class=\\\"row\\\"><ul><li ng-repeat=\\\"dataset in vm.datasets\\\" class=\\\"col-xs-12 col-sm-6 col-lg-4\\\" ng-click=\\\"vm.explore(\\'tools\\',dataset.id)\\\"><img class=\\\"datasource-img\\\" ng-src=\\\"/assets/images/datasets/{{dataset.id}}.png\\\"><h3 class=\\\"datasource-lbl\\\">{{dataset.name}}</h3><nobr><a href=\\\"\\\">Explore</a></nobr></li></ul></div></section>\");\n$templateCache.put(\"app/components/header/header.html\",\"<div class=\\\"header\\\"><nav class=\\\"navbar navbar-inverse navbar-fixed-top\\\"><div class=\\\"container-fluid\\\"><div class=\\\"navbar-header\\\"><button type=\\\"button\\\" class=\\\"navbar-toggle collapsed\\\" data-toggle=\\\"collapse\\\" data-target=\\\"#bs-example-navbar-collapse-1\\\" aria-expanded=\\\"false\\\"><span class=\\\"sr-only\\\">Toggle navigation</span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span> <span class=\\\"icon-bar\\\"></span></button> <a class=\\\"navbar-brand\\\" href=\\\"#\\\"><img alt=\\\"Brand\\\" src=\\\"/assets/images/logo.png\\\" style=\\\"max-height:50px;\\\"></a></div><div class=\\\"collapse navbar-collapse\\\" id=\\\"bs-example-navbar-collapse-1\\\" ng-if=\\\"vm.showMenu\\\"><ul class=\\\"nav navbar-nav navbar-right\\\"><li><a href=\\\"#datasource\\\"><span class=\\\"glyphicon glyphicon-th\\\"></span>Data Sources</a></li><li><a href=\\\"#help\\\"><span class=\\\"glyphicon glyphicon-question-sign\\\"></span>Help</a></li><li><a href=\\\"\\\" ng-click=\\\"vm.logoutClick()\\\"><span class=\\\"glyphicon glyphicon-user\\\"></span>Logout</a></li></ul></div></div><div class=\\\"nav-divider\\\"></div></nav></div><a href=\\\"https://github.com/FredHutch/Oncoscape/labels/help%20wanted\\\" class=\\\"github\\\" tooltip=\\\"Submit Issues\\\" style=\\\"text-align: right;\\\"><div class=\\\"logo\\\"><svg aria-hidden=\\\"true\\\" class=\\\"octicon octicon-mark-github\\\" height=\\\"28\\\" role=\\\"img\\\" version=\\\"1.1\\\" viewbox=\\\"0 0 16 16\\\" width=\\\"28\\\"><path d=\\\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59 0.4 0.07 0.55-0.17 0.55-0.38 0-0.19-0.01-0.82-0.01-1.49-2.01 0.37-2.53-0.49-2.69-0.94-0.09-0.23-0.48-0.94-0.82-1.13-0.28-0.15-0.68-0.52-0.01-0.53 0.63-0.01 1.08 0.58 1.23 0.82 0.72 1.21 1.87 0.87 2.33 0.66 0.07-0.52 0.28-0.87 0.51-1.07-1.78-0.2-3.64-0.89-3.64-3.95 0-0.87 0.31-1.59 0.82-2.15-0.08-0.2-0.36-1.02 0.08-2.12 0 0 0.67-0.21 2.2 0.82 0.64-0.18 1.32-0.27 2-0.27 0.68 0 1.36 0.09 2 0.27 1.53-1.04 2.2-0.82 2.2-0.82 0.44 1.1 0.16 1.92 0.08 2.12 0.51 0.56 0.82 1.27 0.82 2.15 0 3.07-1.87 3.75-3.65 3.95 0.29 0.25 0.54 0.73 0.54 1.48 0 1.07-0.01 1.93-0.01 2.2 0 0.21 0.15 0.46 0.55 0.38C13.71 14.53 16 11.53 16 8 16 3.58 12.42 0 8 0z\\\"></path></svg></div></a>\");\n$templateCache.put(\"app/components/footer/footer.html\",\"<footer class=\\\"footer container\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 col-sm-6\\\"><img class=\\\"footer-logo\\\" src=\\\"/assets/images/logo-fred-hutchinson-cancer-research-center.png\\\" alt=\\\"Fred Hutchinson Cancer Research Center\\\"> <img class=\\\"footer-logo\\\" src=\\\"/assets/images/logo-university-of-washington-medicine.png\\\" alt=\\\"UW Medicine\\\"> <img class=\\\"footer-logo\\\" src=\\\"/assets/images/logo-seattle-cancer-care-alliance.png\\\" alt=\\\"Seattle Cancer Care Alliance\\\"></div><div class=\\\"col-xm-12 col-sm-6 text-right\\\"><a href=\\\"https://www.facebook.com/STTRCancer\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-facebook-out.png\\\" alt=\\\"Facebook\\\"></a> <a href=\\\"https://twitter.com/sttrcancer\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-twitter-out.png\\\" alt=\\\"Twitter\\\"></a> <a href=\\\"https://plus.google.com/+fredhutch/videos\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-youtube-out.png\\\" alt=\\\"YouTube\\\"></a> <a href=\\\"http://instagram.com/FredHutch\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-instagram-out.png\\\" alt=\\\"Instagram\\\"></a> <a href=\\\"http://www.linkedin.com/company/fred-hutchinson-cancer-research-center/careers?trk=top_nav_careers\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-linkedin-out.png\\\" alt=\\\"LinkedIn\\\"></a> <a href=\\\"https://plus.google.com/116048577052683099154/posts\\\" target=\\\"_blank\\\"><img class=\\\"footer-icon\\\" src=\\\"/assets/images/sttr-google-out.png\\\" alt=\\\"Google+\\\"></a></div></div></footer>\");\n$templateCache.put(\"app/components/help/help.html\",\"<section class=\\\"tools container\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-8 col-md-6\\\"><br><br><br></div></div><div class=\\\"row\\\"><div class=\\\"col-xs-12 col-md-7\\\"><h2 style=\\\"margin:0px;margin-bottom: 20px;\\\">Now Playing &mdash; Lorum Ipsum</h2><div style=\\\"background-color:#000;text-align: center;\\\"><video width=\\\"640\\\" height=\\\"360\\\" controls=\\\"\\\" style=\\\"background-color: #000;max-width: 100%;\\\"></video></div><h2>Video Title</h2><p>Transcription At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat</p></div><div class=\\\"col-xs-12 col-md-5\\\" style=\\\"padding-left: 40px;\\\"><h2 style=\\\"margin:0px;\\\">Oncoscape Videos</h2><ul><li ng-repeat=\\\"video in vm.videos\\\" style=\\\"clear: both;\\\"><div style=\\\"width:30%;height:90px;background-color:#EEE;display:inline-block;float:left;margin-bottom: 20px;text-align: center;cursor: pointer;\\\"><span class=\\\"glyphicon glyphicon-play-circle\\\" style=\\\"font-size: 30px;padding-top:30px; color:#FFF\\\"></span></div><div style=\\\"width:69%;display: inline-block;float:left;padding-left: 10px;\\\"><h3 class=\\\"tools-lbl\\\" style=\\\"margin:0px;\\\">{{video.name}}</h3><p>{{video.desc}}</p><a href=\\\"\\\" ng-click=\\\"vm.explore(tool.route, vm.datasource)\\\">Watch Video</a></div></li></ul></div></div></section>\");\n$templateCache.put(\"app/components/history/history.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray caption=\\\"Patients\\\" content=\\\"tray-content-block\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Filters</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Age At Diagnosis</label><div range-slider=\\\"\\\" min=\\\"vm.diagnosisMinValue\\\" model-min=\\\"vm.diagnosisMin\\\" max=\\\"vm.diagnosisMaxValue\\\" model-max=\\\"vm.diagnosisMax\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.applyFilter(\\'Diagnosis\\')\\\"></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Survival</label><div range-slider=\\\"\\\" min=\\\"vm.survivalMinValue\\\" model-min=\\\"vm.survivalMin\\\" max=\\\"vm.survivalMaxValue\\\" model-max=\\\"vm.survivalMax\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.applyFilter(\\'Survival\\')\\\"></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Search</label> <input type=\\\"text\\\" class=\\\"ngrs-range-slider\\\" style=\\\"width: 100%;\\\" ng-model=\\\"vm.search\\\"></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Patient Data</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><table id=\\\"history-datatable\\\" class=\\\"table table-striped table-bordered dt-responsive nowrap\\\" cellspacing=\\\"0\\\" width=\\\"100%\\\"><thead><tr><th ng-repeat=\\\"col in vm.colnames\\\">{{col}}</th></tr></thead><tbody><tr ng-repeat=\\\"row in vm.rows\\\"><td ng-repeat=\\\"datum in row track by $index\\\">{{datum}}</td></tr></tbody></table></div></section>\");\n$templateCache.put(\"app/components/landing/landing.html\",\"<div class=\\\"landing container\\\"><div class=\\\"row\\\" style=\\\"padding-top:20px;\\\"><h2>Bridging Cancer Research and Clinical Care</h2></div><div class=\\\"row\\\" style=\\\"padding-top:20px;\\\"><div class=\\\"col-sm-8\\\"><p>Oncoscape is developed at the Fred Hutchinson Cancer Research Center under the auspices of the Solid Tumor Translational Research initiative. Oncoscape is a web-based, menu-driven analysis and visualization platform for large-scale, heterogeneous clinical and molecular patient timeline data as exemplified by the Fred Hutch HIDRA database. Oncoscape vision and development is managed by a small team comprising: <a href=\\\"https://www.fredhutch.org/en/labs/profiles/holland-eric.html\\\">Eric Holland</a>, <a href=\\\"http://www.sttrcancer.org/en/contact-us/horse-grant-bio.html\\\">Desert Horse-Grant</a>, <a href=\\\"https://www.linkedin.com/in/lisa-mcferrin-9758b029\\\">Lisa McFerrin</a>, <a href=\\\"https://www.linkedin.com/in/hbolouri\\\">Hamid Bolouri</a>, <a href=\\\"https://www.linkedin.com/in/jenny-zhang-ba62a2104\\\">Jenny Zhang</a>, <a href=\\\"https://www.linkedin.com/in/gretchenh\\\">Gretchen Heinrich</a>, <a href=\\\"https://www.linkedin.com/in/robert-mcdermott-a77b9011\\\">Robert McDermott</a> and <a href=\\\"https://www.linkedin.com/in/zager\\\">Michael Zager</a>.</p><p class=\\\"\\\">Through its easy point-and-click browser interface, Oncoscape will become an essential tool for doctors and researchers interested in:</p><ul class=\\\"\\\"><li>Comparing patients or populations across an array of features, like genetic alterations (CNV, IHC, sequencing, expression) or clinical elements (treatment regimens, diagnostics, outcomes)</li><li>Defining cohorts based on selected traits – identifying “patients like me”</li><li>Aligning patient histories according to timeline events: diagnosis, treatment, progression, survival</li><li>Performing powerful and integrated statistical analysis: Principle Component Analysis, Partial least squares regression, Kaplan-Meier curves, enrichment scores</li><li>Creating high quality visualizations of molecular/clinical data</li></ul><p class=\\\"\\\">By providing a portal equipped with rich data, powerful statistics and a simple interface, Oncoscape not only empowers users to quickly answer questions themselves but also expedites the process of discovering novel patterns and relationships. This can lead to numerous possible findings, including optimized drug therapies for individual patients, identification of novel regulatory pathways, or even the need to reassess adherence strategies.</p></div><div class=\\\"col-sm-4\\\"><os-login></os-login></div></div></div>\");\n$templateCache.put(\"app/components/loader/loader.html\",\"<div class=\\\"loader-modal\\\"><div class=\\\"loader\\\"><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__bar\\\"></div><div class=\\\"loader__ball\\\"></div></div></div>\");\n$templateCache.put(\"app/components/login/login.html\",\"<form class=\\\"login\\\"><h3 class=\\\"login-header\\\">Login</h3><div class=\\\"login-body\\\"><div class=\\\"alert alert-danger\\\" role=\\\"alert\\\" ng-show=\\\"vm.hasError\\\"><span class=\\\"glyphicon glyphicon-exclamation-sign\\\" aria-hidden=\\\"true\\\"></span> <span class=\\\"sr-only\\\">Error:</span> Invalid Credentials</div><fieldset class=\\\"form-group\\\"><span for=\\\"domain\\\" class=\\\"small\\\">Affiliation</span><select id=\\\"domain\\\" class=\\\"form-control\\\" ng-options=\\\"option.name for option in vm.domains track by option.name\\\" ng-model=\\\"vm.user.domain\\\"></select></fieldset><fieldset class=\\\"form-group\\\"><span class=\\\"form-control-label small\\\" for=\\\"username\\\">Username</span> <input id=\\\"username\\\" class=\\\"form-control input-sm\\\" type=\\\"text\\\" placeholder=\\\"Username\\\" ng-model=\\\"vm.user.name\\\"></fieldset><fieldset class=\\\"form-group\\\" ng-show=\\\"vm.user.domain.name!=\\'Guest\\'\\\"><span class=\\\"form-control-label small\\\" for=\\\"password\\\">Password</span> <input id=\\\"password\\\" class=\\\"form-control\\\" type=\\\"password\\\" placeholder=\\\"Password\\\" ng-model=\\\"vm.user.password\\\"></fieldset><button class=\\\"btn btn-default\\\" ng-click=\\\"vm.login()\\\">Login</button></div></form>\");\n$templateCache.put(\"app/components/markers/markers.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize()\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Options</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Interactive Mode</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.optInteractiveMode.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optInteractiveModes\\\" ng-click=\\\"vm.optInteractiveMode=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\" ng-if=\\\"vm.optInteractiveMode.name==\\'Commands\\'\\\"><label>Patients</label><br><div class=\\\"btn-group btn-group-md\\\" role=\\\"group\\\"><button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Select Connected Genes\\\" ng-click=\\\"vm.optCommands.selectConnectedGenes()\\\"><span class=\\\"fa fa-code-fork\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Invert Patient Selection\\\" ng-click=\\\"vm.optCommands.invertPatientSelection()\\\"><span class=\\\"fa fa-random\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Select All Patients\\\" ng-click=\\\"vm.optCommands.selectPatients()\\\"><span class=\\\"fa fa-dot-circle-o\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Deselect Patients\\\" ng-click=\\\"vm.optCommands.deselectPatients()\\\"><span class=\\\"fa fa-circle-o\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Show Selected Patient Edges\\\" ng-click=\\\"vm.optCommands.showPatientEdges()\\\"><span class=\\\"fa fa-link\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Hide Edges\\\" ng-click=\\\"vm.optCommands.hidePatientEdges()\\\"><span class=\\\"fa fa-unlink\\\" aria-hidden=\\\"true\\\"></span></button><div class=\\\"btn-group\\\" role=\\\"group\\\"><button type=\\\"button\\\" class=\\\"btn btn-default dropdown-toggle\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"false\\\" title=\\\"More Options\\\"><span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu pull-right\\\"><li ng-click=\\\"vm.optCommand.showGenesInCommon()\\\">Select Genes In Common</li></ul></div></div></div><div class=\\\"col-xs-12 form-item\\\" ng-if=\\\"vm.optInteractiveMode.name==\\'Commands\\'\\\"><label>Genes</label><br><div class=\\\"btn-group btn-group-md\\\" role=\\\"group\\\"><button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Select Connected Patients\\\" ng-click=\\\"vm.optCommands.selectConnectedPatients()\\\"><span class=\\\"fa fa-code-fork\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Invert Gene Selection\\\" ng-click=\\\"vm.optCommands.invertGeneSelection()\\\"><span class=\\\"fa fa-random\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Select All Genes\\\" ng-click=\\\"vm.optCommands.selectGenes()\\\"><span class=\\\"fa fa-dot-circle-o\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Deselect Genes\\\" ng-click=\\\"vm.optCommands.deselectGenes()\\\"><span class=\\\"fa fa-circle-o\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Show Selected Gene Edges\\\" ng-click=\\\"vm.optCommands.showGeneEdges()\\\"><span class=\\\"fa fa-link\\\" aria-hidden=\\\"true\\\"></span></button> <button type=\\\"button\\\" class=\\\"btn btn-default btn-no-focus\\\" title=\\\"Hide Selected Gene Edges\\\" ng-click=\\\"vm.optCommands.hideGeneEdges()\\\"><span class=\\\"fa fa-unlink\\\" aria-hidden=\\\"true\\\"></span></button><div class=\\\"btn-group\\\" role=\\\"group\\\"><button type=\\\"button\\\" class=\\\"btn btn-default dropdown-toggle\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"false\\\" title=\\\"More Options\\\"><span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu pull-right\\\"><li ng-click=\\\"vm.optCommand.showPatientsInCommon()\\\">Select Patients In Common</li></ul></div></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-right:5px\\\"><label>Global</label><div class=\\\"btn-group\\\" role=\\\"group\\\" style=\\\"display: block\\\"><button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.optCommands.invertAll()\\\" style=\\\"width:33.333%\\\" title=\\\"Invert Selections\\\"><span class=\\\"fa fa-random\\\" aria-hidden=\\\"true\\\"></span></button> <button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.optCommands.deselectAll()\\\" style=\\\"width:33.333%\\\" title=\\\"Deselect All\\\"><span class=\\\"fa fa-circle-o\\\" aria-hidden=\\\"true\\\"></span></button> <button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.optCommands.hideAllEdges()\\\" style=\\\"width:33.333%\\\" title=\\\"Hide All Edges\\\"><span class=\\\"fa fa-unlink\\\" aria-hidden=\\\"true\\\"></span></button></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-left:5px\\\"><label>Zoom</label><div class=\\\"btn-group\\\" role=\\\"group\\\" style=\\\"display: block\\\"><button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.optCommands.zoomReset()\\\" style=\\\"width:50%; font-weight: 300;\\\" title=\\\"Zoom Reset\\\">Reset</button> <button class=\\\"btn btn-default btn-no-focus\\\" type=\\\"button\\\" ng-click=\\\"vm.optCommands.zoomFit()\\\" style=\\\"width:50%; font-weight: 300;\\\" title=\\\"Zoom Selection\\\">Fit</button></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-right:5px\\\"><label>Patient Layout</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.optPatientLayout.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optPatientLayouts\\\" ng-click=\\\"vm.optPatientLayout=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-6 form-item\\\" style=\\\"padding-left:5px\\\"><label>Patient Color</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.optNodeColor.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optNodeColors\\\" ng-click=\\\"vm.optNodeColor=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Patient Options</label><div ng-repeat=\\\"item in vm.legandNodes\\\" class=\\\"legend-bar btn btn-default filter-button\\\" style=\\\"border-color:{{item.color}};position:relative\\\">{{item.name}} ({{item.cnt}} Selected)<div class=\\\"markers-button-slider\\\"><div class=\\\"markers-button-slider-circle\\\" ng-click=\\\"vm.updateNode(item, true); $event.stopPropagation();\\\" style=\\\"background-color:{{item.color}};border-color:red;\\\"></div><div class=\\\"markers-button-slider-circle\\\" ng-click=\\\"vm.updateNode(item, false); $event.stopPropagation();\\\" style=\\\"background-color:{{item.color}};\\\"></div></div></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Edge Options</label><div ng-repeat=\\\"item in vm.optEdgeColors\\\" class=\\\"legend-bar btn btn-default filter-button {{item.class}}\\\" style=\\\"position:relative\\\">{{item.name}}<div class=\\\"markers-button-slider\\\"><div class=\\\"markers-button-slider-rect\\\" ng-click=\\\"vm.updateEdge(item, \\'Highlight\\'); $event.stopPropagation();\\\" style=\\\"background-color:{{item.color}};\\\"></div><div class=\\\"markers-button-slider-rect\\\" ng-click=\\\"vm.updateEdge(item, \\'Show\\'); $event.stopPropagation();\\\" style=\\\"background-color:#3993fa\\\"></div><div class=\\\"markers-button-slider-rect\\\" ng-click=\\\"vm.updateEdge(item, \\'Hide\\'); $event.stopPropagation();\\\" style=\\\"background-color:#FFF\\\"></div></div></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Patient Search {{vm.searchPatientResult}}</label> <input type=\\\"text\\\" class=\\\"form-control\\\" ng-model=\\\"vm.searchPatient\\\" placeholder=\\\"Patient Id\\\"></div><div class=\\\"col-xs-12 form-item\\\"><label>Gene Search {{vm.searchGeneResult}}</label> <input type=\\\"text\\\" class=\\\"form-control\\\" ng-model=\\\"vm.searchGene\\\" placeholder=\\\"Gene Name\\\"></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div id=\\\"markers-chart\\\" class=\\\"markers-chart\\\"></div><div style=\\\"position:absolute;top:10px;left:50px;\\\"><h2 class=\\\"h2-tool\\\">Patients + Markers</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3></div></section><ul id=\\\"gene-ctx-menu\\\" class=\\\"dropdown-menu markers-ctx-menu\\\" role=\\\"menu\\\" ng-show=\\\"vm.optCtxGeneShow\\\"><li class=\\\"title\\\"></li><li ng-repeat=\\\"item in vm.optCommandGene\\\" ng-click=\\\"item.cmd()\\\">{{item.name}}</li></ul><ul id=\\\"patient-ctx-menu\\\" class=\\\"dropdown-menu markers-ctx-menu\\\" role=\\\"menu\\\" ng-show=\\\"vm.optCtxPatientShow\\\"><li class=\\\"title\\\"></li><li ng-repeat=\\\"item in vm.optCommandPatient\\\" ng-click=\\\"item.cmd()\\\">{{item.name}}</li></ul><section ng-show=\\\"vm.gene\\\" class=\\\"container-fluid\\\" style=\\\"position:absolute;bottom:0px;margin-right: 300px;z-index: 999;pointer-events: none;\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 legend\\\" style=\\\"background-color: rgba(255,255,255,.8)\\\"><ul style=\\\"float:left;\\\"><li class=\\\"legend-section\\\">{{vm.gene.name}}</li><li>CnGain.1: {{vm.gene.cng1}}</li><li>CnGain.2: {{vm.gene.cng2}}</li><li>CnLoss.1: {{vm.gene.cnl1}}</li><li>CnLoss.2: {{vm.gene.cnl2}}</li></ul></div></div></section><section ng-show=\\\"vm.patient\\\" class=\\\"container-fluid\\\" style=\\\"position:absolute;bottom:0px;margin-right: 300px;z-index: 999;pointer-events: none;\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 legend\\\" style=\\\"background-color: rgba(255,255,255,.8)\\\"><ul style=\\\"float:left;\\\"><li class=\\\"legend-section\\\">{{vm.patient[0][0]}}</li><li>GENDER: {{vm.patient[0][2]}}</li><li>STATUS: {{vm.patient[0][6]}}</li><li>DIAGNOSED: {{vm.patient[0][4]}} years old</li><li>SURVIVED: {{vm.patient[0][3]}} years</li><li>PROGRESSION: {{vm.patient[0][5]}}</li></ul></div></div></section>\");\n$templateCache.put(\"app/components/metadata/metadata.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\"></os-tool-menu><os-tray caption=\\\"Patients\\\" content=\\\"tray-content-block\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Search</h2></div><div class=\\\"col-xs-12 form-item\\\"><input type=\\\"text\\\" class=\\\"ngrs-range-slider ngrs-range-slider-no-pad\\\" style=\\\"width:100%\\\" ng-model=\\\"vm.search\\\"></div><div class=\\\"col-xs-12 form-label\\\"><h2>Information</h2><label>Raw data was provided by <a href=\\\"http://cancergenome.nih.gov/\\\">The Cancer Genome Atlas</a>. Processing of data was conducted by the <a href=\\\"http://www.sttrcancer.org/en.html\\\">Solid Tumor Translational Research Organization</a> in conjuntion with the <a href=\\\"http://www.fhcrc.org\\\">Fred Hutchinson Cancer Research Center</a>, <a href=\\\"http://www.uwmedicine.org/\\\">UW Medicine</a> and <a href=\\\"http://www.scca.org\\\">The Seattle Cancer Care Alliance</a>.</label></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">{{vm.dataset}} Metadata</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><table id=\\\"metadata-datatable\\\" class=\\\"table table-striped table-bordered dt-responsive nowrap\\\" cellspacing=\\\"0\\\" width=\\\"100%\\\"><thead><tr><th ng-repeat=\\\"col in vm.colnames\\\">{{col}}</th></tr></thead><tbody><tr ng-repeat=\\\"row in vm.rows\\\"><td ng-repeat=\\\"datum in row track by $index\\\">{{datum}}</td></tr></tbody></table></div></section>\");\n$templateCache.put(\"app/components/oncoprint/oncoprint.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Cohorts</h2></div><div class=\\\"col-sm-12 form-item\\\"><label>Patient Cohorts</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" style=\\\"width: 34px;display: inline-block; margin-right:0px; float:right\\\" ng-click=\\\"vm.addCohortPatient()\\\">+</button> <button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\" style=\\\"width: 220px;display: inline-block; margin-right:0px;\\\">{{vm.optCohortPatient.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optCohortPatients\\\" ng-click=\\\"vm.optCohortPatient=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-sm-12 form-item\\\"><label>Gene Cohorts</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" style=\\\"width: 34px;display: inline-block; margin-right:0px; float:right\\\" ng-click=\\\"vm.addCohortGene()\\\">+</button> <button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\" style=\\\"width: 220px;display: inline-block; margin-right:0px;\\\">{{vm.optCohortGene.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optCohortGenes\\\" ng-click=\\\"vm.optCohortGene=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-label\\\"><h2>Legend</h2><span class=\\\"legend\\\"></span> <span class=\\\"oncoprint-label-col1\\\" id=\\\"legend\\\"></span></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><div id=\\\"oncoprintDiv\\\" class=\\\"oncoprint\\\"><div id=\\\"oncoprintInstructions\\\" style=\\\"font-size:150%\\\">Please select and send up to 350 genes and patients from another tab, such as Markers &amp Patients, to populate the display.</div><div id=\\\"oncoprintErrorSection\\\" style=\\\"font-size:150%\\\" ng-show=\\\"vm.errorMessage!=\\'\\'\\\">{{vm.errorMessage}}</div><div id=\\\"oncoprintControlsDiv\\\"><div id=\\\"onc\\\"></div><button id=\\\"toggle_whitespace\\\">Toggle Whitespace</button> <button id=\\\"reduce_cell_width\\\">Reduce Cell Width</button></div></div></div></section>\");\n$templateCache.put(\"app/components/pathways/pathways.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortGene()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Options</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Search</label> <input type=\\\"text\\\" class=\\\"form-control\\\" ng-model=\\\"vm.search\\\"></div><div class=\\\"col-xs-12 form-label\\\"><h2>Legend</h2><span class=\\\"legend-bar\\\" style=\\\"border-color: green\\\">Activation</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: red\\\">Inhibition</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: #38347B\\\">Modification</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: #056ce1\\\">Genes</span></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Pathways</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"gbm-chart\\\" class=\\\"pathways-chart\\\"></div></div></section><div class=\\\"modal fade pathways\\\" id=\\\"gbm-webpage\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"myModalLabel\\\"><div class=\\\"modal-dialog\\\" role=\\\"document\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button><h4 class=\\\"modal-title\\\" id=\\\"myModalLabel\\\">{{vm.tip}}</h4></div><iframe class=\\\"modal-iframe\\\" ng-src=\\\"{{vm.frame}}\\\"></iframe></div></div></div>\");\n$templateCache.put(\"app/components/pca/pca.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Filters</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Gene Set</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.geneSet}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\"><li ng-repeat=\\\"item in vm.geneSets\\\" ng-click=\\\"vm.geneSet=item\\\">{{item}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Search</label> <input type=\\\"text\\\" class=\\\"ngrs-range-slider\\\" style=\\\"width: 100%;\\\" ng-model=\\\"vm.search\\\"></div><div class=\\\"col-xs-6 form-label\\\"><h2>Legend</h2><span class=\\\"circle\\\" style=\\\"background-color:black;width:10px;height: 10px;margin-right:10px;\\\"></span>Patients</div><div class=\\\"col-xs-6 form-label\\\"><h2>Variance</h2>PC1: {{vm.pc1}}%<br>PC2: {{vm.pc2}}%</div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Principal Component Analysis</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"pca-chart\\\" class=\\\"pca\\\"></div></div></section>\");\n$templateCache.put(\"app/components/pca3d/pca3d.html\",\"<section id=\\\"pca-chart\\\" class=\\\"pca container-fluid\\\" style=\\\"position: absolute;left:0px;top:0px;right: 0px;bottom: 0px;padding:0px;margin:0px;overflow: hidden;\\\"></section>\");\n$templateCache.put(\"app/components/plsr/plsr.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortGene()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Filters</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Gene Set</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.geneSet}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\"><li ng-repeat=\\\"item in vm.geneSets\\\" ng-click=\\\"vm.geneSet=item\\\">{{item}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Age At Diagnosis</label><div range-slider=\\\"\\\" min=\\\"vm.deathMinValue\\\" model-min=\\\"vm.deathMinFilter\\\" max=\\\"vm.deathMaxValue\\\" model-max=\\\"vm.deathMaxFilter\\\" prevent-equal-min-max=\\\"true\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.update()\\\"></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Survival</label><div range-slider=\\\"\\\" min=\\\"vm.survivalMinValue\\\" model-min=\\\"vm.survivalMinFilter\\\" max=\\\"vm.survivalMaxValue\\\" model-max=\\\"vm.survivalMaxFilter\\\" prevent-equal-min-max=\\\"\\\" show-values=\\\"true\\\" attach-handle-values=\\\"true\\\" on-handle-up=\\\"vm.update()\\\"></div></div><div class=\\\"col-xs-12 form-label\\\"><h2>Legend</h2><span class=\\\"legend-bar\\\" style=\\\"border-color: #1396de\\\">Age At Diagnosis</span> <span class=\\\"legend-bar\\\" style=\\\"border-color: #38347b\\\">Survial</span> <span class=\\\"legend\\\"><span class=\\\"legend-dot\\\" style=\\\"background-color:#000\\\"></span>Genes</span></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Partial Least Squares Regression</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"plsr-chart\\\" class=\\\"plsr\\\"></div></div></section><div class=\\\"modal fade plsr-webpage\\\" id=\\\"plsr-webpage\\\" tabindex=\\\"-1\\\" role=\\\"dialog\\\" aria-labelledby=\\\"myModalLabel\\\"><div class=\\\"modal-dialog\\\" role=\\\"document\\\"><div class=\\\"modal-content\\\"><div class=\\\"modal-header\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\"><span aria-hidden=\\\"true\\\">&times;</span></button><h4 class=\\\"modal-title\\\" id=\\\"myModalLabel\\\">{{vm.tip}}</h4></div><iframe class=\\\"modal-iframe\\\" ng-src=\\\"{{vm.frame}}\\\"></iframe></div></div></div>\");\n$templateCache.put(\"app/components/subnav/subnav.html\",\"<div class=\\\"subnav\\\"><div class=\\\"btn-group\\\" style=\\\"float:right\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"vm.toolsClick()\\\">Analysis Tools</button> <button type=\\\"button\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"vm.cohortClick()\\\">Cohorts</button></div><h2>{{vm.tool}} &mdash; {{vm.filter}}</h2></div>\");\n$templateCache.put(\"app/components/survival/survival.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\"></os-tool-menu><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Patient Survival</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div style=\\\"text-align: center;\\\"><img id=\\\"survival-img\\\" style=\\\"width:100%; height: auto; margin:auto;\\\"></div></div></section>\");\n$templateCache.put(\"app/components/test/test.html\",\"<div class=\\\"test\\\"><input ng-model=\\\"vm.message\\\"><br>Hello {{vm.message}}<div ng-repeat=\\\"item in vm.datasets\\\">{{item}}</div></div>\");\n$templateCache.put(\"app/components/timelines/timelines.html\",\"<os-tool-menu datasource=\\\"{{vm.datasource}}\\\" change=\\\"vm.addCohortPatient()\\\"></os-tool-menu><os-tray content=\\\"tray-content-block\\\" change=\\\"vm.resize($event)\\\"><section class=\\\"tray-content\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Options</h2></div><div class=\\\"col-xs-12 form-item\\\"><label>Align By</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.align.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.events\\\" ng-click=\\\"vm.align = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Order By</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.sort.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.features\\\" ng-click=\\\"vm.sort = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Filter</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.filter.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.filters\\\" ng-click=\\\"vm.filter = item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Timescale</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.timescale.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.timescales\\\" ng-click=\\\"vm.timescale=item\\\">{{item.name}}</li></ul></div></div><div class=\\\"col-xs-12 form-item\\\"><label>Event Colors</label> <span ng-repeat=\\\"item in vm.events\\\" class=\\\"legend-bar btn btn-default filter-button {{item.color}}\\\" ng-style=\\\"{\\'border-color\\':item.color}\\\" ng-click=\\\"vm.updateEventColor(item); $event.stopPropagation();\\\">{{item.name}} ({{item.selected ? \\'Visible\\' : \\'Hidden\\'}})</span></div><div class=\\\"col-xs-12 form-item\\\"><label>Selected Patients Display</label><div class=\\\"dropdown bs-dropdown\\\"><button class=\\\"btn btn-default dropdown-toggle\\\" type=\\\"button\\\" id=\\\"dropdownMenu1\\\" data-toggle=\\\"dropdown\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"true\\\">{{vm.optCohortMode.name}} <span class=\\\"caret\\\"></span></button><ul class=\\\"dropdown-menu\\\" aria-labelledby=\\\"dropdownMenu1\\\" style=\\\"width:100%\\\"><li ng-repeat=\\\"item in vm.optCohortModes\\\" ng-click=\\\"vm.optCohortMode=item\\\">{{item.name}}</li></ul></div></div></div></section></os-tray><section class=\\\"tray-content-block\\\"><div class=\\\"container-fluid\\\"><h2 class=\\\"h2-tool\\\">Timelines</h2><h3 class=\\\"h3-datasource\\\">{{vm.datasource}}</h3><div id=\\\"timelines-chart\\\"></div></div><div class=\\\"timeline-hover\\\" ng-if=\\\"vm.selShow\\\"><dl><dt>Event</dt><dd>{{vm.selEvent}}</dd></dl><dl><dt>Patient Id</dt><dd>{{vm.selPatient}}</dd></dl><dl ng-repeat=\\\"item in vm.selFields\\\"><dt>{{item.name}}</dt><dd>{{item.value}}</dd></dl></div></section>\");\n$templateCache.put(\"app/components/toolmenu/toolmenu.html\",\"<div><label class=\\\"tray-label tray-label-left\\\">Tools</label><section class=\\\"tool-menu tray tray-collapsed-left\\\"><div class=\\\"row\\\"><div class=\\\"col-xs-12 form-label\\\"><h2>Tools</h2></div></div><div class=\\\"row tool-menu-row\\\" ng-repeat=\\\"tool in vm.tools\\\"><a href=\\\"\\\" ng-click=\\\"vm.explore(tool.route)\\\"><img class=\\\"tool-menu-img\\\" ng-src=\\\"/assets/images/datasets/{{tool.img}}\\\"> <span class=\\\"tool-menu-lbl\\\">{{tool.name}}</span></a></div></section></div>\");\n$templateCache.put(\"app/components/tools/tools.html\",\"<section class=\\\"tools container-fluid\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-8 col-md-6\\\"><h1>Analysis Tools</h1></div></div><div class=\\\"row\\\"><ul><li ng-repeat=\\\"tool in vm.tools\\\" class=\\\"col-xs-12 col-sm-6 col-md-4 col-lg-3\\\" ng-click=\\\"vm.explore(tool.route, vm.datasource)\\\"><img class=\\\"tools-img\\\" ng-src=\\\"/assets/images/datasets/{{tool.img}}\\\"><div class=\\\"tools-copy\\\"><h3 class=\\\"tools-lbl\\\">{{tool.name}}</h3><a href=\\\"\\\">Explore</a></div></li></ul></div></section>\");\n$templateCache.put(\"app/components/tray/tray.html\",\"<div><label class=\\\"tray-label tray-label-right\\\">Options</label><div class=\\\"tray {{vm.trayClass}} tray-right\\\" locked=\\\"true\\\"><ng-transclude></ng-transclude><i class=\\\"fa fa-lock tray-sticky-icon {{vm.iconClass}}\\\" ng-click=\\\"vm.toggle()\\\"></i></div></div>\");}]);"],"sourceRoot":"/source/"}